[{"content":"ä»¥åå°†ä¼šæŠŠå»¶æ—¶æ¯”è¾ƒçš„èµ„æ–™éƒ½æœé›†åˆ°è¿™ä¸ªå¸–å­\nä»¥ä¸‹è½¬è‡ªï¼šhttps://stackoverflow.com/questions/4087280/approximate-cost-to-access-various-caches-and-main-memory\n0.5 ns - CPU L1 dCACHE reference 1 ns - speed-of-light (a photon) travel a 1 ft (30.5cm) distance 5 ns - CPU L1 iCACHE Branch mispredict 7 ns - CPU L2 CACHE reference 71 ns - CPU cross-QPI/NUMA best case on XEON E5-46* 100 ns - MUTEX lock/unlock 100 ns - own DDR MEMORY reference 135 ns - CPU cross-QPI/NUMA best case on XEON E7-* 202 ns - CPU cross-QPI/NUMA worst case on XEON E7-* 325 ns - CPU cross-QPI/NUMA worst case on XEON E5-46* 10,000 ns - Compress 1K bytes with Zippy PROCESS 20,000 ns - Send 2K bytes over 1 Gbps NETWORK 250,000 ns - Read 1 MB sequentially from MEMORY 500,000 ns - Round trip within a same DataCenter 10,000,000 ns - DISK seek 10,000,000 ns - Read 1 MB sequentially from NETWORK 30,000,000 ns - Read 1 MB sequentially from DISK 150,000,000 ns - Send a NETWORK packet CA -\u0026gt; Netherlands | | | | | | | ns| | | us| | ms| 2020: Still some improvements, prediction for 2025 ------------------------------------------------------------------------- 0.1 ns - NOP 0.3 ns - XOR, ADD, SUB 0.5 ns - CPU L1 dCACHE reference (1st introduced in late 80-ies ) 0.9 ns - JMP SHORT 1 ns - speed-of-light (a photon) travel a 1 ft (30.5cm) distance -- will stay, throughout any foreseeable future :o) ?~~~~~~~~~~~ 1 ns - MUL ( i**2 = MUL i, i )~~~~~~~~~ doing this 1,000 x is 1 [us]; 1,000,000 x is 1 [ms]; 1,000,000,000 x is 1 [s] ~~~~~~~~~~~~~~~~~~~~~~~~~ 3~4 ns - CPU L2 CACHE reference (2020/Q1) 5 ns - CPU L1 iCACHE Branch mispredict 7 ns - CPU L2 CACHE reference 10 ns - DIV 19 ns - CPU L3 CACHE reference (2020/Q1 considered slow on 28c Skylake) 71 ns - CPU cross-QPI/NUMA best case on XEON E5-46* 100 ns - MUTEX lock/unlock 100 ns - own DDR MEMORY reference 135 ns - CPU cross-QPI/NUMA best case on XEON E7-* 202 ns - CPU cross-QPI/NUMA worst case on XEON E7-* 325 ns - CPU cross-QPI/NUMA worst case on XEON E5-46* |Q\u0026gt;~~~~~ 5,000 ns - QPU on-chip QUBO ( quantum annealer minimiser 1 Qop ) 10,000 ns - Compress 1K bytes with a Zippy PROCESS 20,000 ns - Send 2K bytes over 1 Gbps NETWORK 250,000 ns - Read 1 MB sequentially from MEMORY 500,000 ns - Round trip within a same DataCenter ?~~~ 2,500,000 ns - Read 10 MB sequentially from MEMORY~~(about an empty python process to copy on spawn)~~~~ x ( 1 + nProcesses ) on spawned process instantiation(s), yet an empty python interpreter is indeed not a real-world, production-grade use-case, is it? 10,000,000 ns - DISK seek 10,000,000 ns - Read 1 MB sequentially from NETWORK ?~~ 25,000,000 ns - Read 100 MB sequentially from MEMORY~~(somewhat light python process to copy on spawn)~~~~ x ( 1 + nProcesses ) on spawned process instantiation(s) 30,000,000 ns - Read 1 MB sequentially from a DISK ?~~ 36,000,000 ns - Pickle.dump() SER a 10 MB object for IPC-transfer and remote DES in spawned process~~~~~~~~ x ( 2 ) for a single 10MB parameter-payload SER/DES + add an IPC-transport costs thereof or NETWORK-grade transport costs, if going into [distributed-computing] model Cluster ecosystem 150,000,000 ns - Send a NETWORK packet CA -\u0026gt; Netherlands | | | | | | | ns| | | us| | ms| ä¸‹å›¾å‡ºè‡ªé‡åŒ–ä½“ç³»æ–¹æ³•ï¼š å‚è€ƒï¼š\nhttps://blog.csdn.net/konghhhhh/article/details/120463330\nhttps://www.zhihu.com/question/488790905\n","date":"2023-02-25T07:14:16+08:00","permalink":"https://sanbuphy.github.io/p/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%8A%E7%9A%84%E6%97%B6%E9%97%B4/","title":"è®¡ç®—æœºä¸Šçš„æ—¶é—´"},{"content":"é€šç”¨ç±» Vtuneï¼ˆIntelï¼‰ ç®€ä»‹ VTuneæ˜¯ Intel æä¾›æ€§èƒ½åˆ†æè½¯ä»¶ï¼ŒVTune Amplifier XE 2011 é›†æˆäº†Intel VTune Performance Analyzer å’Œ Thread Profilerçš„ä¸»è¦åŠŸèƒ½ï¼ŒåŒæ—¶å¸å–äº†Performance Tool Utility è¿™ä¸ªäº§å“çš„ä¼˜ç‚¹ã€‚\nperf çœ‹ä¸åˆ°L3cache ç­‰ç¡¬ä»¶ç‰¹æ€§ï¼Œéœ€è¦æ›´å¼ºå¤§çš„å·¥å…·ã€‚\nå…¶ä¸­ï¼ŒVtune Performance Analyzeræ˜¯æ€§èƒ½åˆ†æå·¥å…·ï¼Œæ‰¾åˆ°è½¯ä»¶æ€§èƒ½çƒ­ç‚¹ã€ç“¶é¢ˆéƒ¨åˆ†ï¼›\nVtune Threading Profileræ˜¯çº¿ç¨‹æ€§èƒ½æ£€æµ‹å·¥å…· , åˆ†æè´Ÿè½½å¹³è¡¡ã€åŒæ­¥å¼€é”€è¿‡å¤§ç­‰çº¿ç¨‹ç›¸å…³çš„æ€§èƒ½é—®é¢˜ã€‚\nVTune Amplifier XE å¯ä»¥æŒ‡æ˜åœ¨ç›¸å…³çš„ç¡¬ä»¶èµ„æºä¸Šåº”ç”¨ç¨‹åºçš„æ”¹å–„ç‚¹ï¼Œå…·ä½“æ¥è¯´ï¼Œä½¿ç”¨è¯¥è½¯ä»¶ç”¨æˆ·è·å–çš„ä¿¡æ¯ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\nl ç¡®å®šå ç”¨å¤§é‡å¤„ç†å™¨æ—¶é—´çš„åŒºåŸŸ(çƒ­ç‚¹)ï¼›\nl æŸ¥çœ‹åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­çš„æƒ…å†µ(é€šè¿‡æ£€æµ‹ç»‘å®šprocess)ï¼›\nl æ²¡æœ‰å……åˆ†çš„æœ‰æ•ˆåˆ©ç”¨å¯ç”¨çš„å¤„ç†å™¨æ—¶é—´çš„ä»£ç ï¼›\nl å½±å“åº”ç”¨ç¨‹åºæ€§èƒ½çš„åŒæ­¥å¯¹è±¡ï¼›\nl åº”ç”¨ç¨‹åºæ˜¯å¦æµªè´¹æ—¶é—´åœ¨è¾“å…¥è¾“å‡ºæ“ä½œä¸Šï¼Œåœ¨å“ªé‡Œæµªè´¹çš„ï¼Œä¸ºä½•æµªè´¹ï¼›\nl å¯¹æ¯”ä¸åŒçš„åŒæ­¥æ–¹æ³•ã€ä¸åŒçš„çº¿ç¨‹æ•°é‡ã€ä¸åŒçš„ç®—æ³•ä¹‹é—´å¯¹æ€§èƒ½çš„å½±å“ï¼›\nl çº¿ç¨‹çš„æ´»åŠ¨çŠ¶æ€å’ŒçŠ¶æ€çš„è½¬æ¢ï¼›\nl ä»£ç ä¸­ä¸ç¡¬ä»¶ç›¸å…³çš„æ€§èƒ½ç“¶é¢ˆ(å¦‚ç¼“å­˜ç¼ºå¤±ã€åˆ†æ”¯é¢„æµ‹å¤±è´¥ç­‰)ï¼›\nå®˜æ–¹å®‰è£…åœ°å€ï¼š\nhttps://www.intel.com/content/www/us/en/develop/documentation/vtune-install-guide/top.html\nä½¿ç”¨æŒ‡å—ï¼š\nhttps://www.intel.com/content/www/us/en/develop/documentation/get-started-with-vtune/top/linux-os.html\npythonä»£ç åˆ†ææŒ‡å— pythonä»£ç åˆ†ææŒ‡å—ï¼š\nhttps://www.intel.com/content/www/us/en/develop/documentation/vtune-help/top/analyze-performance/code-profiling-scenarios/python-code-analysis.html\nè§†é¢‘æ•™ç¨‹ï¼š\nhttps://www.intel.com/content/www/us/en/developer/videos/performance-analysis-of-python-applications-with-intel-vtune-amplifier.html\nC++ä»£ç åˆ†ææŒ‡å— å¾…å®š\næœ¬æ¬¡åœ¨ WSL2 ubuntu20.04ç¯å¢ƒä¸‹è¿›è¡Œpythonä»£ç çš„æ€§èƒ½æµ‹è¯•ã€‚ï¼ˆå¦‚æœæ˜¯å¯æ‰§è¡Œæ–‡ä»¶å°±æ›´ç®€å•äº†ï¼Œç›´æ¥è¾“å…¥åœ°å€å°±è¡Œï¼‰\næˆ‘é€‰æ‹©çš„æ˜¯onlineå®‰è£…ï¼Œä»¤äººæƒŠå–œçš„æ˜¯WSL2å®Œç¾æ”¯æŒå®‰è£…è¿‡ç¨‹ä¸­çš„guiæ˜¾ç¤ºã€‚\nå®‰è£…å®Œäº†åsourceè¿›è¡Œå˜é‡çš„é…ç½®ï¼Œç„¶åä½¿ç”¨vtune-guiæ‰“å¼€è½¯ä»¶ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­é‡åˆ°äº†å‡ ä¸ªåŠ¨æ€é“¾æ¥åº“ç¼ºå¤±é—®é¢˜ï¼šlibatk-1.0.so.0 ä»¥åŠ libcups.so.2ä»¥åŠ libgtk-3.so.0\nåˆ†åˆ«ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£å†³ï¼šï¼ˆä¼°è®¡æ˜¯WSL2ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼‰\nsudo apt-get install -y libatk-bridge2.0-0 sudo apt-get install -y libcups2 sudo apt install -y libgtk-3-0 #å¦‚æœè¿™ä¸ªä¸ç®¡ç”¨å¯ä»¥é€‰æ‹©å®‰è£…ï¼šsudo apt install -y libgtk-3-dev sudo apt install -y libnss3-dev libgdk-pixbuf2.0-dev libgtk-3-dev libxss-dev sudo apt install -y libasound2 å³å¯æˆåŠŸè¿›å…¥ä¸»ç•Œé¢vtune-gui ï¼ˆå¦‚æœè¿›ä¸å»è¯·å…ˆç¡®ä¿ä½¿ç”¨äº†sourceï¼‰\næ¥ä¸‹æ¥é€‰æ‹© configure analysis ç„¶åè¾“å…¥è§£é‡Šå™¨åœ°å€ä»¥åŠå¯¹åº”çš„parameterï¼ˆå°±æ˜¯pythonæ–‡ä»¶çš„åœ°å€ï¼‰\nè¿›å»åå‘ç°ç²’åº¦è¿˜æ˜¯å¤ªç»†ï¼Œæˆ‘æƒ³è¦ä»£ç å’Œå‡½æ•°å±‚é¢çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ç»§ç»­å°è¯•å…¶ä»–ä¸œè¥¿ã€‚\nCPUæ€§èƒ½æŒ‡æ ‡ï¼ˆå…¶å®è¿™ä¸ªåº”è¯¥çœ‹vtuneæ›´å¥½ä¸€ç‚¹\nhttps://zhuanlan.zhihu.com/p/521597381?utm_id=0\u0026amp;utm_medium=social\u0026amp;utm_psn=1604820983428329473\u0026amp;utm_source=qzone\u0026amp;utm_oi=751534157867290624\ngoogle perftools\nhttps://www.cnblogs.com/GODYCA/archive/2013/05/28/3104281.html\npython cprofile ç›®å‰æœ€æ¨èä½¿ç”¨cprofileï¼Œæ ‡å‡†åº“æä¾›çš„å·¥å…·ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\npython -m cProfile -o out.prof my_test.py äº§ç”Ÿçš„åºåˆ—åŒ–æ–‡ä»¶å¯ä»¥é€šè¿‡ä¸€ä¸ªå«åš snakeviz çš„å·¥å…·è¿›è¡Œå¯è§†åŒ–ï¼Œå…·ä½“æ•ˆæœå¯å‚è€ƒï¼š\nå®˜ç½‘ï¼šhttps://jiffyclub.github.io/snakeviz/\ngithubï¼šhttps://github.com/jiffyclub/snakeviz/\nä½†æ˜¯è¿™ä¸ªåªé€‚åˆå¯¹å¤§éƒ¨åˆ†è‡ªå·±å†™çš„æˆ–è€…æ˜¯å®Œå…¨è‡ªå·±å®ç°çš„å°æ¨¡å—è¿›è¡Œæµ‹è¯•ï¼Œè¦åšåˆ°æ›´éšå¿ƒæ‰€æ¬²çš„æ§åˆ¶æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªå·¥å…·ï¼Œç¨³å®šåå¼€æºã€‚\nä½ åªè¦pip install snakevizï¼Œç„¶åsnakeviz out.profå°±å¯ä»¥åœ¨äº§ç”Ÿçš„ç½‘é¡µæœåŠ¡ä¸­æŸ¥çœ‹pythonæ€§èƒ½å¼€é”€çš„ç«ç„°å›¾äº†ã€‚\nline_profiler PyInstrumentä¹Ÿä¸é”™ï¼Œä½†è¿˜æ˜¯æ›´å–œæ¬¢ line_profiler\nhttps://github.com/pyutils/line_profiler\nhttps://zhuanlan.zhihu.com/p/88193562\nå¯è§†åŒ–æ’ä»¶ï¼šã€æ³¨æ„ï¼Œåªèƒ½åœ¨å•†ä¸šç‰ˆä¸Šä½¿ç”¨ï¼Œæ— æ³•åœ¨ç¤¾åŒºç‰ˆä¸Šä½¿ç”¨ã€‘\nhttps://zhuanlan.zhihu.com/p/215302708\nä½†æ˜¯è¿™é‡Œæˆ‘åªèƒ½åœ¨windowsä¸ŠæˆåŠŸæµ‹è¯•ï¼ˆwindowsä¸Šå®‰è£…çš„pythonè§£é‡Šå™¨å’Œpytcharmï¼‰ï¼ŒWSLä¸‹æ— æ³•æˆåŠŸç”Ÿæˆï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç”¨ubuntuç³»ç»Ÿè¯•è¯•çœ‹æ˜¯åªèƒ½åœ¨windowsä¸Šçœ‹è¿˜æ˜¯WSLæ”¯æŒä¸å¥½ã€‚\nä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š\n1ã€å‡†å¤‡æµ‹è¯•ä»£ç \nimport time from line_profiler_pycharm import profile @profile def fun1(a, b): print(\u0026#39;fun1\u0026#39;) print(a, b) time.sleep(1) @profile def fun2(): print(\u0026#39;fun2\u0026#39;) time.sleep(1) @profile def fun3(): print(\u0026#39;fun3\u0026#39;) time.sleep(2) @profile def fun4(): print(\u0026#39;fun4\u0026#39;) time.sleep(1) @profile def fun5(): print(\u0026#39;fun5\u0026#39;) time.sleep(1) fun4() fun1(\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;) fun2() fun3() fun5() 2ã€pycharmä¸Šå®‰è£…æ’ä»¶ï¼š\næ’ä»¶ä¸­æœç´¢line_profiler_pycharmå®‰è£…åé‡å¯å³å¯\n3ã€å®‰è£…line_profilerå’Œpycharmé€‚é…ç”¨åº“\npip install line_profiler pip install line_profiler_pycharm 4ã€å¼€å§‹è¿è¡Œ\nç„¶åå°±èƒ½çœ‹åˆ°è¯¦ç»†çš„æŠ¥å‘Šï¼š\næ›´è¯¦ç»†çš„ä»£ç çº§çš„åˆ†æä»¥åŠå†…å­˜ç“¶é¢ˆåˆ†æå¯ä»¥å‚è€ƒï¼š\nhttps://zhuanlan.zhihu.com/p/392210020\nhttps://blog.vicyu.com/2017/12/26/more-about-python-profiling/\næ¡ˆä¾‹å‚è€ƒï¼š\nhttps://www.cnblogs.com/dechinphy/p/line-profiler.html\nc++ å‡½æ•°ç²’åº¦ç›´æ¥ä½¿ç”¨ google benchmark\nhttps://blog.vicyu.com/2017/12/26/more-about-python-profiling/\nhttps://geek-docs.com/numpy/numpy-tutorials/parallelizing-a-numpy-vector-operation.html\nç®—å­å±‚çº§çš„profile å…¶ä»–å·¥å…·å¾…æ›´æ–°ã€‚\nå‚è€ƒpaddle lite\nhttps://paddlelite.paddlepaddle.org.cn/user_guides/profiler.html\npaddle liteæ”¯æŒçš„ç®—å­ä¿¡æ¯ï¼š\nhttps://paddlelite.paddlepaddle.org.cn/user_guides/opt/opt_bin.html\n","date":"2023-02-25T06:14:16+08:00","permalink":"https://sanbuphy.github.io/p/%E8%80%97%E6%97%B6%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E6%80%BB%E7%BB%93/","title":"è€—æ—¶æ€§èƒ½ä¼˜åŒ–è½¯ä»¶æµ‹è¯•æ€»ç»“"},{"content":"å…·ä½“è¯·å‚è€ƒæ–‡æ¡£ï¼š\nhttps://huggingface.co/docs/optimum/index\nå®é™…ä¸Šï¼Œhuggingface çš„optimumå°±æ˜¯å¯¹onnxruntime optimizerçš„åŒ…è£…ï¼Œ å¦‚æœä½ æ˜¯huggingfaceä¸Šé¢è·å–çš„æ¨¡å‹ï¼Œæœ‰modelå’Œconfigï¼Œé‚£å°±å¯ä»¥ç›´æ¥é€šè¿‡optimumè¿›è¡Œè¿›ä¸€æ­¥å›¾ä¼˜åŒ–å’Œç®€å•çš„fp16é‡åŒ–ã€‚å¦‚æœä½ æ˜¯è‡ªå·±çš„è‡ªç„¶è¯­è¨€æ¨¡å‹ï¼Œé‚£å°±åªèƒ½ç”¨onnxruntimeçš„optimizerè¿›è¡Œå¤„ç†äº†ã€‚ä½†å®é™…ä¸Šåº”è¯¥æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œæœ¬è´¨åªæ˜¯ä¸€å±‚åŒ…è£…ã€‚\nå®ƒçš„é»˜è®¤é€‰é¡¹å¦‚ä¸‹ï¼š\nGelu fusion with disable_gelu_fusion=False, Layer Normalization fusion with disable_layer_norm_fusion=False, Attention fusion with disable_attention_fusion=False, SkipLayerNormalization fusion with disable_skip_layer_norm_fusion=False, Add Bias and SkipLayerNormalization fusion with disable_bias_skip_layer_norm_fusion=False, Add Bias and Gelu / FastGelu fusion with disable_bias_gelu_fusion=False, Gelu approximation with enable_gelu_approximation=True. å…·ä½“å¯ä»¥åœ¨optimum/onnxruntime/configuration.pyæ–‡ä»¶ä¸­çœ‹åˆ°å¯¹åº”çš„å®ç°ï¼š\nOptimizationConfigçš„Attributesæ³¨é‡Šå†™çš„å¾ˆæ˜ç™½äº†ï¼Œæ¯ä¸ªåŠŸèƒ½çš„ä½œç”¨å’Œä¸ºä»€ä¹ˆè¦è®¾ç½®Trueå’ŒFlase\n\u0026#34;\u0026#34;\u0026#34; OptimizationConfig is the configuration class handling all the ONNX Runtime optimization parameters. There are two stacks of optimizations: 1. The ONNX Runtime general-purpose optimization tool: it can work on any ONNX model. 2. The ONNX Runtime transformers optimization tool: it can only work on a subset of transformers models. Attributes: optimization_level (`int`, defaults to 1): Optimization level performed by ONNX Runtime of the loaded graph. Supported optimization level are 0, 1, 2 and 99. - 0: will disable all optimizations - 1: will enable basic optimizations - 2: will enable basic and extended optimizations, including complex node fusions applied to the nodes assigned to the CPU or CUDA execution provider, making the resulting optimized graph hardware dependent - 99: will enable all available optimizations including layout optimizations optimize_for_gpu (`bool`, defaults to `False`): Whether to optimize the model for GPU inference. The optimized graph might contain operators for GPU or CPU only when `optimization_level` \u0026gt; 1. fp16 (`bool`, defaults to `False`): Whether all weights and nodes should be converted from float32 to float16. enable_transformers_specific_optimizations (`bool`, defaults to `True`): Whether to only use `transformers` specific optimizations on top of ONNX Runtime general optimizations. disable_gelu_fusion (`bool`, defaults to `False`): Whether to disable the Gelu fusion. disable_layer_norm_fusion (`bool`, defaults to `False`): Whether to disable Layer Normalization fusion. disable_attention_fusion (`bool`, defaults to `False`): Whether to disable Attention fusion. disable_skip_layer_norm_fusion (`bool`, defaults to `False`): Whether to disable SkipLayerNormalization fusion. disable_bias_skip_layer_norm_fusion (`bool`, defaults to `False`): Whether to disable Add Bias and SkipLayerNormalization fusion. disable_bias_gelu_fusion (`bool`, defaults to `False`): Whether to disable Add Bias and Gelu / FastGelu fusion. disable_embed_layer_norm_fusion (`bool`, defaults to `True`): Whether to disable EmbedLayerNormalization fusion. The default value is set to `True` since this fusion is incompatible with ONNX Runtime quantization. enable_gelu_approximation (`bool`, defaults to `False`): Whether to enable Gelu / BiasGelu to FastGelu conversion. The default value is set to `False` since this approximation might slightly impact the model\u0026#39;s accuracy. use_mask_index (`bool`, defaults to `False`): Whether to use mask index instead of raw attention mask in the attention operator. no_attention_mask (`bool`, defaults to `False`): Whether to not use attention masks. Only works for bert model type. disable_embed_layer_norm (`bool`, defaults to `True`): Whether to disable EmbedLayerNormalization fusion. The default value is set to `True` since this fusion is incompatible with ONNX Runtime quantization disable_shape_inference (`bool`, defaults to `False`): Whether to disable symbolic shape inference. The default value is set to `False` but symbolic shape inference might cause issues sometimes. use_multi_head_attention (`bool`, defaults to `False`): Experimental argument. Use MultiHeadAttention instead of Attention operator, which has merged weights for Q/K/V projection, which might be faster in some cases since 3 MatMul is merged into one.\u0026#34; \u0026#34;Note that MultiHeadAttention might be slower than Attention since MatMul of input projection is excluded. \u0026#34; \u0026#34;MultiHeadAttention has only CUDA implementation so the model can only run with CUDAExecutionProvider. enable_gemm_fast_gelu (`bool`, defaults to `True`): Enable GemmfastGelu fusion. use_raw_attention_mask (`bool`, defaults to `False`): Use raw attention mask. Use this option if your input is not right-side padding. This might deactivate fused attention and get worse performance. disable_group_norm (`bool`, defaults to `False`): Do not fuse GroupNorm. Only works for model_type=unet. disable_packed_kv (`bool`, defaults to `False`): Do not use packed kv in cross attention. Only works for model_type=unet. \u0026#34;\u0026#34;\u0026#34; è¿™é‡Œå¯èƒ½æœ‰äº›äººä¼šæ„Ÿè§‰å¥‡æ€ªï¼Œä»€ä¹ˆå«åš99: will enable all available optimizations including layout optimizationsï¼Œè¿™ä¸ªä½ å¯ä»¥å°è¯•ä½¿ç”¨ä¼˜åŒ–åå°±ä¼šçœ‹åˆ°å¯¹åº”çš„å¸ƒå±€è½¬æ¢ï¼ˆæ ¹æ®ä¸åŒç¡¬ä»¶å¯èƒ½é€‚é…çš„æ•°æ®æ„é€ ä¸åŒï¼‰\nAutoOptimizationConfigæ˜¯optimumå†…éƒ¨çš„ä¼˜åŒ–é€»è¾‘ï¼Œæœ€åè¿˜æ˜¯ä»¥onnxruntimeçš„ä¸ºå‡†ã€‚\nclass AutoOptimizationConfig: \u0026#34;\u0026#34;\u0026#34; Factory to create common `OptimizationConfig`. \u0026#34;\u0026#34;\u0026#34; _LEVELS = { \u0026#34;O1\u0026#34;: { \u0026#34;optimization_level\u0026#34;: 1, \u0026#34;enable_transformers_specific_optimizations\u0026#34;: False, }, \u0026#34;O2\u0026#34;: { \u0026#34;optimization_level\u0026#34;: 2, \u0026#34;enable_transformers_specific_optimizations\u0026#34;: True, }, \u0026#34;O3\u0026#34;: { \u0026#34;optimization_level\u0026#34;: 2, \u0026#34;enable_transformers_specific_optimizations\u0026#34;: True, \u0026#34;enable_gelu_approximation\u0026#34;: True, }, \u0026#34;O4\u0026#34;: { \u0026#34;optimization_level\u0026#34;: 2, \u0026#34;enable_transformers_specific_optimizations\u0026#34;: True, \u0026#34;enable_gelu_approximation\u0026#34;: True, \u0026#34;fp16\u0026#34;: True, }, } å¦‚æœä½ æƒ³å¯¹æ¨¡å‹è¿›è¡Œé‡åŒ–ï¼Œåœ¨æ— æ³•ä½¿ç”¨optimumçš„åŠ è½½æƒ…å†µä¸‹ï¼Œå®Œå…¨å¯ä»¥å‚è€ƒoptimumå¯¹onnxruntimeçš„åŒ…è£…è‡ªè¡Œå¤„ç†ï¼Œåœ¨AutoQuantizationConfigçš„æ–¹æ³•ä¸­æœ‰å¾ˆå¤šé’ˆå¯¹å¯¹åº”æŒ‡ä»¤é›†çš„é‡åŒ–é…ç½®ï¼Œæ¯”å¦‚vnniï¼š\ndef avx512_vnni( is_static: bool, format: Optional[QuantFormat] = None, mode: Optional[QuantizationMode] = None, use_symmetric_activations: bool = False, use_symmetric_weights: bool = True, per_channel: bool = True, nodes_to_quantize: Optional[List[NodeName]] = None, nodes_to_exclude: Optional[List[NodeName]] = None, operators_to_quantize: List[NodeName] = ORT_FULLY_CONNECTED_OPERATORS, ) -\u0026gt; QuantizationConfig: \u0026#34;\u0026#34;\u0026#34; When targeting Intel AVX512-VNNI CPU underlying execution engine leverage the CPU instruction VPDPBUSD to compute \\\\i32 += i8(w) * u8(x)\\\\ within a single instruction. AVX512-VNNI (AVX512 Vector Neural Network Instruction) is an x86 extension Instruction set and is a part of the AVX-512 ISA. AVX512 VNNI is designed to accelerate convolutional neural network for INT8 inference. :param is_static: Boolean flag to indicate whether we target static or dynamic quantization. :param format: Targeted ONNX Runtime quantization format. When targeting dynamic quantization mode, the default value is `QuantFormat.QOperator` whereas the default value for static quantization mode is `QuantFormat.QLinearOps` :param mode: Targeted ONNX Runtime quantization mode, default is QLinearOps to match QDQ format. When targeting dynamic quantization mode, the default value is `QuantFormat.QOperator` whereas the default value for static quantization mode is `QuantFormat.QLinearOps` :param use_symmetric_activations: :param use_symmetric_weights: :param per_channel: Whether we should quantize per-channel (also known as \u0026#34;per-row\u0026#34;). Enabling this can increase overall accuracy while making the quantized model heavier. :param nodes_to_quantize: :param nodes_to_exclude: :param operators_to_quantize: :return: \u0026#34;\u0026#34;\u0026#34; ensure_valid_mode_or_raise(is_static, mode) format, mode = default_quantization_parameters(is_static, format, mode) return QuantizationConfig( is_static=is_static, format=format, mode=mode, activations_dtype=QuantType.QUInt8, activations_symmetric=use_symmetric_activations, weights_dtype=QuantType.QInt8, weights_symmetric=use_symmetric_weights, per_channel=per_channel, reduce_range=False, nodes_to_quantize=nodes_to_quantize or [], nodes_to_exclude=nodes_to_exclude or [], operators_to_quantize=operators_to_quantize, ) è¿™é‡Œé¢çš„QuantizationConfigæœ¬è´¨æ˜¯å¯¹onnxruntime.quantizationçš„åŒ…è£…ï¼Œå‚è€ƒè®¾è®¡åå¯ä»¥æ”¹é€ å‡ºè‡ªå·±çš„æ–¹æ¡ˆï¼ŒåŒæ—¶å¯¹äºé™æ€ç¦»çº¿é‡åŒ–è¦æ³¨æ„åˆ°CalibrationConfigï¼Œå…·ä½“ä½ å¯ä»¥è°ƒè¯•ä¸€æ¬¡è¿‡ç¨‹æŸ¥çœ‹æ¯ä¸€æ­¥çš„å‚æ•°å°±å¯ä»¥å¤§æ¦‚æ˜ç™½æ•°æ®æ˜¯æ€ä¹ˆæµåŠ¨çš„ã€‚\nå¦‚æœä½ æƒ³ç›´æ¥ä½¿ç”¨huggingface optimumå¯¹æ”¯æŒæ¨¡å‹çš„ä¼˜åŒ–ï¼Œä½ å¯ä»¥å‚è€ƒä»¥ä¸‹æµç¨‹ï¼š\nä¼˜åŒ–è¿‡ç¨‹ï¼š\nfrom optimum.onnxruntime.configuration import OptimizationConfig from optimum.onnxruntime.optimization import ORTOptimizer model = ORTModelForSequenceClassification.from_pretrained(\u0026#34;uer/roberta-base-finetuned-dianping-chinese\u0026#34;, from_transformers=True) optimization_config = OptimizationConfig( optimization_level=2, #0,1,2,99 enable_transformers_specific_optimizations=True, optimize_for_gpu=False, ) # åˆ›å»ºä¼˜åŒ–å™¨ optimizer = ORTOptimizer.from_pretrained( model ) # ä¿å­˜æ¨¡å‹é…ç½®æ–‡ä»¶ save_dir = \u0026#34;my_optimized\u0026#34; optimizer.optimize(save_dir=save_dir, optimization_config=optimization_config) ä¼˜åŒ–ååŠ è½½ï¼š\nort_opt_model = ORTModelForSequenceClassification.from_pretrained(save_dir) opt_onnx_classifier_new = pipeline(\u0026#34;text-classification\u0026#34;, model=ort_opt_model, tokenizer=tokenizer, device=-1) result = opt_onnx_classifier_new (\u0026#34;æµ‹è¯•æµ‹è¯•æµ‹è¯•\u0026#34;) ","date":"2023-02-24T23:14:16+08:00","permalink":"https://sanbuphy.github.io/p/huggingface-optimum%E4%BB%8B%E7%BB%8D/","title":"Huggingface optimumä»‹ç»"},{"content":"æ€»çš„æ¥è¯´ï¼Œæ—¥å¸¸æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°çš„åŠ¨æ€åº“æ‰¾ä¸åˆ°é—®é¢˜ï¼Œé¦–å…ˆé‡äº‹ä¸å†³lddçœ‹ä¾èµ–ï¼Œç„¶åä¸¢åˆ°æœç´¢è·¯å¾„ï¼ˆusr/libç­‰ï¼‰å³å¯ã€‚ï¼ˆcmakeæœ‰é—®é¢˜å°±messageå‡ºæ¥çœ‹é‚£ä¸ªå˜é‡æœ‰é—®é¢˜ã€‚ã€‚ã€‚æˆ–è€…å¼€è°ƒè¯•straceç­‰ç­‰ï¼‰\nä»€ä¹ˆæ˜¯ldconfigï¼Œä»linux manå¯ä»¥çŸ¥é“ï¼š\nldconfig creates the necessary links and cache to the most recent shared libraries found in the directories specified on the command line, in the file /etc/ld.so.conf, and in the trusted directories (/lib and /usr/lib). The cache is used by the run-time linker, ld.so or ld-linux.so. ldconfig checks the header and filenames of the libraries it encounters when determining which versions should have their links updated.\nä»€ä¹ˆæ˜¯run-time linkerå‘¢ï¼Ÿ\nThe programs ld.so and ld-linux.so* find and load the shared objects (shared libraries) needed by a program, prepare the program to run, and then run it.\nldconfigä¸LD_PATH ï¼ˆè½¬è‡ªhttps://www.cnblogs.com/my-show-time/p/15250435.html\n1ã€å¾€/libå’Œ/usr/libé‡Œé¢åŠ ä¸œè¥¿ï¼Œæ˜¯ä¸ç”¨ä¿®æ”¹/etc/ld.so.confæ–‡ä»¶çš„ï¼Œä½†æ˜¯æ·»åŠ å®Œåéœ€è¦è°ƒç”¨ä¸‹ldconfigï¼Œä¸ç„¶æ·»åŠ çš„libraryä¼šæ‰¾ä¸åˆ°ã€‚\n2ã€å¦‚æœæ·»åŠ çš„libraryä¸åœ¨/libå’Œ/usr/libé‡Œé¢çš„è¯ï¼Œå°±éœ€è¦ä¿®æ”¹/etc/ld.so.confæ–‡ä»¶ï¼Œå¾€è¯¥æ–‡ä»¶è¿½åŠ libraryæ‰€åœ¨çš„è·¯å¾„ï¼Œç„¶åä¹Ÿéœ€è¦é‡æ–°è°ƒç”¨ä¸‹ldconfigå‘½ä»¤ã€‚æˆ–è€…åœ¨/etc/ld.so.conf.d/ä¸‹æ·»åŠ *.confçš„æ–‡ä»¶å¹¶è¿½åŠ libraryçš„è·¯å¾„ï¼Œç„¶åæ‰§è¡Œldconfigã€‚æ¯”å¦‚åœ¨å®‰è£…MySQLçš„æ—¶å€™ï¼Œå…¶åº“æ–‡ä»¶/usr/local/mysql/libï¼Œå°±éœ€è¦è¿½åŠ åˆ°/etc/ld.so.confæ–‡ä»¶ä¸­ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š\necho \u0026#34;/usr/local/mysql/lib\u0026#34; \u0026gt;\u0026gt;/etc/ld.so.conf ldconfig -v | grep mysql æŸ¥çœ‹ç¼“å­˜æ–‡ä»¶æ‰€ä¿å­˜çš„æ‰€æœ‰å…±äº«åº“\nldconfig -p\n3ã€å¦‚æœæ·»åŠ çš„libraryä¸åœ¨/libæˆ–/usr/libä¸‹ï¼Œä¸”æ²¡æœ‰æƒé™æ“ä½œå†™/etc/ld.so.confæ–‡ä»¶çš„è¯ï¼Œè¿™æ—¶åªéœ€è¦å°†è·¯å¾„æ”¾åˆ°LD_LIBRARY_PATHç¯å¢ƒå˜æ›´å°±å¯ä»¥äº†ã€‚\nå¯ä»¥ç”¨å‘½ä»¤ export** **æ¥ä¸´æ—¶ç”Ÿæ•ˆ\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib\nä»¥ä¸Šåšæ³•ï¼Œåªæ˜¯ä¸´æ—¶è®¾ç½®å˜é‡ LD_LIBRARY_PATH ï¼Œä¸‹æ¬¡å¼€æœºè¿™ä¸ªå˜é‡å°†å¤±æ•ˆï¼›å¦‚ä½•æŠŠè¿™ä¸ªå€¼æŒç»­å†™åˆ° LD_LIBRARY_PATH é‡Œå‘¢ï¼Ÿ\næˆ‘ä»¬å¯ä»¥åœ¨ ~/.bashrc æˆ–è€… ~/.bash_profile ä¸­åŠ å…¥ export è¯­å¥ï¼Œå‰è€…åœ¨æ¯æ¬¡ç™»é™†å’Œæ¯æ¬¡æ‰“å¼€ shell éƒ½è¯»å–ä¸€æ¬¡ï¼Œåè€…åªåœ¨ç™»é™†æ—¶è¯»å–ä¸€æ¬¡ã€‚æˆ‘çš„ä¹ æƒ¯æ˜¯åŠ åˆ° ~/.bashrc ä¸­.åœ¨è¯¥æ–‡ä»¶çš„æœªå°¾ï¼Œå¯é‡‡ç”¨å¦‚ä¸‹è¯­å¥æ¥ä½¿è®¾ç½®ç”Ÿæ•ˆï¼š\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib\nä»¥ä¸Šæ˜¯bashé…ç½®ç¯å¢ƒå˜é‡çš„æ ¼å¼cshçš„æ ¼å¼æœ‰æ‰€ä¸åŒï¼š\nsetenv LD_LIBRARY_PATH {LD_LIBRARY_PATH}:{my_HOME}/lib\nä¿®æ”¹å®Œåï¼Œè®°å¾—å…³æ‰å½“å‰ç»ˆç«¯å¹¶é‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œä»è€Œä½¿ä¸Šé¢çš„é…ç½®ç”Ÿæ•ˆã€‚\nç¼–è¯‘è¿‡ç¨‹çš„æœç´¢è·¯å¾„ è½¬è‡ªï¼šhttps://mp.weixin.qq.com/s/MresJrkdnZ8iDGCP6WzR4Q\n#Â å»å“ªé‡Œæ‰¾å¤´æ–‡ä»¶Â ç›¸å½“äºgcc/clangÂ ä¸­çš„-I(içš„å¤§å†™å­—æ¯)å‚æ•° include_directories(${GTEST_INCLUDE_DIR}) include_directories(${GMOCK_INCLUDE_DIR}) #Â å»å“ªé‡Œæ‰¾åº“æ–‡ä»¶Â .soÂ .dllÂ .dylibÂ ç›¸å½“äºgccÂ ä¸­çš„-Lå‚æ•° link_directories(${GTEST_LINK_DIR}) link_directories(${GMOCK_LINK_DIR}) å°½ç®¡å¦‚æ­¤ï¼Œè®¾ç½®æˆè¿™ç§æƒ…å†µè¿˜æ˜¯æœ‰æ—¶å€™æ‰¾ä¸åˆ°ï¼ˆè¿˜æ²¡æœ‰å½»åº•è§£å†³å’Œç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹åªè¦æš´åŠ›çš„æ”¹å˜cmakeçš„åŠ¨æ€åº“æœç´¢è·¯å¾„å³å¯ï¼ˆæ¯”å¦‚ç›´æ¥åœ¨usr/local/libä¸­æŸ¥æ‰¾éœ€è¦çš„æŸäº›åŠ¨æ€åº“ï¼‰\né“¾æ¥åº“çš„è·¯å¾„æœç´¢é¡ºåº ä»¥ä¸‹æ¥è‡ªlinux man ld.so\nIf a shared object dependency does not contain a slash, then it is searched for in the following order:\nUsing the directories specified in the DT_RPATH dynamic section attribute of the binary if present and DT_RUNPATH attribute does not exist. Use of DT_RPATH is deprecated.\nUsing the environment variable LD_LIBRARY_PATH, unless the executable is being run in secure-execution mode (see below), in which case this variable is ignored.\nUsing the directories specified in the DT_RUNPATH dynamic section attribute of the binary if present. Such directories are searched only to find those objects required by DT_NEEDED (direct dependencies) entries and do not apply to those objects\u0026rsquo; children, which must themselves have their own DT_RUNPATH entries. This is unlike DT_RPATH, which is applied to searches for all children in the dependency tree.\nFrom the cache file /etc/ld.so.cache, which contains a compiled list of candidate shared objects previously found in the augmented library path. If, however, the binary was linked with the -z nodeflib linker option, shared objects in the default paths are skipped. Shared objects installed in hardware capability directories (see below) are preferred to other shared objects.\nIn the default path /lib, and then /usr/lib. (On some 64-bit architectures, the default paths for 64-bit shared objects are /lib64, and then /usr/lib64.) If the binary was linked with the -z nodeflib linker option, this step is skipped.\nè½¬è‡ªï¼šhttps://zhuanlan.zhihu.com/p/458193070\ngccåœ¨ç¼–è¯‘æ—¶æŒ‰ç…§å¦‚ä¸‹é¡ºåºå¯»æ‰¾æ‰€éœ€è¦çš„åº“æ–‡ä»¶ï¼š\ngccä¼šå»æ‰¾-LæŒ‡å®šçš„ç›®å½• å†æ‰¾gccçš„ç¯å¢ƒå˜é‡LIBRARY_PATH å†æ‰¾å†…å®šç›®å½• /libå’Œ/lib64 /usr/lib å’Œ/usr/lib64 /usr/local/libå’Œ/usr/local/lib64 è¿™æ˜¯å½“åˆç¼–è¯‘ gcc æ—¶å†™åœ¨ç¨‹åºå†…çš„ã€‚\nè¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š\né»˜è®¤æƒ…å†µä¸‹ï¼Œgccç¼–è¯‘æ—¶åªä¼šæŸ¥æ‰¾ç›¸åº”çš„å¤´æ–‡ä»¶ï¼Œè€Œä¸ä¼šè¿æ¥å…·ä½“çš„libã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦includeè®¾ç½®å®Œå…¨ï¼Œå°±å¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚å®ƒæ²¡æœ‰è¿›ä¸€æ­¥æ£€æŸ¥includeä¸­çš„ç±»å’Œå‡½æ•°æœ‰æ²¡æœ‰å®ç°ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ‰å¼€å§‹æŸ¥æ‰¾ã€‚æ‰€ä»¥å°±ä¼šç»å¸¸å‘ç”Ÿç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œä½†è¿è¡Œæ—¶å´æ— æ³•è¿è¡Œï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶å®ƒæ‰¾ä¸åˆ°ç›¸å…³ç±»æˆ–è€…å‡½æ•°çš„å®ç°ã€‚ è¿™æ—¶ï¼Œä½¿ç”¨-Wl,--no-undefinedå‚æ•°ï¼Œå¦‚æœä½¿ç”¨äº† include æ–‡ä»¶ï¼Œé“¾æ¥å™¨å´æ‰¾ä¸åˆ°ç›¸åº”çš„å®ç°ï¼Œå°±ä¼šäº§ç”Ÿé”™è¯¯æç¤ºã€‚\nç¼–è¯‘æ—¶é»˜è®¤ä¸æŸ¥æ‰¾å½“å‰ç›®å½•ï¼Œéœ€è¦ä½¿ç”¨-L ./æŒ‡å®š è¿è¡Œæ—¶åŠ¨æ€åº“çš„æœç´¢è·¯å¾„çš„å…ˆåé¡ºåºæ˜¯ï¼š\nç¼–è¯‘ç›®æ ‡ä»£ç æ—¶æŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ï¼›è¿™æ˜¯é€šè¿‡gccçš„å‚æ•°-Wl,-rpath=æŒ‡å®šã€‚å½“æŒ‡å®šå¤šä¸ªåŠ¨æ€åº“æœç´¢è·¯å¾„æ—¶ï¼Œè·¯å¾„ä¹‹é—´ç”¨å†’å· ï¼šåˆ†éš” ç¯å¢ƒå˜é‡LD_LIBRARY_PATHæŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ é…ç½®æ–‡ä»¶/etc/ld.so.confä¸­æŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ é»˜è®¤çš„åŠ¨æ€åº“æœç´¢è·¯å¾„ï¼Œå¦‚ï¼š/lib, /usr/lib ","date":"2023-02-24T23:14:16+08:00","permalink":"https://sanbuphy.github.io/p/%E7%BC%96%E8%AF%91%E5%99%A8%E9%93%BE%E6%8E%A5%E4%B8%8Eldconfigld_library_path/","title":"ç¼–è¯‘å™¨é“¾æ¥ä¸ldconfigã€LD_LIBRARY_PATH"},{"content":"å‰è¨€ æœ€è¿‘åœ¨æ¥è§¦éƒ¨åˆ†paddleæºç ï¼Œä½†ç”±äºæœ¬åœ°æ­å»ºç‰¹å®¹æ˜“å‡ºç°ç¯å¢ƒä¾èµ–é—®é¢˜å’Œå…¶ä»–å¥‡æ€ªçš„é—®é¢˜ï¼Œæ•…é€‰æ‹©äº†dockerç¼–è¯‘ã€‚æœ‰å¾ˆå¤šæœ‹å‹é‡åˆ°è¿™ç±»é—®é¢˜ç¬¬ä¸€æƒ³æ³•ä¾¿æ˜¯ï¼š\nç›´æ¥ç”¨vscode gnu globalå‡‘åˆå°±å®Œäº‹äº† ï¼ˆç¼ºç‚¹ï¼šç¬¦å·ä¿¡æ¯ç¼ºå¤±ï¼‰ æ‰¾ä¸ªå…¶ä»–å¯ä»¥çš„æœåŠ¡å™¨ç¼–è¯‘ ï¼ˆç¼ºç‚¹ï¼šéœ€è¦é’±ï¼‰ å…¶ä»–codespaceä¹‹ç±»çš„ä¸œè¥¿ ï¼ˆç¼ºç‚¹ï¼šé€Ÿåº¦æ…¢ï¼‰ ç›´æ¥ç”¨ vscode attach dockerå°±å®Œäº‹äº†ï¼ˆç¼ºç‚¹ï¼šæƒ³è¦ç”¨åˆ°clangdé…åˆcmakeçš„compileçš„jsonç”Ÿæˆå®Œæ•´ç¬¦å·ä¿¡æ¯ï¼Œä½†æ˜¯attachåæˆ‘å‘ç°æˆ‘ä¸èƒ½ç»™å®ƒå®‰è£…vscodeçš„clangdæ’ä»¶ï¼‰ğŸ’¡ã€æ³¨æ„ï¼ã€‘åæ¥æˆ‘æ¢å°ç”µè„‘è¿›å…¥åˆ°ä»–æŒ‚è½½å¥½æ–‡ä»¶çš„é¡¹ç›®åå‘ç°è¿™ä¸ªè¿˜æ˜¯å¯ä»¥å®‰è£…çš„ï¼Œå¯èƒ½åœ¨æˆ‘åŸæ¥é‚£å°ç”µè„‘ä¸Šæœ‰bugã€‚ã€‚ã€‚ã€‚æˆ–è€…vscodeç‰ˆæœ¬ä¸å¯¹ã€‚ã€‚é‚£è¿™æ ·å¯¹äºä¸å¤æ‚çš„åœºæ™¯å¯ä»¥ç›´æ¥ç”¨vscode attachå°±å¯ä»¥äº†ã€‚ä¸è¿‡ä½†ä¸ç®¡æ€ä¹ˆæ ·è¿™ä¸ªsshæ–¹å¼å¯ä»¥é€‚é…ç»å¤§å¤šæ•°æƒ…å†µå’Œå„ç±»IDEã€‚ã€‚ã€‚ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„ç»Ÿä¸€å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œè¿™æ—¶å€™æœ€å¥½çš„é€‰æ‹©å°±æ˜¯dockeräº†ï¼Œclionå¯ä»¥å®Œç¾æ”¯æŒc++é¡¹ç›®çš„è·³è½¬ä»¥åŠcmakeçš„è°ƒè¯•ä»¥åŠç¬¦å·ä¿¡æ¯çš„è·å–ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨clionè¿›è¡Œç¬¦å·è·³è½¬çš„æŸ¥çœ‹ã€‚\nä½†clionä¸åƒvscodeå¯ä»¥å¾ˆæ–¹ä¾¿çš„attachï¼Œæˆ‘ä»¬éœ€è¦è¿œç¨‹sshè¿›è¡Œå¤„ç†\nå…·ä½“ç¼–è¯‘ç»†èŠ‚å’Œå„å¹³å°çš„ç¼–è¯‘è¿‡ç¨‹å¯å‚è€ƒpaddleå®˜æ–¹æ‰‹å†Œï¼šhttps://www.paddlepaddle.org.cn/documentation/docs/zh/develop/install/compile/linux-compile.html#paddlepaddle-paddlepaddle-github-paddle\nä¸€ã€dockeråŸºç¡€ä¾èµ–å®‰è£… å¦‚æœæ²¡æœ‰pull dockerï¼Œå…ˆä½¿ç”¨ï¼šnvidia-docker pull paddlepaddle/paddle:latest-gpu-cuda10.2-cudnn7-dev\nå› ä¸ºæˆ‘çš„æ˜¯11.5çš„cudaï¼Œæ‰€ä»¥ä½¿ç”¨nvidia-docker pull paddlepaddle/paddle:latest-dev-cuda11.2-cudnn8-gcc82\npullä¹‹åç›´æ¥runï¼š\næ³¨æ„ï¼ã€è¿™é‡Œå’Œå®˜æ–¹å»ºè®®ä¸åŒçš„æ˜¯æˆ‘æ²¡æœ‰ç”¨--network=hostè€Œæ˜¯ç”¨-p 50003:22ä¸ºäº†sshçš„ç«¯å£æ˜ å°„ã€‘\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒWSL2ä¸­æˆ‘ä»¬ä¸éœ€è¦å®‰è£…nvidia-dockerï¼Œç›´æ¥ä½¿ç”¨docker-desktopå…³è”çš„ç¯å¢ƒç„¶ådockerå°±å¯ä»¥ä½¿ç”¨nvidiaç›¸å…³çš„å®¹å™¨ã€‚\nhttps://www.docker.com/blog/wsl-2-gpu-support-for-docker-desktop-on-nvidia-gpus/\nhttps://blog.csdn.net/qq_29462849/article/details/118160182\nnvidia-docker run --name paddle-test -v $PWD:/paddle -p 50003:22 -it registry.baidubce.com/paddlepaddle/paddle:latest-dev-cuda11.2-cudnn8-gcc82 /bin/bash å¦‚æœä½ å·²ç»runäº†ï¼Œç›´æ¥docker exec -itå³å¯ï¼Œæˆ–è€…åœ¨vscodeæˆ–clionä¸­ç›´æ¥attachåˆ°ç»ˆç«¯ã€‚\näºŒã€æ¢æº è¿›å…¥dockerç»ˆç«¯åé¦–å…ˆå¯¹dockerå†…è¿›è¡Œä¸€æ³¢æ¢æºï¼švim ä¿®æ”¹ /etc/apt/sources.list å…¨éƒ¨æ›¿æ¢ä¸ºï¼š\ndeb https://mirrors.ustc.edu.cn/ubuntu/ focal main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ focal-updates main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-updates main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ focal-security main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-security main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse ä¸‰ã€sshä¾èµ–å®‰è£…ä¸å¯åŠ¨ æ¥ä¸‹æ¥çš„æ“ä½œå¤§ä½“å‚è€ƒï¼šhttps://www.anquanclub.cn/6674.html\nç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–\napt-get update apt-get install passwd apt-get install openssh-server apt-get install rsync #åç»­clionåŒæ­¥æ–‡ä»¶éœ€è¦ç”¨åˆ° ç¬¬äºŒæ­¥ï¼šè®¾ç½®ç™»å½•åå¯†ç ï¼šé€šè¿‡passwdå‘½ä»¤æ¥è®¾ç½®rootçš„å¯†ç ï¼Œæ¯”å¦‚123456\nç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨sshæœåŠ¡\nservice ssh start è®°å¾—æŠŠè¿™å¥è¯åŠ å…¥åˆ° ~/.bashrc å¦åˆ™æ¯æ¬¡é‡å¯dockeréƒ½è¦è‡ªå·±å†™ã€‚\nå¯ä»¥é€šè¿‡ps -e |grep sshæŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨\nç¬¬å››æ­¥ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡vimç¼–è¾‘å™¨æ‰“å¼€é…ç½®æ–‡ä»¶ vim /etc/ssh/sshd_config\nåœ¨é…ç½®æ–‡ä»¶ä¸­éšä¾¿æ‰¾ä¸ªåœ°æ–¹å†™å…¥ä»¥ä¸‹å†…å®¹(#å·åæ˜¯æ³¨é‡Š)\nPubkeyAuthentication yes #å¯ç”¨å…¬é’¥ç§é’¥é…å¯¹è®¤è¯æ–¹å¼ AuthorizedKeysFile .ssh/authorized\\_keys #å…¬é’¥æ–‡ä»¶è·¯å¾„ PermitRootLogin yes #rootèƒ½ä½¿ç”¨sshç™»å½• ç¬¬äº”æ­¥ï¼šé‡å¯æœåŠ¡\nservice ssh restart è¿™æ—¶å€™å°±å¯ä»¥æ„‰å¿«çš„sshæ“ä½œdockeräº†ï¼\nä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿›è¡Œæµ‹è¯•ï¼Œä½¿ç”¨ï¼š\nssh -p 50003 root@127.0.0.1 è¾“å…¥123456å¯†ç å‘ç°å¯ä»¥æˆåŠŸè¿›å…¥ï¼Œè¿™æ—¶å€™å·²ç»åŸºæœ¬æˆåŠŸï¼Œæ¥ä¸‹æ¥è¿›å…¥åˆ°clioné…ç½®çš„ç¯èŠ‚\nå››ã€Clioné…ç½® æ¥ä¸‹æ¥è¿›å…¥åˆ°clioné…ç½®çš„ç¯èŠ‚ï¼Œåªè¦å¤„ç†å¥½è¿™å‡ ä¸ªéƒ¨åˆ†å°±å¯ä»¥å®Œç¾ä½“éªŒï¼\nä¸»è¦å‚è€ƒï¼šhttps://imhuwq.com/2018/12/02/Clion ä½¿ç”¨ Docker ä½œä¸ºå¼€å‘ç¯å¢ƒ/\nä¸€ã€å·¥å…·é“¾è®¾ç½® åœ¨ Clion Settings-Build,Execution,Deployment-Toolchains é¡µé¢å…ˆæ–°å»ºä¸€ä¸ª Toolchains è®¾ç½®ï¼Œåå­—å« my-project å§ï¼Œç±»å‹é€‰ Remote Hostã€‚ Credential è®¾ç½®é‡Œé¢å¡«å…¥ Container çš„ IPã€‚ç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç æŒ‰è‡ªå·±åˆ›å»º Docker é•œåƒçš„æ—¶å€™æ¥è®¾ç½®ã€‚ç”±äºæˆ‘æ˜¯ä»æºç ç¼–è¯‘çš„ Cmakeï¼Œæ‰€ä»¥éœ€è¦å˜æ›´ä¸€ä¸‹ Cmake åœ°å€ä¸º /usr/local/bin/cmakeã€‚å¤§å®¶è‡ªå·±ä¼šæ„ï¼ŒæŒ‰æƒ…å†µæ¥æ”¹å°±å¥½:\næˆ‘çš„å‚è€ƒå®ç°ï¼šï¼ˆç‚¹+å·é€‰æ‹©è¿œç¨‹ä¸»æœºï¼‰ã€å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ï¼Œåˆ°cmakeæˆ–è€…å…¶ä»–ä¸œè¥¿ï¼Œåœ¨dockerå†…aptå®‰è£…ä¸€ä¸‹å°±å¥½ï¼›g++ç¼–è¯‘å™¨å¯èƒ½è‡ªåŠ¨æœç´¢ä¸åˆ°ï¼Œæ‰€ä»¥whereis g++çœ‹ä¸€ä¸‹åœ°å€ï¼Œç„¶åå¡«å…¥å³å¯ã€‘\nè¿™é‡Œæ’æ’­ä¸€ä¸‹å‚…å‚…çŒªçš„å»ºè®®ï¼š è¡¥å……ä¸€ä¸ªæ“ä½œï¼Œtoochainlé‚£è¾¹ å¯ä»¥ç›´æ¥æŠŠsshçš„é…ç½®æ‹–åŠ¨åˆ°æœ€å‰é¢\nå·¥å…·é“¾è®¾ç½®åœ¨ Clion Settings-Build,Execution,Deployment-Toolchains é¡µé¢å…ˆæ–°å»ºä¸€ä¸ª Toolchains è®¾ç½®ï¼Œåå­—å« my-project å§ã€‚ è¿™é‡Œçš„å‡ ä¸ªtoolchainsæ˜¯å¯ä»¥æ‹–åŠ¨çš„ï¼Œä½ æŠŠdockerçš„é‚£ä¸ªtoolchainæ‹–åŠ¨åˆ°æœ€å‰é¢ä¹Ÿå¯ä»¥ ç„¶åæœ‰ä¸¤ä¸ªå‘ç‚¹ï¼Œæœ‰æ—¶å€™å¤´æ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œå¯ä»¥ç”¨shift shift, é€‰æ‹©resync with remote hosts è¿˜æœ‰å°±æ˜¯dockeré‡Œçš„tmpä»£ç ç›®å½•æ‰¾ä¸åˆ°äº†ï¼Œå°±shift shift é€‰æ‹©reload cmake project,é‡æ–°ä¼ è¾“ä¸€ä¸‹ä»£ç ã€‚ äºŒã€CMAKEè®¾å®š åˆ›å»º Toolchains é…ç½®åï¼Œåœ¨ Settings-Build,Execution,Deployment-CMake é¡µé¢çš„ Toolchain ä¸‹æ‹‰èœå•é‡Œé¢é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ my-projectã€‚ ç„¶åç‚¹å‡» Apply ä¿å­˜åˆ°ç›®å‰ä¸ºæ­¢çš„é…ç½®:\næˆ‘çš„å®ç°å‚è€ƒï¼šï¼ˆå·¥å…·é“¾é€‰æ‹©ç¬¬ä¸€æ­¥è®¾å®šçš„ï¼‰\ncmakeé€‰é¡¹ä¸­éœ€è¦åŠ å…¥-DPY_VERSION=3.7 -DWITH_GPU=ON è¿™æ˜¯æˆ‘ä»¬éœ€è¦çš„cmakeå‚æ•°\nå¦‚æœä½ æƒ³è¦å¸¦ä¸Štensorrtç¼–è¯‘ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š-DPY_VERSION=3.7 -DWITH_GPU=ON -DWITH_TENSORRT=ON\nNo CMAKE_CUDA_COMPILER could be found. Tell CMake where to find the compiler by setting either the environment variable \u0026#34;CUDACXX\u0026#34; or the CMake cache entry CMAKE_CUDA_COMPILER to the full path to the compiler, or to the compiler name if it is in the PATH. åŒæ—¶ä½ éœ€è¦export PATH=/usr/local/cuda/bin:$PATHç›´æ¥é™„åŠ åˆ°ç»ˆç«¯æˆ–è€…æ˜¯åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­,å¦åˆ™ä¼šæ‰¾ä¸åˆ°ã€‚\nä¸‰ã€ç®¡ç†åŒæ­¥ å…¶å®ä»–çš„ç”¨æ³•å°±æ˜¯åˆ›å»ºä¸€ä¸ªtmpï¼ˆä½ å¯ä»¥åœ¨æ˜ å°„ä¸­çœ‹åˆ°ï¼‰\nç„¶åæŠŠæ–‡ä»¶æ‹·è´è¿›å»ç¼–è¯‘åå†æŠŠä¿¡æ¯æ‹¿å›æ¥ã€‚\nè®°å¾—æµ‹è¯•è¿æ¥ï¼Œæ ¹è·¯å¾„è‡ªåŠ¨æ£€æµ‹å³å¯\näº”ã€å¿«ä¹ä½“éªŒ æ³¨é‡Šï¼šæ¯æ¬¡é‡å¯dockeråçš„æ“ä½œ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡é‡å¯åæˆ‘ä»¬éƒ½éœ€è¦åœ¨dockerç»ˆç«¯å†…å¯åŠ¨ä¸€ä¸‹sshæœåŠ¡å¦åˆ™ä¸èƒ½ä½¿ç”¨ï¼š\nservice ssh start è¿™æ—¶å€™å·²ç»å¤§åŠŸå‘Šæˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢é€‰æ‹©å¯¹åº”çš„å¼€å‘ç¯å¢ƒï¼ˆå¦‚æœå®ƒæ²¡æœ‰è‡ªåŠ¨åˆ‡æ¢çš„è¯ï¼‰\nè¿™æ—¶å€™ä½ ä¼šçœ‹åˆ°å®ƒæ­£åœ¨ä¼ è¾“æ–‡ä»¶ï¼Œå¹¶ä¸”å¼€å§‹æœ‰ä¸ªæ¼«é•¿çš„ç¬¦å·è¡¨åŠ è½½è¿‡ç¨‹ï¼ˆéœ€è¦ä¸€ç‚¹ç‚¹æ—¶é—´ï¼Œä½†é‡å¤æ‰“å¼€åå°±ä¸éœ€è¦æ—¶é—´äº†ï¼ï¼‰\nå¦‚æœå‡ºç°é—®é¢˜å¯ä»¥ä¿®æ”¹åï¼ˆå¤§éƒ¨åˆ†æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œæ ¹æ®ä¸Šé¢çš„ç¬¬äºŒæ­¥éª¤è¿›è¡Œä¿®æ”¹å³å¯ï¼‰\nç»è¿‡æ¼«é•¿çš„ç­‰å¾…æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç»“æœäº†ã€‚\ncmakeè¿‡ç¨‹å‘ç‚¹æ³¨æ„ cmakeè¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦ä¸‹è½½ä¸€äº›ä»“åº“ï¼Œä½†æ— æ³•æˆåŠŸä¸‹è½½ï¼ˆç½‘ç»œåŸå› ï¼‰ï¼Œä½ å¯ä»¥bind 172.17.0.1 èµ°proxyï¼Œæˆ–è€…ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼šå‚è€ƒè‡ªhttps://www.cnblogs.com/isLinXu/p/16693491.html\nç”±äºåœ¨paddleæºç ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®‰è£…ç›¸åº”çš„ä¾èµ–åº“ï¼Œè¿™äº›ä¾èµ–åº“æ˜¯é€šè¿‡githubä»“åº“æ‹‰å–æºç çš„å½¢å¼ä¸‹è½½ä¸‹æ¥çš„ã€‚ è‹¥dockerç¯å¢ƒä¸‹èƒ½å¤Ÿç½‘ç»œé€šç•…çš„ä½¿ç”¨githubï¼Œå¯è·³è¿‡æ­¤é¡¹ã€‚ è‹¥ç½‘ç»œæƒ…å†µä¸ç¨³å®šï¼Œé‚£ä¹ˆè¿™é‡Œå»ºè®®å‚è€ƒä¸‹é¢ï¼Œåˆ†åˆ«å°†è¿™äº›ä»“åº“æ‰‹åŠ¨cloneä¸‹æ¥ï¼ŒåŒæ—¶è¦æ³¨æ„å½“å‰çš„ç›®å½•ï¼ˆæ”¾åœ¨æ ¹ç›®å½•ï¼‰ã€‚ï¼ˆå› ä¸ºæ˜¯æ˜ å°„ç›®å½•ï¼Œä½ å¯ä»¥æ‰¾å„ç§æ–¹æ³•åœ¨æœ¬åœ°ä¸‹è½½åæ”¾åˆ°ç›®æ ‡ä½ç½®å³å¯ï¼Œæœ‰å¿…è¦çš„è¯å¼„ä¸€ä¸‹DNSï¼‰\nextern_gflags https://github.com/gflags/gflags.git extern_cryptopp https://github.com/weidai11/cryptopp.git extern_mkldnn https://github.com/oneapi-src/oneDNN extern_warpctc git clone https://github.com/espnet/warp-ctc.git extern_protobuf https://github.com/protocolbuffers/protobuf.git è™½ç„¶æœ‰äº›ç¬¦å·è¿˜æ˜¯ä¸èƒ½çœ‹åˆ°å®šä¹‰å’Œå®ç°ï¼Œä½†å·²ç»è¶³å¤Ÿçœ‹ä»£ç äº†ï¼ˆæ”¯æŒç»å¤§éƒ¨åˆ†ï¼Œè€Œä¸”å¯ä»¥è‡ªç”±è·³è½¬ï¼‰ï¼ï¼ˆæœ‰äº›æ˜¯cudaè°ƒç”¨soæœ¬æ¥å°±ä¸èƒ½çœ‹åˆ°ï¼‰\näº«å—ç¬¦å·è·³è½¬å¸¦æ¥çš„éå†æŠŠã€‚ï¼ˆæœ‰äº†é‚£ä¸ªå°æ ‡å¿—å°±è¯´æ˜å…¨éƒ¨åŠ è½½å®Œæˆï¼Œå¦‚æœåŠ è½½ç¬¦å·è¡¨è¿‡ç¨‹ä¸­å¡ä½äº†å¡äº†éå¸¸ä¹…ï¼Œå¯ä»¥å°è¯•é‡å¯clionï¼‰\nTensorrtæ‰©å±•è§£æ æ­¤æ—¶æœ‰äº›è·³è½¬è¿˜æ˜¯å¤±æ•ˆçš„ï¼Œå› ä¸ºæ ¹æœ¬æ²¡æœ‰é€‰æ‹©å¯¹åº”ç¼–è¯‘é€‰é¡¹ä¸åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšä¸¤æ­¥æ“ä½œï¼š\nå¢åŠ cmake é€‰é¡¹ -DWITH_TENSORRT=ON åœ¨dockerä¸­æ ¹æ® nvidia å®˜æ–¹æ•™ç¨‹å®‰è£… tensorrtï¼š https://docs.nvidia.com/deeplearning/tensorrt/install-guide/index.html#installing-debian\né‡æ–°å¯åŠ¨clionå³å¯æˆåŠŸ~ï¼ˆæ‰€æœ‰nvinfer1ç›¸å…³éƒ½ç‚¹äº®äº†ï¼‰å¦‚æœè¿˜å‡ºç°ä¸å¯è·³è½¬çš„æƒ…å†µï¼Œå¯ä»¥ç‚¹å‡»è®¾ç½®èœå•ä¸­çš„ å·¥å…·â€”â€”ä¸è¿œç¨‹ä¸»æœºé‡æ–°åŒæ­¥ï¼Œç„¶åç¬¦å·åŠ è½½å®Œåå°±å¯ä»¥äº†ï¼Œå®åœ¨ä¸è¡Œé‡å¯clionè§£å†³ä¸€åˆ‡é—®é¢˜ã€‚\nå¤–ä¼ â€”â€”æ²¡clionä½†ç”¨vscodeå‡‘åˆ â€œæ”¾è¿‡vscodeå§ï¼ä»–åªæ˜¯ä¸€ä¸ªç¼–è¾‘å™¨ï¼Œä¸æ˜¯IDEï¼â€â€”â€”æ²ƒå…¹å­£ç¡•å¾·\nvscodeä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨clangd+cmakeæ’ä»¶å®ç°ä¸€å®šçš„è·³è½¬åŠŸèƒ½ï¼Œä¹‹å‰æˆ‘ä»¬çŸ¥é“äº†ç”¨dockerç›´æ¥attachåˆ°vscodeæ˜¯å¤±è´¥çš„ï¼Œä¸èƒ½å®‰è£…æ’ä»¶ã€‚\nä½†clionå±•ç¤ºäº†ä»–çš„å¼ºå¤§åŠŸåŠ›ï¼ˆå¯ä»¥sshåä½¿ç”¨ç›®æ ‡ç¼–è¯‘é“¾è¿›è¡Œç¼–è¯‘å’Œç¬¦å·è¡¨çš„å¯¼å…¥æ“ä½œï¼‰ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å¤§èƒ†çŒœæƒ³å¯ä»¥ç”¨vscodeä¹Ÿç›´æ¥sshåˆ°dockerç„¶åçœ‹ä¸‹æ˜¯å¦å¯ä»¥å®‰è£…æ’ä»¶ã€‚\nå¹¸è¿çš„æ˜¯ï¼Œvscode åœ¨sshé“¾æ¥dockeråæ˜¯å¯ä»¥å®‰è£…clangdå’Œcmakeæ’ä»¶çš„ï¼Œæˆ‘ä»¬åªéœ€å®‰è£…å¥½æ’ä»¶ç„¶åé…ç½®å¥½ä¸‹æ–¹çš„buildçš„ç›¸å…³å‚æ•°ï¼Œç­‰ä»–è‡ªå·±æ„å»ºå³å¯ã€‚\næˆ‘çš„è¯æ˜¯ç”Ÿæˆäº†clangdéœ€è¦ä½¿ç”¨çš„compile_commands.json æ–‡ä»¶ã€‚åœ¨paddleçš„æ ¹ç›®å½•ä¸‹ä½¿ç”¨è¿™ä¸ªå³å¯æˆåŠŸï¼ï¼ˆCMAKE_EXPORT_COMPILE_COMMANDSä¸ºäº†ç”Ÿæˆjsonï¼‰\ncmake . -B build -DPY_VERSION=3.7 -DWITH_GPU=ON -DCMAKE_EXPORT_COMPILE_COMMANDS=1 å®‰è£…ç”Ÿæˆå®Œåé‡å¯vscodeå³å¯çœ‹åˆ°ä¸€ä¸ªindexåŠ è½½è¿‡ç¨‹ï¼Œç­‰å¾…å…¨éƒ¨å®Œæˆåå°±å¯ä»¥ä½“éªŒåŸºæœ¬åŠŸèƒ½çš„è·³è½¬äº†ï¼ˆè™½ç„¶è‚¯å®šè¿˜æ˜¯æ²¡æœ‰clionå¼ºå¤§ï¼Œä½†æ˜¯å¯¹äºæ²¡æœ‰clionçš„æƒ…å†µä¸‹è¿˜éœ€è¦ä»€ä¹ˆè‡ªè¡Œè½¦å‘¢ï¼Ÿè€Œä¸”æ¯”GNU globalçš„æç¤ºè‚¯å®šæ˜¯æ›´å…¨æ›´èˆ’é€‚çš„ï¼‰\nå¦‚æœä½ æƒ³è¦vscodeè¯†åˆ«cmakeå‚æ•°ï¼Œå¯ä»¥åœ¨.vscodeçš„settingsä¸­æ·»åŠ ï¼š\n\u0026#34;cmake.configureArgs\u0026#34;: [ \u0026#34;-DPY_VERSION=3.7\u0026#34;, \u0026#34;-DWITH_GPU=ON\u0026#34;, \u0026#34;-DWITH_TENSORRT=ON\u0026#34;, ], reference ä½¿ç”¨sshè¿æ¥dockeræœåŠ¡å™¨çš„æ–¹æ³•_docker\nhttps://www.anquanclub.cn/6674.html\nã€å¥å¿˜ç¬”è®°ã€‘Clionè¿æ¥dockerè¿œç¨‹å¼€å‘\nhttps://zhuanlan.zhihu.com/p/429270402\nå¤‡å¿˜-Dockerå¸¸ç”¨å‘½ä»¤ å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/410056073 ","date":"2023-02-22T22:18:16+08:00","permalink":"https://sanbuphy.github.io/p/%E7%81%B5%E6%B4%BB%E4%BD%BF%E7%94%A8ide%E6%90%AD%E5%BB%BA%E8%BF%9C%E7%A8%8Bdocker%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/","title":"çµæ´»ä½¿ç”¨IDEæ­å»ºè¿œç¨‹Dockerå¼€å‘ç¯å¢ƒ"},{"content":"å†™åœ¨å‰é¢ æ”¶å½•äº†ä¸ªäººå–œå¥½è§‰å¾—å“å‘³å¥½çš„ç½‘ç«™ï¼ˆä¹Ÿæœ‰ä¸€äº›å°å·¥å…·ï¼‰ï¼Œ\nå¦‚æœæœ‰å…¶ä»–å¥½çš„å»ºè®®ä¹Ÿæ¬¢è¿æå‡ºï¼Œéå¸¸æ„Ÿè°¢ã€‚\nä¸å®šæœŸæ›´æ–°\nå¸¦ç›®å½•è¾¹æ ï¼ˆç”µè„‘ä¸Šå¯çœ‹ï¼‰ï¼šhttps://sanbuphy.github.io/p/æˆ‘çš„è®¡ç®—æœºå­¦ä¹ ç½‘ç«™é›†åˆ/\ngithubå¼€æºä»“åº“åœ°å€ï¼š https://github.com/sanbuphy/my-awesome-cs\nåŸºç¡€ç´ è´¨è¦æ±‚ï¼ˆè‡ªå‹‰ç”¨ï¼Œå‚è€ƒNJUPAå†…çš„è¦æ±‚ï¼‰\næé—®çš„è‰ºæœ¯\nhttps://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md\nä¸åƒå¼±æ™ºä¸€æ ·æé—®\nhttps://github.com/tangx/Stop-Ask-Questions-The-Stupid-Ways/blob/master/README.md\néƒ¨åˆ†å†…å®¹å‡ºè‡ªä»¥ä¸‹å‚è€ƒç½‘ç«™ï¼Œä¹Ÿæ¬¢è¿å…³æ³¨ä»–ä»¬\nPPRPï¼š\nhttps://www.cnblogs.com/pprp/p/8880493.html\nå¦‚éœ€è½¬è½½è¯·æ³¨é‡ŠåŸå‡ºå¤„å³å¯ï¼Œè°¢è°¢\næ•°å­¦ æœºå™¨å­¦ä¹ ç›¸å…³æ•°å­¦åŸºç¡€\nç›´è§‚ç†è§£æœºå™¨å­¦ä¹ çš„æ•°å­¦è¿‡ç¨‹\nçŸ©é˜µæ±‚å¯¼å…¥é—¨ æˆ–è€…ä½ ä¹Ÿå¯ä»¥å‚è€ƒæˆ‘æ•´ç†çš„æ–‡ç« ï¼š\nhttps://sanbuphy.github.io/p/çŸ©é˜µæ±‚å¯¼ç®€æ˜“å…¥é—¨æ‰‹å†Œ/\næèˆªç»Ÿè®¡å­¦ä¹ åŸºç¡€ç¬¬ä¸€ç« è¡¥æ•°å­¦åŸºç¡€ åªéœ€è¦ç¬¬ä¸€å¼  è¡¥åŸºç¡€ï¼Œå…¶ä»–æœ‰é—®é¢˜å†æ‰¾\nDeep Learning An MIT Press bookå‚è€ƒç¬¬ä¸€ç« å³å¯ï¼Œä¸­æ–‡ç‰ˆåœ¨è¿™æˆ–è€…ç›´æ¥ä¸‹è½½é™„ä»¶ä¸­dlbook_cn_v0.5-betaã€‚\næ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ é™ˆå¸Œå­º æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡åŸºç¡€ å‚è€ƒè¯¾ç¨‹è§†é¢‘åœ°å€\nã€æ¦‚ç‡ç»Ÿè®¡è¯¾ç¨‹å­¦ä¹ æ€»ç»“ã€‘1. å°å¤§æ¦‚ç‡ä¸å°æ¹¾äº¤é€šå¤§å­¦ç»Ÿè®¡è¯¾ - å¥¶æ²¹ç…è›‹çº¢çƒ§è‚‰çš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/86071634\nå°æ¹¾å¤§å­¦ - é ‘æƒ³å­¸æ¦‚ç‡ï¼šæ©Ÿç‡ä¸€ (Probability (1))\nå°æ¹¾å¤§å­¦ - é ‘æƒ³å­¸æ¦‚ç‡ï¼šæ©Ÿç‡äºŒ (Probability (2))\nå°æ¹¾äº¤é€šå¤§å­¦ - çµ±è¨ˆå­¸ Statistics\nå°æ¹¾äº¤é€šå¤§å­¦ - é«˜ç­‰çµ±è¨ˆå­¸ Advanced Statistics\nå…¶ä»–\nçº¿ä»£å¯ç¤ºå½•ï¼ˆä¸€ä½æŒæ¡äº†çº¿ä»£çµé­‚çš„è€å¸ˆï¼‰\nhttps://ccjou.wordpress.com/\nimmersive linear algebra çº¿æ€§ä»£æ•°å¯è§†åŒ–\nhttp://immersivemath.com/ila/index.html\nCSå¤§ç±» CSè‡ªå­¦æŒ‡å—ã€å¿…çœ‹ã€‘\nhttps://csdiy.wiki/\nã€åŒ—ç¾åæ ¡CSè¯¾ç¨‹é›†é”¦ã€‘2.åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡CSè¯¾ç¨‹å…¨é›† - æ–‡å…„çš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/102083014\nQuick Referenceå¼€å‘äººå‘˜é€ŸæŸ¥è¡¨ï¼ˆå„ç§è¯­è¨€ã€è„šæœ¬ã€å¸¸ç”¨å·¥å…·çš„å‘½ä»¤é€ŸæŸ¥ï¼‰\nhttps://quickref.me/\nhttps://xushanxiang.com/ref/\nåŸºæœ¬æ“ä½œ GDBã€VIMã€GITã€SHELLç­‰å¸¸è§linuxæ“ä½œåŸºç¡€ï¼ˆæ…¢æ…¢æ¥ï¼Œåœ¨ä½¿ç”¨ä¸­å­¦ The Missing Semester of Your CS Education ä¸­æ–‡ç‰ˆï¼ˆå¼ºçƒˆæ¨èï¼‰ å®˜æ–¹ä¸­æ–‡ç«™ç‚¹ï¼šhttps://missing-semester-cn.github.io/ Bç«™ï¼šhttps://www.bilibili.com/video/BV1x7411H7wa?t=2829 å—å¤§PAæ•™ç¨‹æœ€ä¸‹é¢çš„ä¸€äº›ç®€å•å…¥é—¨å’Œææ–™ https://nju-projectn.github.io/ics-pa-gitbook/ics2021/index.html\nå‘½ä»¤è¡Œçš„è‰ºæœ¯ï¼ˆæ€»ç»“äº†å„ç§å‘½ä»¤è¡Œä¸‹ç›¸å…³å¥½ç‰©ï¼‰ https://github.com/jlevy/the-art-of-command-line å¦‚ä½•å­¦ä¹ å†™shellè„šæœ¬ï¼ˆå°è£…ï¼‰å¯å‚è€ƒçš„é¡¹ç›®ï¼š https://github.com/sanbuphy/vimplus/blob/master/install.sh\nshellå’Œç¨‹åºå¼€å¤´çš„å­—ç¬¦ç”»LOGOç”Ÿæˆå·¥å…· https://tools.kalvinbg.cn/txt/ascii\nç³»ç»Ÿç›¸å…³åŠç³»ç»Ÿä¿¡æ¯ç›¸å…³ å¦‚ä½•å¼€æœºè‡ªåŠ¨æŒ‚è½½æ–°ç¡¬ç›˜ï¼ˆéubuntuå®‰è£…ç¡¬ç›˜ï¼‰\nhttps://blog.csdn.net/qq_27370437/article/details/117806294\nè·å–CPUçš„æ€§èƒ½ä¿¡æ¯å’Œå¸¸è§ä¿¡æ¯ï¼Œæ¶µç›–x86/armç­‰å¤šç¡¬ä»¶\nhttps://github.com/pytorch/cpuinfo\nå¦‚ä½•ç»´æŠ¤å’Œåˆ‡æ¢gccä¸g++ä»£ç ï¼ˆä¸¤ç§æ–¹æ¡ˆï¼‰\næœ€ç®€å•çš„ï¼Œé€šè¿‡è®¾ç½®ä¸åŒä¼˜å…ˆçº§å¹¶åˆ‡æ¢å³å¯ï¼š\n# https://www.cnblogs.com/haiyonghao/p/14440283.html sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 40 # è®¾ç½®gcc-5çš„ä¼˜å…ˆçº§ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 50 # ä¿®æ”¹ç³»ç»Ÿä¸­çš„é»˜è®¤gccç‰ˆæœ¬ sudo update-alternatives --config gcc #å¦‚æœæƒ³è¦æ ¹æ®ä¼˜å…ˆçº§åˆ‡æ¢gccç‰ˆæœ¬ï¼Œå¯ä»¥è¾“å…¥è¿™ä¸ªååœ¨è¾“å…¥å‰é¢è®¾å®šçš„æ•°å­— sudo update-alternatives --config gcc https://blog.csdn.net/FX677588/article/details/78681325\nhttps://cloud.tencent.com/developer/article/1430839\nå¦‚ä½•åŠæ—¶è·å–å¯è§†åŒ–çš„CPUé¢‘ç‡å’Œä½¿ç”¨ç‡ä¿¡æ¯ï¼š(Linux æŸ¥çœ‹CPUå½“å‰è¿è¡Œé¢‘ç‡å’Œæ¸©åº¦)\nsudo pip install s-tui\nsudo s-tui\nvscodeç›¸å…³ è‡ªåŠ¨æ ¼å¼åŒ–pythonä»£ç  é¦–å…ˆå®‰è£…googleçš„æ ¼å¼åŒ–ç¨‹åºï¼špip install yapf\nç„¶åé”®å…¥ctrl+shift+pç„¶åè¾“å…¥settingså¾€ä¸‹æ‰¾åˆ°ç”¨æˆ·çš„jsonï¼Œå¦‚æœä½ æ˜¯WSLçš„è¯å°±è¦æ‰¾åˆ°å¯¹åº”WSLçš„configï¼Œç„¶åè¾“å…¥ \u0026quot;python.formatting.provider\u0026quot;: \u0026quot;yapf\u0026quot;ã€‚ä¹‹ååªè¦ä½¿ç”¨Alt+shift+Få³å¯æ ¼å¼åŒ–æ•´ä½“çš„pythoné¡¹ç›®ä»£ç ã€‚\ngitç›¸å…³ gitå¸¸è§æ“ä½œæ•´ç† https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html\nç®€å•çš„git sshç§˜é’¥æ•™ç¨‹ https://blog.csdn.net/helloasimo/article/details/123778112\næ·»åŠ äº†SSHå¯†é’¥ï¼Œgitæ¨é€/æ‹‰å–æ—¶è¦æ±‚éªŒè¯ https://blog.csdn.net/qq_37435462/article/details/122240506\nç®€å•çš„præ•™ç¨‹ https://mmcv.readthedocs.io/zh_CN/latest/community/pr.html\ngithub linuxä¸‹çš„desktopç‰ˆ https://github.com/shiftkey/desktop/releases\ngitçš„rebaseçš„ä½¿ç”¨è¯´æ˜ï¼ˆå¯ç”¨äºåˆå¹¶å¤šæ¬¡commit,ä¿®æ”¹commitç­‰æƒ…å†µï¼‰ https://www.jianshu.com/p/4a8f4af4e803\nubuntuå¸¸è§ç–‘éš¾è§£ç­” å¿«é€Ÿä¸‹è½½ubuntué•œåƒ: æ‰¾åˆ°å®˜ç½‘ä¸‹è½½é“¾æ¥åä½¿ç”¨wgetä¸‹è½½\nç®€å•å®‰è£…åŒç³»ç»Ÿ\n1ã€å®‰è£…windowsï¼ˆå› ä¸ºwindowsçš„bootä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼‰\n2ã€å®‰è£…ubuntuï¼Œä»–èƒ½æ£€æµ‹åˆ°å’Œwindowså¹¶å­˜çš„çŠ¶æ€ï¼Œé€‰æ‹©é‚£ä¸ªå®‰è£…å³å¯\nç®€å•æ›´æ¢ubuntué•œåƒæº\nSettingsâ†’Aboutâ†’Software Updatesâ†’Download from é€‰æ‹©å…¶ä»–æœåŠ¡å™¨ï¼Œç„¶åæ‰¾åˆ°ä¸­å›½ï¼Œé€‰æ‹©è¿›è¡Œæµ‹è¯•ä»¥ä¾¿æ‰¾åˆ°æœ€å¿«çš„ç«™ç‚¹ã€‚ sudo apt-get update: 0% [æ­£åœ¨ç­‰å¾…æŠ¥å¤´]é—®é¢˜çš„è§£å†³ï¼ˆå‚è€ƒhttps://article.itxueyuan.com/XP2rnï¼‰\nå…ˆæ–­ç½‘ç„¶åæ‰¾åˆ°Settingsâ†’Aboutâ†’Software Updateså…³é—­æ‰€æœ‰ä¸‹è½½ sudo apt-get clean æ¥ä¸‹æ¥å°†/etc/apt/source.listæ–‡ä»¶å†…å®¹æ¸…ç©ºå¹¶ä¿å­˜ æ¢å¤ç½‘ç»œï¼Œå°†ç¬¬ä¸€æ­¥ä¸­å–æ¶ˆæ‰çš„å››ä¸ªé€‰é¡¹é‡æ–°ç‚¹é€‰ç„¶ååœ¨æœ€ä½³å›½å†…æœåŠ¡å™¨æ›´æ–°å³å¯ã€‚ WSL2å¸¸è§ç–‘éš¾è§£ç­” WSLå…¥å‘æŒ‡å—ï¼ˆå¾ˆå…¨çš„èµ„æ–™ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒçš„é…ç½®ï¼‰ https://dowww.spencerwoo.com/\nwindowsä¸Šå®‰è£…ubuntu(WSL2)ï¼š 1ã€åœ¨microsoftä¸‹è½½ubuntu 2ã€æ ¹æ®ä¸‹åˆ—æ–¹å¼å¯¼å‡ºå¹¶å¯¼å…¥é•œåƒï¼Œé˜²æ­¢å ç”¨Cç›˜ç©ºé—´ï¼ˆé»˜è®¤å®‰è£…åœ¨Cç›˜ï¼‰http://t.zoukankan.com/davidchild-p-15606786.html ï¼ˆç”¨è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥åŠæ—¶å¿«ç…§ä¿å­˜~\nWSL2å¸¸ç”¨å‘½ä»¤ï¼ˆå¼€å¯å…³é—­ç”šè‡³æ³¨é”€ç­‰ç­‰ https://learn.microsoft.com/zh-cn/windows/wsl/basic-commands\nå®‰è£…WSL2ä¸“ç”¨systemctlã€ç›®å‰ï¼ˆ2023/02/02ï¼‰åªèƒ½ç”¨äº20.04,è¯·å‹¿åœ¨22.04ä¸­ä½¿ç”¨ï¼ã€‘ï¼ˆæ…é‡ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´pycharmè¿æ¥å‡ºç°é—®é¢˜ï¼Œè¯·å…ˆå¿«ç…§åå†è¿›è¡Œå°è¯•ï¼ https://github.com/DamionGans/ubuntu-wsl2-systemd-script\nWSLä¸­å¦‚ä½•ä½¿ç”¨win v2rayçš„proxyï¼šï¼ˆç›´æ¥åœ¨wslé‡Œé¢è·‘å³å¯ï¼‰ ç¬¬ä¸€æ­¥ å®‰è£…ï¼šhttps://github.com/v2fly/fhs-install-v2rayï¼ˆå®‰è£…åå…¶ä»–æ­¥éª¤å‚è€ƒhttps://gukaifeng.cn/posts/linux-pei-zhi-v2ray-he-proxychains-shi-xian-ming-ling-xing-dai-li-wu-tu-xing-jie-mian/#1-3-å¯åŠ¨-V2Ray ç¬¬äºŒæ­¥ å¯åŠ¨ï¼šï¼ˆå› ä¸ºWSLæ— æ³•ç”¨systemctlï¼Œæ‰€ä»¥ç›´æ¥è¿è¡Œå³å¯ï¼ˆæˆ–è€…è‡ªå·±å»å®‰è£…ä¸€ä¸‹wsl2çš„systemctlï¼‰ï¼Œä½ å¯ä»¥åå°è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œèµ·æ¥ï¼Œç„¶åæ–°å¼€ä¸€ä¸ªç»ˆç«¯å»export ALLproxyä¹‹ç±»çš„å°±å¥½ï¼Œå‚è€ƒdockerçš„åšæ³•ï¼Œæˆ–è€…ä½¿ç”¨proxychains4ä¹Ÿå¯ä»¥ã€‚ï¼‰åœ¨ç»ˆç«¯ä¸­è¿è¡Œ/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json å³å¯å¯åŠ¨ï¼ ç¬¬ä¸‰æ­¥ ä½¿ç”¨ï¼šå°±å½“ä½œä¸€ä¸ªå·²ç»ç›‘å¬äº†æŸä¸ªç«¯å£çš„proxyä½¿ç”¨å³å¯ æ³¨é‡Šï¼šå½“ç„¶ï¼Œä¸ºäº†æ–¹ä¾¿ä½ å¯ä»¥è‡ªè¡Œæ”¹é€ ï¼Œä½¿ç”¨ /etc/init.d/ ç›®å½•ä¸­çš„æœåŠ¡å‘½ä»¤æˆ– service å‘½ä»¤æ›¿ä»£systemctlã€‚ æ³¨æ„ï¼WSL2ç»å¸¸ä¼šä¸ä¸»æœºæ—¶é—´ä¸åŒæ­¥ï¼Œè¿™å¯èƒ½ä¼šé€ æˆå¾ˆå¤šé—®é¢˜ï¼ˆåŒ…æ‹¬proxyç”¨ä¸äº†ï¼‰ï¼Œä½ æœ€å¥½è®¾ç½®ä¸€ä¸ªå¯åŠ¨è„šæœ¬æˆ–è‡ªå·±æ‰§è¡Œsudo hwclock -så¼ºåˆ¶å¯¹WSL2æ—¶é—´è¿›è¡ŒåŒæ­¥ï¼Œå¯ä½¿ç”¨sudo hwclockæŸ¥çœ‹WSLçš„å½“å‰æ—¶é—´ï¼Œ ä»¥é˜²å‡ºç°å¥‡æ€ªé—®é¢˜ä½ å¯ä»¥ç»å¸¸å¯¹WSLåšå¿«ç…§ï¼šhttps://blog.csdn.net/weixin_43425561/article/details/115765148 æ”¹å˜/å¢åŠ WSL2çš„å†…å­˜ã€swapç©ºé—´å¤§å° åœ¨Cç›˜çš„ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼ˆæ¯”å¦‚æˆ‘çš„æ˜¯C:\\Users\\sanbuï¼‰åˆ›å»º.wslconfigæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢è¾“å…¥\n[wsl2] memory=8GB swap=16GB # ä¸º WSL 2 è™šæ‹Ÿæœºåˆ†é…çš„å¤„ç†å™¨æ ¸å¿ƒæ•°é‡ # processors=\u0026lt;number\u0026gt; åœ¨é…ç½®è®¾ç½®å®Œä¹‹åï¼Œåœ¨powershellæ‰§è¡Œwsl --shutdownå‘½ä»¤è¿›è¡Œå…³é—­ï¼Œéšåå†æ‰“å¼€å³å¯ï¼ˆæ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨äº†docker-desktopï¼Œå®é™…ä¸Šä¹Ÿæ˜¯åŸºäºwsl2æ„å»ºçš„ï¼Œæ‰€ä»¥ä¹Ÿä¼šå½±å“åˆ°çš„å¯¹åº”ç¯å¢ƒçš„èµ„æº\nwindowså¸¸è§å·¥å…·ç®± æœ‰å…³winå®¶çš„é•œåƒæºä»¥åŠVSç­‰çš„çº¯å‡€å®‰è£…æ–‡ä»¶ï¼Œä»¥åŠå„ç§ç½‘ç»œå·¥ç¨‹å¸ˆèƒ½ç”¨åˆ°çš„è½¯ä»¶ç¨‹åºå®‰è£…åŒ… https://msdn.itellyou.cn/\nå›¾å§å·¥å…·ç®±ï¼ˆç»™è‡ªå·±ç”µè„‘åšç¡¬ä»¶åˆ†æç­‰ç­‰ http://www.tbtool.cn/\nDISM++ æœ€å¥½ç”¨çš„windowsæ§åˆ¶é¢æ¿å·¥å…·ç®±ï¼ˆç›´æ¥çœ‹releaseéƒ¨åˆ†ä¸‹è½½ https://github.com/Chuyu-Team/Dism-Multi-language\nUbuntu - bashè„šæœ¬ä¸ Windows - bat è„šæœ¬äº’ç›¸è½¬æ¢å·¥å…·ï¼ˆBash to Bat Converter https://daniel-sc.github.io/bash-shell-to-bat-converter/\nwindows-linuxå‘½ä»¤è¡Œå¯¹ç…§è¡¨ https://www.geeksforgeeks.org/linux-vs-windows-commands/\næ­£åˆ™è¡¨è¾¾å¼ç›¸å…³ æ­£åˆ™è¡¨è¾¾å¼å…¥é—¨ä¸ç»ƒä¹  https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md\næ­£åˆ™è¡¨è¾¾å¼å¯è§†åŒ–æµè§ˆ https://regexr.com/\né•¿æ­£åˆ™è¡¨è¾¾å¼ç»“æ„å¯è§†åŒ– https://regexper.com/\nå¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼æ±‡æ€»ï¼ˆè½¦ç‰Œå·æ‰‹æœºå·å§“åIPç­‰ç­‰ï¼‰ http://obkoro1.com/web_accumulate/codeBlack/æ­£åˆ™è¡¨è¾¾å¼æ”¶é›†.html\ndockerç›¸å…³ dockerçš„ä¸€åˆ‡ï¼š https://yeasy.gitbook.io/docker_practice/\nåœ¨WSL2ä¸‹ä½¿ç”¨docker ã€ä½ åªéœ€è¦å®‰è£…docker desktopç„¶åå‚è€ƒè¿™ä¸ªæ•™ç¨‹ï¼Œç‚¹ç‚¹å°±èƒ½ç”¨äº†ã€‘ï¼š\nhttps://dockerdocs.cn/docker-for-windows/wsl/\nå¯ä»¥å¾ˆæ–¹ä¾¿ä½¿ç”¨ï¼æ— éœ€æŒ‰ç…§å‘½ä»¤è¡Œå®‰è£…å³å¯ä½¿ç”¨dockerï¼\nå®‰è£…dockeråå¯åŠ¨æ—¶é‡åˆ°ï¼šFailed to connect to bus: Host is downï¼ˆæˆ‘åœ¨WSL2é‡åˆ°ï¼Œéå¿…è¦ä¸ä½¿ç”¨ï¼Œæœ€å¥½è¿˜æ˜¯å…ˆå®‰è£…ä¸€ä¸‹systemctlç¡®ä¿èƒ½ç”¨ï¼‰ # è¿è¡Œä¸‹åˆ—æ“ä½œå³å¯ï¼Œç„¶å sudo systemctl daemon-reload # https://gist.github.com/alyleite/ca8b10581dbecd722d9dcc35b50d9b2b sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -yqq daemonize dbus-user-session fontconfig sudo daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target exec sudo nsenter -t $(pidof systemd) -a su - $LOGNAME snap version ä½¿dockerèƒ½å¤Ÿé¿å…è¾“å…¥sudoï¼ˆé€šè¿‡ docker infoæ£€æŸ¥æ˜¯å¦è¦sudoæ‰å¯è¾“å‡ºï¼‰ https://www.yisu.com/zixun/139260.html\nNVIDIA dockerâ€”â€”nvidia-docker2çš„ç›¸å…³å®‰è£… https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker\ndockeræ¢æºï¼ˆæ‹‰é•œåƒæå¤§åŠ é€Ÿï¼‰ https://blog.51cto.com/u_13281972/2997681\nä¿®æ”¹Dockeré»˜è®¤é•œåƒå’Œå®¹å™¨çš„å­˜å‚¨ä½ç½® https://www.cnblogs.com/chentiao/p/16963647.html\ndocker pull images â€” use proxy https://www.lfhacks.com/tech/pull-docker-images-behind-proxy/\ndocker â€” use proxyï¼ˆåœ¨å®¹å™¨å†…ï¼‰ æ–¹æ³•ä¸€ï¼š\n-it ä»¥åŠåŠ ä¸Šäº†hostå‘½ä»¤è¿›å…¥dockeråï¼ˆæ¯”å¦‚ï¼šï¼‰\nnvidia-docker run --name paddle-test -v $PWD:/paddle --network=host -it [registry.baidubce.com/paddlepaddle/paddle:latest-gpu-cuda10.2-cudnn7-dev](http://registry.baidubce.com/paddlepaddle/paddle:latest-gpu-cuda10.2-cudnn7-dev) /bin/bash æ­¤æ—¶åœ¨å†…éƒ¨å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç½‘å¡ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬172ipçš„æŸä¸ªç«¯å£ï¼Œç„¶åä½¿ç”¨\nexport ALL_PROXY=\u0026quot;http://172.17.0.1:8888/\u0026quot;\nexport ALL_PROXY=socks5://172.17.0.1:1088 å³å¯ä½¿ç”¨proxyã€‚ï¼ˆæœ‰æ—¶å€™è¿˜ä¸å¤Ÿç”¨ï¼Œå¯ä»¥åŠ ä¸Šhttpsçš„ï¼‰ï¼ˆä¸éœ€è¦host network åªéœ€è¦bind 172å³å¯ä½¿ç”¨ï¼‰\nexport http_proxy=\u0026#34;http://172.17.0.1:8888/\u0026#34; export HTTP_PROXY=\u0026#34;http://172.17.0.1:8888/\u0026#34; export https_proxy=\u0026#34;http://172.17.0.1:8888/\u0026#34; export HTTPS_PROXY=\u0026#34;http://172.17.0.1:8888/\u0026#34; æ–¹æ³•äºŒï¼š\nmake sure your proxy bind 172.17.0.1 and port (e.g. 8888) add that in dockerfile ENV http_proxy \u0026#34;http://172.17.0.1:8888/\u0026#34; ENV HTTP_PROXY \u0026#34;http://172.17.0.1:8888/\u0026#34; ENV https_proxy \u0026#34;http://172.17.0.1:8888/\u0026#34; ENV HTTPS_PROXY \u0026#34;http://172.17.0.1:8888/\u0026#34; run it **æ–¹æ³•ä¸‰ï¼š**è¿è¡Œç»ˆç«¯ç‰ˆçš„v2rayä¹‹ç±»çš„è½¯ä»¶ï¼Œåå°è¿è¡Œåç›´æ¥ä½¿ç”¨proxychains4çš„httpä»£ç†å³å¯ï¼ˆå¾ˆå¤šä¸èƒ½èµ°sockerï¼‰\næ³¨é‡Šï¼šå¦‚æœè€Œåœ¨ç»ˆç«¯é‡åˆ°curlä¹‹ç±»çš„å¥‡æ€ªçš„httpé—®é¢˜ï¼Œè¯·env|grepæŸ¥çœ‹æœ‰æ— å¥‡æ€ªçš„ç¯å¢ƒå˜é‡æˆ–è€…å…³é—­proxyçš„ç³»ç»ŸproxyåŠŸèƒ½ã€‚å› ä¸ºæ— éœ€å¼€å¯ä¹Ÿå¯ä»¥æ“ä½œã€‚\ndockerç£ç›˜å ç”¨æŸ¥çœ‹ä¸ç¼“å­˜æ¸…ç† https://blog.csdn.net/m0_67390963/article/details/126327604\nåˆ©ç”¨dockerè°ƒè¯•ä»£ç ï¼Œä»¥apolloä¸ºä¾‹ï¼š https://zhuanlan.zhihu.com/p/468146522\nå¯¼å‡ºè‡ªå·±çš„é•œåƒå’Œå¯¼å…¥ï¼š https://yeasy.gitbook.io/docker_practice/container/import_export\næäº¤è‡ªå·±çš„é•œåƒåˆ°dockehubï¼š(ä½ ä¹Ÿå¯ä»¥å‚è€ƒä¸Šé¢æåˆ°çš„dockerçš„ä¸€åˆ‡ï¼Œé‡Œé¢ä»€ä¹ˆéƒ½æœ‰ã€‚ å¯å‚è€ƒ https://blog.csdn.net/butterfly5211314/article/details/83068807\nä¸çŸ¥é“å˜é‡æ€ä¹ˆå‘½åå°±å¯ä»¥çœ‹çœ‹ï¼š\nhttps://unbug.github.io/codelf/\nå…¶ä»–æœ‰è¶£çš„æ–‡ç«  æœ‰å…³linuxçš„åŸºç¡€è®²è§£ï¼Œæœ‰é…å›¾å’Œè‡ªå·±çš„ç†è§£ï¼Œæ¨èä¸€è¯»ã€‚\nhttps://segmentfault.com/u/public0821\nä¸€ä¸ªå¯¹cpuå’Œç½‘ç»œäº†è§£éƒ½éå¸¸æ·±å…¥çš„å·¥ç¨‹å¸ˆ\nhttps://plantegg.github.io/\nå…¶ä¸­æœ€å¥½çš„ä¸€ç±»æ–‡ç« ï¼ˆæœ‰å…³cpuçš„è®²è§£ï¼‰https://plantegg.github.io/2021/06/01/CPUçš„åˆ¶é€ å’Œæ¦‚å¿µ/\nä¸€ä¸ªå…³äºå„ç§ç”Ÿæˆç½‘ç»œå’Œç¼–ç å™¨å°è®ºæ–‡é€šè¯»çš„åšä¸»ï¼Œæœ‰äº›å†™çš„è¿˜å¯ä»¥ï¼ˆæ¯”è¾ƒåŸºç¡€å…¥é—¨ï¼‰\nhttps://medium.com/@falconives\njavaç›¸å…³æŠ€æœ¯æ ˆèµ„æ–™å¤§å…¨åšä¸»ï¼ˆè¿˜æœ‰ä¸€äº›ä¸‰å¤§ä»¶ç›¸å…³çš„èµ„æ–™ï¼Œè¿˜æŒºå¤š\nhttp://learn.lianglianglee.com/\nLinuxæ€§èƒ½åˆ†æå·¥å…·å¤§å…¨ï¼ˆLinux/BSDæ€§èƒ½ä¸“å®¶Brendan Greggï¼‰\nhttps://www.brendangregg.com/linuxperf.html\né¢å‘ç¨‹åºå‘˜çš„å„ç±»è°ƒç”¨åº“æ¸…å•ï¼ˆä¸»è¦æ˜¯C/C++ PYTHON)\nhttps://github.com/programthink/opensource\nGitHubä¸­æ–‡æ’è¡Œæ¦œ\nhttps://github.com/GrowingGit/GitHub-Chinese-Top-Charts\nGitHub ä¸Šæœ‰è¶£ã€å…¥é—¨çº§çš„å¼€æºé¡¹ç›®\nhttps://github.com/521xueweihan/HelloGitHub\nç¾åŒ–è‡ªå·±çš„githubç•Œé¢\nhttps://zhuanlan.zhihu.com/p/454597068\ngithub.com/rzashakeri/beautify-github-profile\nhttps://bowenyoung.cn/posts/githubBeautify\nç¤¾åŒºåˆ¶ä½œçš„ä¸€é”®ç”Ÿæˆç•Œé¢ï¼šhttps://rahuldkjain.github.io/gh-profile-readme-generator/\nå…¬ä¼—å· / çœŸæ²¡ä»€ä¹ˆé€»è¾‘çš„ä½œè€…ï¼ˆä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ç³»åˆ—æ–‡ç« ï¼‰æ¶‰åŠç½‘ç»œã€æ•°æ®åº“ã€æ“ä½œç³»ç»Ÿç­‰\nhttps://draveness.me/whys-the-design/\nRoadmap to becoming a developer\nhttps://github.com/kamranahmedse/developer-roadmap\nå°æ— x å›¾è§£è®¡ç®—æœºåŸºç¡€ï¼ˆå›½å†…æœ€å¥½çš„å…«è‚¡æ–‡æ•´ç†ä¹‹ä¸€ï¼‰ï¼ˆå›¾è§£ç½‘ç»œå’Œæ“ä½œç³»ç»Ÿï¼‰\nhttps://xiaolincoding.com/\nlinux inside è®²è§£äº†ä¸€ä¸‹linuxå†…éƒ¨è¿è¡Œæœºåˆ¶ï¼Œæ¯”å¦‚Program startup process in userspace\nhttps://0xax.gitbooks.io/linux-insides/content/Misc/linux-misc-4.html\nè‹å‰‘æ—çš„ç©ºé—´ï¼ˆä»æ•°å­¦å†åˆ°NLPå†åˆ°å¤©æ–‡éƒ½æœ‰æ¶‰çŒ\nhttps://spaces.ac.cn/\næ“ä½œç³»ç»Ÿä¸ä½“ç³»ç»“æ„ å—äº¬å¤§å­¦è®¡ç®—æœºåŸºç¡€ï¼ˆè¢æ˜¥é£ï¼‰CSAPPçš„é’æ˜¥ç‰ˆï¼Œä½†æ¯”csappå¥½æ‡‚å¾—å¤šï¼ˆå¼ºçƒˆä¸å»ºè®®ä¸€å¼€å§‹å°±è¯»csapp\nèµ¶æ—¶é—´å¯ä»¥ç›´æ¥çœ‹é…å¥—ä¹¦ã€‚\nhttps://www.icourse163.org/course/nju-1001625001#/info\nå‰ç½®ï¼šå—äº¬å¤§å­¦è®¡ç®—æœºåŸºç¡€å®éªŒï¼ˆåšäº†èƒ½è®©ä½ çœŸçš„å˜å¼ºï¼‰https://nju-projectn.github.io/ics-pa-gitbook/ics2021/index.html\n2022 å—äº¬å¤§å­¦æ‹”å°–è®¡åˆ’ã€Šæ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°ã€‹\n(è’‹ç‚å²© æˆ‘æ°¸è¿œçš„è¶…çº§æ— æ•Œé…·ç‚«å®è—ç”·ç¥ï¼Œè¿˜æœ‰ä»€ä¹ˆå¥½è¯´çš„å‘¢ï¼Ÿæ²¡æœ‰ä»–æˆ‘å°±æ°¸è¿œä¸æ‡‚è®¡ç®—æœºçš„ç¾ä¸½\nå½“ç„¶åŒ…äº‘å²—è€å¸ˆä¹Ÿæ˜¯æˆ‘çš„ç”·ç¥å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ)\nè¯¾ç¨‹ä¸»é¡µï¼šhttp://jyywiki.cn/OS/2022/ (slidesã€ç¤ºä¾‹ä»£ç )\nè§†é¢‘åœ°å€ï¼š https://www.bilibili.com/video/BV1Cm4y1d7Ur/\næ“ä½œç³»ç»Ÿï¼ˆå“ˆå·¥å¤§ææ²»å†›è€å¸ˆï¼‰è¯¾ä»¶å¯åœ¨ä¸‹æ–¹é“¾æ¥è·å–ã€‚\næ…•è¯¾ç½‘: http://www.feemic.cn/mooc/icourse163/1002692015#ã€‚ ç™¾åº¦äº‘é“¾æ¥ï¼šhttps://pan.baidu.com/s/1h2aEk6A_DGpXkZvRtNmeUw æå–ç ï¼šqoll é…å¥—å®éªŒè¯¾ï¼šhttps://www.shiyanlou.com/courses/115 MIT 6.S081: Operating System Engineering\nhttps://csdiy.wiki/æ“ä½œç³»ç»Ÿ/MIT6.S081/\næµ™æ±Ÿå¤§å­¦å‘¨äºšé‡‘è€å¸ˆçš„æ“ä½œç³»ç»Ÿè¯¾è¯¾ä»¶ï¼ˆå†™çš„å¾ˆå¥½ï¼Œæœ‰æ“ä½œå’Œç°ä»£çš„ä¸€äº›è§„èŒƒå¤‡æ³¨ï¼Œæˆ‘å¾ˆå–œæ¬¢ï¼‰\nåœ¨Scheduleä¸­å¯ä»¥è·å–åˆ°å…¨éƒ¨è¯¾ä»¶\nhttps://yajin.org/os2018fall/\nå—äº¬å¤§å­¦è½¯ä»¶åˆ†æè¯¾ç¨‹ï¼š\nhttps://tai-e.pascal-lab.net/pa1.html#_1-ä½œä¸šå¯¼è§ˆ\nhttps://space.bilibili.com/2919428/channel/series\næ•™ç§‘ä¹¦ã€Šè®¡ç®—æœºä½“ç³»ç»“æ„åŸºç¡€ã€‹ï¼ˆèƒ¡ä¼Ÿæ­¦ç­‰ï¼Œç¬¬ä¸‰ç‰ˆï¼‰çš„å¼€æºç‰ˆæœ¬\nhttps://github.com/foxsen/archbase\nã€MITå…¬å¼€è¯¾ã€‘6.172 è½¯ä»¶æ€§èƒ½å·¥ç¨‹\nhttps://www.bilibili.com/video/BV1wA411h7N7/\nå…¶ä»–æœ‰è¶£æ–‡ç« :\nå¦‚ä½•å®ç°ä¸€ä¸ªelfçš„loaderï¼šhttps://blog.csdn.net/GoolyOh/article/details/119801160\nä»ä¸€ä¸ªELFç¨‹åºçš„åŠ è½½çª¥æ¢æ“ä½œç³»ç»Ÿå†…æ ¸:\nhttps://blog.csdn.net/goolyoh/category_11298420.html\nå¦‚ä½•å®ç°æœ€å°çš„hello world?\nhttps://cjting.me/2020/12/10/tiny-x64-helloworld/\nLinux å†…æ ¸æ­å¯†ï¼ˆä¸€ç³»åˆ—å…³äº Linux å†…æ ¸å’Œå…¶å†…åœ¨æœºç†çš„å¸–å­ã€‚ï¼‰\nhttps://xinqiu.gitbooks.io/linux-inside-zh/content/\nè®¡ç®—æœºç½‘ç»œå­¦ä¹  è¯¾ç¨‹ç±»å¾…è¡¥å……\nå…¶ä»–æ–‡ç« ï¼š\ntcpé«˜çº§ç–‘éš¾æ±‡æ€»æ¡ˆä¾‹åˆ†æï¼šplantegg.github.io/2021/02/14/TCPç–‘éš¾é—®é¢˜æ¡ˆä¾‹æ±‡æ€»/\nè¿™ä¸ªåšä¸»å†™äº†ç½‘ç»œç¼–ç¨‹ç›¸å…³çš„ä¸€ç³»åˆ—æ–‡ç« ï¼šhttps://juejin.cn/user/862486453028888/posts\nå…¶ä¸­æˆ‘æœ€å–œæ¬¢ï¼šNginxä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–ï¼š\nhttps://juejin.cn/post/7112826654291918855\næœ‰å‰ç«¯NginxæœåŠ¡å™¨åœ¨çº¿é…ç½®ï¼ŒåŠå¤§æ”¹å–„ä¿®æ”¹nginxçš„é…ç½®ä½“éªŒ\nhttps://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN\né¡¹ç›®æ¥æºï¼šhttps://github.com/digitalocean/nginxconfig.io\næ•°æ®ç»“æ„ä¸ç®—æ³• ç¨‹åºå‘˜å¦‚ä½•å‡†å¤‡é¢è¯•ä¸­çš„ç®—æ³•\nhttps://wizardforcel.gitbooks.io/the-art-of-programming-by-july/content/00.01.html\nlabuladong çš„ç®—æ³•å°æŠ„\nhttps://github.com/labuladong/fucking-algorithm\nACWINGçš„è¯¾\nhttps://www.acwing.com/activity/\nGitHub\u0026rsquo;s largest open-source algorithm library\nhttps://the-algorithms.com/\næ•°æ®ç»“æ„ä¸ç®—æ³•å¯è§†åŒ–\nhttps://visualgo.net/zh\nè®¾è®¡æ¨¡å¼ ä¸€ä¸ªå›¾æ–‡å¹¶èŒ‚çš„è®¾è®¡æ¨¡å¼å­¦ä¹ ç½‘ç«™\nrefactoringguru.cn/design-patterns\næ·±åº¦å­¦ä¹ å¤§ç±» ç†è®ºåŸºç¡€ï¼ˆæ—¶é—´å°‘ç›´æ¥çœ‹ææ²/æå®æ¯…ï¼‰ å‘¨å¿—å\nå—ç“œä¹¦ä¸»é¡µ\nhttps://datawhalechina.github.io/pumpkin-book/#/\nå‘¨å¿—åã€Šæœºå™¨å­¦ä¹ ã€‹æ‰‹æ¨ç¬”è®° by Sophia-11\nhttps://github.com/Sophia-11/Machine-Learning-Notes\nå‘¨å¿—åã€Šæœºå™¨å­¦ä¹ ã€‹ç¬”è®°ï¼ˆä¸»è¦æ˜¯æ–‡æœ¬ï¼‰ by yv.l1.pnn\nhttps://zhuanlan.zhihu.com/p/134089340\næå®æ¯…ç›¸å…³è¯¾ç¨‹ æå®æ¯…è€å¸ˆçš„è¯¾ç¨‹ä¸»é¡µï¼š https://speech.ee.ntu.edu.tw/~hylee/index.phpÂ è¿™æ˜¯æè€å¸ˆçš„ä¸ªäººä¸»é¡µï¼Œå¯ä»¥æ‰¾åˆ°æ¯å¹´MLçš„è¯¾ç¨‹ä¸»é¡µï¼Œç„¶åè·å–ä½œä¸šä»£ç å’ŒKaggleé“¾æ¥\næå®æ¯…ã€Šæœºå™¨å­¦ä¹ ã€‹ï¼š https://www.bilibili.com/video/BV1Ht411g7Ef\næå®æ¯…æœºå™¨å­¦ä¹ ç¬”è®°ï¼š https://gitee.com/datawhalechina/leeml-notes\næå®æ¯…ã€Šæœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ ã€‹2021è¯¾ç¨‹ï¼š https://www.bilibili.com/video/BV1JA411c7VT?p=34\næå®æ¯…2022è¯¾ç¨‹ï¼š https://www.bilibili.com/video/BV1JK4y1D7Wb/\nææ²åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ï¼ˆé€‚åˆé€Ÿæˆï¼Œæ‰“åŸºç¡€å»ºè®®æå®æ¯…ï¼‰\nhttps://zh.d2l.ai/index.html\nææ²æ·±åº¦å­¦ä¹ ç²¾è¯»\nhttps://github.com/mli/paper-reading\nè¿™ä¸ªç½‘ç«™ç»™å‡ºäº†ä¸åŒæ¨¡å‹çš„æ’ååŠå…¶å¼€æºä»£ç \nhttps://paperswithcode.com/\npytorchåº•å±‚æºç è§£æï¼ˆä¸€ä¸ªå¾ˆä¸é”™çš„åšä¸»ï¼‰\nhttps://www.cnblogs.com/rossiXYZ/category/1626268.html?page=5\næ‰‹å†™æ·±åº¦å­¦ä¹ å…¥é—¨é¡¹ç›® å°åœŸå † pytorchå­¦ä¹ \nhttps://space.bilibili.com/203989554\néœ¹é›³å§å•¦Wz å›¾åƒåˆ†ç±»ç¯‡ç«  ä»¥åŠç›®æ ‡æ£€æµ‹\nhttps://space.bilibili.com/18161609/channel/collectiondetail?sid=48290\næ‰‹å†™YOLOç³»åˆ—å’Œfast rcnnç³»åˆ—ï¼š\nhttps://www.bilibili.com/video/BV1JR4y1g77H\nhttps://space.bilibili.com/472467171\nå¼€æºåº“/é¡¹ç›® OpenMMLab\nhttps://openmmlab.com/\nhttps://github.com/open-mmlab\npaddle\nhttps://github.com/PaddlePaddle\nDeep Learning Paper Implementations\nhttps://github.com/labmlai/annotated_deep_learning_paper_implementations\nAwesome Machine Learning\nhttps://github.com/josephmisiti/awesome-machine-learning\nAwesome Deep Learning\nhttps://github.com/ChristosChristofidis/awesome-deep-learning\nã€æ‚è°ˆã€‘GitHubä¸Šçš„æœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ ç»¼è¿°é¡¹ç›®åˆé›† - è¨€æœ‰ä¸‰çš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/60245227\nåæ ¡ä¸“ï¼Œæ›¾ä»»é˜¿é‡Œå·´å·´èµ„æ·±ç®—æ³•å·¥ç¨‹å¸ˆ å¤šå¹´ä»¥æ¥å­¦ä¹ æ€»ç»“çš„ç¬”è®°ï¼ˆæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ï¼‰\nhttps://www.huaxiaozhuan.com/\næœ‰å…³å®è·µæ–¹æ³•è®ºçš„æ€»ç»“ï¼šhttps://www.huaxiaozhuan.com/æ·±åº¦å­¦ä¹ /chapters/18_practical.html\nç‹æ ‘æ£®ï¼ˆå°çº¢ä¹¦ç®—æ³•å·¥ç¨‹å¸ˆã€åŸºç¡€æ¨¡å‹å›¢é˜Ÿè´Ÿè´£äººï¼‰è€å¸ˆçš„æ¨èç³»ç»Ÿã€å¼ºåŒ–å­¦ä¹ ç›¸å…³è¯¾ç¨‹\nhttps://github.com/wangshusen/RecommenderSystem\nhttps://github.com/wangshusen/DRL\nåœ¨çº¿æ•°æ®é›†ç½‘ç«™ https://universe.roboflow.com/\nNLPDataSetï¼ˆåˆ˜èªNLPæ”¶é›†çš„å„ç§nlpæ•°æ®é›†ï¼Œæ¥è¿‘50ä¸ªã€‚ã€‚ã€‚ï¼‰\nhttps://github.com/liucongg/NLPDataSet\n3Dæ„ŸçŸ¥ç›¸å…³ ä»é›¶å¼€å§‹æ­ä¸€å¥—æ¿€å…‰SLAMå‡ºæ¥, é€šè¿‡ä»£ç çš„è§’åº¦ä¸€ç‚¹ä¸€ç‚¹åœ°æ·±å…¥å­¦ä¹ æ¿€å…‰SLAM.\nhttps://github.com/xiangli0608/Creating-2D-laser-slam-from-scratch\nNVIDIAç¯å¢ƒé…ç½®å¸¸è§é—®é¢˜ æ˜¾å¡é©±åŠ¨å®‰è£…å¿«é€Ÿæ–¹æ³•ï¼š ubuntu-drivers devices\nsudo apt install è¾“å…¥æ˜¾ç¤ºçš„æ¨èç‰ˆæœ¬\nCUDAä¸cuDNNçš„å®‰è£…ï¼šï¼ˆç›´æ¥å®˜ç½‘é€‰æ‹©ï¼‰ æ³¨æ„ï¼ša100å’Œ3090tiä¸æ”¯æŒcuda11ä»¥ä¸‹ï¼Œè¯·è£…113ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚\næ¨èè£…cudaçš„æ—¶å€™å¯ä»¥ç”¨shçš„æ¨¡å¼ï¼Œç„¶åé¡ºå¸¦å®‰è£…äº†é©±åŠ¨ï¼ˆä¹‹å‰å°±ä¸ç”¨è£…äº†ï¼‰å¯¹åŠ¨æ€åº“çš„é»˜è®¤æ”¯æŒæ›´å¥½\næ•™ç¨‹å¯å‚è€ƒï¼šhttps://blog.csdn.net/tangjiahao10/article/details/125227005\nhttps://blog.csdn.net/weixin_37926734/article/details/123033286\ncudnnçš„å¸è½½å¯å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/83971195\n(æ³¨æ„ï¼Œè¿™é‡Œé»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ï¼Œä½ éœ€è¦åœ¨å³ä¸‹è§’è¿›å…¥æ¡£æ¡ˆé€‰æ‹©å¯¹åº”ç‰ˆæœ¬å®‰è£…,æˆ–åœ¨ä¸‹é¢çš„ç½‘é¡µä¸­æ‰¾åˆ°archiveï¼‰\nArchive of Previous CUDA Releases https://developer.nvidia.com/cuda-downloads\nhttps://developer.nvidia.com/rdp/cudnn-archive\ncudnnçš„å®˜æ–¹å®‰è£…æ•™ç¨‹ï¼ˆé€šè¿‡taræ–‡ä»¶è‡ªå·±cpæˆ–è€…æ ¹æ®æ•™ç¨‹å®‰è£…debï¼‰\nhttps://docs.nvidia.com/deeplearning/cudnn/install-guide/index.html\nTensorRTçš„å®‰è£…ï¼ˆå‚è€ƒDebian Installationï¼‰\nhttps://docs.nvidia.com/deeplearning/tensorrt/install-guide/index.html#installing-debian\nå®‰è£…cudaç»“æŸåè®°å¾—æŠŠè¿™ä¸¤ä¸ªå‘½ä»¤åŠ å…¥åˆ°~/.bashrc ç„¶åsourceã€‚ å¦‚æœä½ æƒ³è¦ä¿®æ”¹ç‰ˆæœ¬ï¼Œå¯ä»¥ä¿®æ”¹cudaçš„è½¯é“¾æ¥ï¼ˆé€‰æ‹©å…¶ä»–ç‰ˆæœ¬çš„cudaï¼‰ï¼Œæˆ–è€…åœ¨bashrcä¸­çš„cudaåé¢åŠ ä¸Šç‰ˆæœ¬ï¼Œå¦‚cuda-11.2\nï¼ˆå…·ä½“çš„å®‰è£…å’Œå¸è½½ä¹Ÿå¯ä»¥å‚è€ƒhttps://flywine.blog.csdn.net/article/details/81879514ï¼‰\nexport PATH=\u0026#34;/usr/local/cuda/bin:$PATH\u0026#34; export LD_LIBRARY_PATH=\u0026#34;/usr/local/cuda/lib64:$LD_LIBRARY_PATH\u0026#34; è§£å†³nvccç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜ï¼ˆå¯èƒ½çš„æ–¹æ³•ï¼Œæ›´æ¢runtimeæ˜ å°„\nhttps://qiyuan-z.github.io/2022/01/06/è§£å†³nvidia-smiå’Œnvccæ˜¾ç¤ºä¿¡æ¯ä¸æ‰€å®‰è£…CUDAç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜/\nè§£å†³cudnnæ‰¾ä¸åˆ° é—®é¢˜ï¼ˆè½¯è¿æ¥åˆ°ç³»ç»Ÿåº“ï¼‰\nhttps://blog.csdn.net/qq451882471/article/details/106967942\nCUDA GPG Repository Key\nhttps://forums.developer.nvidia.com/t/notice-cuda-linux-repository-key-rotation/212772\nTensorrt X dockerç¯å¢ƒæ­å»ºï¼ˆç°åœ¨ï¼ˆ20221228ï¼‰tensorrt-ubuntuå·²ç»æ”¯æŒdebå®‰è£…ï¼Œå¦‚æœtarå°±é€‰linuxçš„ï¼‰\nhttps://blog.csdn.net/hxj0323/article/details/115859174\nupdateånvidiaæŠ¥GPGç›¸å…³é—®é¢˜ï¼ˆæˆ‘åœ¨18.04çš„dockeré‡åˆ°ï¼‰ï¼š\necho \u0026#39;deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /\u0026#39; \u0026gt; /etc/apt/sources.list.d/cuda.list apt-key adv --recv-keys --keyserver keyserver.ubuntu.com $(åŠ å…¥æŠ¥é”™çš„å¯†é’¥) apt update è§£å†³ç±»ä¼¼ error code is libcuda.so: cannot open shared object file: No such file or directoryçš„é—®é¢˜ï¼šhttps://stackoverflow.com/questions/54249577/importerror-libcuda-so-1-cannot-open-shared-object-file # æ­¤å¤„æˆ‘ä»¬æœç´¢çš„æ˜¯libcuda.so sudo find /usr/ -name \u0026#39;libcuda.so\u0026#39; #æœ‰æ—¶å€™æœç´¢çš„æ˜¯libcuda.so.* # è¿™ä¸€æ­¥æ˜¯ä¸ºäº†æ‰¾åˆ°æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œæˆ‘åœ¨WSLä¸­æœåˆ°äº†å‡ ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œæˆ‘ä»»æ„åŠ å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹åˆ°LD_PATHï¼š # å‡å¦‚å‰ä¸€æ­¥å‘ç°libcudaçš„ä½ç½®ä¸ºï¼š/usr/lib/wsl/lib/libcuda.so # å‘Šè¯‰ç³»ç»Ÿè¦åœ¨è¿™é‡Œæ‰¾ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™å¥è¯åŠ å…¥åˆ°~/.bashrcç„¶åsource ~/.bashrc export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/targets/x86_64-linux/lib æ­¤æ—¶å†æ¬¡è¿è¡Œå°±ä¸ä¼šæŠ¥é”™äº†ï¼\nå…¶ä»– å¿«é€Ÿä¸‹è½½torchå®‰è£…åŒ…ï¼ˆwgetä¸‹è½½ç„¶åç›´æ¥pip installï¼‰\nhttps://download.pytorch.org/whl/torch/\nå­ªç”Ÿç¥ç»ç½‘ç»œçš„ç›¸å…³å®ç°ï¼š\nhttps://blog.csdn.net/weixin_44791964/article/details/107406072\nhttps://blog.csdn.net/lx_ros/article/details/124439120\næ·±åº¦å­¦ä¹ 500é—®\nhttps://github.com/shliang0603/Awesome-DeepLearning-500FAQ\nMLsystem ML system å…¥å‘æŒ‡å—\nhttps://zhuanlan.zhihu.com/p/608318764\nå¾®è½¯å‡ºå“ äººå·¥æ™ºèƒ½ç³»ç»Ÿ\nhttps://github.com/microsoft/AI-System\nã€Šæœºå™¨å­¦ä¹ ç³»ç»Ÿï¼šè®¾è®¡å’Œå®ç°ã€‹ï¼ˆä¸ªäººè§‰å¾—å¾ˆå¥½ https://openmlsys.github.io/#\nMLIR æ–‡ç« è§†é¢‘æ±‡æ€»ï¼ˆMLIRç›®çš„æ˜¯åšä¸€ä¸ªé€šç”¨ã€å¯å¤ç”¨çš„ç¼–è¯‘å™¨æ¡†æ¶\nhttps://zhuanlan.zhihu.com/p/141256429\næ·±åº¦å­¦ä¹ éƒ¨ç½² GiantPandaCV\nå›½å†…æœ€å¥½çš„éƒ¨ç½²ç›¸å…³å…¬ä¼—å¹³å°ä¹‹ä¸€ï¼Œæ¶‰åŠéƒ¨ç½²çš„å†…å®¹æ¯”è¾ƒå¤šä¸”ç¡¬æ ¸ï¼Œäº”æ˜Ÿæ¨èã€‚\nhttp://giantpandacv.com/resources/\nhttp://giantpandacv.com/project/éƒ¨ç½²ä¼˜åŒ–/\nncnnæ¨ç†æ¡†æ¶å¼€å‘ç‰ˆæµ‹è¯•\nhttps://zhuanlan.zhihu.com/p/458139435\nBuild \u0026amp; Share Delightful Machine Learning Apps\nhttps://gradio.app/\nOptimum :\nOptimum is an extension of ğŸ¤— Transformers that provides a set of performance optimization tools to train and run models on targeted hardware with maximum efficiency.\nhttps://huggingface.co/docs/optimum/index\næ¨ç†\u0026amp;åŠ é€Ÿé‡åŒ–æ¡†æ¶ ncnn\nhttps://github.com/Tencent/ncnn\nncnnæºç é˜…è¯»å­¦ä¹ \nhttps://blog.csdn.net/sinat_31425585/category_9312419.html\nopenvino\nhttps://space.bilibili.com/38566875\nbbufè€å¸ˆçš„onnxå­¦ä¹ ç¬”è®°\nONNXå­¦ä¹ ç¬”è®° - çŸ¥ä¹ (zhihu.com)\nTVMå®˜æ–¹ä¸­æ–‡æ‰‹å†Œ\nhttps://tvm.hyper.ai/docs/\ntensorrt æ’ä»¶è‡ªç”Ÿæˆï¼ˆè…¾è®¯TPATï¼‰\nhttps://github.com/Tencent/TPAT\nå¤§ç¼ºå¼¦çš„åœ¨çº¿onnxè½¬æ¢å™¨\nhttps://convertmodel.com/\nå¾ˆå¥½çš„é‡åŒ–å·¥å…·â€”â€”PPQ\nhttps://github.com/openppl-public/ppq\nå®ä¾‹å‚è€ƒ å„ç§å¼€å‘ç‰ˆçš„åŸºç¡€åŠŸèƒ½è°ƒé€š\nhttps://blog.csdn.net/sxj731533730\nå¾…æµ‹è¯•\næˆè¹Š - çŸ¥ä¹ (zhihu.com)\npaddle_to_openvinoç®—å­å¼€å‘\nhttps://aistudio.baidu.com/aistudio/projectdetail/5241605?channelType=0\u0026amp;channel=0\né«˜æ€§èƒ½æ¨ç†ï¼ŒTensorRT C++/Pythonåº“ï¼Œtensorrtå­¦ä¹ å‚è€ƒ\nhttps://github.com/shouxieai/tensorRT_Pro\nA lite C++ toolkit of awesome AI models with ONNXRuntime, NCNN, MNN and TNN. YOLOv5, YOLOX, YOLOP, YOLOv6, YOLOR, MODNet, YOLOX, YOLOv7, YOLOv8. MNN, NCNN, TNN, ONNXRuntime.\nhttps://github.com/DefTruth/lite.ai.toolkit/blob/main/README.zh.md\nonxxruntimeæºç å¸¦è¯»\nhttps://zhuanlan.zhihu.com/p/530925674\nç¾å›¢è§†è§‰GPUæ¨ç†æœåŠ¡éƒ¨ç½²æ¶æ„ä¼˜åŒ–å®è·µï¼ˆç¾å›¢å…³äºGPUçš„æ¨ç†éƒ¨ç½²æœ‰å¾ˆå¤šä¸é”™çš„æ–‡ç« \nhttps://zhuanlan.zhihu.com/p/605094862\nNCNNåº•å±‚æºç å¸¦è¯»\nhttps://zhuanlan.zhihu.com/p/588809520\npython anacondaåŸºç¡€ å›½å†…çš„anacondaé•œåƒä¸‹è½½ https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/\n(windows)anacondaä¸Jupyter notebookå®‰è£…æ•™ç¨‹ https://zhuanlan.zhihu.com/p/37093476\n(linux)anacondaå®‰è£…æ•™ç¨‹ ä¸‹è½½debæ ¼å¼çš„anacondaå®‰è£…åŒ… å®‰è£…ååœ¨ç»ˆç«¯ä½¿ç”¨source ~/.bashrcå³å¯åœ¨ç»ˆç«¯çœ‹åˆ°(base)æ ‡è¯†ï¼ˆä¸è¦åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹è¿è¡Œï¼‰ anaconda æ¢æº(è®°å¾—æ›´æ¢æºçš„æ—¶å€™åˆ å»default ä»¥åŠå¤‡ä»½åŸæ¥çš„ï¼‰ https://blog.csdn.net/qq_33590958/article/details/103291206\npip -ié•œåƒæºåˆé›†ï¼ˆä¸ªäººå–œæ¬¢ç”¨ç™¾åº¦çš„ï¼‰ https://www.cnblogs.com/sunnydou/p/5801760.html\néconda pipç›´æ¥æ¢æºï¼ˆconfï¼‰ https://www.runoob.com/w3cnote/pip-cn-mirror.html\nrequirements.txtçš„ç”Ÿæˆæ•™ç¨‹ https://www.cnblogs.com/lvjinfeng/articles/16333180.html\ncondaä¸pipè™šæ‹Ÿç¯å¢ƒå¯¼å‡ºä¸è½¬ç§»ï¼ˆæ–¹ä¾¿ç§»æ¤ï¼‰ https://blog.csdn.net/weixin_42272869/article/details/122471357\ncondaå¸¸è§å‘½ä»¤å’Œç–‘éš¾é—®é¢˜è§£ç­”ï¼š æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šé‡åˆ°ç±»ä¼¼Solving environment: failed with initial frozen solve. Retrying with flexible solve.çš„é—®é¢˜ï¼Œå…ˆè€å¿ƒç­‰ç­‰ï¼è®©ä»–éå†é‡è¯•å®Œå„ä¸ªåº“ï¼ˆæˆ‘åœ¨condaå®‰è£…clingçš„æ—¶å€™é‡åˆ°ï¼‰\nå¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜å†æŒ‰ç…§ç½‘ä¸Šçš„æ–¹æ³•è¿›è¡Œæ›´æ–°condaæˆ–è€…é‡æ–°å®‰è£…condaã€‚ï¼ˆæˆ–è€…ä¸è¦åœ¨baseä¸‹å®‰è£…ï¼‰\nåˆ é™¤è™šæ‹Ÿç¯å¢ƒï¼šconda remove -n ENV_NAME â€”all\ncondaæ›´æ–°ï¼šconda update anaconda\ncondaæ‰€æœ‰åº“æ›´æ–°ï¼šconda update --all\nå¯¼å‡ºè‡ªå·±å®‰è£…çš„é‚£äº›åŒ…ï¼ˆfreezeæ˜¯å…¨éƒ¨ï¼ï¼‰ï¼šä½¿ç”¨pipreqsåº“ powershellä¸‹çœ‹ä¸åˆ°ï¼ˆbaseï¼‰ä¹‹ç±»çš„è™šæ‹Ÿåº“ä¿¡æ¯ï¼Œæ˜¾ç¤ºå‡ºè„šæœ¬å®‰å…¨é—®é¢˜æ— æ³•å¯ç”¨ï¼Œå¯åœ¨powershellç®¡ç†å‘˜æ¨¡å¼ä¸‹è¾“å…¥Set-ExecutionPolicy -ExecutionPolicy RemoteSignedå³å¯è§£å†³é—®é¢˜ã€‚ awesomeé¡¹ç›®ï¼ˆåŒ…å«äº†ç»å¤§éƒ¨åˆ†çš„pythonç›¸å…³èµ„æºï¼‰\nhttps://github.com/vinta/awesome-python\nhttp://jobbole.github.io/awesome-python-cn/\nPython Cookbook 3rd Edition\nhttps://python3-cookbook.readthedocs.io/zh_CN/latest/index.html\nPythonå¹¶è¡Œç¼–ç¨‹\nhttps://python-parallel-programmning-cookbook.readthedocs.io/zh_CN/latest/index.html\nPython 3 æ ‡å‡†åº“å®ä¾‹æ•™ç¨‹(çœŸæ­£ç°ä»£ã€è¿›é˜¶çš„pythonæ•™ç¨‹\nhttps://learnku.com/docs/pymotw\npandasæ•™ç¨‹\nhttps://pandas.pydata.org/docs/getting_started/install.html\næˆ–è€…å¯ä»¥çœ‹çœ‹datawhaleçš„æ•™ç¨‹\nScipy Lecture Notes//Advanced Python Constructs//Advanced NumP\nhttp://scipy-lectures.org/index.html\nSICP Python æè¿° ä¸­æ–‡ç‰ˆ\nhttps://wizardforcel.gitbooks.io/sicp-py/content/\nopencvå›¾åƒå¤„ç†100é—®ï¼Œå¯ç”¨æ¥æŸ¥ç¼ºè¡¥æ¼ï¼ˆæœ‰äº›æ ¼å¼é—®é¢˜ä½†ä¸å½±å“\nhttps://github.com/gzr2017/ImageProcessing100Wen\næœ‰è¶£çš„Pythonçˆ¬è™«å’ŒPythonæ•°æ®åˆ†æå°é¡¹ç›®ï¼ˆæœ‰äº›æ–¹æ³•å¯èƒ½å› ä¸ºæ˜¯3å¹´å‰çš„ä¸œè¥¿ä¼šå¤±æ•ˆ\nhttps://github.com/Alfred1984/interesting-python\nrequestsåº“å®˜æ–¹æ‰‹å†Œï¼ˆäº¤äº’å¸¸ç”¨ï¼Œä¸»è¦éœ€ç†è§£è¯·æ±‚å¤´ç­‰ï¼‰\nhttps://requests.readthedocs.io/en/latest/user/quickstart/#make-a-request\nå®ä¾‹é¡¹ç›®ç­‰ supervisor + gunicorn + flask é«˜å¹¶å‘çš„æ¥å£ + å®Œæ•´ï¼ˆæ ‡å‡†ï¼‰çš„æ—¥å¿—éƒ¨ç½²\nhttps://zhuanlan.zhihu.com/p/79227989\næ•™ä½ é˜…è¯» Python å¼€æºé¡¹ç›®ä»£ç ï¼ˆé‡Œé¢æœ‰ä¸€äº›åŸºç¡€å¼€æºé¡¹ç›®å¯ä»¥å‚è€ƒï¼‰\nhttps://learnku.com/articles/23010/teach-you-to-read-the-python-open-source-project-code\nå¾ˆä¸é”™çš„pythonçŠ¶æ€æœºï¼ˆå¯ä»¥ç”»æˆå›¾ï¼‰å±•ç¤ºå·¥å…·ï¼š\nhttps://github.com/laike9m/Cyberbrain\nCä¸æ±‡ç¼– ç¿æºçš„ç›¸å…³è§†é¢‘(å…¥é—¨å’Œè¿›é˜¶)\nhttps://www.icourse163.org/u/wengkai?userId=318013\n100ä¸ªGDBå°æŠ€å·§ï¼š\nhttps://wizardforcel.gitbooks.io/100-gdb-tips/content/part1.html\næ ‡å‡†åº“æ”¶å½•ç½‘ç«™\nhttps://www.cplusplus.com/reference/\næ±‡ç¼–è¯­è¨€åœ¨çº¿è§£æç½‘ç«™\nhttps://godbolt.org/\nå†…è”æ±‡ç¼–å­¦ä¹ \nhttps://baijiahao.baidu.com/s?id=1722268508697136684\nhttps://www.jianshu.com/p/1782e14a0766\n\u0026ldquo;undefined reference to XXX\u0026quot;é—®é¢˜æ€»ç»“\nhttps://github.com/Captain1986/CaptainBlackboard/blob/master/D%230001-undefined_reference_to_XXX/D%230001.md\næœ‰å…³ç¡¬ä»¶å¼€å‘ï¼ˆåµŒå…¥å¼ï¼‰çš„æ¨èä¸ªäººåšå®¢åˆ—è¡¨\nhttps://github.com/JesseGuoX/DoHard\nA curated list of C good stuff.\nThis project does not index anything C++-related; only pure C stuff is considered.\nhttps://github.com/sanbuphy/awesome-c\nLLVMç¼–è¯‘è¿‡ç¨‹\nwget https://github.com/llvm/llvm-project/releases/download/llvmorg-10.0.0/llvm-10.0.0.src.tar.xz tar xvJf llvm-10.0.0.src.tar.xz cd llvm-10.0.0.src mkdir build cd build cmake .. -DLLVM_ENABLE_RTTI:BOOL=ON -DBUILD_SHARED_LIBS:BOOL=OFF -DCMAKE_BUILD_TYPE=Release -DLLVM_TARGETS_TO_BUILD=â€œX86;NVPTXâ€ -DLLVM_ENABLE_ASSERTIONS=ON # å¦‚æœä½ æƒ³åœ¨ NVIDIA Jetson TX2 ä¸Šè¿›è¡Œæ„å»º, è¯·ä½¿ç”¨ -DLLVM_TARGETS_TO_BUILD=\u0026#34;ARM;NVPTX\u0026#34; make -j 8 sudo make install # æ£€æŸ¥ä½ å®‰è£…çš„ LLVM ç‰ˆæœ¬ llvm-config â€”version # åº”è¯¥æ˜¯ 10.0.0 Cè¯­è¨€çš„jupyter notebookæ‹“å±•å®‰è£…ï¼š\npip install jupyter-c-kernel install_c_kernel jupyter kernelspec list C++ c++å…¥é—¨å­¦ä¹ ï¼ˆçœ‹è‡ªå·±å…´è¶£æŒ‰éœ€ç´¢å–ï¼‰\næµ™å¤§ç¿æºï¼ˆç®€å•ï¼Œé€‚åˆå¿«é€Ÿè¿‡ä¸€éï¼‰ï¼šhttps://www.bilibili.com/video/BV1dE41167hJ?p=34 å—ç§‘å¤§äºä»•çªï¼ˆç°ä»£åŒ–ï¼Œååˆ†æ¨èï¼‰https://www.bilibili.com/video/BV1Vf4y1P7pq?p=1 ä¾¯æ·è€å¸ˆè§†é¢‘ï¼ˆçœ‹å®Œäºè€å¸ˆå¯ä»¥æ— ç¼è¡”æ¥ï¼Œèµ„æºå°±ä¸å…¬å¼€äº†ï¼Œæ¨èçœ‹å®Œ1ã€2ã€3ï¼‰ c++çš„jupyter notebook æ‰©å±•ï¼ˆç”¨æ¥å†™å°ä½œä¸šï¼‰\nconda install -c conda-forge xeus-cling\nconda install -c conda-forge jupyterlab\nç„¶åè¾“å…¥ jupyter lab å°±å¯ä»¥çœ‹åˆ°æœ‰c11åˆ°17å†…æ ¸æ”¯æŒçš„äº†ã€‚\nå¦‚æœæƒ³è¦åœ¨vscodeä½¿ç”¨ï¼Œåªè¦å¤åˆ¶å¸¦tokençš„é‚£ä¸€å¤§ä¸²ä¸œè¥¿ç„¶ååœ¨vscodeæ‰“å¼€jupyterä¸‹é¢æ‰¾åˆ°serverè¿æ¥è¿œç¨‹å³å¯ã€‚\nc++ åœ¨çº¿æµ‹è¯•ï¼š\nhttps://cpp.sh/\nå„ç±»è¯­è¨€åœ¨çº¿è§£æç½‘ç«™ï¼ŒåŒ…æ‹¬æ±‡ç¼–è°ƒè¯•å’Œå„ç§C++æ ‡å‡†ä¸‹çš„insightå‡½æ•°\nhttps://godbolt.org/\nawesomeé¡¹ç›®ï¼ˆåŒ…å«äº†ç»å¤§éƒ¨åˆ†çš„c++ç›¸å…³èµ„æºï¼‰\nhttps://github.com/fffaraz/awesome-cpp\nhttp://jobbole.github.io/awesome-python-cn/\ncmake å¿«é€Ÿç¼–è¯‘å®‰è£…ï¼š\nå‰å¾€å®˜ç½‘ä¸‹è½½æœ€æ–°å‘è¡Œç‰ˆï¼šhttps://cmake.org/download/ ç„¶åå¦‚ä¸‹è¿è¡Œå³å¯ï¼š\n#å¸è½½æ—§ç‰ˆæœ¬ sudo apt-get autoremove cmake #å®‰è£…æ–°ç‰ˆæœ¬ ./configure make -j20 sudo make install #å¦‚æœæ­¤æ—¶cmake --verion æ²¡æœ‰å˜åŒ–æˆ–è€…ä¸å­˜åœ¨ï¼ŒæŠŠä¸‹é¢è¿™ä¸ªåŠ å…¥ç¨‹åºåˆ°ç¯å¢ƒå˜é‡å³å¯ vim ~/.bashrc # export PATH=/usr/local/share/cmake-3.25:$PATH source ~/.bashrc Modern CMake ç®€ä½“ä¸­æ–‡ç‰ˆ\nhttps://modern-cmake-cn.github.io/Modern-CMake-zh_CN/\ncmakelistç”Ÿæˆçš„makefileè°ƒè¯•ç”¨make VERBOSE=1 è€Œä¸æ˜¯ make -nb\ncmakeå¿«é€Ÿå…¥é—¨\nhttps://juejin.cn/post/6844903557183832078\nCMakeèœè°±ï¼ˆCMake Cookbookä¸­æ–‡ç‰ˆï¼‰ï¼ˆé¢å‘å®é™…åº”ç”¨å°å·¥å…·ï¼Œæ¨èï¼‰\nhttps://www.bookstack.cn/read/CMake-Cookbook/README.md\nC++ referenceï¼ˆå­—å…¸ï¼‰\nhttps://en.cppreference.com/w/\nc++å¹¶å‘ç¼–ç¨‹\nhttps://paul.pub/cpp-concurrency/\nåŒç¬™å­ä½¯è°¬ å›¾å½¢å­¦å¤§ä½¬ï¼ŒZenoå’ŒTaichi Blendçš„ä½œè€…\nhttps://space.bilibili.com/263032155\nC++ Core Guidelines\nhttps://github.com/isocpp/CppCoreGuidelines\nGoogle C++ Style Guide\nhttps://google.github.io/styleguide/cppguide.html\nc++æ‰‹å†™æ•°æ®åº“ç»ƒä¹  CMU 15-445: Database Systems\nhttps://csdiy.wiki/æ•°æ®åº“ç³»ç»Ÿ/15445/\nC++ Standard Draft Sourcesï¼ˆä¸€èµ·æˆä¸ºè¯­è¨€å¾‹å¸ˆï¼‰\nhttps://github.com/cplusplus/draft\nè¯¦ç»†çš„C/C++ç¼–ç¨‹è§„èŒƒæŒ‡å—ï¼Œç”±360è´¨é‡å·¥ç¨‹éƒ¨ç¼–è‘—ï¼Œé€‚ç”¨äºæ¡Œé¢ã€æœåŠ¡ç«¯åŠåµŒå…¥å¼è½¯ä»¶ç³»ç»Ÿã€‚\nhttps://github.com/Qihoo360/safe-rules\nç¨‹åºå¯ç§»æ¤æ€§ä¿è¯cmakeã€‚å¯è·å–ç³»ç»Ÿä¿¡æ¯ã€ç¼–è¯‘å™¨ã€å¹³å°ã€æŒ‡ä»¤é›†ç­‰ä¿¡æ¯ã€‚\nhttps://www.bookstack.cn/read/CMake-Cookbook/content-chapter2-2.5-chinese.md\nC++çš„æ‚ç‰©é—´ DJI thermal analysis tool ç›¸å…³æ•™ç¨‹ï¼ˆæ—¥æ–‡\nhttps://qiita.com/tutu/items/b5cf2b39dd30786d9064\néŸ³è§†é¢‘ç›¸å…³ éŸ³è§†é¢‘åŸç†å¿…çœ‹å›½å†…å¤§ç¥-é›·ç¥\nhttps://blog.csdn.net/leixiaohua1020/article/details/18893769\nffmpegåŸç† ç½—ä¸Šæ–‡\nhttps://ffmpeg.xianwaizhiyin.net/cover.html\nCUDA é€‚åˆå…¥é—¨çš„å°å‹Pythonç¼–è¯‘å™¨é¡¹ç›®ï¼ˆåŒ…å«cudaç›¸å…³å†…å®¹ï¼‰\nhttps://zhuanlan.zhihu.com/p/603352525\ncudaå­¦ä¹ æ•™ç¨‹\nhttps://space.bilibili.com/37270391/channel/seriesdetail?sid=1454805\nCUDA-Programming-Guide-in-Chinese\nhttps://github.com/HeKun-NVIDIA/CUDA-Programming-Guide-in-Chinese\nCUDA C++ Programming Guide\nhttps://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html\nç¨‹åºæ€§èƒ½ä¼˜åŒ– æ€§èƒ½ä¼˜åŒ–å®æˆ˜æ”¶é›†ï¼ˆåŒ…æ‹¬å¬é£æ‰‡å£°éŸ³æµ‹æ€§èƒ½ï¼‰\nhttps://github.com/plantegg/programmer_case\nå­¦æœ¯è®ºæ–‡ æŸ¥è¯¢æ¥å—ç‡çš„ç½‘ç«™:\nhttps://www.openresearch.org/wiki/Main_Page\nLaTeX å›¾ç‰‡è½¬ä»£ç \nç‚¹è¿™é‡ŒmathF\nhttps://web.baimiaoapp.com/image-to-latex\nLaTeXæ‰‹å†™å­—ç¬¦è¯†åˆ«ï¼ˆä¸çŸ¥é“å­—ç¬¦çš„ä»£ç æ˜¯ä»€ä¹ˆçš„æ—¶å€™ï¼‰\nhttp://detexify.kirelabs.org/classify.html\nLaTeXå¼€æºOCRæ–¹æ¡ˆ\nhttps://github.com/lukas-blecher/LaTeX-OCR\nè®ºæ–‡ç¿»è¯‘\nhttps://tongtianta.site/\nä¸€æ–‡ç½‘å°½CV/Roboticsé¡¶ä¼šè®ºæ–‡å¸¸ç”¨é«˜çº§è¯æ±‡/å¥å¼ï¼ by å¶å°é£ï¼ˆæ¨èå…³æ³¨ï¼‰\nhttps://zhuanlan.zhihu.com/p/415926905\nAIè®ºæ–‡æ£€ç´¢\nhttps://elicit.org/\nå…¶ä»–æ—¥å¸¸ä½¿ç”¨ç½‘ç«™ æœ‰å…³æ€ç»´å¯¼å›¾çš„ä»£ç ï¼ˆç±»ä¼¼markdownï¼‰ç”Ÿæˆï¼š\nhttps://xzmind.xuanzi.ltd/apps.html\næµç¨‹å›¾ç»˜åˆ¶ï¼š\nhttps://app.diagrams.net/\njsonå¯è§†åŒ–ï¼š\nhttps://c.runoob.com/front-end/53/\nå¿«é€Ÿæ–‡ä»¶ä¼ è¾“ï¼ˆéšæ„åˆ†äº«ç»™äººä¸ç”¨ç½‘ç›˜ï¼‰(æ‹·è´å…”ä¹Ÿå¯ä»¥ï¼‰\nhttps://www.wenshushu.cn/\nåæå®¢çš„æ–°é—»ç½‘ï¼Œæ— å¹¿å‘Šï¼Œè€Œä¸”æœ‰ä¸€å¥—é˜²åˆ·çƒ­åº¦ç®—æ³•ï¼Œä¹Ÿä¸ææ¨èç®—æ³•\nhttps://news.ycombinator.com/news\nå¿«é€Ÿæ‹¼æ¥å›¾åƒå’Œå…¶ä»–å¸¸ç”¨å›¾ç‰‡å¤„ç†å·¥å…·\nhttp://www.atoolbox.net/Tool.php?Id=978\né»‘ç™½ç…§ç‰‡ä¸Šè‰²\nhttps://palette.fm/\nè®©ä½ â€œçˆ±â€ä¸Š GitHubï¼Œè§£å†³è®¿é—®æ—¶å›¾è£‚ã€åŠ è½½æ…¢çš„é—®é¢˜ã€‚ï¼ˆæ— éœ€å®‰è£…ï¼‰\nhttps://github.com/521xueweihan/GitHub520\næœ‰è¶£çš„é¡¹ç›® æ¯”disco diffusionæ›´å¼ºå¤§çš„ç»˜åˆ¶å·¥å…·SDï¼š\nåœ¨è‡ªå·±ç”µè„‘è¿è¡ŒStable Diffusionå’Œå®Œæ•´é¡¹ç›®ä¸‹è½½\nhttps://mp.weixin.qq.com/s/syEkqbBSmTwdi_cPB6Kd3g\nStableDiffusion Int8é‡åŒ–æ•™ç¨‹ä¸ONNXå¯¼å‡ºæ¨ç†\nhttps://mp.weixin.qq.com/s/18EIga7w9y1FG0oWcnysIw\nChatGPT ä¸­æ–‡è°ƒæ•™æŒ‡å—\nhttps://github.com/PlexPt/awesome-chatgpt-prompts-zh\nCodeGeeX: å¤šè¯­è¨€ä»£ç ç”Ÿæˆæ¨¡å‹ï¼ˆä»£ç ç”Ÿæˆä¸ä»£ç ç¿»è¯‘ï¼‰\nhttps://github.com/THUDM/CodeGeeX/blob/main/README_zh.md\nWhisper AIå‰ªè§†é¢‘å°å·¥å…·\nhttps://www.bilibili.com/video/BV1Pe4y1t7de/\nhttps://github.com/mli/autocut/\næœ‰è¶£çš„æ•…äº‹ è°·æ­ŒèƒŒåçš„æ•°å­¦\nhttps://www.changhai.org/articles/technology/misc/google_math.php\nç«å…‰æ‘‡æ›³(æ•°å­¦ç§‘æ™®) Rickjin(é³å¿—è¾‰) ï¼ˆéå¸¸å¥½ä¼ é€’äº†ç»Ÿè®¡ä¹‹ç¾ï¼‰\nhttps://uploads.cosx.org/2014/07/gamma.pdf\nè®¡ç®—çš„æé™\nhttps://fwjmath.wordpress.com/recommended-list/\nå¿ƒç†å¥åº·å»ºè®¾ å¦‚ä½•åœ¨å·¥ä½œä¸­å­¦ä¹ ï¼ˆå¥½çš„æ–¹æ³•è®ºï¼‰\nhttps://plantegg.github.io/2018/05/24/å¦‚ä½•åœ¨å·¥ä½œä¸­å­¦ä¹ V1.1/\n2017å¹´ä¹°æˆ¿ç»å†æ€»ç»“å‡ºæ¥çš„ä¹°æˆ¿è´­æˆ¿çŸ¥è¯†\nhttps://github.com/houshanren/hangzhou_house_knowledge\n2022å¹´æ­å·è´­æˆ¿æŒ‡å—\ngithub.com/zkqiang/hangzhou-house-guide\n2020å¹´11æœˆä¸Šæµ·è´­æˆ¿æŒ‡å—\ngithub.com/ayuer/shanghai_house_knowledge\nè‹±è¯­ è‹±æ–‡è¯­æ³•åœ¨çº¿ä¿®æ”¹ https://www.grammarly.com/\nhttps://www.nounplus.net/grammarcheck/\nhttps://virtualwritingtutor.com/\nè‹±æ–‡è®ºæ–‡å¥½ç”¨å·¥å…· TextRanch å¥å­å‚è€ƒ\nhttps://textranch.com/\nQuillBot æ–‡æ®µæ”¹å†™\nhttps://quillbot.com/\n","date":"2023-02-06T12:08:27+08:00","permalink":"https://sanbuphy.github.io/p/%E6%88%91%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%BD%91%E7%AB%99%E9%9B%86%E5%90%88/","title":"æˆ‘çš„è®¡ç®—æœºå­¦ä¹ ç½‘ç«™é›†åˆ"},{"content":"çˆ†è‚äº†ä¸€æ®µæ—¶é—´ï¼Œé’ˆå¯¹zomié…±è§†é¢‘åšäº†å¯¹åº”ç¬”è®°ï¼Œå­¦åˆ°å¾ˆå¤šï¼Œæ›´æ–°å¦‚ä¸‹ï¼š\næ—¥å¸¸æ„Ÿè°¢æ˜‡è…¾æ¶æ„å¸ˆZOMIé…±\nï¼ˆæˆ‘æ„¿ç§°ä¹‹ä¸ºè‚å¸ï¼ï¼‰çš„è¶…çº§è´¡çŒ®ï¼Œæ¬¢è¿ä¸€é”®ä¸‰è¿\nZOMIé…±çš„ä¸ªäººç©ºé—´-ZOMIé…±ä¸ªäººä¸»é¡µ-å“”å“©å“”å“©è§†é¢‘\nä»–çš„githubåœ°å€\næœ‰å…³è®¡ç®—å›¾çš„å†…å®¹ï¼šä¸»è¦ä»‹ç»äº†ä¸ºä»€ä¹ˆè¦ç”¨è®¡ç®—å›¾ã€åŸºäºè®¡ç®—å›¾çš„è¡¨ç¤ºä¸è‡ªåŠ¨å¾®åˆ†ã€åŠ¨æ€å›¾é™æ€å›¾çš„åŸºæœ¬åŒºåˆ«ã€ä»€ä¹ˆæ˜¯å›¾ä¼˜åŒ–ä¸ç®—å­è°ƒåº¦ï¼ˆè®¾å¤‡åˆ‡åˆ†ï¼‰ã€å¦‚ä½•è¡¨è¾¾æ§åˆ¶æµã€å¦‚ä½•è¿›è¡ŒåŠ¨é™è½¬æ¢ã€‚\nAIæ¡†æ¶ä¹‹è®¡ç®—å›¾çš„å‰ä¸–ä»Šç”Ÿ-ä¸Šï¼ˆç¬”è®°ï¼‰\nAIæ¡†æ¶ä¹‹è®¡ç®—å›¾çš„å‰ä¸–ä»Šç”Ÿ-ä¸‹ï¼ˆç¬”è®°ï¼‰\næœ‰å…³åˆ†å¸ƒå¼ç³»ç»Ÿçš„å†…å®¹ï¼šä¸»è¦ä»‹ç»äº†AIé›†ç¾¤PSæœåŠ¡å™¨æ¶æ„ï¼ˆå„ç§æœåŠ¡å™¨é›†ç¾¤å¹¶è¡Œç®—æ³•ï¼‰ã€AIé›†ç¾¤è½¯ç¡¬ä»¶é€šä¿¡ã€é€šä¿¡å®ç°æ–¹å¼ï¼ˆä¸€å¯¹å¤šå¤šå¯¹å¤šç­‰ç­‰ï¼‰ï¼Œå¹¶è¡Œå¤„ç†ç¡¬ä»¶æ¶æ„ï¼ˆSIMDç­‰ï¼‰ï¼Œåˆ†å¸ƒå¼è®­ç»ƒç³»ç»Ÿï¼Œå¤§æ¨¡å‹è®­ç»ƒæŒ‘æˆ˜é‡åˆ°çš„(å†…å­˜ã€é€šä¿¡ã€æ€§èƒ½ã€è°ƒä¼˜å¢™)ç­‰ã€‚\nAIæ¡†æ¶ä¹‹åˆ†å¸ƒå¼ç³»ç»Ÿ-ä¸Šï¼ˆç¬”è®°ï¼‰\nAIæ¡†æ¶ä¹‹åˆ†å¸ƒå¼ç³»ç»Ÿ-ä¸‹ï¼ˆç¬”è®°ï¼‰\næœ‰å…³AIç¼–è¯‘å™¨å‰ç«¯ä¼˜åŒ–çš„å†…å®¹ï¼šä¸»è¦ä»‹ç»äº†ç®—å­èåˆã€æ”¯é…æ ‘ã€æ•°æ®å¸ƒå±€è½¬æ¢åŸç†ï¼ˆNCHW/NHWCçš„åŒºåˆ«ä¸ä¸åŒè®¾å¤‡ä¸Šæ›´é€‚åˆå“ªç§)ï¼›ä»¥åŠå„ç±»passï¼ˆä¼˜åŒ–ï¼‰ï¼šå†…å­˜å¯¹é½ã€å¸¸é‡æŠ˜å ã€å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤ã€æ­»ä»£ç æ¶ˆé™¤ã€ä»£æ•°ç®€åŒ–(ç®—æœ¯åŒ–ç®€ã€è¿è¡ŒåŒ–ç®€ã€å¹¿æ’­åŒ–ç®€)ç­‰ã€‚\nAIç¼–è¯‘å™¨ä¹‹å‰ç«¯ä¼˜åŒ–-ä¸Šï¼ˆç¬”è®°ï¼‰\nAIç¼–è¯‘å™¨ä¹‹å‰ç«¯ä¼˜åŒ–-ä¸‹ï¼ˆç¬”è®°ï¼‰\næœ‰å…³AIç¼–è¯‘å™¨åç«¯ä¼˜åŒ–çš„å†…å®¹ï¼šä¸»è¦ä»‹ç»äº†ç®—å­åˆ†ç±»ã€ç®—å­è®¡ç®—å’Œè°ƒåº¦åŒºåˆ«ä¸è§£è€¦ã€è°ƒåº¦æ ‘ã€ç®€å•çš„ç®—å­ä¼˜åŒ–æ‰‹å·¥æ–¹å¼ï¼ˆå¯èƒ½å¼€äº†æ¯”è¾ƒé«˜çš„ç¼–è¯‘å™¨ä¼˜åŒ–å°±ä¼šè‡ªåŠ¨åšï¼šå¾ªç¯äº¤æ¢ã€å¾ªç¯å˜é‡å®ä¾‹åŒ–æå‰ã€è¡¨è¾¾å¼å¤–æ”¾ã€å¾ªç¯ç»ˆæ­¢è°ƒç”¨ï¼‰ï¼Œç®—å­å¾ªç¯ä¼˜åŒ–ï¼ˆå¾ªç¯å±•å¼€ã€å¾ªç¯åˆ†å—ã€å¾ªç¯é‡æ’ï¼ˆä¸»è¦cacheç›¸å…³ï¼‰ã€å¾ªç¯èåˆã€å¾ªç¯æ‹†åˆ†ï¼‰ï¼ŒæŒ‡ä»¤å’Œå­˜å‚¨ä¼˜åŒ–å¦‚å‘é‡åŒ–ï¼ˆè¿™ä¸ªå¾ˆå¤šä¹Ÿæœ‰ç ”ç©¶ï¼Œæœ‰æ‹“å±•ï¼‰ã€å¼ é‡åŒ–ã€è®¿å­˜å»¶è¿Ÿï¼ˆgpu coreï¼‰ã€å­˜å‚¨åˆ†é…ä¼˜åŒ–ä»¥åŠç®€å•çš„ auto tuningã€‚\nAIç¼–è¯‘å™¨ä¹‹åç«¯ä¼˜åŒ–ï¼ˆç¬”è®°ï¼‰\næœ‰å…³æ¨¡å‹éƒ¨ç½²åŠ é€Ÿçš„ä¸€äº›å†…å®¹ï¼ˆé‡åŒ–å‰ªæå’Œè’¸é¦çš„ç®€å•å…¥é—¨çŸ¥è¯†ï¼‰\nAIæ¨ç†å¼•æ“â€”â€”ç¦»çº¿å‹ç¼©ï¼ˆç¬”è®°\n","date":"2023-01-23T11:14:16+08:00","permalink":"https://sanbuphy.github.io/p/ai%E6%A1%86%E6%9E%B6%E4%B8%8Eai%E7%BC%96%E8%AF%91%E5%99%A8%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/","title":"AIæ¡†æ¶ä¸AIç¼–è¯‘å™¨ç›¸å…³ç¬”è®°"},{"content":"2023å¹´1æœˆ3æ—¥ä¸‹åˆï¼Œæˆ‘æ°¸è¿œå¤±å»äº†æˆ‘çˆ·çˆ·ã€‚\nå¾ˆé—æ†¾çš„æ˜¯ï¼Œæˆ‘æœ¬æ¥æœ‰æœºä¼šèƒ½æ•‘ä»–çš„ï¼Œå°½ç®¡ä¸‰ç•ªäº”æ¬¡æ³¨æ„è¿‡ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰åšæŒèµ°æµç¨‹å¤„ç†è‡ªå·±çš„åˆ¤æ–­ï¼Œæ²¡æœ‰äº²åŠ›äº²ä¸ºè¿‡é—®å’Œç›‘æ§æƒ…å†µã€‚å°±åƒå‰å‡ å¤©çœ‹çš„æ—¥å‰§è¯´çš„ä¸€æ ·ï¼Œä»‹æŠ¤è¿‡ç¨‹ä¸­ï¼Œä»€ä¹ˆé—®é¢˜éƒ½å¯èƒ½å‘ç”Ÿï¼Œä¸€æ¬¡ç–å¿½å¯èƒ½è¿˜æœ‰å¸Œæœ›ï¼Œä½†æ˜¯å¥‡è¿¹ä¸ä¼šå‘ç”Ÿç¬¬äºŒæ¬¡ï¼Œå¿½ç•¥å’Œæ²¡åšå†—ä½™çš„åº”å¯¹æªæ–½ç»ˆç©¶å¸¦æ¥ä¸å¯æŒ½å›çš„åæœã€‚\nå¹¸å¥½æˆ‘ä¹‹å‰ä¸€ç›´æœ‰ä¸ä»–åŒæ­¥æˆ‘çš„è¿›å±•ï¼Œè¯´æˆ‘åœ¨ç ”ç©¶aiåº•å±‚åº”ç”¨ï¼Œæ²¡æœ‰ç»™ä»–ä¸¢è„¸ï¼Œä»–å¾ˆé«˜å…´ï¼›è¿™ä¸€ç‚¹ä¸Šæ²¡æœ‰åæ‚”çš„åœ°æ–¹ï¼Œè¯¥è¯´çš„è¯éƒ½æ˜¯ä¸€æœŸä¸€ä¼šçš„è¯´çš„ï¼Œè¯¥é€çš„ç¤¼ç‰©æ¯å¹´éƒ½é€ç”šè‡³è§é¢éƒ½ä¼šå¸¦ï¼Œæ¯æ¬¡è§é¢éƒ½è¦æœ‰æœ€åä¸€é¢çš„è§‰æ‚Ÿã€‚ä¸ç„¶æˆ‘çœŸçš„åæ‚”æ­»äº†ï¼Œå¯è¿˜æ˜¯ç•™ä¸‹äº†åæ‚”çš„åœ°æ–¹ï¼Œè¿™ä½¿æˆ‘åçœã€‚\nä»–æ˜¯ä¸ªæ¡ƒææ»¡å›­ï¼Œå…‰è£çš„äººæ°‘æ•™å¸ˆï¼›æ˜¯ä¸€ä¸ªç®€æœ´å‹¤åŠ³ï¼Œä¹äºåŠ©äººï¼Œä¸å–œæ¬¢ç»™åˆ«äººæ·»éº»çƒ¦ï¼Œä¸¥è°¨è®¤çœŸï¼Œè´Ÿè´£ä»»çš„æ•°å­¦è€å¸ˆï¼›å³ä¾¿90å¤šå²äº†ï¼Œè¿˜åšæŒçœ‹ä¹¦çœ‹æŠ¥ï¼›è€Œæˆ‘ä¹‹æ‰€ä»¥å–œæ¬¢çœ‹ä¹¦ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºåœ¨å°å­¦çš„æ—¶å€™å°±å’Œä»–ä¸€èµ·çœ‹æŠ¥ï¼Œé€æ¸åŒåŒ–å…»æˆäº†ä¹ æƒ¯ã€‚ä»–å¤ªç®€æœ´äº†ï¼Œç”¨çš„é’±åŒ…çš„å°çš®æ—©å°±ç£¨çƒ‚äº†ï¼Œè‹¹æœæœ‰æ—¶å€™ä¸èˆå¾—åƒéƒ½æ”¾åäº†ï¼Œä¸‰å—é’±çš„é»„ç³–å¯ä»¥æ”¾åˆ°èåŒ–ï¼Œä½†ç»™æˆ‘å‹å²é’±æ¯«ä¸æ‰‹è½¯ï¼›æˆ‘ä¹Ÿå’Œä»–æ¯æ¬¡å¼ºè°ƒæˆ‘éƒ½å»ä¹°äº†å¾ˆå¤šä¹¦ã€‚å¾ˆå¤šäººéƒ½å’Œæˆ‘è¯´è¿‡ä»–ä»¥å‰å¸®åŠ©å›°éš¾å­¦ç”Ÿä¸Šå­¦ï¼Œä»¥åŠé¼“åŠ±å¥³æ€§ä¸ç•™åœ¨ä¹¡ä¸‹è¦ç‹¬ç«‹è¯»ä¹¦çš„æ•…äº‹ã€‚\nä»–å–œæ¬¢åƒé©¬è¹„ï¼ˆæ°´æœï¼‰ã€è’œæ³¥èŒ„å­ã€é¥ºå­ã€é’èœé…è’œï¼›ä»–è¿˜ä¼šåšé…¿è±†è…ã€è‘›ç²‰ç­‰ç­‰ï¼›è¿™äº›ä¹ŸåŒæ ·æˆä¸ºäº†æˆ‘çš„å–œå¥½ã€‚äººç±»çš„ç”Ÿå‘½æ˜¯è„†å¼±çš„ï¼Œä½†æ˜¯ç²¾ç¥æ˜¯å¯ä»¥æ°¸è¿œä¼ æ‰¿çš„ã€‚æˆ‘ä¸€ç›´è®¤ä¸ºï¼Œä¸€ä¸ªäººçš„æ€æƒ³è¿˜å­˜åœ¨çš„è¯ï¼Œè¿™å°±æ˜¯ä»–ç”Ÿå‘½çš„å»¶ç»­ã€‚ä»–è¯´çš„æˆ‘éƒ½è®°åœ¨å¿ƒé‡Œå¹¶å®è·µï¼Œè€Œä¸”æˆ‘ä¿©éƒ½å­¦è¿‡åŸºç¡€å­¦ç§‘ï¼Œä»–æ˜¯æ•°å­¦æˆ‘æ˜¯ç‰©ç†ï¼Œå¯æƒœç‰©ç†çœŸæ²¡æ•°å­¦éš¾ï¼Œæ¯”èµ·æ¥æˆ‘ç‰©ç†ä¹Ÿå­¦çš„ä¸å¥½ã€‚æˆ‘è‡ªè®¤ä¸ºæ˜¯ä»–æ€æƒ³çš„ä¼ æ‰¿äººï¼Œå¸Œæœ›è¿™ç‚¹ä¸Šä»–èƒ½å¾—åˆ°æ…°è—‰ï¼›ä»–æ˜¯ä¸€ä¸ªä¹äºä¼ æ’­çŸ¥è¯†ã€åŸ¹å…»é’å¹´ã€å¸®åŠ©åˆ«äººçš„äººï¼›è€Œæˆ‘ä¹Ÿå¸Œæœ›èƒ½è®©aiè½åœ°çš„ä»·å€¼æ›´å¥½çš„æ™®ä¸–äºæ¯ä¸€ä¸ªæ™®é€šäººï¼Œä»¥åä¼šä»¥ä»–å‘½åå¼€æºä¸€é¡¹è€äººçŠ¶æ€ç›‘æµ‹ç³»ç»Ÿï¼Œè¿™æ ·å¾ˆå¤šäº‹æƒ…å°±ä¸å†ä¼šå‘ç”Ÿï¼Œå¯æƒœæˆ‘ç°åœ¨èƒ½åŠ›ä¸è¶³ï¼Œç°åœ¨è¿˜ä¸èƒ½åšå‡ºå®ç”¨çš„ä¸œè¥¿ï¼Œæƒ­æ„§ã€‚\näººä¸€æ—¦åˆ°è€ï¼Œä»€ä¹ˆäº‹æƒ…éƒ½å¯èƒ½å‘ç”Ÿï¼›ä¸ºäº†é˜²æ­¢åæ‚”ï¼Œè¯·ä¸€å®šåœ¨æ¯ä¸€æ¬¡è§é¢çš„æ—¶å€™åšå¥½æœ€åä¸€é¢çš„å‡†å¤‡ï¼Œå¤šæ‹ç‚¹ç…§ç‰‡å¤šç•™ä¸‹å›å¿†ï¼Œå°‘ç•™ä¸‹é—æ†¾ï¼Œæƒ³è¦ä¼ è¾¾çš„æ„Ÿæƒ…å°±ä¸€å®šè¦ä¼ è¾¾ï¼Œè™½ç„¶æœ€åéƒ½ä¼šåŒ–ä¸ºè™šæ— ï¼Œä½†äººç±»æœ€å¯çˆ±çš„ä¸€ç‚¹è«è¿‡äºç”Ÿå‘½ä»è·³åŠ¨æ—¶ï¼Œäººä¸äººä¹‹é—´æ –æ¯çš„ä¸°å¯Œæ„Ÿæƒ…ã€‚è¯·åŠ¡å¿…çæƒœçœ¼å‰äººï¼Œççˆ±ç”Ÿå‘½ï¼Œè«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆã€‚\nä¸–ç•Œä¸Šæœ€å¯æ€•çš„äº‹æƒ…å°±æ˜¯â€œæˆ‘æœ¬å¯ä»¥â€ã€‚ä½†æˆ‘çŸ¥é“ä»–è‚¯å®šä¸å¸Œæœ›æˆ‘ä¸€ç›´é—æ†¾ï¼›æˆ‘åªèƒ½åšåˆ°ä¸ä¸¢è„¸ï¼Œå°è¯•åšå‡ºæœ‰ç”¨çš„ä¸œè¥¿ï¼Œè‹¥å¹²å¹´åèƒ½è¯´ä¸€å¥â€œå¾ˆæ®‹é…·ï¼Œä¹‹åšäº†ä¸€ç‚¹å¾®å°çš„è´¡çŒ®â€ï¼Œè¦åšçš„äº‹æƒ…è¿˜æœ‰å¾ˆå¤šï¼Œæ‰€ä»¥è¦è®¤çœŸåšäº‹ï¼Œäººè¦å­¦ä¼šè´Ÿè´£ä»»ã€‚\n2023å¹´1æœˆ3æ—¥ä¸‹åˆï¼Œæˆ‘æ°¸è¿œå¤±å»äº†æˆ‘çˆ·çˆ·ï¼›ä½†ä»–ä¹Ÿæ°¸è¿œåœ¨æˆ‘å¿ƒä¸­ï¼Œä»æœªç¦»å»ï¼Œä¹Ÿä¼šé™ªä¼´æˆ‘ç»å†ä¹‹åçš„æ¯ä¸€ä¸ªäººç”Ÿé˜¶æ®µã€‚\nå› ä¸ºå¦‚æœæˆ‘èµ°äº†ï¼Œå³ä¾¿ä¸åœ¨äº†ï¼Œæƒ³è§ä¸€ä¸ªäººçš„è¯æˆ‘å°±ä¼šå‡ºç°ï¼Œä¹Ÿä¼šä¸€ç›´åŠªåŠ›å®ˆæŠ¤å®ƒï¼›è€Œæˆ‘æƒ³ä»–ä¹Ÿæ˜¯ï¼Œä¸ä»…æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯åŒä¸€æˆ˜çº¿ï¼Œæ›´æ˜¯å› ä¸ºæˆ‘ä»¬äº’ç›¸ä¿¡ä»»ï¼Œä»¥åŠçˆ±ã€‚\n","date":"2023-01-04T22:00:00+08:00","permalink":"https://sanbuphy.github.io/p/%E7%BA%AA%E5%BF%B5%E6%88%91%E7%9A%84%E7%88%B7%E7%88%B7/","title":"çºªå¿µæˆ‘çš„çˆ·çˆ·"},{"content":"ã€æ³¨æ„ï¼šå¤šå›¾ï¼Œéš¾ä»¥åŠ è½½å»ºè®®ç§‘å­¦ä¸Šç½‘,æˆ–æŸ¥çœ‹çŸ¥ä¹çš„é•œåƒæ–‡ç« ï¼š https://zhuanlan.zhihu.com/p/596739480 ã€‘\nhttps://www.bilibili.com/video/BV1hD4y1k7Ty/\næ„Ÿè°¢åŸè§†é¢‘ä½œè€…ï¼Œåä¸ºæ˜‡è…¾æ¶æ„å¸ˆZOMIé…±ï¼ˆæˆ‘æ„¿ç§°ä¹‹ä¸ºè‚å¸ï¼ï¼‰çš„è¶…çº§è´¡çŒ®ï¼Œæœ‰ä¸ªè§†é¢‘æåˆ°äº†ä»–å½•åˆ¶çš„æ—¶å€™æ˜¯å‡Œæ™¨ä¸€ç‚¹ï¼ˆè¿˜æœ‰å…¶ä»–çš„ä¼‘æ¯æ—¶é—´ï¼‰\nå¯ä»¥çœ‹å‡ºä»–æ˜¯çœŸæ­£çƒ­çˆ±æ·±åº¦å­¦ä¹ ç¼–è¯‘å™¨ã€AIæ¡†æ¶ç›¸å…³å·¥ä½œçš„ï¼Œå‘ä»–å­¦ä¹ /è‡´æ•¬ï¼ç»å¯¹å€¼å¾—ä¸€é”®ä¸‰è¿\nç¬¬äºŒèŠ‚-ä¸ºä»€ä¹ˆéƒ½ç”¨è®¡ç®—å›¾ 2.1ç¥ç»ç½‘ç»œæ¡†æ¶é‡åˆ°çš„é—®é¢˜ é¦–è¦çš„é—®é¢˜æ˜¯æˆ‘ä»¬èƒ½å¤Ÿå¦‚ä½•å®šä¹‰ç¥ç»ç½‘ç»œ\né™¤äº†ç¨‹åºè¡¨ç¤ºçš„é—®é¢˜ï¼Œè¿˜è¦ç ”ç©¶æ€ä¹ˆè®©æˆ‘ä»¬çš„è¡¨ç¤ºåœ¨ç¡¬ä»¶æ¡†æ¶èƒ½å¤Ÿé«˜æ•ˆæ‰§è¡Œã€‚\næ·±åº¦å­¦ä¹ å¦‚ä½•è¿›è¡Œè¿è¡Œæ—¶ç®¡ç†ï¼Ÿå¦‚ä½•ç¼–è¯‘å‘¢ï¼Ÿå¦‚ä½•é€‚é…ä¸åŒåç«¯ï¼Ÿ\nç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å…ˆç»™å‡ºäº†ç»Ÿä¸€è¡¨ç¤ºâ€”â€”è®¡ç®—å›¾\n2.2åŸºäºè®¡ç®—å›¾çš„åŸºæœ¬æ¡†æ¶ç»„æˆ å½¢çŠ¶è¿™ä¹ˆç†è§£ï¼ˆä»3ï¼Œ2ï¼Œ5åç€ç†è§£ï¼‰ï¼šæˆ‘ä»¬æœ‰ä¸ªå…ƒç´ ä¸º5çš„æ•°ç»„ï¼Œç„¶åè¿™æ ·çš„æ•°ç»„æœ‰ä¸¤æ’ï¼›è¿™æ ·ä¸¤æ’çš„æ•°ç»„ä¸€å…±æœ‰ä¸‰å¤§å—ã€‚\nä¸ºä»€ä¹ˆä½¿ç”¨å¼ é‡è€Œä¸ç”¨å…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜ç‚¹å¦‚ä¸Šæ‰€è¿°ã€‚ä¸Šå±‚è¡¨ç¤ºä¸ºå¼ é‡æ•°ç»„ï¼Œè¯´æ˜æœ‰äº†ç»Ÿä¸€æ•°æ®ç»“æ„å¯ä»¥åšä¸€ä¸ªç»Ÿä¸€çš„å†…å­˜æ˜ å°„ï¼Œæ–¹ä¾¿åšåˆ‡ç‰‡ç­‰æ“ä½œã€‚'\n2.3ä¸åŒæ•°æ®çš„å¼ é‡åŒ–è¡¨ç¤º 2.4åŸºäºè®¡ç®—å›¾çš„è®¡ç®—æ¡†æ¶ ç®—å­æœ‰å¤§æœ‰å°ï¼Œå°åˆ°åŠ å‡ä¹˜é™¤å¤§åˆ°å³è¾¹çš„é‚£äº›ä¸€å †ã€‚\nè®¡ç®—å›¾ï¼ˆDAGï¼‰è®¡ç®—æ¡†æ¶\nç‰¹æ®Šçš„æ“ä½œä¼šå¤æ‚åŒ–è®¡ç®—å›¾ã€‚ï¼ˆåç»­ä¼šè¯´ï¼‰\nè¿™é‡Œè¯´çš„è®¡ç®—å›¾æ¯”è¾ƒç®€ç•¥ï¼Œæƒ³çœ‹è¯¦ç»†çš„ç‰ˆæœ¬å¯å‚è€ƒï¼š\næ·±åº¦å­¦ä¹ å…¥é—¨ä¸Pytorch|2.1 è®¡ç®—å›¾çš„æ¦‚å¿µä¸ç†è§£ - aHiiLnçš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/412542969\nç¬¬ä¸‰èŠ‚-æ€ä¹ˆç”¨è®¡ç®—å›¾è¡¨ç¤ºè‡ªåŠ¨å¾®åˆ† 3.1å¤ä¹ è®­ç»ƒè¿‡ç¨‹ åå‘ä¼ æ’­è¿‡ç¨‹å°±æ˜¯ä¸ºäº†æ‰¾åˆ°æœ€å°éç‚¹ï¼ˆé«˜åº¦éå‡¸å‡½æ•°ï¼‰\nä¸ºä»€ä¹ˆè¯´è‡ªåŠ¨ç”Ÿæˆåå‘è®¡ç®—ç¨‹åºï¼Ÿæ˜¯å› ä¸ºå‰å‘æ˜¯äººå·¥æ„é€ çš„ï¼›åå‘å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºã€‚\n3.2åå‘ä¼ æ’­ä¸å¾®åˆ† æ¯”å¦‚è¿™æ ·çš„ä¸€ä¸ªç½‘ç»œæ¨¡å‹ï¼ˆæˆ‘ä»¬åªå†™äº†æ­£å‘ä¼ æ’­ï¼‰\né‚£å³è¾¹çš„åå‘ç¨‹åºæ€ä¹ˆåŠï¼Ÿä¸èƒ½æ‰‹å†™ï¼Œå¸Œæœ›æ¡†æ¶èƒ½å¤Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬æ„å»ºï¼ˆæ„å»ºDAGçš„æœ‰å‘æ— ç¯å›¾ï¼Œå³è®¡ç®—å›¾è¡¨è¾¾æˆ‘ä»¬çš„æ­£å‘å’Œåå‘ï¼‰\næˆ‘ä»¬å›é¡¾ä¸€ä¸‹è‡ªåŠ¨å¾®åˆ†é‡Œé¢æ¶‰åŠåˆ°çš„ç®€å•å¾®åˆ†æ–¹å¼ï¼š\né¦–å…ˆæ˜¯ç¬¦å·å¾®åˆ†ï¼š\nï¼ˆæ³¨æ„åˆ°è¡¨è¾¾å¼è†¨èƒ€ä»¥åŠæ— æ³•æ±‚å¯¼çš„ç®—å­ï¼‰\nç¬¬äºŒç§æ–¹æ³•â€”â€”æ•°å€¼å¾®åˆ†\n3.3è‡ªåŠ¨å¾®åˆ† ç¬¬ä¸‰ç§æ–¹å¼â€”â€”è‡ªåŠ¨å¾®åˆ†ï¼\né‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸­é—´å˜é‡å‘¢ï¼Ÿï¼Ÿ\næ¯”å¦‚v-1åˆ°v5éƒ½æ˜¯ä¸­é—´å˜é‡ã€‚æ¯ç»è¿‡ä¸€ä¸ªè¾¹è¿ç®—äº§ç”Ÿä¸€ä¸ªä¸­é—´å˜é‡ã€‚ï¼ˆåˆ†æ²»æ³•ï¼‰\nå‰é¢çœ‹çš„æ˜¯æ­£å‘çš„ï¼Œæˆ‘ä»¬å†çœ‹çœ‹åå‘ã€‚\nåœ¨åå‘ä¼ æ’­ä¸­ï¼Œåå¯¼æ•°ä¹Ÿç®—ä¸­é—´å˜é‡ã€‚\né»„è‰²éƒ¨åˆ†æ˜¯ç¥ç»ç½‘ç»œçš„â€œä¸€å±‚â€ï¼ŒæŠŠä»–å½“æˆä¸€ä¸ªæŠ½è±¡å‡½æ•° Y = G(X) ï¼Œå…¶ä¸­Xæ˜¯v1,v2ç»„æˆçš„ä¸€ä¸ªæŠ½è±¡å¼ é‡ï¼›è¾“å‡ºYå°±æ˜¯v3,v4ã€‚\nä¸ºäº†æ›´å¥½çš„åœ¨æ•°å­¦ä¸Šè¡¨ç¤ºYå¯¹Xçš„å¯¼æ•°æˆ‘ä»¬å¼•å…¥äº†é›…å¯æ¯”çŸ©é˜µã€‚ æˆ‘ä»¬è®¡ç®—å®Œæœ€ç»ˆçš„å¯¼æ•°f(x1,x2ï¼‰åå°±è¦å¼€å§‹åå‘ä¼ æ’­çš„è¿‡ç¨‹ã€‚ æˆ‘ä»¬åœ¨v4,v3åå‘ä¼ æ’­çš„æ—¶å€™å…ˆæš‚æ—¶æŠŠå®ƒå½“ä½œï¼š\nï¼ˆå®é™…ä¸Šè¿™ä¸ªç©æ„å„¿æ˜¯ä¸ºäº†æ±‚åå‘è¾“å‡ºï¼šï¼‰\nå¯ä»¥çœ‹å‡ºæ¯ä¸ªç»“ç‚¹æ— è®ºå‰åéƒ½æ˜¯æ¥å—è¾“å…¥ç»™å‡ºè¾“å‡ºã€‚\næˆ‘ä»¬æŠŠè®¡ç®—å›¾åˆ†ç¦»å‡ºæ¥çœ‹æ˜¯è¿™æ ·çš„ï¼Œæ³¨æ„åˆ°æœ‰æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯ä¼šç”¨åˆ°æ­£å‘çš„å˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å§ä¸­é—´å˜é‡å­˜ä¸‹æ¥ã€‚æ‰€ä»¥è¯´å æ®æ˜¾å­˜ã€‚ã€‚ã€‚å› ä¸ºç¥ç»ç½‘ç»œä¼šå­˜å¤§é‡çš„ä¸­é—´å˜é‡æ•°æ®ã€‚\nä¸¤ä¸ªå°é—®é¢˜ï¼š\næ¥ä¸‹æ¥çœ‹å‡ ç§è‡ªåŠ¨å¾®åˆ†çš„å½¢å¼ï¼š\nçœ‹ä¸€ä¸‹mindsporeçš„ä¼˜åŒ–å®ç°\næœ€åå¤ä¹ ä¸€ä¸‹ï¼Œæœ‰äº†æŸä¸ªè¯­è¨€è¡¨ç¤ºçš„è®¡ç®—å›¾ï¼ˆæ­£å‘ï¼‰ç„¶åæœ‰äº†è‡ªåŠ¨å¾®åˆ†ï¼Œæœ‰äº†æ­£åå‘çš„è®¡ç®—å›¾ï¼Œç„¶åå°±å¯ä»¥æˆä¸ºæ·±åº¦å­¦ä¹ è®­ç»ƒä¹‹å‰çš„å®Œæ•´çš„è®¡ç®—å›¾ã€‚\n3.4 pytorchå’Œtensorflowçš„åŒºåˆ« è¿™ä¸ªæ˜¯è‡ªå·±çš„é¢å¤–æ•´ç†éƒ¨åˆ†ã€‚ä»¥è¿™æ ·ä¸€ä¸ªè®¡ç®—å›¾ä¸ºä¾‹ï¼š\nå·¦è¾¹æ˜¯tensorflowçš„é™æ€å›¾ï¼Œå…ˆæ„å»ºç„¶åè¿›å…¥è¿è¡Œæ—¶ï¼›å³è¾¹æ˜¯torchåŠ¨æ€å›¾ï¼Œç›¸å½“äºæ¯ä¸€ä¸ªè¾“å‡ºéƒ½å¯ä»¥åœ¨ä¸åŒç¯èŠ‚å¾—åˆ°ã€‚ç±»ä¼¼é™æ€ç¼–è¯‘å’ŒåŠ¨æ€ç¼–è¯‘ã€‚\nå·¦å›¾ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºé™æ€ç»“æ„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦åœ¨ä¸€ä¸ªä¼šè¯ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½å®šä¹‰æ–°çš„æ“ä½œï¼ˆæˆ–èŠ‚ç‚¹ï¼‰ï¼Œå¯ä½¿ç”¨sess.run()æ–¹æ³•ä¸­çš„feed_dictå±æ€§æ¥æ”¹å˜è¾“å…¥å˜é‡ã€‚ä»–çš„ç¼ºç‚¹æ˜¯ï¼š\nå¯¹å¯å˜ç»´åº¦è¾“å…¥çš„æ‰©å±•æ€§å¾ˆå·®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªCNNï¼ˆå·ç§¯ç¥ç»ç½‘ç»œï¼‰æ¶æ„æœ‰ä¸€ä¸ªé™æ€çš„è®¡ç®—å›¾ï¼Œåœ¨28Ã—28çš„å›¾åƒä¸Šè®­ç»ƒï¼Œå¦‚æœæ²¡æœ‰å¤§é‡çš„é¢„å¤„ç†æ¨¡æ¿ä»£ç ï¼Œåœ¨ä¸åŒå°ºå¯¸çš„å›¾åƒï¼ˆå¦‚100Ã—100ï¼‰ä¸Šå°±ä¸ä¼šæœ‰å¥½çš„è¡¨ç°ã€‚ è°ƒè¯•æ€§å·®ã€‚è¿™äº›éƒ½æ˜¯å¾ˆéš¾è°ƒè¯•çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºç”¨æˆ·æ— æ³•æ¥è§¦åˆ°ä¿¡æ¯æµæ˜¯å¦‚ä½•å‘ç”Ÿçš„ã€‚ erg:å‡è®¾ç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ªç•¸å½¢çš„é™æ€å›¾ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥è·Ÿè¸ªè¿™ä¸ªé”™è¯¯ï¼Œç›´åˆ°TensorFlowä¼šè¯åœ¨è®¡ç®—åå‘ä¼ æ’­å’Œå‰å‘ä¼ æ’­æ—¶å‘ç°ä¸€ä¸ªé”™è¯¯ã€‚å½“æ¨¡å‹å·¨å¤§æ—¶ï¼Œè¿™å°±æˆä¸ºä¸€ä¸ªä¸»è¦é—®é¢˜ï¼Œå› ä¸ºå®ƒæ—¢æµªè´¹äº†ç”¨æˆ·çš„æ—¶é—´åˆæµªè´¹äº†è®¡ç®—èµ„æºã€‚ pytorchåŠ¨æ€å›¾ç›¸å…³çš„ä¼˜ç‚¹ä¸ºï¼š\nå¯¹ä¸åŒç»´åº¦è¾“å…¥çš„å¯æ‰©å±•æ€§ã€‚å¯¹ä¸åŒç»´åº¦çš„è¾“å…¥æœ‰å¾ˆå¥½çš„æ‰©å±•æ€§ï¼Œå› ä¸ºæ–°çš„é¢„å¤„ç†å±‚å¯ä»¥åŠ¨æ€åœ°åŠ å…¥åˆ°ç½‘ç»œæœ¬èº«ã€‚ è°ƒè¯•å®¹æ˜“ã€‚è¿™äº›éƒ½æ˜¯éå¸¸å®¹æ˜“è°ƒè¯•çš„ï¼Œä¹Ÿæ˜¯å¾ˆå¤šäººä»Tensorflowè½¬å‘Pytorchçš„åŸå› ä¹‹ä¸€ã€‚ç”±äºèŠ‚ç‚¹æ˜¯åœ¨ä»»ä½•ä¿¡æ¯æµç»å®ƒä»¬ä¹‹å‰åŠ¨æ€åˆ›å»ºçš„ï¼Œå› æ­¤é”™è¯¯å˜å¾—éå¸¸å®¹æ˜“å‘ç°ï¼Œå› ä¸ºç”¨æˆ·å®Œå…¨æ§åˆ¶äº†è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨çš„å˜é‡ã€‚ ç¬¬å››èŠ‚ è®¡ç®—å›¾ä¼˜åŒ–å’Œæ‰§è¡Œ 4.1 å›¾ä¼˜åŒ– è®¡ç®—å›¾çš„å¥½å¤„æ˜¯ä½œä¸ºé«˜å±‚IRè¡¨ç°ï¼ŒæŠŠå‰ç«¯å…·ä½“å®ç°å’Œåè€…ä¼˜åŒ–éš”ç¦»ã€‚\nè®¡ç®—å›¾çš„ä¼˜åŒ–æ˜¯ç¼–è¯‘å™¨åšçš„ï¼š\nå¸¸é‡æŠ˜å ï¼šæœ‰äº›å¸¸é‡è®¡ç®—æ¯”å¦‚1+1å¯ä»¥åœ¨ç¼–è¯‘æœŸå°±ç®—å‡ºæ¥ï¼Œæ²¡å¿…è¦åœ¨è¿è¡Œæ—¶è®¡ç®— å¸¸é‡ä¼ æ’­ï¼šå¸¸é‡ä¼ æ’­ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŠŠå¸¸é‡ä¼ æ’­åˆ°ä½¿ç”¨äº†è¿™ä¸ªå¸¸é‡çš„åœ°æ–¹å»ï¼Œç”¨å¸¸é‡æ›¿æ¢åŸæ¥çš„å˜é‡ã€‚https://www.modb.pro/db/524829 https://blog.csdn.net/qq_36287943/article/details/104974597 ç®—å­èåˆï¼šå°ç®—å­å˜æˆå¤§ç®—å­ 7 æ˜¯ä¸€äº›åå‘çš„æ“ä½œã€‚ã€‚ã€‚ï¼ˆå¦‚ä¸‹å›¾æ˜¾ç¤ºï¼‰\nä»–çš„è®¡ç®—æ—¶æ ¹æ®ä¾èµ–å…³ç³»ä¸¢åˆ°ä¸€ä¸ªç®—å­åˆ—è¡¨ï¼Œç„¶åè®¡ç®—å•å…ƒæ ¹æ®æˆ‘ä»¬çš„ç®—å­åˆ—è¡¨è®¡ç®—å‡ºç»“æœã€‚\n4.2 ç®—å­è°ƒåº¦ åœ¨ä¸åŒçš„çº¿ç¨‹æ± å¹¶è¡Œï¼ˆå¤šè®¡ç®—æ ¸ï¼‰å¯ä»¥æé«˜æˆ‘ä»¬çš„ç®—å­è®¡ç®—é€Ÿåº¦ã€‚ å‡è®¾æˆ‘ä»¬æœ‰å››å°è®¡ç®—è®¾å¤‡ï¼Œå¯¹äºInceptionæ¨¡å—ï¼Œæˆ‘ä»¬å¯èƒ½ä¸åŒçš„ç®—å­æ¨¡å—ä¼šæ”¾åˆ°ä¸åŒçš„è®¡ç®—è®¾å¤‡ä¸­è¿è¡Œï¼ˆä¸‹å›¾å·¦ä¾§ï¼‰\nä¸€æ—¦æ”¾åœ¨ä¸åŒè®¾å¤‡å°±æœ‰å¤šç§è°ƒåº¦æ¨¡å¼ï¼Œè¿™é‡Œæ²¡é‚£ä¹ˆç®€å•ï¼Œæˆ‘ä»¬è¿˜è¦çœ‹çœ‹å¦‚ä½•å¤„ç†ä¿¡æ¯çš„åˆ‡åˆ†ï¼ˆæ•°æ®æ˜¯æ€ä¹ˆåˆ‡åˆ†çš„ï¼Ÿæ€ä¹ˆåˆ†åˆ°ä¸åŒçš„è®¾å¤‡çš„ï¼Ÿï¼‰\nåˆ‡åˆ†åå¯èƒ½é€šè¿‡sendç®—å­ä¹Ÿå¯èƒ½æ˜¯é€šè®¯åŸè¯­è¿›è¡Œä¼ è¾“ã€‚\næœ‰å…³é€šè®¯åŸè¯­å¯å‚è€ƒopenmmlab çš„ç›¸å…³æ¨æ–‡ï¼š\nAIæ¡†æ¶åŸºç¡€æŠ€æœ¯ä¹‹æ·±åº¦å­¦ä¹ ä¸­çš„é€šä¿¡ä¼˜åŒ–\nhttps://zhuanlan.zhihu.com/p/348982652\næˆ–æœ¬è§†é¢‘ä½œè€…çš„æ–‡ç« ï¼šåˆ†å¸ƒå¼è®­ç»ƒç¡¬æ ¸æŠ€æœ¯â€”â€”é€šä¿¡åŸè¯­https://zhuanlan.zhihu.com/p/465967735\nå®é™…ä¸Šè¿™ä¸ªæ˜¯éå¸¸å›°éš¾çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘è¦è€ƒè™‘è®¡ç®—å›¾æ€ä¹ˆåˆ‡åˆ†ï¼Œæ€ä¹ˆåˆ‡åˆ†å¯ä»¥è®©æˆ‘çš„ç»„åˆä¼˜åŒ–é—®é¢˜æ•ˆç‡æ›´é«˜ï¼ˆå¯¹ç®—å­è¿›è¡Œåˆ†å‘å’Œé€šè®¯çš„æ‰‹æ®µï¼‰\nç¬¬äº”èŠ‚ AIæ¡†æ¶å¦‚ä½•è¡¨ç¤ºæ§åˆ¶æµ AIæ¡†æ¶åœ¨è®¾è®¡çš„æ—¶å€™å°±åƒåšåˆ°å‰åç«¯åˆ†ç¦»ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æå‡ºäº†ç»Ÿä¸€æ ‡è¯†è®¡ç®—å›¾ï¼Œé€šè¿‡ç»Ÿä¸€æè¿°å¯ä»¥å¸®åŠ©å‰ç«¯ç”¨æˆ·æ›´çµæ´»ç¼–å†™ç®—æ³•ï¼›è®¡ç®—å›¾ä¹Ÿå½±å“äº†åç»­ä¼˜åŒ–æ–¹å¼å’Œç³»ç»Ÿæ‹“å±•ï¼›\n5.1 æ§åˆ¶æµ ä»¥transformerä¸ºä¾‹ï¼šé™¤äº†ifè¿˜æœ‰å¾ˆå¤šforå¾ªç¯ã€‚\nç°åœ¨ä¸»æµæœ‰äº†ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼šï¼ˆåˆ†åˆ«æ˜¯ten py mindspore)\ntenå’Œtorchæœ€æ–°ç‰ˆæœ¬ä¹Ÿå¼€å§‹å¼•å…¥ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚\n5.2 tensorflowé™æ€å›¾æ§åˆ¶æµå®ç° é™æ€å›¾çš„æ§åˆ¶æµåŸè¯­å°±æ˜¯ä¸‹åˆ—å›¾æåˆ°çš„ Enterç­‰é‚£äº”ä¸ªï¼Œæå‰å£°æ˜çš„å¥½å¤„æ˜¯å¯ä»¥è·å¾—ç»Ÿä¸€æè¿°ï¼Œä¸éœ€è¦åå¤åˆ‡æ¢å‰ç«¯è¯­è¨€å’Œè¿è¡Œæ—¶ï¼Œéƒ½åœ¨runtimeè§£å†³ã€‚\ntfå¾ˆéº»çƒ¦è¦ç”¨åˆ°å„ç§condçš„åŸºç¡€apiï¼Œè™½ç„¶å°è£…é«˜å±‚æ¬¡apiæ¯”å¦‚caseä¹‹ç±»çš„è¿˜æ˜¯å¾ˆéš¾ç”¨ï¼›torchæ ¹æ®ç¬¬ä¸‰ç§æºç è½¬æ¢çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠå‰ç«¯è¯­å¥æ˜ å°„åˆ°å¯¹åº”çš„åŸºç¡€æ§åˆ¶æµapiã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œä¸€èµ·çœ‹çœ‹tensorflowé‡Œé¢æ˜¯æ€ä¹ˆæ·»åŠ æ§åˆ¶æµåŸè¯­çš„ï¼š\nåœ¨tensorflowåé¢éœ€è¦è°ƒç”¨ä¸¤ä¸ªwhile loopè¿›è¡ŒåµŒå¥—è¡¨è¾¾ã€‚åœ¨åº•å±‚çš„è¡¨è¾¾æ˜¯æœ‰ä¸€ä¸ªexcution frameå¸§ï¼ˆé‡Œé¢æ˜¯ä¸€ä¸ªscopeï¼‰ï¼Œé‡Œé¢ä¿å­˜äº†ç®—å­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼›åµŒå¥—forå°±ä½¿ç”¨äº†åµŒå¥—çš„æ‰§è¡Œå¸§ã€‚\ncondæ˜¯ç”¨äº† switchå’ŒmergeåŸè¯­ç»„æˆçš„ã€‚å®é™…ä¸Šè¿˜æ˜¯å¾ˆéš¾ç†è§£ä½¿ç”¨çš„\u0026hellip;\u0026hellip;.\næ›´å¤æ‚çš„æ“ä½œå°±æ˜¯while loopçš„æ“ä½œï¼ˆéš¾æ€ªtfè¶Šæ¥è¶Šå°‘äººç”¨ã€‚ã€‚ï¼‰\næ¥ä¸‹æ¥çœ‹çœ‹æä¾›æ§åˆ¶æµåŸè¯­çš„ä¼˜ç¼ºç‚¹ï¼šï¼ˆç¼ºç‚¹å¤ªå¤ªå¤ªæ˜æ˜¾äº†ã€‚ã€‚éœ€è¦èŠ±æ—¶é—´å­¦ä¹ æ§åˆ¶æµåˆ°åº•æ˜¯æ€ä¹ˆè¡¨è¾¾å’Œä½¿ç”¨çš„ï¼Œè€Œä¸”è®¡ç®—å›¾è¢«è¿™ä¹ˆå¤æ‚åŒ–çœŸçš„æ²¡æ³•çœ‹äº†ï¼‰\n5.3 pytorchåŠ¨æ€å›¾æ§åˆ¶æµå®ç° å¯¹äºtorchè€Œè¨€ï¼Œé€‰æ‹©çš„æ˜¯å¤ç”¨ç”¨æˆ·å‰ç«¯apiè¯­è¨€æ§åˆ¶æµè¯­å¥ã€‚\nåç«¯ç›´æ¥é€‰æ‹©ç”¨åº“çš„è¡Œä¸ºæ‰§è¡Œç®—å­ï¼Œå¦‚æœé‡åˆ°æ§åˆ¶æµå°±åœ¨pythoné‡Œé¢æ‰§è¡Œã€‚è¿™ä¸ªæœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯ä»¥çµæ´»ä½¿ç”¨æ§åˆ¶æµè€Œä¸”é©¬ä¸Šè¾“å‡ºå¼ é‡çš„è®¡ç®—ç»“æœã€‚ç¼ºç‚¹å°±æ˜¯å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œè¿˜æœ‰runtimeå¼€é”€ã€‚ã€‚ã€‚ã€‚æ— æ³•è¿›è¡Œå…¨å±€è®¡ç®—å›¾ä¼˜åŒ–ã€‚\n5.4 mindsporeé™æ€å›¾æ§åˆ¶æµå®ç° æ¥ä¸‹æ¥å†çœ‹çœ‹mindsporeçš„åšæ³•ï¼Œæºç è§£æå±•å¼€å’Œè½¬æ¢è®¡ç®—å›¾ã€‚æ¯”å¦‚å¯ä»¥å§forå˜æˆä¸²è¡Œçš„ï¼›ifå’Œelseå¯ä»¥å˜æˆä¸¤ä¸ªå­å›¾ï¼Œè¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©å­å›¾è¿›è¡Œè¿ç®—ã€‚è¿™ä¸ªå¥½å¤„æ˜¯ç”¨æˆ·å¯ä»¥ä¸€å®šç¨‹åº¦ä½¿ç”¨å‰ç«¯å®¿ä¸»æ§åˆ¶æµè¯­è¨€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åŠ é€Ÿè¿è¡Œæ—¶æ•ˆç‡ï¼Œå¯ä»¥å…¨å±€ä¼˜åŒ–ã€‚\nä½†æ˜¯ç®—å­é€‰æ‹©éœ€è¦ç¡¬ä»¶æ”¯æŒã€‚ã€‚ã€‚ã€‚éƒ¨åˆ†pythonæ§åˆ¶æµä»£ç ä¹Ÿä¸èƒ½è¡¨ç¤ºï¼Œæœ‰ä¸€å®šç¨‹åº¦çš„çº¦æŸæ€§ï¼ˆå¹¶ä¸æ˜¯å®Œæˆè‡ªç”±ï¼‰\nç¬¬å…­èŠ‚ AIæ¡†æ¶å¦‚ä½•å®ç°åŠ¨é™ç»Ÿä¸€ï¼Œtorchå’Œmindsporeçš„åŠ¨é™ç»Ÿä¸€ç°çŠ¶ 6.1åŠ¨æ€å›¾è½¬æ¢ä¸ºé™æ€å›¾çš„æ–¹æ³• ï¼ˆpaddleä¹Ÿæœ‰ï¼Œç„¶åmindsporeè¯´æ˜¯ç¬¬ä¸€æ¬¡æå‡ºçš„ï¼‰\næ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ ,å…ˆçœ‹ä¸‹trace\nTraceçš„åå¤„æ˜¯å› ä¸ºåŸºäºç”¨æˆ·ä»£ç è¿›è¡Œè¿½è¸ªï¼Œä½†è¿™ä¸ªè¦†ç›–ç‡ä¸ä¸€å®šå…¨ï¼›æ‰€ä»¥éå†åå˜æˆé™æ€å›¾å¯èƒ½ä¼šé€ æˆå›¾æŸå¤±ï¼Œå®é™…ä¸Šè¿™ä¸ªåœ¨å®é™…æ¡†æ¶æ¯”è¾ƒå°‘ã€‚ã€‚ã€‚ã€‚\nä»¥JITï¼ˆJust In Timeï¼‰ä¸ºä¾‹ï¼Œå…¶å®æ˜¯åŸºäºæºä»£ç è§£æã€‚jitæ˜¯è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ï¼Œåœ¨å†…å­˜é‡Œç”Ÿæˆå’Œè¿è¡Œä¸€æ®µä»£ç ï¼Œä¸€è¾¹ç¼–è¯‘ä¸€è¾¹æ‰§è¡Œã€‚\nåŸºäºæºç è§£æçš„JITæ–¹å¼å¦‚ä¸‹ï¼š\n4 æ˜¯ä¸€ç§å¯¹äº123çš„è§£å†³æ–¹å¼ã€‚\nç¬¬ä¸ƒèŠ‚ è®¡ç®—å›¾çš„æŒ‘æˆ˜ä¸æœªæ¥ é¦–å…ˆå›é¡¾ä¸€ä¸‹è®¡ç®—å›¾çš„åŸºç¡€æ•°æ®ç»“æ„ï¼šé¦–å…ˆæ˜¯ç”¨æ­£å‘DAGæ„å»ºåå‘DAGï¼Œè®¡ç®—å›¾ä¸»è¦ç”±èŠ‚ç‚¹å’Œè¾¹æ„æˆçš„ï¼Œæ‰€ä»¥å¯ä»¥å«åšæ•°æ®æµå›¾ã€‚è®¡ç®—å›¾å‡ºç°çš„å¥½å¤„æ˜¯æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„è¡¨ç¤ºï¼Œåšåˆ°äº†åˆ†å±‚è§£è€¦ã€‚\né‡è¦çš„å°±æ˜¯ä¸‰ä¸ªä¼˜åŒ–å±‚ï¼\nä½œè€…ç»™å‡ºçš„æ€è€ƒï¼š\nä¸€å®šéœ€è¦æ˜ç¡®çš„åˆ†å±‚è§£è€¦?\npytorchæ²¡é‚£ä¹ˆå¤šå±‚ä¸ºä»€ä¹ˆè¿™ä¹ˆæˆåŠŸï¼Ÿ\næ–°çš„diffusionå’Œtransformåº•å±‚ä¼˜åŒ–å¦‚ä½•æ”¹å˜ï¼Ÿ\nè®¡ç®—å›¾ä¸èƒ½è§£å†³AI ä¸šåŠ¡çš„å“ªäº›é—®é¢˜ï¼Ÿ\nå†æ¥çœ‹æ›´å¤šï¼š\n","date":"2023-01-02T11:14:16+08:00","permalink":"https://sanbuphy.github.io/p/ai%E6%A1%86%E6%9E%B6%E4%B9%8B%E8%AE%A1%E7%AE%97%E5%9B%BE%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%E7%AC%94%E8%AE%B0/","title":"AIæ¡†æ¶ä¹‹è®¡ç®—å›¾çš„å‰ä¸–ä»Šç”Ÿï¼ˆç¬”è®°ï¼‰"},{"content":"åŸºç¡€ top ä¸å¤šè¯´ ï¼ˆæˆ‘æ›´å–œæ¬¢htopæœ‰æ—¶å€™ï¼‰\nps è¿›ç¨‹ä¿¡æ¯\nfree ç³»ç»Ÿå†…å­˜æ•´ä½“ä½¿ç”¨ç‡\nldd åŠ¨æ€é“¾æ¥ä¿¡æ¯\nnm äºŒè¿›åˆ¶ç¬¦å·è¡¨ä¿¡æ¯\nobjdump ä¸å¤šè¯´\nreadelf ä¸å¤šè¯´\nsysstatå·¥å…·ä»‹ç» sysstatä¸»è¦ä½œç”¨æ˜¯è§‚å¯ŸæœåŠ¡è´Ÿè½½ï¼Œæ¯”å¦‚cpu\\å†…å­˜çš„å ç”¨ç‡ï¼Œç½‘ç»œçš„ä½¿ç”¨ç‡ä»¥åŠç£ç›˜å†™å…¥å’Œè¯»å–çš„é€Ÿåº¦ç­‰ã€‚ã€‚ã€‚\nsudo apt install sysstat\nsysstatå·¥å…·åŒ…å«\niostatå·¥å…·æä¾›cpuä½¿ç”¨ç‡ä»¥åŠç¡¬ç›˜ååæ•ˆç‡ mpstatæä¾›å•ä¸ªæˆ–å¤šä¸ªå¤„ç†å™¨ç›¸å…³æ•°æ® pidstat å…³äºè¿è¡Œä¸­çš„è¿›ç¨‹ ä»»åŠ¡ cpu å†…å­˜ç»Ÿè®¡ç­‰ä¿¡æ¯ sarå·¥å…·è´Ÿè´£æ”¶é›†ï¼ŒæŠ¥å‘Šå¹¶å­˜å‚¨ç³»ç»Ÿæ´»è·ƒä¿¡æ¯ï¼ˆæˆ‘æ„Ÿè§‰è¿™ä¸ªæ¯”è¾ƒå‰å®³ï¼‰ sar å¸¸è§é—®é¢˜ï¼š\næ²¡æœ‰ç»Ÿè®¡æƒé™ï¼Œå‚è€ƒï¼šhttps://blog.csdn.net/lord_y/article/details/100139049 æ— æ³•æ‰“å¼€/sysstat/sa02 æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼šhttps://blog.csdn.net/lord_y/article/details/100139049 åˆšå¼€ç»Ÿè®¡æƒé™åï¼Œè¦è¿‡ä¸€ä¼šå„¿æ‰èƒ½åœ¨sar -u çœ‹åˆ°å…·ä½“çš„ä¿¡æ¯ sar -u å›æ˜¾è¯´æ˜\nä¸»è¦çœ‹ä¸‹é¢ä¸¤æ¡ï¼š\nè‹¥iowaitè¿‡é«˜è¡¨ç¤ºå­˜åœ¨I/O ç“¶é¢ˆï¼Œå³ç£ç›˜I/Oæ— æ³•æ»¡è¶³ä¸šåŠ¡éœ€æ±‚\nè‹¥idleè¿‡ä½æŒç»­ä½äº10ï¼Œè¡¨ç¤ºcpuä½¿ç”¨ç‡æ¯”è¾ƒä¸¥é‡ï¼Œæœ€éœ€è¦è§£å†³çš„èµ„æºæ˜¯cpuï¼Œéœ€è¦ç»“åˆå†…å­˜ä½¿ç”¨æƒ…å†µåˆ¤æ–­cpuæ˜¯å¦ç“¶é¢ˆï¼Œè‹¥idleè¿‡é«˜ä½†ç³»ç»Ÿå“åº”æ…¢ï¼Œæœ‰å¯èƒ½æ˜¯cpuç­‰å¾…åˆ†é…å†…å­˜ï¼Œæ­¤æ—¶åº”åŠ å¤§å†…å­˜å®¹é‡ã€‚\n%user ç”¨æˆ·æ¨¡å¼ä¸‹æ¶ˆè€—çš„CPUæ—¶é—´çš„æ¯”ä¾‹ï¼› %nice é€šè¿‡niceæ”¹å˜äº†è¿›ç¨‹è°ƒåº¦ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ¶ˆè€—çš„CPUæ—¶é—´çš„æ¯”ä¾‹ %system ç³»ç»Ÿæ¨¡å¼ä¸‹æ¶ˆè€—çš„CPUæ—¶é—´çš„æ¯”ä¾‹ï¼› %iowait CPUç­‰å¾…ç£ç›˜I/Oå¯¼è‡´ç©ºé—²çŠ¶æ€æ¶ˆè€—çš„æ—¶é—´æ¯”ä¾‹ï¼›ï¼ˆå³cpuç­‰å¾…ioçš„ç™¾åˆ†æ¯”ï¼‰ %steal åˆ©ç”¨Xenç­‰æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç­‰å¾…å…¶å®ƒè™šæ‹ŸCPUè®¡ç®—å ç”¨çš„æ—¶é—´æ¯”ä¾‹ï¼› %idle CPUç©ºé—²æ—¶é—´æ¯”ä¾‹ï¼› å¦‚æœæƒ³è¦çœ‹å®æ—¶çš„10æ¡ï¼Œå¯ä»¥ä½¿ç”¨sar -u ALL 1 10\nsar -I 3 1 ç»Ÿè®¡æŸä¸ªç¡¬ä¸­æ–­é¢‘ç‡ å¯ä»¥ç”¨æ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸çš„ç¡¬ç»ˆç«¯é¢‘ç‡ã€‚\næ¯”å¦‚ç¡¬ç›˜ä¸­æ–­è¿‡é«˜æœ‰æ—¶å€™æ˜¯å†…å­˜ç‚¸äº†ï¼Œswapè¿‡åº¦ã€‚ä¸€ç›´åœ¨ç¡¬ç›˜ä¸­æ–­ã€‚\nï¼ˆQï¼šswapä¸€èˆ¬ä»€ä¹ˆæ—¶å€™æ»¡äº†ï¼Ÿ A:ç½‘ç»œå¡äº†å‘ä¸å‡ºä¿¡æ¯å¡æ»¡ç¼“å­˜ï¼Œä¸€ç›´åœ¨äº¤æ¢ã€‚ã€‚ã€‚æˆ–è€…ç©ºé—´ç¢ç‰‡è¿‡å¤šä¸è¿ç»­å¯¼è‡´å¡çˆ†ï¼Œå¯èƒ½é€ æˆé‡å¯äº‹æ•…ï¼‰\nç³»ç»Ÿç“¶é¢ˆåˆ¤æ–­æ–¹æ³•ï¼š é™¤äº†å¸¸è§çš„topå’Œfree\n1-æ€€ç–‘cpuå­˜åœ¨ç“¶é¢ˆ å¯ç”¨ä¸¤ä¸ªæŒ‡ä»¤æŸ¥çœ‹ï¼š\nsar -u sar -q\n2-æ€€ç–‘å†…å­˜å­˜åœ¨ç“¶é¢ˆå¯ç”¨ sar -B\nsar -r\nsar -w\n3-æ€€ç–‘I/Oå­˜åœ¨ç“¶é¢ˆï¼Œå¯ç”¨ sar -b\nsar -u\nsar -d\npidstat æŸ¥çœ‹cpuçš„ä½¿ç”¨æƒ…å†µï¼Œæ¯ç§’ç»Ÿè®¡ä¸€æ¬¡\næŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹è¿è¡Œåœ¨é‚£ä¸ªcpuä¸Šï¼Œéšä¾¿æ‰¾äº†ä¸€ä¸ªè¿›ç¨‹ä¸ºä¾‹ï¼š pidstat -u -p 587990 -t æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ¯ç§’ç»Ÿè®¡ä¸€æ¬¡ ç»Ÿè®¡ä¸‰æ¬¡\npidstat -r -p 587990 1 3\nRSS ç‰©ç†å†…å­˜ VSZ è™šæ‹Ÿå†…å­˜ majflt/s å¤§ç¼ºé¡µæ¬¡æ•°ï¼Œéœ€è¦è¯»ç£ç›˜ minflt/s å°ç¼ºé¡µæ¬¡æ•°ï¼Œéœ€è¦è¯»å†…å­˜ mpstat linux cpuå®æ—¶ç›‘æ§ï¼Œæ¯ç§’æ˜¾ç¤ºä¸€æ¬¡cpuä½¿ç”¨çŠ¶æ€ï¼ˆç±»ä¼¼topï¼‰\nmpstat -P ALL 1\nperf ç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·ï¼Œè¿”å›cpuæ­£åœ¨æ‰§è¡Œçš„å‡½æ•°åä»¥åŠè°ƒç”¨æ ˆã€‚\nperfèƒ½åšä»€ä¹ˆ\næä¾›å„ç§è§’åº¦çš„ç³»ç»Ÿæ€§èƒ½åˆ†æï¼Œcpu/å†…å­˜ ç£ç›˜ ç½‘ç»œç­‰ç­‰ å®šä½æ€§èƒ½å¼‚å¸¸ï¼Œè¾…åŠ©æ€§èƒ½ä¼˜åŒ– éœ€è¦æŒæ¡çš„éƒ¨åˆ†\næ€§èƒ½æ•°æ®æ”¶é›† perf stat perf recordf ç«ç„°å›¾çš„ç”Ÿæˆ åŸºäºperfç”Ÿæˆçš„svgå›¾ç‰‡ï¼Œç”¨äºå±•ç¤ºcpuè°ƒç”¨æ ˆ strace è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ä¸ä¿¡å·ï¼ˆsyscallç­‰ã€‚ã€‚ï¼‰\næ¯”å¦‚è·Ÿè¸ªä¸€å·è¿›ç¨‹ï¼ˆinitï¼‰\nsudo strace -p 1\nç»Ÿè®¡ç³»ç»Ÿå‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼š\næŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´\nsudo strace -p 1 -t ç²¾ç¡®åˆ°ç§’ -ttç²¾ç¡®åˆ°å¾®å¦™\nstraceèƒ½åšçš„äº‹æƒ… åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¡æ­» è§‚å¯Ÿè€—æ—¶æ“ä½œæœ‰å“ªäº› è§‚å¯ŸåŠ è½½äº†é‚£äº›åŠ¨æ€åº“ è§‚å¯Ÿæ‰“å¼€äº†é‚£äº›æ–‡ä»¶ lsof æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€æ–‡ä»¶ä¿¡æ¯ï¼ŒæŸ¥çœ‹æŸä¸ªæ–‡ä»¶æ˜¯å¦è¢«æ‰“å¼€\nlsof | grep deleted å¤„ç†ç£ç›˜å·²æ»¡ä½†æ˜¯æ‰¾ä¸åˆ°å¯¹åº”å¤§æ–‡ä»¶çš„é—®é¢˜ã€‚ ä¸€ç§æ–¹æ³•æ˜¯killç›¸åº”è¿›ç¨‹ï¼Œæˆ–è€…åœæ‰è¿™ä¸ªæ–‡ä»¶çš„åº”ç”¨ï¼Œè®©osè‡ªåŠ¨å›æ”¶ç£ç›˜ç©ºé—´ã€‚ dmesgã€æ³¨æ„ åªæœ€è¿‘1å°æ—¶çš„ä¿¡æ¯ï¼ï¼ï¼ï¼ï¼ï¼ï¼ã€‘ æŸ¥çœ‹å†…æ ¸æ—¥å¿—ï¼Œå†…æ ¸æ—¥å¿—ä¹Ÿä¼šè¢«syslogdåŒæ­¥è½¬å‚¨ï¼Œè½¬å‚¨ä½ç½®å–å†³äºsyslogdå¯åŠ¨å‚æ•°ã€‚ å¯ä»¥æ ¹æ®dmesgæŸ¥è¯¢æŒ‡å®šè¿›ç¨‹IDæ˜¯å¦è¢«ç³»ç»Ÿæ€æ‰ dmesg | grep è¿›ç¨‹id æ³¨æ„ åªæœ€è¿‘1å°æ—¶çš„ä¿¡æ¯ï¼ï¼ï¼ï¼ï¼ï¼ï¼ æ¯”å¦‚linuxçš„oomæœºåˆ¶ï¼ŒæŸä¸ªè¿›ç¨‹å ç”¨å¾ˆå¤§çš„å†…å­˜ï¼Œä¼šå¯¼è‡´è¿›ç¨‹è¢«killäº†ã€‚ã€‚ã€‚ã€‚cat /var/log/messages | grep Killæ˜¯å¦æŸ¥åˆ°äº† Out of memory: Kill processã€å¯ä»¥ç»“åˆmore less grep tailæŸ¥çœ‹ /proc é€šè¿‡è™šæ‹Ÿæ–‡ä»¶ï¼ˆå†…æ ¸æ•°æ®ç»“æ„å¯è§†åŒ–æ¥å£ï¼‰è·å¾—å†…æ ¸ä¿¡æ¯ï¼Œä¸»è¦æœ‰ï¼š\nè¿›ç¨‹ä¿¡æ¯ å†…å­˜èµ„æºä¿¡æ¯ ç£ç›˜åˆ†åŒºä¿¡æ¯ï¼ˆprocåªè¯»ï¼Œ/sys å¯ä»¥è¯»å†™ï¼‰ åˆ©ç”¨gdbæŸ¥çœ‹æ­»é”é—®é¢˜ gdb attachæŸ¥çœ‹æ­»é”é—®é¢˜\nç»“è®ºï¼šé”çš„èŒƒå›´ä¸€å®šè¦æ§åˆ¶å¥½ï¼Œåœ¨å¤æ‚çš„åµŒå¥—é€»è¾‘ä¸­æ›´åŠ éœ€è¦è°¨æ…ã€‚\nå†è°ƒç­–è¿‡ç¨‹ä¸­ï¼Œç¢°åˆ°çº¿ç¨‹ä¸è¿è½¬çš„æƒ…å†µï¼ŒçŒœæµ‹çº¿ç¨‹å·²ç»æ­»é”åƒµæ­»äº†ï¼Œ\nå®šä½æ€è·¯1ï¼š\næ„é€ çº¿ç¨‹ï¼Œgdb attach $(pid)è¿›å…¥çº¿ç¨‹ info threadsç›´æ¥æŸ¥çœ‹çº¿ç¨‹å †æ ˆï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰çº¿ç¨‹ä¸€ç›´åœ¨ç­‰å¾…é”ã€‚ thread $(gdb id)æŸ¥çœ‹çº¿ç¨‹å †æ ˆ å®šä½æ€è·¯2ï¼š\ntop æŸ¥çœ‹è¦è°ƒè¯•çš„è¿›ç¨‹id gdb pstack pidè¿›å…¥traceæ¨¡å¼ thread apply all btæŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹çš„ back traceä¿¡æ¯ï¼› æŸ¥çœ‹æ‰€æœ‰ç­‰å¾…é”çš„çº¿ç¨‹ï¼Œæ‰¾åˆ°æœ€æ—©çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä»£ç ä¸­æ‰¾åˆ°å¯¹åº”çš„ä½ç½®ï¼Œå¯¹åº”é”çš„å‡½æ•°ï¼Œå…·ä½“é”åœ¨å“ªä¸ªçº¿ç¨‹ã€‚ thread å®šä½é”çº¿ç¨‹id btæŸ¥çœ‹btä¿¡æ¯ ä½¿ç”¨f7è¿›å…¥ç„¶å p lockNameæŸ¥çœ‹é”è¢«å“ªä¸ªçº¿ç¨‹æ‰€æ‹¥æœ‰ taskset busyboxå·¥å…·ä¸­çš„å‘½ä»¤ï¼Œå¯ä»¥å°†è¿›ç¨‹æ”¾åˆ°æŒ‡å®šçš„cpuæ ¸ä¸Šè¿è¡Œï¼Œç»‘æ ¸ï¼ˆäº²å’ŒåŠ›ï¼‰ã€‚\npstree è¿›ç¨‹æ ‘çˆ¶å­å…³ç³»\nnetstat ç›‘æ§tcp/ipç½‘ç»œã€‚æ˜¾ç¤ºè·¯ç”±è¡¨ï¼Œå®é™…ç½‘ç»œè¿æ¥å’Œæ¯ä¸€ä¸ªç½‘ç»œæ¥å£è®¾å¤‡çš„çŠ¶æ€ä¿¡æ¯ã€‚\nnetstat -tunlpç”¨äºæ˜¾ç¤ºtcp udp çš„ç«¯å£å’Œè¿›ç¨‹çš„ç›¸å…³æƒ…å†µ\nnetstat -tunlp | grep ç«¯å£å·\nvmstat å±äºsysstatåŒ…ï¼Œå¯ä»¥å±•ç¤ºç»™å®šæ—¶é—´é—´éš”çš„æœåŠ¡å™¨çš„çŠ¶æ€å€¼ï¼ˆCPUä½¿ç”¨ç‡ï¼Œå†…å­˜ä½¿ç”¨ï¼Œè™šæ‹Ÿå†…å­˜äº¤æ¢æƒ…å†µï¼‰\nç›¸æ¯”topï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªæœºå™¨çš„cpu å†…å­˜ ioä½¿ç”¨æƒ…å†µï¼Œè€Œä¸æ˜¯å„ä¸ªè¿›ç¨‹çš„cpu å†…å­˜ä½¿ç”¨ç‡ã€‚\npidof å¿«é€Ÿæ‰¾åˆ°åº”ç”¨çš„pidï¼Œç›¸å½“äº ps -ef | grep lscpu ä¸è§£é‡Š\nvalgrind ç”¨äºlinuxç¨‹åºçš„å†…å­˜è°ƒè¯•å’Œä»£ç å‰–æ\nç”¨äºå†…å­˜æ³„æ¼æ£€æµ‹è°ƒè¯•ã€‚ï¼ˆç”³è¯·é‡Šæ”¾ä¸åŒ¹é…ï¼ŒäºŒæ¬¡é‡Šæ”¾ï¼Œä½¿ç”¨é‡Šæ”¾åå†…å­˜ï¼Œä½¿ç”¨æœªåˆå§‹åŒ–å†…å­˜ï¼‰\niotop ç±»ä¼¼top ï¼Œæ›´æ–¹ä¾¿ç›‘æ§è¿›ç¨‹å¯¹ç£ç›˜è¯»å–æƒ…å†µ\nsudo apt install iotop\niostat å¯¹ç³»ç»Ÿçš„ç£ç›˜æ“ä½œæ´»åŠ¨è¿›è¡Œç›‘è§†ï¼ˆç›‘è§†ç½‘å¡ã€cpuã€ttyã€ç£ç›˜çš„ioè´Ÿè½½æƒ…å†µï¼‰\nclockdiff æµ‹ç®—è®¾å¤‡é—´ç³»ç»Ÿæ—¶é—´å·®\nfuser æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨ä½¿ç”¨æŒ‡å®šçš„fileï¼Œfile systemæˆ–è€…socketsçš„è¿›ç¨‹ä¿¡æ¯ã€‚\nlinuxæƒ…å†µä¸‹ï¼Œå½“ç”¨umountå¸è½½æŒ‚è½½ç‚¹ä¼šé‡åˆ°device is busyæç¤ºï¼Œç”¨fuserå°±å¯ä»¥æŸ¥åˆ°è°åœ¨ä½¿ç”¨è¿™ä¸ªèµ„æºã€‚å½“ç„¶ä½¿ç”¨umount -lf [æŒ‚è½½ç‚¹] ä¹Ÿå¯ä»¥å¼ºåˆ¶å¸è½½\nå‡è®¾æ— æ³•å¸è½½çš„è®¾å¤‡ä¸º/dev/sdb1\nè¿è¡Œä¸‹é¢å‘½ä»¤æŸ¥çœ‹xxç”¨æˆ·xxè¿›ç¨‹æ­£åœ¨å ç”¨è¿™ä¸ªè®¾å¤‡ fuser -m -v /dev/sdb12 è¿è¡Œå‘½ä»¤æ²™äº†å¯¹åº”è¿›ç¨‹ fuser -m -v -k /dev/sdb1 æˆ–è€…fuser -m -v -k -i /dev/sdb1è¿™ä¸ªä¼šåœ¨æ€æ‰è¿›ç¨‹å‰è¿›è¡Œç¡®è®¤ï¼ é‡æ–°umount æŸ¥çœ‹å“ªäº›ç¨‹åºä½¿ç”¨tcpçš„80ç«¯å£ï¼š\nfuser -n tcp 80æˆ–è€…fuser -v -n tcp 80æˆ–è€…fuser -v 80/tcp\ndd ç”¨æŒ‡å®šå¤§å°å—æ‹·è´æ–‡ä»¶ï¼Œæ‹·è´åŒæ—¶è¿›è¡ŒæŒ‡å®šçš„è½¬æ¢ï¼ˆç”¨äºå¤‡ä»½ï¼‰\nuptime ç³»ç»Ÿè¿è¡Œäº†å¤šé•¿æ—¶é—´ã€‚ã€‚ã€‚ã€‚æŸ¥çœ‹å¤šå°‘ä¸ªç”¨æˆ·è¿æ¥ã€‚ã€‚ã€‚ä»¥åŠå¹³å‡è´Ÿè½½å€¼\nReference åµŒå…¥å¼æ— äººé©¾é©¶ç³»ç»Ÿè¿›é˜¶ä¸è°ƒæµ‹ï¼ˆæœ¬æ–‡ä¸»è¦å‚è€ƒï¼‰\nhttps://www.bilibili.com/video/BV1MA4y1S7zu/?spm_id_from=333.337.search-card.all.click\nsar â€”â€” Linux ä¸Šæœ€ä¸ºå…¨é¢çš„ç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·ä¹‹ä¸€\nhttps://shockerli.net/post/linux-tool-sar/\n","date":"2022-12-31T12:14:16+08:00","permalink":"https://sanbuphy.github.io/p/linux%E5%B8%B8%E8%A7%81%E6%80%A7%E8%83%BD%E4%B8%8E%E7%93%B6%E9%A2%88%E7%AD%89%E7%BB%B4%E6%8A%A4%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7%E5%90%88%E9%9B%86/","title":"Linuxå¸¸è§æ€§èƒ½ä¸ç“¶é¢ˆç­‰ç»´æŠ¤ç›‘æ§å·¥å…·åˆé›†"},{"content":"å¼€å¤´å®‰åˆ©äº†ä¸€ä¸‹å„ç§æœ‰è¶£çš„åº“ï¼ˆnihuiå§å§çš„çŸ¥ä¹ä¹Ÿå¯ä»¥çœ‹çœ‹\nè¿™é‡Œé¢æœ‰å¾ˆå¤šä¸é”™çš„é¡¹ç›®å®ç°ã€‚\nå…³äºncnnçš„æ‰€æœ‰èµ„æ–™\nhttps://github.com/zchrissirhcz/awesome-ncnn\nncnnæºç è§£æç›¸å…³èµ„æ–™æ¨èï¼š\nhttps://blog.csdn.net/just_sort/article/details/111403398\nhttps://www.zhihu.com/column/c_1320446932913762304\nZenï¼ˆè®¾è®¡ç†å¿µï¼‰ ncnnå†…é’ˆå¯¹armçš„ä¼˜åŒ–ä»£ç éƒ½æ˜¯å¯é€‰çš„â€”â€”æ•´ä¸ªæ¡†æ¶å¹¶ä¸ä¾èµ–ä¼˜åŒ–ä»£ç ï¼Œå¢åŠ äº†å¯ç§»æ¤æ€§å’Œå…¼å®¹æ€§ã€‚\nncnné¡¹ç›®ä½¿ç”¨äº†Vulkançš„APIï¼Œè®©ä¸€å¥—ä»£ç å¯ä»¥åœ¨è¯¸å¦‚å®‰å“ã€IOSç­‰ä»»æ„å¹³å°ä¸Šå®ç°ã€‚\nç»´æŠ¤æ€§ä¹Ÿæ˜¯ncnné¡¹ç›®çš„è®¾è®¡ç†å¿µä¹‹ä¸€ï¼Œ ä¸ºæ–¹ä¾¿å¼€å‘è€…é˜…è¯»ï¼Œé™ä½é˜…è¯»æˆæœ¬ï¼Œncnnä¸­çš„ä¼˜åŒ–ä»£ç éƒ½æ˜¯å¯é€‰çš„ï¼Œè¿™å°±ç›¸å½“äºæ•´ä¸ªæ¡†æ¶ä¸ä¾èµ–äºä¼˜åŒ–ä»£ç ï¼Œæœ‰åˆ©äºåˆ†ç¦»ã€‚æœ€åï¼Œncnnä½œä¸ºåº•å±‚æ¨ç†æ¡†æ¶è¦è€ƒè™‘å…¼å®¹æ€§ï¼Œåº•å±‚èµ‹èƒ½åï¼Œå¼€å‘è€…å°±ç®—æ¢ä»£ç ï¼Œä¹Ÿèƒ½é€‚ç”¨æœ€æ–°æ¡†æ¶ã€‚\nTHE MATâ€”â€”ncnnçš„æ•°æ®ç»“æ„ ncnnä¸éœ€è¦batchsizeã€‚è‡ªå·±åŠ ä¸ªforå¾ªç¯å®ç°å³å¯ã€‚ï¼ˆå› ä¸ºnihuiè§‰å¾—è¿™ä¸ªåªæœ‰è®­ç»ƒæ¡†æ¶æ‰éœ€è¦æ‹¥æœ‰ï¼‰\næ‰€ä»¥æˆ‘åªè¦focusäºç®—å­æœ¬èº«è¦å®ç°çš„åŠŸèƒ½ï¼Œä»£ç å°‘ï¼Œç»´æŠ¤æ€§é«˜ã€‚\næœ€æ—©ncnnç”¨çš„æ˜¯opencvçš„matï¼Œå¯ä»¥æ”¯æŒä»»æ„ç»´åº¦batchsizeã€‚åæ¥nihuiè‡ªå·±å†™äº†ä¸€ä¸ªmatï¼ŒåŒ…æ‹¬æµ…æ‹·è´ï¼ŒwhcåŸºæœ¬çš„ä¸œè¥¿å°±å›ºå®šäº†ã€‚ï¼ˆä¸»è¦çš„è€ƒè™‘æ˜¯æ€§èƒ½ï¼Œä»¥åŠæ•°æ®ç»“æ„çš„è¿ç»­æ€§ï¼Œæœ‰æ²¡æœ‰è¿›è¡Œå¯¹é½ã€‚å¯¹äºæŸäº›armä¸Šæ²¡å¯¹é½æ€§èƒ½å·®å¾ˆå¤šï¼‰\nMatä¸­åŠ äº†cstepå±æ€§ï¼Œå¯ä»¥è®©æ¯ä¸€ä¸ªchanneléƒ½åšä¸€ä¸ªæ•°æ®å¯¹é½ï¼Œè®¿é—®ã€å‚¨å­˜ç­‰æ“ä½œéƒ½å¯ä»¥åœ¨å¯¹é½å†…å­˜ä¸Šè¿›è¡Œï¼Œæ•ˆç‡æ›´é«˜ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä¸åŠ cstepï¼ŒåƒarmV7å°±æœ‰å¾ˆå¤šå¯¹é½å’Œä¸å¯¹é½çš„æ•°æ®ï¼Œè®¿é—®é€Ÿåº¦ä¼šå­˜åœ¨å·®å¼‚ã€‚\nå¦‚æœchannelä¸å¯¹é½ï¼Œå¤šçº¿ç¨‹å¯èƒ½å‡ºé—®é¢˜ï¼Œæ¯ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®çš„æ—¶å€™cacheä¼šè·³åˆ°åˆ«çš„ä¸Šé¢ã€‚\næ­¤å¤–ï¼Œncnnçš„æ•°æ®ç»“æ„è¿˜åšäº†Type-lessï¼Œèµ·åˆMatåªèƒ½æ”¾floatæ•°æ®ç±»å‹ï¼Œä½†int8éœ€è¦æ”¾å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œå‡ºäºå…¼å®¹æ€§çš„è€ƒè™‘ï¼ŒMatåœ¨å°½é‡ä¸æ”¹å˜æ•°æ®ç»“æ„çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å±‚å®ç°çš„è‡ªæˆ‘çº¦å®šæ¥å®ç°æ•°æ®ç±»å‹è§£è¯»ï¼Œé™ä½å¤æ‚æ€§ï¼ŒæŒ‰è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€å¥è¯è¯´å°±æ˜¯â€œçº¦å®šä¼˜äºé…ç½®â€ã€‚\nè½¯ä»¶å·¥ç¨‹æœ‰ä¸€å¥è¯ï¼šçº¦å®šä¼˜äºé…ç½®ã€‚\nå°±æ˜¯åœ¨å¼€å‘ä¸­ï¼Œå¦‚æœæœ‰äº›å€¼ä½ æ²¡æœ‰é…ç½®çš„è¯ï¼Œé‚£ç¨‹åºä¼šå–ä¸€ä¸ªé»˜è®¤å€¼ï¼Œæ¢å¥è¯è¯´ï¼Œèƒ½å–é»˜è®¤å€¼çš„é…ç½®ï¼Œå°±ä¸éœ€è¦é…ç½®äº†ï¼Œè¿™ä¸ªé»˜è®¤å€¼å°±æ˜¯çº¦å®šã€‚ çº¦å®šå¯ä»¥å‡å°‘å¾ˆå¤šé…ç½® æ¯”å¦‚è¯´åœ¨mavençš„ç»“æ„ä¸­:ï¼ˆjavaç¨‹åºä¸ºä¾‹ï¼‰\n/src/main/javaç›®å½•ç”¨æ¥å­˜æ”¾javaæºæ–‡ä»¶ src/main/resourcesç›®å½•ç”¨æ¥å­˜æ”¾èµ„æºæ–‡ä»¶ï¼Œå¦‚application.ymlæ–‡ä»¶ï¼Œmybatisçš„*mapper.xmlæ–‡ä»¶ /src/test/javaç›®å½•ç”¨æ¥å­˜æ”¾javaæµ‹è¯•æ–‡ä»¶ /src/test/resourcesç›®å½•ç”¨æ¥å­˜æ”¾æµ‹è¯•èµ„æºæ–‡ä»¶ /targetç›®å½•ä¸ºé¡¹ç›®çš„è¾“å‡ºä½ç½®\næƒé‡ç›¸å…³â€”â€”ä¸ºä»€ä¹ˆåˆ†ä¸¤ä¸ªæ–‡ä»¶ï¼Ÿ æˆ‘ä»¬ä¼šæœ‰ä¸ªé—®é¢˜ï¼šncnnçš„æ¨¡å‹ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Ÿæ—¢ç„¶æˆ‘çš„ç»“æ„å’Œæƒé‡æ˜¯æˆå¥—ä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¸¤ä¸ªæ–‡ä»¶ï¼Ÿ\nåŸå› æ˜¯å¯ç”¨æ€§çš„è€ƒè™‘ã€‚AIæ¨ç†éƒ¨ç½²æœ‰ä¸€ä¸ªå¾ˆéš¾çš„ç¯èŠ‚æ˜¯æ¨¡å‹è½¬æ¢ï¼ˆå¯èƒ½å› ä¸ºæŸä¸ªç®—å­æ²¡å®ç°ï¼Œæˆ–è€…æ²¡å†™å¥½æˆ–è€…å‚æ•°é…ç½®å‡ºé”™orè½¬æ¢å¤±è´¥ä¼šå¯¼è‡´æ•´ä¸ªæ¨¡å‹éƒ½ç”¨ä¸äº†ï¼‰å½“é‡åˆ°è¿™ç§æƒ…å†µå¯èƒ½ä¼šå‡ºç° nonsupport layer\u0026hellip;.\nä¸»æµé‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼š\næ‰‹å·¥ç”¨ç¼–è¾‘å™¨æ‰“å¼€paramåˆ é™¤å¯¹åº”çš„å›¾ï¼ˆç›´æ¥æŠŠæˆ‘ä¸è¦çš„å±‚å¹²æ‰ï¼‰ï¼Œncnnä¸ºäº†èƒ½æ”¯æŒè¿™ä¸ªæ“ä½œæ‰€ä»¥ç•™ç€äº†ã€‚å¦‚æœå…¶ä»–è½¬æ¢åå¾ˆéš¾å»å¤„ç†å¯¹åº”çš„opã€‚å¦‚æœæ˜¯äººå¯ä»¥ç¼–è¾‘çš„è¯å°±å¯ä»¥äººå·¥å¤„ç†è¿™ä¸ªæ¨¡å‹ï¼ˆçº¯çº¯äºŒè¿›åˆ¶æ–‡ä»¶çš„è¯æ—§æ—§ç™½ç»™äº†ï¼‰\nä½†æ˜¯æœ‰ä¸ªè®¾è®¡çš„é—æ†¾ï¼Œåœ¨ncnn çš„paramå¦‚æœè¦å†™ä¸ªæ•°ç»„ã€ 5 = [0,2,3]ã€‘ï¼Œå¿…é¡»å†™ä¸€ä¸ª-23305(05æ˜¯id) = 3,0,1,2 ï¼ˆ3æ˜¯ä¸ªæ•°ï¼Œæˆ‘æœ‰3ä¸ªä¸ªæ•°ï¼‰ æœ€åè¯´ä¸‹binï¼Œå°±æ˜¯çº¯ç²¹æ”¾æƒé‡çš„æ–‡ä»¶ï¼ˆå­˜åœ¨çš„ç›®çš„ï¼‰ï¼Œæ²¡æœ‰ä»»ä½•ç»“æ„åŒ–ä¿¡æ¯ã€‚ä¸çŸ¥é“å“ªä¸ªæƒé‡å¯¹åº”xxxã€‚è¿™ä¸ªbinä¸èƒ½çŸ¥é“ä»»ä½•æƒé‡ç›¸å…³ä¿¡æ¯ã€‚\nå®ƒçš„å¥½å¤„æ˜¯ï¼Œæˆ‘å¯ä»¥æŠŠå…¶ä»–çš„æ¨¡å‹çš„binéƒ½åˆæˆåˆ°ä¸€èµ·ï¼ˆæ¯”å¦‚æˆ‘youä¸¤ä¸ªæ¨¡å‹ï¼Œæˆ‘å¯ä»¥ç›´æ¥ç”¨concatæŠŠä»–ä»¬ç»„åˆä¸ºä¸€ä¸ªbinï¼‰éƒ¨ç½²èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚\nDynamicâ€”â€”å®Œå…¨åŠ¨æ€å›¾ ncnnæ˜¯éå¸¸åŠ¨æ€å›¾çš„æ¨ç†æ¡†æ¶ï¼Œè¾“å…¥å°ºå¯¸å¯ä»¥ä»»æ„å¤§å°ã€‚ncnnå¤©ç”Ÿé€‚åˆåŠ¨æ€å°ºå¯¸ï¼Œåœ¨2017å¹´å‘å¸ƒæ—¶å°±å·²å…·å¤‡ä¸‰ç§dynamicã€‚\nä¸€æ˜¯å°ºå¯¸ï¼Œ ncnnå¯ä»¥ä»»æ„è¾“å…¥å°ºå¯¸ï¼Œä¸€èˆ¬å…¶ä»–æ¨ç†åŠ è½½æ¨¡å‹æ—¶ä¼šéœ€è¦æŒ‡å®šæœ€å¤§å°ºå¯¸ï¼Œä½†ncnnä¸éœ€è¦ï¼Œå¼€å‘è€…ç»™å®ƒå¤šå°‘å®ƒå°±èƒ½ç®—å¤šå°‘ã€‚\näºŒæ˜¯ç»´åº¦ï¼Œ åŠ¨æ€shapeåˆ†ä¸ºä¸¤ç§ï¼šçŸ¥é“è¾“å…¥ç»´åº¦å’Œä¸ç¡®å®šç»´åº¦ï¼Œncnnçš„ç®—å­æ˜¯ç›´æ¥æ”¯æŒä¸ç¡®å®šç»´åº¦æ“ä½œçš„ï¼Œæ¯”å¦‚BinaryOpè¿è¡Œæ—¶æ¥å—ä¸¤ç»´æ•°æ®ï¼Œä¹Ÿæ¥å—ä¸€ç»´å’Œä¸‰ç»´æ•°æ®ã€‚\nä¸‰æ˜¯æ¨ç†å›¾ï¼Œ åœ¨ncnnä¸­ï¼Œå¯ä»¥åœ¨åŒä¸€æ¨¡å‹ä¸­å®ç°ä»»æ„èŠ‚ç‚¹åˆ°èŠ‚ç‚¹çš„æ¨ç†è·¯å¾„ï¼Œåƒæ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯ä¹Ÿå¯ä»¥é€šè¿‡ä¸åŒå­å›¾ï¼Œæ¢æ¥æ¢å»ï¼Œåœ¨è¿è¡Œæ—¶åˆ¤æ–­å’Œè°ƒåº¦å“ªéƒ¨åˆ†éœ€è¦è®¡ç®—ï¼Œå“ªéƒ¨åˆ†ä¸éœ€è¦è®¡ç®—ï¼Œè¿™æ ·çš„åŠ¨æ€æ¨ç†è·¯å¾„å¯ä»¥æå‡æ•ˆç‡ã€‚\nnihuiæ€€ç–‘å¾ˆå¤šæ¡†æ¶æ˜¯å› ä¸ºå’Œè®­ç»ƒæ¡†æ¶å¯¹é½çš„ï¼Œå› ä¸ºè¦è€ƒè™‘batchsizeæ‰€ä»¥æ‰è¦è€ƒè™‘åˆ°é™æ€å›¾ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šè¿™é‡Œè¡¨è¾¾çš„å°±æ˜¯c=a+b ä½†è¿™é‡Œä¸éœ€è¦è€ƒè™‘åˆ°channelï¼Œå› ä¸ºæ˜¯åŠ¨æ€çš„ï¼ˆæ”¯æŒåŠ¨æ€çš„sizeå’Œchannelï¼‰ã€‚\nncnnçš„å›¾ä¹Ÿæ˜¯å¯ä»¥åŠ¨æ€æ”¹å˜çš„ï¼Œæ¯”å¦‚æœ‰è¿™ä¹ˆä¸€ä¸ªå›¾ï¼šaâ€”â€”bâ€”â€”c\né™æ€å›¾å¿…é¡»å›ºå®šæ¯”å¦‚aè¿›ï¼Œcå‡ºï¼›è€Œncnnå¯ä»¥aè¿›bå‡ºæˆ–è€…bè¿›cå‡ºç­‰ç­‰ã€‚ã€‚ã€‚\næ¯”å¦‚dè¡¨ç¤ºæ˜¯ä¸æ˜¯äººè„¸ï¼Œeè´Ÿè´£äººè„¸ç”»æ¡†ï¼›å¦‚æœdå·²ç»ä¸æ˜¯äººè„¸äº†ï¼Œé‚£å°±å¯ä»¥è·³è¿‡cåˆ°eçš„è®¡ç®—ï¼Œç›¸å½“äºèŠ‚çœäº†è®¡ç®—é€Ÿåº¦ã€‚ï¼ˆåŠ¨æ€å­å›¾æ¨ç†ï¼‰\nå¯¹äºæ™®é€šçš„é™æ€æ¡†æ¶eæ¯ä¸€æ¬¡éƒ½ä¼šå¾—åˆ°ç»“æœï¼ˆä¸ç®¡dç½®ä¿¡åº¦é«˜ä¸é«˜ï¼‰\nåŒæ ·çš„é“ç†ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒé…ç½®çš„æ‰‹æœºè®¾è®¡ä¸åŒçš„å‡ºå£æ¯”å¦‚Xå’ŒYã€‚æ¯”å¦‚bè¾“å‡ºåˆ°Xï¼Œcè¾“å‡ºåˆ°Yï¼Œå¯ä»¥æ ¹æ®ä¸åŒæ‰‹æœºæ€§èƒ½é…ç½®é€‰æ‹©èµ°Xè¿˜æ˜¯èµ°Yã€‚\nIs-Aâ€”â€”ncnnçš„çº¯ç»§æ‰¿å…³ç³»è®¾è®¡layer Is-A v.s. Has-A æ³¨æ„åˆ°è¿™é‡Œçš„è°ƒç”¨åŸºç±»æ“ä½œã€‚æˆ‘ä»¬èµ°ç®—å­ä¼˜åŒ–å¯èƒ½åšç‰¹å®šå‚æ•°ã€sizeä¸‹çš„ä¼˜åŒ–ï¼ˆåªæ”¹ç¼–éƒ¨åˆ†å‚æ•°ï¼‰\nncnné‡‡ç”¨äº†ä¸€ä¸ªçº¯ç²¹çš„ç»§æ‰¿å…³ç³»å»åšçš„æ¶æ„è®¾è®¡ï¼Œç²¾å¿ƒä¼˜åŒ–çš„æ¶æ„ä»£ç ï¼Œ æ¯”å¦‚ï¼šx86ã€armã€vulkanç­‰éƒ½æ˜¯ç»§æ‰¿è‡ªcpuçš„ä¸€ä¸ªæœ€åŸºç¡€å®è·µçš„ï¼Œå½“é‡åˆ°æ²¡æœ‰ä¼˜åŒ–çš„å‚æ•°ç»„åˆæ—¶èƒ½æ–¹ä¾¿çš„å›é€€åˆ°cpuåŸºç¡€å®ç°ã€‚\nå¾ˆå¤šæ¡†æ¶æ˜¯åœ¨poolingé‡Œé¢åŠ äº†ä¸ªkernelï¼Œå’Œopåˆ†å¼€ã€‚è¿™ä¹ˆè®¾è®¡çš„å¥½å¤„æ˜¯kernelå¯ä»¥è¢«å¾ˆå¤šç®—å­ç”¨åˆ°ï¼ˆæ¯”å¦‚gemmçš„kernelå¯ä»¥è¢«å·ç§¯ã€åå·ç§¯çš„ç®—å­ç­‰ç­‰ç”¨åˆ°ï¼‰ï¼›ncnnä¸è¿™ä¹ˆåšçš„åŸå› æ˜¯ï¼škernelå’Œopåˆ†ç¦»éœ€è¦ä¸¤ä»½ä»£ç ï¼Œ è¿™æ ·å¤æ‚åº¦å°±æå‡äº†ä¹Ÿä¸æ–¹ä¾¿è®©ä½ è‡ªå·±å†™æ–°çš„å®ç°ã€‚æ–¹ä¾¿å‡èšç®—å­è‡ªèº«çš„æ¨¡å—æ€§ï¼Œå‡å°‘ç®—å­ä¹‹é—´çš„è€¦åˆã€‚\nä¸è¿‡å¾ˆå¤šæ—¶å€™kernelå…±ç”¨æ€§å¯èƒ½å¹¶ä¸å¤§ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™ä¼˜åŒ–æ˜¯å¯¹ç®—å­æ•´ä½“çš„ä¼˜åŒ–ï¼Œè¿™ä¸ªæ˜¯ç»“æ„ç‰¹æœ‰ä¸å¯å¤ç”¨ã€‚\nCIâ€”â€”ä»£ç å¥å£®æ€§æ£€æŸ¥ ä½¿ç”¨å¥‡æ€ªçš„ä¸å¸¸è§çš„å‚æ•°ç»„åˆè¿›è¡Œæš´åŠ›æµ‹è¯•ï¼Œæ¶ˆé™¤äº†å¾ˆå¤šbugã€‚\nå¼ºè¿«ç—‡æé«˜è¦†ç›–ç‡ã€‚\ncodecovæ— æ³•æä¾›gpuçš„æµ‹è¯•ï¼Œæ‰€ä»¥ç”¨swiftshaderåšäº†gpuç›¸å…³çš„æµ‹è¯•ã€‚\nå¯¹äºä¸€äº›å¥‡è‘©çš„æ¶æ„æ— æ³•è·‘ciï¼Œç”¨qemuç›´æ¥æ¨¡æ‹Ÿæµ‹è¯•å³å¯ã€‚\nå¯¹äºncnnæœ‰äº›çœ‹ä¸Šå»å¾ˆç®€å•çš„å•å…ƒæµ‹è¯•è¯­å¥ï¼Œå®é™…ä¸ŠèƒŒååŒ…å«äº†å„ç§æ•°æ®ç»“æ„å’Œç¡¬ä»¶çš„æµ‹è¯•ã€‚ã€‚ã€‚ã€‚ã€‚\nreference è®²åº§åœ°å€ï¼š\nhttps://cloud.tencent.com/developer/salon/live-1346\nä¼˜å›¾å®˜æ–¹ç¬”è®°\nhttps://zhuanlan.zhihu.com/p/348587668\n","date":"2022-12-30T17:14:16+08:00","permalink":"https://sanbuphy.github.io/p/ncnn%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E4%B8%8E%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%90%AC%E8%AF%BE%E7%AC%94%E8%AE%B0/","title":"ncnnè®¾è®¡ç†å¿µä¸è½¯ä»¶å·¥ç¨‹ï¼ˆå¬è¯¾ç¬”è®°ï¼‰"},{"content":"å…¨æ–‡ç»è¿‡å„ç±»å‚è€ƒçš„æ•´ç†ä¸æ‘˜æŠ„ï¼ˆè‹¥æœ‰é”™è¯¯æ¬¢è¿é‚®ä»¶å‘ŠçŸ¥ï¼Œæ„Ÿè°¢ã€‚ï¼‰\nä»€ä¹ˆæ˜¯è™šå‡½æ•° ä¸ºä»€ä¹ˆéœ€è¦è™šå‡½æ•°ï¼Ÿä»€ä¹ˆæ—¶å€™ä½¿ç”¨äº†è™šå‡½æ•°ï¼Ÿ\næ¯”å¦‚ä½ æœ‰ä¸ªæ¸¸æˆï¼Œæ¸¸æˆé‡Œæœ‰ä¸ªè™šåŸºç±»å«ã€Œæ€ªç‰©ã€ï¼Œæœ‰çº¯è™šå‡½æ•° ã€Œæ”»å‡»ã€ã€‚ç„¶åæ´¾ç”Ÿå‡ºäº†ä¸‰ä¸ªå­ç±»ã€Œç‹¼ã€ã€Œèœ˜è››ã€ã€ŒèŸ’è›‡ã€ï¼Œéƒ½å®ç°äº†è‡ªå·±ä¸åŒçš„ã€Œæ”»å‡»ã€å‡½æ•°ï¼Œæ¯”å¦‚ç‹¼æ˜¯å’¬äººï¼Œèœ˜è››æ˜¯åä¸ï¼ŒèŸ’è›‡æŠŠä½ ç¼ èµ·æ¥ï½ï½\nç„¶åå‡ºç°å¥½å¤šæ€ªç‰©çš„æ—¶å€™å°±å¯ä»¥å®šä¹‰ä¸€ä¸ª è™šåŸºç±»æŒ‡é’ˆæ•°ç»„ï¼ŒæŠŠå„ç§æ€ªç‰©çš„æŒ‡é’ˆç»™å®ƒï¼Œç„¶åè¿­ä»£å¾ªç¯çš„æ—¶å€™ç›´æ¥ monster[i]-\u0026gt;attack() æ”»å‡»ç©å®¶å°±è¡Œäº†ï¼Œå¤§æ¦‚è§ä¸‹å›¾ï¼š\nå¦‚æœæ²¡æœ‰è™šå‡½æ•°çš„è¯ï¼Œç®¡ç†ä¸€å †å·®ä¸å¤šä½†æ˜¯ç±»å‹åˆä¸ä¸€æ ·çš„å¯¹è±¡çš„æ—¶å€™å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚\nè™šå‡½æ•°éœ€è¦æ³¨æ„çš„ç»†èŠ‚ åªæœ‰æˆå‘˜å‡½æ•°æ‰å¯å®šä¹‰ä¸ºè™šå‡½æ•°ï¼Œå‹å…ƒ/å…¨å±€/static/æ„é€ å‡½æ•°éƒ½ä¸å¯ä»¥ æ„é€ å‡½æ•°ä¸å¯ä»¥æ˜¯è™šå‡½æ•°ï¼Œè€Œææ„å‡½æ•°å¯ä»¥ä¸”å¸¸å¸¸æ˜¯è™šå‡½æ•°ã€‚ è®°å¾—åŠ ä¸Šå…³é”®å­—virtual æˆå‘˜å‡½æ•°å¦‚æœä¸æ˜¯è™šå‡½æ•°ï¼Œå…¶è§£æè¿‡ç¨‹å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶è€Œéè¿è¡Œæ—¶ æ´¾ç”Ÿç±»å¯ä»¥ä¸è¦†ç›–ï¼ˆé‡å†™ï¼‰å®ƒç»§æ‰¿çš„è™šå‡½æ•° æ´¾ç”Ÿç±»é‡å†™ï¼ˆè¦†ç›–ï¼‰åŸºç±»ä¸­çš„å‡½æ•°ï¼Œå…¶ä¸­å‡½æ•°åï¼Œå‚æ•°åˆ—è¡¨ï¼Œè¿”å›å€¼ç±»å‹éƒ½å¿…é¡»ä¸€è‡´ï¼Œå¹¶ä¸”é‡å†™ï¼ˆè¦†ç›–ï¼‰çš„å‡½æ•°æ˜¯virtualå‡½æ•° è™šå‡½æ•°åœ¨å­ç±»å’Œçˆ¶ç±»ä¸­çš„è®¿é—®æƒé™å¯ä»¥ä¸åŒ ç›¸å…³è§„åˆ™ï¼š â‘ å¦‚æœè™šå‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼šè¿”å›å€¼ç±»å‹å¿…é¡»ç›¸åŒ â‘¡å¦‚æœè™šå‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯ç±»æœ¬èº«çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼šè¿”å›å€¼ç±»å‹å¯ä»¥ä¸åŒï¼Œä½†æ´¾ç”Ÿç±»çš„è¿”å›å€¼ç±»å‹å°äºåŸºç±»è¿”å›å€¼ç±»å‹ åŸºç±»ä¸æ´¾ç”Ÿç±»çš„è™šå‡½æ•°åä¸å‚æ•°åˆ—è¡¨ç›¸åŒï¼Œè‡³äºå‚æ•°åˆ—è¡¨ä¸ºä»€ä¹ˆä¸€è‡´æ˜¯ä¸ºäº†é¿å…è™šå‡½æ•°è¢«éšè— å®šä¹‰ä»–ä¸ºè™šå‡½æ•°æ˜¯ä¸ºäº†å…è®¸ç”¨åŸºç±»çš„æŒ‡é’ˆæ¥è°ƒç”¨å­ç±»çš„è¿™ä¸ªå‡½æ•°ï¼Œä¸ä»£è¡¨æ²¡æœ‰å®ç°ã€‚\nå®šä¹‰ä¸€ä¸ªå‡½æ•°ä¸ºçº¯è™šå‡½æ•°ï¼Œæ‰ä»£è¡¨å‡½æ•°æ²¡æœ‰è¢«å®ç°ã€‚å®šä¹‰çº¯è™šå‡½æ•°æ˜¯ä¸ºäº†å®ç°ä¸€ä¸ªæ¥å£ï¼Œèµ·åˆ°ä¸€ä¸ªè§„èŒƒçš„ä½œç”¨ï¼Œè§„èŒƒç»§æ‰¿è¿™ä¸ªç±»çš„ç¨‹åºå‘˜å¿…é¡»å®ç°è¿™ä¸ªå‡½æ•°ã€‚ï¼ˆæŠ½è±¡ç±»å¤šç”¨ï¼‰\nåŸºç±»é€šå¸¸éƒ½åº”è¯¥å®šä¹‰ä¸€ä¸ªè™šææ„å‡½æ•°ã€‚å³ä½¿è¯¥å‡½æ•°ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œï¼ æ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•° ä»vptrè§’åº¦è§£é‡Š\nvtable: è®°å½•å‡½æ•°æŒ‡é’ˆçš„ä¸€å¼ è¡¨ã€‚ æ¯ä¸ªç±»ç»´æŠ¤ä¸€ä¸ªè™šè¡¨ã€‚ vptr: æŒ‡å‘è™šè¡¨vtableçš„æŒ‡é’ˆã€‚ æ¯ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªvptrã€‚\nC++æ ‡å‡†å¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚å¦‚ä½•å®ç°è¿è¡Œæ—¶å¤šæ€ï¼Œä½†æ˜¯å„ç¼–è¯‘å™¨åŸºæœ¬ä¸Šéƒ½åŸºäºè¿™ç§æœºåˆ¶ï¼ŒåŠ å…¥å°çš„ä¿®æ”¹ã€‚\nç°ä»£çš„C++ç¼–è¯‘å™¨å¯¹äºæ¯ä¸€ä¸ªå¤šæ€ç±»å‹ï¼Œå…¶æ‰€æœ‰çš„è™šå‡½æ•°çš„åœ°å€éƒ½ä»¥ä¸€ä¸ªè¡¨V-Tableçš„æ–¹å¼å­˜æ”¾åœ¨ä¸€èµ·ï¼Œè™šå‡½æ•°è¡¨çš„é¦–åœ°å€å‚¨å­˜åœ¨æ¯ä¸€ä¸ªå¯¹è±¡ä¹‹ä¸­ï¼Œç§°ä¸ºè™šè¡¨æŒ‡é’ˆvptrï¼Œè¿™ä¸ªè™šæŒ‡é’ˆä¸€èˆ¬ä½äºå¯¹è±¡çš„èµ·å§‹åœ°å€ã€‚é€šè¿‡è™šæŒ‡é’ˆå’Œåç§»é‡è®¡ç®—å‡ºè™šå‡½æ•°çš„çœŸå®åœ°å€å®ç°è°ƒç”¨ã€‚\nè™šå‡½æ•°çš„è°ƒç”¨æ˜¯é€šè¿‡è™šå‡½æ•°è¡¨æ¥æŸ¥æ‰¾çš„ï¼Œè€Œè™šå‡½æ•°è¡¨ç”±ç±»çš„å®ä¾‹åŒ–å¯¹è±¡çš„vptræŒ‡é’ˆ(vptrå¯ä»¥å‚è€ƒC++çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆvptr)æŒ‡å‘ï¼Œè¯¥æŒ‡é’ˆå­˜æ”¾åœ¨å¯¹è±¡çš„å†…éƒ¨ç©ºé—´ä¸­ï¼Œéœ€è¦è°ƒç”¨æ„é€ å‡½æ•°å®Œæˆåˆå§‹åŒ–ã€‚å¦‚æœæ„é€ å‡½æ•°æ˜¯è™šå‡½æ•°ï¼Œé‚£ä¹ˆè°ƒç”¨æ„é€ å‡½æ•°å°±éœ€è¦å»æ‰¾vptrï¼Œä½†æ­¤æ—¶vptrè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼\nä»å¤šæ€è§’åº¦è§£é‡Š\nè™šå‡½æ•°ä¸»è¦æ˜¯å®ç°å¤šæ€ï¼Œåœ¨è¿è¡Œæ—¶æ‰å¯ä»¥æ˜ç¡®è°ƒç”¨å¯¹è±¡ï¼Œæ ¹æ®ä¼ å…¥çš„å¯¹è±¡ç±»å‹æ¥è°ƒç”¨å‡½æ•°ï¼Œä¾‹å¦‚é€šè¿‡çˆ¶ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨æ¥è°ƒç”¨å®ƒçš„æ—¶å€™å¯ä»¥å˜æˆè°ƒç”¨å­ç±»çš„é‚£ä¸ªæˆå‘˜å‡½æ•°ã€‚è€Œæ„é€ å‡½æ•°æ˜¯åœ¨åˆ›å»ºå¯¹è±¡æ—¶è‡ªå·±ä¸»åŠ¨è°ƒç”¨çš„ï¼Œä¸å¯èƒ½é€šè¿‡çˆ¶ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨å»è°ƒç”¨ã€‚é‚£ä½¿ç”¨è™šå‡½æ•°ä¹Ÿæ²¡æœ‰å®é™…æ„ä¹‰ã€‚\nåœ¨è°ƒç”¨æ„é€ å‡½æ•°æ—¶è¿˜ä¸èƒ½ç¡®å®šå¯¹è±¡çš„çœŸå®ç±»å‹ï¼ˆç”±äºå­ç±»ä¼šè°ƒçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼‰ï¼›å¹¶ä¸”æ„é€ å‡½æ•°çš„ä½œç”¨æ˜¯æä¾›åˆå§‹åŒ–ï¼Œåœ¨å¯¹è±¡ç”Ÿå‘½æœŸä»…ä»…è¿è¡Œä¸€æ¬¡ï¼Œä¸æ˜¯å¯¹è±¡çš„åŠ¨æ€è¡Œä¸ºï¼Œæ²¡æœ‰å¿…è¦æˆä¸ºè™šå‡½æ•°ã€‚\næ„é€ å¯¹è±¡æ—¶éœ€è¦çŸ¥é“å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè€Œè™šå‡½æ•°è¡Œä¸ºæ˜¯åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå®é™…ç±»å‹çš„ï¼Œç”±äºå¯¹è±¡è¿˜æœªæ„é€ æˆåŠŸï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œä¿¨ç„¶æ˜¯ä¸ªé¸¡å’Œè›‹çš„é—®é¢˜ã€‚ å¦‚æœæ„é€ å‡½æ•°æ˜¯è™šå‡½æ•°ï¼Œé‚£ä¹ˆæ„é€ å‡½æ•°çš„æ‰§è¡Œå°†ä¾èµ–è™šå‡½æ•°è¡¨ï¼Œè€Œè™šå‡½æ•°è¡¨åˆæ˜¯åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–çš„ï¼Œè€Œåœ¨æ„é€ å¯¹è±¡æœŸé—´ï¼Œè™šå‡½æ•°è¡¨åˆè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆæ˜¯ä¸ªæ­»å¾ªç¯é—®é¢˜ã€‚ ä»ç¼–è¯‘å™¨çš„è§’åº¦å»çœ‹ï¼Œæ„é€ å‡½æ•°å°±æ˜¯ä¸ºäº†åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šå¯¹è±¡ç±»å‹ã€åˆ†é…ç©ºé—´ç­‰å·¥ä½œï¼Œè™šå‡½æ•°ä¸ºäº†å®ç°åŠ¨æ€å¤šæ€éœ€è¦åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…·ä½“çš„è¡Œä¸ºï¼Œæ˜¾ç„¶æ„é€ å‡½æ•°ä¸å¯èƒ½åŒæ—¶å…·å¤‡é™æ€ç‰¹æ€§å’ŒåŠ¨æ€ç‰¹æ€§ã€‚\nææ„å‡½æ•°å¯ä»¥ä¸”å¸¸æ˜¯è™šå‡½æ•° è¿™ä¸ªåŸç†ä¸Šå°±å¾ˆå¥½ç†è§£å•¦ï¼Œå› ä¸ºæ­¤æ—¶ vtable å·²ç»åˆå§‹åŒ–äº†ï¼Œå®Œå…¨å¯ä»¥æŠŠææ„å‡½æ•°æ”¾åœ¨è™šå‡½æ•°è¡¨é‡Œé¢æ¥è°ƒç”¨ã€‚\nC++ç±»æœ‰ç»§æ‰¿æ—¶ï¼Œææ„å‡½æ•°å¿…é¡»ä¸ºè™šå‡½æ•°ã€‚å¦‚æœä¸æ˜¯è™šå‡½æ•°ï¼Œåˆ™ä½¿ç”¨æ—¶å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ç§ç»§æ‰¿å…³ç³»ï¼š å¦‚æœæˆ‘ä»¬ä»¥è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼š SubClass* pObj = new SubClass(); delete pObj; ä¸ç®¡ææ„å‡½æ•°æ˜¯å¦æ˜¯è™šå‡½æ•°(å³æ˜¯å¦åŠ virtualå…³é”®è¯)ï¼Œdeleteæ—¶åŸºç±»å’Œå­ç±»éƒ½ä¼šè¢«é‡Šæ”¾ï¼›\nå¦‚æœæˆ‘ä»¬ä»¥è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼š BaseClass* pObj = new SubClass(); delete pObj; è‹¥ææ„å‡½æ•°æ˜¯è™šå‡½æ•°(å³åŠ ä¸Švirtualå…³é”®è¯)ï¼Œdeleteæ—¶åŸºç±»å’Œå­ç±»éƒ½ä¼šè¢«é‡Šæ”¾ï¼› è‹¥ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°(å³ä¸åŠ virtualå…³é”®è¯)ï¼Œdeleteæ—¶åªé‡Šæ”¾åŸºç±»ï¼Œä¸é‡Šæ”¾å­ç±»ï¼› ï¼ˆ1ï¼‰åŸºç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°çš„è¯ï¼Œåˆ é™¤æŒ‡é’ˆæ—¶ï¼Œåªæœ‰åŸºç±»çš„å†…å­˜è¢«é‡Šæ”¾ï¼Œæ´¾ç”Ÿç±»çš„æ²¡æœ‰ã€‚è¿™æ ·å°±å†…å­˜æ³„æ¼äº†ã€‚\nï¼ˆ2ï¼‰ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°çš„è¯ï¼Œç›´æ¥æŒ‰æŒ‡é’ˆç±»å‹è°ƒç”¨è¯¥ç±»å‹çš„ææ„å‡½æ•°ä»£ç ï¼Œå› ä¸ºæŒ‡é’ˆç±»å‹æ˜¯åŸºç±»ï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨åŸºç±»ææ„å‡½æ•°ä»£ç ã€‚\nï¼ˆ3ï¼‰å…»æˆä¹ æƒ¯ï¼šåŸºç±»çš„ææ„ä¸€å®švirtualã€‚ä½†å¦‚æœæŸä¸ªç±»ä¸åŒ…å«è™šå‡½æ•°ï¼Œä¸€èˆ¬è¡¨ç¤ºå®ƒå°†ä¸ä½œä¸ºä¸€ä¸ªåŸºç±»æ¥ä½¿ç”¨ï¼Œå› æ­¤ä¸ä½¿è™šææ„å‡½æ•°ï¼Œå¦åˆ™å¢åŠ ä¸€ä¸ªè™šå‡½æ•°è¡¨å’Œè™šæŒ‡é’ˆï¼Œä½¿å¾—å¯¹è±¡çš„ä½“ç§¯å¢å¤§ã€‚å¦‚æœæŸä¸ªç±»å°†ä½œä¸ºåŸºç±»é‚£ä¹ˆå»ºè®®ä½¿ç”¨è™šææ„ï¼ŒåŒ…å«è™šå‡½æ•°åˆ™è¿™æ¡è¦æ±‚æˆä¸ºå¿…ç„¶ã€‚æ— æ•…ä½¿ç”¨è™šææ„å‡½æ•°å’Œæ°¸è¿œä¸ä½¿ç”¨ä¸€æ ·æ˜¯é”™è¯¯çš„ã€‚\nä»£ç æµ‹è¯•ï¼š\n#include \u0026lt;iostream\u0026gt; using namespace std; class Father { public: Father(){cout\u0026lt;\u0026lt;\u0026#34;contructor Father!\u0026#34;\u0026lt;\u0026lt;endl;}; ~Father(){cout\u0026lt;\u0026lt;\u0026#34;destructor Father!\u0026#34;\u0026lt;\u0026lt;endl;}; }; class Son:public Father { public: Son(){cout\u0026lt;\u0026lt;\u0026#34;contructor Son!\u0026#34;\u0026lt;\u0026lt;endl;}; ~Son(){cout\u0026lt;\u0026lt;\u0026#34;destructor Son!\u0026#34;\u0026lt;\u0026lt;endl;}; }; int main() { Father *pfather=new Son; delete pfather; pfather=NULL; return 0; } /*è¾“å‡ºç»“æœä¸ºï¼š contructor Father! contructor Son! destructor Father! */ å‡½æ•°é‡è½½ã€å‡½æ•°éšè—ã€å‡½æ•°è¦†ç›–å’Œå‡½æ•°é‡å†™ ç‰¢è®°ä»¥ä¸‹å‡ ç‚¹ï¼Œå°±å¯åŒºåˆ†å‡½æ•°é‡è½½ã€å‡½æ•°éšè—ã€å‡½æ•°è¦†ç›–å’Œå‡½æ•°é‡å†™çš„åŒºåˆ«ï¼š ï¼ˆ1ï¼‰å‡½æ•°é‡è½½å‘ç”Ÿåœ¨ç›¸åŒä½œç”¨åŸŸï¼› ï¼ˆ2ï¼‰å‡½æ•°éšè—å‘ç”Ÿåœ¨ä¸åŒä½œç”¨åŸŸï¼› ï¼ˆ3ï¼‰å‡½æ•°è¦†ç›–å°±æ˜¯å‡½æ•°é‡å†™ã€‚å‡†ç¡®åœ°å«ä½œè™šå‡½æ•°è¦†ç›–å’Œè™šå‡½æ•°é‡å†™ï¼Œä¹Ÿæ˜¯å‡½æ•°éšè—çš„ç‰¹ä¾‹ã€‚\nå…³äºä¸‰è€…çš„å¯¹æ¯”ï¼Œæå¥è€å¸ˆåœ¨ã€Šç¼–å†™é«˜è´¨é‡ä»£ç ï¼šæ”¹å–„C++ç¨‹åºçš„150ä¸ªå»ºè®®ã€‹ç»™å‡ºäº†è¾ƒä¸ºè¯¦ç»†çš„æ€»ç»“ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\nä¸‰è€… ä½œç”¨åŸŸ æœ‰æ— virtual å‡½æ•°å å½¢å‚åˆ—è¡¨ è¿”å›å€¼ç±»å‹ é‡è½½ ç›¸åŒ å¯æœ‰å¯æ—  ç›¸åŒ ä¸åŒ å¯åŒå¯ä¸åŒ éšè— ä¸åŒ å¯æœ‰å¯æ—  ç›¸åŒ å¯åŒå¯ä¸åŒ å¯åŒå¯ä¸åŒ é‡å†™ ä¸åŒ æœ‰ ç›¸åŒ ç›¸åŒ ç›¸åŒï¼ˆåå˜ï¼‰ åŠ¨æ€ç»‘å®š é¦–å…ˆçŸ¥é“ä»€ä¹ˆæ˜¯é™æ€ä»€ä¹ˆæ˜¯åŠ¨æ€ï¼š\né™æ€ç»‘å®šï¼šç¨‹åºç¼–è¯‘è¿‡ç¨‹ä¸­æŠŠå‡½æ•°è°ƒç”¨ä¸æ‰§è¡Œè°ƒç”¨æ‰€éœ€çš„ä»£ç ç›¸å…³è”ï¼Œè¿™ç§ç»‘å®šå‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œç¨‹åºæœªè¿è¡Œå°±å·²ç¡®å®šï¼Œä¹Ÿç§°ä¸ºå‰æœŸç»‘å®šã€‚ åŠ¨æ€ç»‘å®šï¼šå½“æŸä¸ªè™šå‡½æ•°é€šè¿‡æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨æ—¶ï¼Œç¼–è¯‘å™¨äº§ç”Ÿçš„ä»£ç ç›´åˆ°è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šåˆ°è¯¥è°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„å‡½æ•°ï¼ˆæ ¹æ®è¯¥æŒ‡é’ˆæ‰€ç»‘å®šçš„å¯¹è±¡ï¼‰ï¼Œè¿™ç§å‘ç”Ÿäºè¿è¡ŒæœŸï¼Œç¨‹åºè¿è¡Œæ—¶æ‰ç¡®å®šå“åº”è°ƒç”¨çš„æ–¹æ³•ï¼Œä¹Ÿç§°ä¸ºåæœŸç»‘å®šã€‚ åŠ¨æ€ç»‘å®šåªæœ‰å½“æˆ‘ä»¬é€šè¿‡æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨â€œè™šå‡½æ•°â€æ—¶æ‰ä¼šå‘ç”Ÿï¼Œå¦‚æœé€šè¿‡å¯¹è±¡è¿›è¡Œçš„å‡½æ•°è°ƒç”¨ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šè¯¥è°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„å‡½æ•°äº†ï¼ˆæ¯”å¦‚åŸºå‡½æ•°çš„æŸä¸ªæ–¹æ³•æ‰“å°Aï¼Œç»§æ‰¿åæ”¹å†™æ‰“å°çš„æ˜¯Bï¼ŒåŒæ—¶è¿è¡ŒåŸºç±»å’Œç»§æ‰¿ç±»çš„åŒæ ·æ–¹æ³•ä¼šå‘ç°æ‰“å°å‡ºäº†ABè€Œä¸æ˜¯Bï¼Œè¯´æ˜è¿è¡Œæ—¶æ‰ç»‘å®šã€‚ï¼‰ å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰é‡å†™åŸºç±»çš„è™šå‡½æ•°ï¼Œé‚£ä¹ˆé€šè¿‡åŸºç±»æŒ‡é’ˆæŒ‡å‘äºæ´¾ç”Ÿç±»æ—¶ï¼Œè°ƒç”¨è™šå‡½æ•°è¿˜æ˜¯è°ƒç”¨çš„åŸºç±»çš„è™šå‡½æ•°ï¼ˆå› ä¸ºæ´¾ç”Ÿç±»æ²¡æœ‰é‡å†™ï¼‰ åŠ¨æ€ç»‘å®šä¸â€œæ´¾ç”Ÿç±»å¯¹è±¡è½¬æ¢ä¸ºåŸºç±»å¯¹è±¡â€æ˜¯ç›¸ä¼¼çš„ï¼ŒåŸç†ç›¸åŒ è™šå‡½æ•°ä¸€å®šæ˜¯è¿è¡ŒæœŸæ‰ç»‘å®šä¹ˆï¼Ÿ - çŸ¥ä¹ç”¨æˆ·çš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/491602524/answer/2165605549\nè™šå‡½æ•°ä¸å¤šæ€ åœ¨C++æ³›å‹ç¼–ç¨‹ä¸­å¯ä»¥åŸºäºæ¨¡æ¿templateå’Œé‡è½½overrideä¸¤ç§å½¢å¼æ¥å®ç°é™æ€å¤šæ€ã€‚\nåŠ¨æ€å¤šæ€ä¸»è¦ä¾èµ–äºè™šå‡½æ•°æœºåˆ¶æ¥å®ç°ï¼Œä¸åŒçš„ç¼–è¯‘å™¨å¯¹è™šå‡½æ•°æœºåˆ¶çš„å®ç°ä¹Ÿæœ‰ä¸€äº›å·®å¼‚ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»Linuxç¯å¢ƒä¸‹gcc/g++ç¼–è¯‘å™¨çš„å®ç°æ–¹æ³•ã€‚\nå¤šæ€æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ³›å‹æŠ€æœ¯ï¼Œè¯´ç™½äº†å°±æ˜¯è¯•å›¾ä½¿ç”¨ä¸å˜çš„ä»£ç æ¥å®ç°å¯å˜çš„ç®—æ³•ï¼Œè¦ä¹ˆè¯•å›¾åœ¨ç¼–è¯‘æ—¶å†³å®šï¼Œè¦ä¹ˆè¯•å›¾åœ¨è¿è¡Œæ—¶å†³å®šã€‚ â€”â€”å·¦è€³æœµè€—å­-é™ˆçš“\næˆ‘ä»¬çŸ¥é“C++ä¸‰å¤§ç‰¹å¾ï¼šç»§æ‰¿ã€å¤šæ€ã€å°è£…ã€‚\nè™šå‡½æ•°ä¸ºå¤šæ€æä¾›äº†åŸºç¡€ï¼Œå¹¶ä¸”å€ŸåŠ©äºç»§æ‰¿æ¥å‘æŒ¥å¤šæ€çš„ä¼˜åŠ¿ï¼Œä»è€Œå®Œå–„äº†è¯­è¨€è®¾è®¡çš„å°è£…ã€‚\nä¸‹é¢å°±æ˜¯è¿è¡Œæ—¶å¤šæ€çš„ç®€å•ä¾‹å­ã€‚\n#include\u0026lt;iostream\u0026gt; using namespace std; class Base { public: virtual void show() { cout\u0026lt;\u0026lt;\u0026#34; In Base \\n\u0026#34;; } }; class Derived: public Base { public: void show() { cout\u0026lt;\u0026lt;\u0026#34;In Derived \\n\u0026#34;; } }; int main(void) { Base *bp = new Derived; bp-\u0026gt;show(); // è¿è¡Œæ—¶å¤šæ€ return 0; } è¿è¡Œç»“æœï¼š\nIn Derived\nä¸Šé¢ç¨‹åºä¸­æœ€ä¸»è¦çš„ä¸€ç‚¹æ˜¯ï¼Œä½¿ç”¨äº†ä¸€ä¸ªåŸºç±»æŒ‡é’ˆæ¥è°ƒç”¨å­ç±»çš„æˆå‘˜å‡½æ•°ã€‚è™šå‡½æ•°çš„è°ƒç”¨ä¸ä¾èµ–è°ƒç”¨å®ƒçš„æŒ‡é’ˆæˆ–å¼•ç”¨æœ¬èº«çš„ç±»å‹ï¼Œè€Œå–å†³äºå¼•ç”¨æˆ–æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡ç±»å‹ã€‚\nçº¯è™šå‡½æ•°ï¼ˆæŠ½è±¡ç±»ï¼‰ è™šå‡½æ•°çš„å£°æ˜ä»¥=0ç»“æŸï¼Œä¾¿å¯å°†å®ƒå£°æ˜ä¸ºçº¯è™šå‡½æ•°ï¼ŒåŒ…å«çº¯è™šå‡½æ•°çš„ç±»ä¸å…è®¸å®ä¾‹åŒ–ï¼Œç§°ä¸ºæŠ½è±¡ç±»ï¼Œä½†æ˜¯çº¯è™šå‡½æ•°ä¹Ÿå¯ä»¥æœ‰å‡½æ•°ä½“ï¼Œçº¯è™šå‡½æ•°æä¾›äº†é¢å‘å¯¹è±¡ä¸­æ¥å£çš„åŠŸèƒ½ï¼Œç±»ä¼¼äºJavaä¸­çš„æ¥å£ã€‚\nè¯­æ³•æ ¼å¼ä¸ºï¼švirtual è¿”å›å€¼ç±»å‹ å‡½æ•°å(å‡½æ•°å‚æ•°) = 0;\néœ€è¦æŠ½è±¡ç±»çš„åœºæ™¯ï¼š\nåŠŸèƒ½ä¸åº”ç”±åŸºç±»å»å®Œæˆ æ— æ³•ç¡®è®¤å¦‚ä½•å†™åŸºç±»çš„å‡½æ•° åŸºç±»æœ¬èº«ä¸åº”è¢«å®ä¾‹åŒ– å°±åƒè™½ç„¶æœ‰Animalç±»ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç”Ÿæˆä¸€ä¸ªåŠ¨ç‰©å®ä¾‹ï¼Œå¹¶ä¸”Animalçš„ç±»çš„æˆå‘˜å‡½æ•°æ— æ³•å®šä¹‰ï¼Œéœ€è¦å…¶æ´¾ç”Ÿç±»Tigerç±»ã€Fishç±»æ¥å…·ä½“å®ç°\nè™šç»§æ‰¿ çœ‹è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š\nBå’ŒCä»Aä¸­ç»§æ‰¿ï¼Œè€ŒDå¤šé‡ç»§æ‰¿äºBï¼ŒCã€‚é‚£å°±æ„å‘³ç€Dä¸­ä¼šæœ‰Aä¸­çš„ä¸¤ä¸ªæ‹·è´ã€‚å› ä¸ºæˆå‘˜å‡½æ•°ä¸ä½“ç°åœ¨ç±»çš„å†…å­˜å¤§å°ä¸Šï¼Œæ‰€ä»¥å®é™…ä¸Šå¯ä»¥çœ‹åˆ°çš„æƒ…å†µæ˜¯Dçš„å†…å­˜åˆ†å¸ƒä¸­å«æœ‰2ç»„Açš„æˆå‘˜å˜é‡ã€‚å¦‚ä¸‹ä»£ç ï¼š\nclass A { public: A():a(1){}; void printA(){cout\u0026lt;\u0026lt;a\u0026lt;\u0026lt;endl;} int a; }; class B : public A { }; class C : public A { }; class D: public B , public C { }; int _tmain(int argc, _TCHAR* argv[]) { D d; cout\u0026lt;\u0026lt;sizeof(d); } è¾“å‡ºdçš„å¤§å°ä¸º8ã€‚ä¹Ÿå°±æ˜¯dä¸­æœ‰2ä¸ªaæˆå‘˜å˜é‡ã€‚è¿™æ ·ä¸€æ¥å¦‚æœè¦ä½¿ç”¨aå°±æŠ¥é”™äº†ã€‚è°çŸ¥é“ä½ è¦ç”¨å“ªä¸€ä¸ªï¼ŸåŒæ ·çš„è®¿é—®æˆå‘˜å‡½æ•°ä¹Ÿä¼šå‡ºç°â€œäºŒä¹‰æ€§â€è¿™ä¸ªé—®é¢˜ã€‚\nd.a=10;//error C2385: å¯¹â€œaâ€çš„è®¿é—®ä¸æ˜ç¡® d.printA();//error C2385: å¯¹â€œprintAâ€çš„è®¿é—®ä¸æ˜ç¡® å³ä½¿æˆå‘˜å‡½æ•°æœ‰ä¸åŒçš„å½¢å‚è¡¨ä¹Ÿä¸è¡Œï¼Œå¦‚ä¸‹ã€‚\nclass A { public: A():a(1){}; void printA(){cout\u0026lt;\u0026lt;a\u0026lt;\u0026lt;endl;} int a; }; class B : public A { public: void printB(){cout\u0026lt;\u0026lt;\u0026#34;from B\u0026#34;\u0026lt;\u0026lt;endl;} }; class C : public A { public: void printB(int v){cout\u0026lt;\u0026lt;\u0026#34;from C\u0026#34;\u0026lt;\u0026lt;endl;} }; class D: public B , public C { }; int _tmain(int argc, _TCHAR* argv[]) { D d; cout\u0026lt;\u0026lt;sizeof(d); d.printB(); } å½“ç„¶ä½ å¯ä»¥æ— è€»åœ°ä½¿ç”¨ä½œç”¨åŸŸæ¥è§„é¿è¿™ä¸ªé—®é¢˜ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚\nd.B::a=10; d.C::printB(1); è¿™æ—¶å€™è™šç»§æ‰¿å°±æŒºèº«è€Œå‡ºï¼Œæ‰›ä¸‹æå®šæ­¤é—®é¢˜çš„é‡æ‹…äº†ã€‚è™šç»§æ‰¿æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç±»é€šè¿‡è™šç»§æ‰¿æŒ‡å‡ºå®ƒå¸Œæœ›å…±äº«è™šåŸºç±»çš„çŠ¶æ€ã€‚å¯¹ç»™å®šçš„è™šåŸºç±»ï¼Œæ— è®ºè¯¥ç±»åœ¨æ´¾ç”Ÿå±‚æ¬¡ä¸­ä½œä¸ºè™šåŸºç±»å‡ºç°å¤šå°‘æ¬¡ï¼Œåªç»§æ‰¿ä¸€ä¸ªå…±äº«çš„åŸºç±»å­å¯¹è±¡ï¼Œå…±äº«åŸºç±»å­å¯¹è±¡ç§°ä¸ºè™šåŸºç±»ã€‚è™šåŸºç±»ç”¨virtualå£°æ˜ç»§æ‰¿å…³ç³»å°±è¡Œäº†ã€‚è¿™æ ·ä¸€æ¥ï¼ŒDå°±åªæœ‰Açš„ä¸€ä»½æ‹·è´ã€‚\nclass A { public: A():a(1){}; void printA(){cout\u0026lt;\u0026lt;a\u0026lt;\u0026lt;endl;} int a; }; class B : virtual public A { }; class C : virtual public A { }; class D: public B , public C { }; int _tmain(int argc, _TCHAR* argv[]) { D d; cout\u0026lt;\u0026lt;sizeof(d); d.a=10; d.printA(); } è¾“å‡ºdçš„å¤§å°æ˜¯12ï¼ˆåŒ…å«äº†2ä¸ª4å­—èŠ‚çš„Dç±»è™šåŸºæŒ‡é’ˆå’Œ1ä¸ª4å­—èŠ‚çš„intå‹æ•´æ•°ï¼‰ã€‚è€Œaå’ŒprintA()éƒ½å¯ä»¥æ­£å¸¸è®¿é—®ã€‚æœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯iostreamç»§æ‰¿äºistreamå’Œostreamï¼Œè€Œistreamå’Œostreamè™šç»§æ‰¿äºiosã€‚\nclass istream : virtual public ios{...}; class ostream : virtual public ios{...}; class iostream : public istream, public ostream{...}; æ„é€ å’Œææ„é¡ºåº ä»¥æœ¬å›¾ä¸ºä¾‹\nC() E() A() B() D() F() ~F() ~D() ~B() ~A() ~E() ~C() å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆæŒ‰å£°æ˜é¡ºåºæ£€æŸ¥ç›´æ¥åŸºç±»ï¼ˆåŒ…æ‹¬å…¶å­æ ‘ï¼‰ï¼Œçœ‹æ˜¯å¦æœ‰è™šåŸºç±»ï¼Œå…ˆåˆå§‹åŒ–è™šåŸºç±»ï¼ˆä¾‹ä¸­é¦–å…ˆåˆå§‹åŒ–Cå’ŒEï¼‰ã€‚ä¸€æ—¦è™šåŸºç±»æ„é€ å®Œæ¯•ï¼Œå°±æŒ‰å£°æ˜é¡ºåºè°ƒç”¨éè™šåŸºç±»çš„æ„é€ å‡½æ•°ï¼ˆä¾‹ä¸­ABDFï¼‰ï¼Œææ„çš„è°ƒç”¨æ¬¡åºå’Œæ„é€ è°ƒç”¨æ¬¡åºç›¸åã€‚\nå¸¸è§å…³é”®å­— virtual æ”¾åœ¨å‡½æ•°çš„è¿”å›å€¼å‰é¢ï¼Œç”¨äºè¡¨ç¤ºè¯¥æˆå‘˜å‡½æ•°ä¸ºè™šå‡½æ•° çˆ¶ç±»è™šå‡½æ•°å‰å¿…é¡»å†™ï¼›å­ç±»è™šå‡½æ•°å‰å¯ä»¥çœç•¥ï¼ˆä¸å›°çœä¸çœç•¥ï¼Œè¯¥å‡½æ•°åœ¨å­ç±»ä¸­ä¹Ÿæ˜¯è™šå‡½æ•°ç±»å‹ï¼‰ virtualåªèƒ½å‡ºç°åœ¨ç±»å†…éƒ¨çš„å£°æ˜è¯­å¥ä¹‹å‰è€Œä¸èƒ½ç”¨äºç±»å¤–éƒ¨çš„å‡½æ•°å®šä¹‰ override ä¸€æ—¦ç±»ä¸­çš„æŸä¸ªå‡½æ•°è¢«å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰çš„æ´¾ç”Ÿç±»ä¸­å®ƒéƒ½æ˜¯è™šå‡½æ•°ã€‚ä¸€ä¸ªæ´¾ç”Ÿç±»çš„å‡½æ•°å¦‚æœè¦†ç›–äº†æŸä¸ªç»§æ‰¿è€Œæ¥çš„è™šå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒçš„å½¢å‚ç±»å‹å¿…é¡»ä¸åŸºç±»å‡½æ•°å®Œå…¨ä¸€è‡´ã€‚\næ´¾ç”Ÿç±»ä¸­å¦‚æœå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ä¸åŸºç±»ä¸­è™šå‡½æ•°çš„åå­—ç›¸åŒä½†æ˜¯å½¢å‚åˆ—è¡¨ä¸åŒï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºæ–°å®šä¹‰çš„å‡½æ•°ä¸åŸºç±»ä¸­åŸæœ‰çš„å‡½æ•°æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬æœ¬æ¥å¸Œæœ›æ´¾ç”Ÿç±»å¯ä»¥è¦†ç›–æ‰åŸºç±»ä¸­çš„è™šå‡½æ•°ï¼Œä½†æ˜¯ä¸€ä¸å°å¿ƒæŠŠå½¢å‚åˆ—è¡¨å†™é”™äº†ï¼Œè¿™å¯èƒ½ä¸æˆ‘ä»¬çš„æœ¬æ„ä¸ç¬¦ã€‚\nC++11æ–°æ ‡å‡†æä¾›äº†overrideå…³é”®å­—æ¥æ˜¾å¼åœ°å‘ŠçŸ¥è™šæ‹Ÿå™¨è¿›è¡Œé‡è½½ï¼Œç¼–è¯‘å™¨å°†æ£€æŸ¥åŸºç±»æ˜¯å¦å­˜åœ¨è¿™æ ·çš„è™šå‡½æ•°ï¼Œå¦åˆ™å°†æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ è¿™æ ·çš„å¥½å¤„æ˜¯ä½¿å¾—ç¨‹åºå‘˜çš„æ„å›¾æ›´åŠ æ¸…æ™°ï¼ˆè¦†ç›–åŸºç±»ä¸­çš„è™šå‡½æ•°ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨overrideå…³é”®å­—æ ‡è®°äº†æŸä¸ªå‡½æ•°ä½†æ˜¯è¯¥å‡½æ•°æ²¡æœ‰è¦†ç›–å·²æœ‰çš„è™šå‡½æ•°ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚\nä»–å¯ä»¥æ‹¦æˆªä»¥ä¸‹é”™è¯¯ï¼š\nclass A{ virtual void f1(int) const; virtual void f2(); void f3(); }; calss B:public A{ void f1(int)const override; //æ­£ç¡® void f2(int)override; //é”™è¯¯ï¼Œå‚æ•°ä¸ä¸€è‡´ void f3()override; //é”™è¯¯ï¼Œf3ä¸æ˜¯è™šå‡½æ•° void f4()override; //é”™è¯¯ï¼ŒBæ²¡æœ‰åä¸ºf4çš„å‡½æ•° }; final å¦‚æœæˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªè™šå‡½æ•°ä¸æƒ³è¢«æ´¾ç”Ÿç±»è¦†ç›–ï¼ˆé‡å†™ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è™šå‡½æ•°ä¹‹åæ·»åŠ ä¸€ä¸ªfinalå…³é”®å­—ï¼Œå£°æ˜è¿™ä¸ªè™šå‡½æ•°ä¸å¯ä»¥è¢«æ´¾ç”Ÿç±»æ‰€è¦†ç›–ï¼ˆé‡å†™ï¼‰ å¦‚æœå‡½æ•°æœ‰å°¾æŒ‡è¿”å›ç±»å‹ï¼Œé‚£ä¹ˆè¦æ”¾åœ¨å°¾æŒ‡è¿”å›ç±»å‹å (since C++11) final å¯¹è™šå‡½æ•°çš„å¤šæ€æ€§å…·æœ‰å‘ä¸‹é˜»æ–­ä½œç”¨ã€‚ç» final ä¿®é¥°çš„è™šå‡½æ•°æˆ–ç» final ä¿®é¥°çš„ç±»çš„æ‰€æœ‰è™šå‡½æ•°ï¼Œè‡ªè¯¥çº§èµ·ï¼Œä¸å†å…·æœ‰å¤šæ€æ€§ã€‚ å› æ­¤ï¼Œæ­¤å¤„ä¸€å®šæ˜¯ç¼–è¯‘æ—¶ç»‘å®šï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶ç»‘å®šã€‚\nä¸šåŠ¡ä»£ç ä¸­ï¼Œå¯¹äºå¤šæ€ç±»ï¼Œå¦‚æœç¡®å®šä¸€ä¸ªè™šå‡½æ•°ä¸ä¼šå†è¢«è¦†ç›–ï¼Œæˆ–è€…è¯¥ç±»ä¸ä¼šå†è¢«ç»§æ‰¿ï¼Œåˆ™æ¨èæ ‡ä¸Š finalã€‚è¿™å¯ä»¥ä¸ºç¼–è¯‘å™¨æä¾›éå¸¸æœ‰ä»·å€¼çš„ç¼–è¯‘ä¼˜åŒ–ä¿¡æ¯ï¼Œæ€»è€Œå°†åŸæœ¬éœ€è¦æ¨è¿Ÿåˆ°è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šçš„è™šå‡½æ•°è°ƒç”¨æå‰åœ¨ç¼–è¯‘æœŸå°±å·²ç¡®å®šã€‚ å¦‚è¢«è°ƒç”¨çš„å‡½æ•°èƒ½ä¸ä¸Šå±‚è°ƒç”¨æ–¹ä¸€èµ·è¿›ä¸€æ­¥åœ°åšå‡½æ•°å†…è”ã€å¸¸é‡æŠ˜å ã€æ— ç”¨ä»£ç æ¶ˆé™¤ç­‰ä¼˜åŒ–ï¼Œåˆ™å¯ä»¥å‹æ¦¨å‡ºéå¸¸å¯è§‚çš„æ€§èƒ½æå‡ã€‚\nå…¶ä»– C++20é‡Œé¢è§£é™¤äº†è™šå‡½æ•°ä¸èƒ½æ˜¯ constexprçš„é™åˆ¶ï¼Œè™šå‡½æ•°å®Œå…¨å¯ä»¥åœ¨ç¼–è¯‘æœŸç»‘å®šï¼Œ\nè™šå‡½æ•°çš„è¯ï¼Œä¸æ˜¯â€œåªèƒ½â€åœ¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šï¼Œä¹Ÿå­˜åœ¨å¯ä»¥é™æ€ç»‘å®šçš„æƒ…å†µã€‚ä½ èƒ½çœ‹å‡ºæ¥å®é™…è°ƒç”¨å‡½æ•°çš„åœºåˆï¼Œç¼–è¯‘å™¨ä¹Ÿæœ‰ä¸€å®šå¯èƒ½çœ‹å‡ºæ¥ã€‚è¿™æ—¶å‡½æ•°å»è™šåŒ–ä½œä¸ºä¸€ç§ä¼˜åŒ–å­˜åœ¨ã€‚\næ¨¡æ‹Ÿè™šå‡½æ•°è¡¨æŠ€æœ¯å¯å‚è€ƒï¼š\nè™šå‡½æ•°æŠ€æœ¯ï¼šå¤šæ€çš„ä¸Šä¸‹æ–‡+è¿è¡Œæ—¶åŠ¨æ€ç±»å‹è¯†åˆ«+è™šå‡½æ•°è¡¨åŠæŒ‡é’ˆ https://www.toutiao.com/article/7006183609581257228/?wid=1671356502138\nC++ä¸­è™šå‡½æ•°ã€è™šç»§æ‰¿å†…å­˜æ¨¡å‹\nhttps://zhuanlan.zhihu.com/p/41309205\nC++ç±»çš„3ç§ç»§æ‰¿æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯publicç»§æ‰¿ï¼Œprotectedç»§æ‰¿ï¼Œprivateç»§æ‰¿:\nhttps://www.wuyuze.vip/2019/09/06/C-ç»§æ‰¿å…³ç³»/\nreference c++è™šå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\nhttps://www.zhihu.com/question/23971699\nC++:44\u0026mdash;å…³é”®å­—virtualã€overrideã€final\nhttps://cloud.tencent.com/developer/article/1784495\nè™šå‡½æ•°ä¸€å®šæ˜¯è¿è¡ŒæœŸæ‰ç»‘å®šä¹ˆï¼Ÿ\nhttps://www.zhihu.com/question/491602524\nC++ç»§æ‰¿(2) - è™šå‡½æ•°ä¸è¿è¡Œæ—¶å¤šæ€\nhttps://blog.csdn.net/shltsh/article/details/45960377\nè™šå‡½æ•°æŠ€æœ¯ï¼šå¤šæ€çš„ä¸Šä¸‹æ–‡+è¿è¡Œæ—¶åŠ¨æ€ç±»å‹è¯†åˆ«+è™šå‡½æ•°è¡¨åŠæŒ‡é’ˆ\nhttps://www.toutiao.com/article/7006183609581257228/?wid=1671356502138\né¢è¯•å¿…çŸ¥å¿…ä¼šï¼šç†è§£ C++ è™šå‡½æ•°\nhttps://toutiao.io/posts/zaxcvwp/preview\nC++ä¸­å‡½æ•°é‡è½½ã€éšè—ã€è¦†ç›–å’Œé‡å†™çš„åŒºåˆ«\nhttps://cloud.tencent.com/developer/article/1177174\nC++ æ„é€ å‡½æ•°å’Œææ„å‡½æ•°å¯ä»¥æ˜¯è™šå‡½æ•°å˜›ï¼Ÿ\nhttps://blog.csdn.net/qq_28584889/article/details/88749862\nè±å½¢ç»§æ‰¿å’Œè™šç»§æ‰¿\nhttps://blog.csdn.net/jackystudio/article/details/17877219\n","date":"2022-12-24T17:14:16+08:00","permalink":"https://sanbuphy.github.io/p/%E8%99%9A%E5%87%BD%E6%95%B0%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%85%B3%E9%94%AE%E5%AD%97virtualoverridefinal/","title":"è™šå‡½æ•°åŸºç¡€ä¸å…³é”®å­—virtualã€overrideã€final"},{"content":"é¦–å…ˆå»ºè®®ä½ äº†è§£ä¸‹äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼š\nhttps://www.cnblogs.com/wdliu/p/6890930.html\nPythonçº¿ç¨‹ã€åç¨‹æ¢ç©¶ï¼ˆ3ï¼‰â€”â€”åç¨‹çš„è°ƒåº¦å®ç°å¤§é¾™\nhttps://zhuanlan.zhihu.com/p/96969508\npython cookbook 11.12 ç†è§£äº‹ä»¶é©±åŠ¨çš„IO\nhttps://python3-cookbook.readthedocs.io/zh_CN/latest/c11/p12_understanding_event_driven_io.html\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåç¨‹å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œç”±äºç³»ç»Ÿäº‹ä»¶å¾ªç¯çš„é™åˆ¶ï¼Œæ‰€ä»¥æ–‡ä»¶IOä¸€èˆ¬è¿˜æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹æ¥æ‰§è¡Œï¼Œå…·ä½“è§ï¼šgithub.com/python/asynâ€¦\nåç¨‹çš„å…³é”®åœ¨äºfutureã€taskã€‚\nä¸Coroutineåªæœ‰è®©æ­¥å’Œæ¥æ”¶ç»“æœä¸åŒçš„æ˜¯Futureé™¤äº†è®©æ­¥å’Œæ¥æ”¶ç»“æœåŠŸèƒ½å¤–ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªåªä¼šè¢«åŠ¨è¿›è¡Œäº‹ä»¶è°ƒç”¨ä¸”å¸¦æœ‰çŠ¶æ€çš„å®¹å™¨ï¼Œå®ƒåœ¨åˆå§‹åŒ–æ—¶å°±æ˜¯PendingçŠ¶æ€ï¼Œè¿™æ—¶å¯ä»¥è¢«å–æ¶ˆï¼Œè¢«è®¾ç½®ç»“æœå’Œè®¾ç½®å¼‚å¸¸ã€‚è€Œåœ¨è¢«è®¾å®šå¯¹åº”çš„æ“ä½œåï¼ŒFutureä¼šè¢«è½¬åŒ–åˆ°ä¸€ä¸ªä¸å¯é€†çš„å¯¹åº”çŠ¶æ€ï¼Œå¹¶é€šè¿‡loop.call_sonnæ¥è°ƒç”¨æ‰€æœ‰æ³¨å†Œåˆ°æœ¬èº«ä¸Šçš„å›è°ƒå‡½æ•°ï¼ŒåŒæ—¶å®ƒå¸¦æœ‰__iter__å’Œ__await__æ–¹æ³•ä½¿å…¶å¯ä»¥è¢«awaitå’Œyield fromè°ƒç”¨ã€‚\nTaskæ˜¯Futureçš„å­ç±»ï¼Œé™¤äº†ç»§æ‰¿äº†Futureçš„æ‰€æœ‰æ–¹æ³•ï¼Œå®ƒè¿˜å¤šäº†ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•__stepå’Œ__wakeupï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•èµ‹äºˆäº†Taskè°ƒåº¦èƒ½åŠ›ï¼Œè¿™æ˜¯Coroutineå’ŒFutureæ²¡æœ‰çš„ã€‚\næœ¬æ¬¡è°ƒè¯•çš„é—®é¢˜åœ¨äºï¼šâ€œä¸ºä»€ä¹ˆå½“ä¸‹é¢çš„æ¥å—ä»£ç ç»“æŸ(break)åï¼Œå‘é€ä»£ç ä»ç„¶ä¼šé™·å…¥é˜»å¡ï¼Ÿåˆæ˜¯ä¸ºä»€ä¹ˆå¯ä»¥å°†ä»–é‡æ–°å”¤é†’ï¼Ÿâ€\n# socket_start.py import asyncio import websockets import json from loguru import logger async def sen_data(websocket, path): logger.error(\u0026#34;åˆå§‹åŒ–å®Œæˆ\u0026#34;) while 1: data1 = {\u0026#34;value\u0026#34;:1} data1 = json.dumps(data1).encode(\u0026#39;utf-8\u0026#39;) try: await websocket.send(data1) except Exception: logger.debug(\u0026#34;é‡æ–°å¯åŠ¨\u0026#34;) break logger.debug(\u0026#34;ç»“æŸäº†ï¼\u0026#34;) start_serve1 = websockets.serve(sen_data, \u0026#34;127.0.0.1\u0026#34;, 1122, ping_interval=None) asyncio.get_event_loop().run_until_complete(start_serve1) asyncio.get_event_loop().run_forever() # socket_get.py import json import asyncio import websockets import time from loguru import logger async def hello(uri): async with websockets.connect(uri, ping_interval=None) as websocket: while True: recv_text = await websocket.recv() print(\u0026#34;\u0026gt; {}\u0026#34;.format(recv_text)) print(time.time()) time.sleep(1) asyncio.get_event_loop().run_until_complete( hello(\u0026#39;ws://127.0.0.1:1122\u0026#39;)) # åœ°å€æ”¹ä¸ºè‡ªå·±çš„åœ°å€ ä¸ºäº†ææ¸…æ¥šï¼Œéœ€è¦ç”»ä¸€ä¸ªæ—¶åºçŠ¶æ€æœºï¼š æ—¶åºçŠ¶æ€æœºç»˜åˆ¶åœ°å€ï¼š\nhttps://tooltt.com/sequence/\næ—¶åºç»˜åˆ¶ä»£ç ï¼š\nNote right of socket\\_start: -\u0026gt; å¼€å§‹æ‰§è¡Œç¨‹åº Note right of socket\\_start: self.\\_run\\_once() Note right of socket\\_start: ï¼ˆbase\\_events.pyï¼‰self.\\_selector.select(timeout) Note right of socket\\_start: ï¼ˆ[selectors.py](http://selectors.py \u0026#34;selectors.py\u0026#34;)ï¼‰self.*selector.poll(timeout, max\\_ev) Note right of socket\\_start: é™·å…¥é˜»å¡ Note left of socket\\_get: å¼€å§‹æ‰§è¡Œç¨‹åº \u0026lt;- Note left of socket\\_get: aenter Note left of socket\\_get: await Note left of socket\\_get: await\\_impl\\_timeout Note left of socket\\_get: await\\_impl Note left of socket\\_get: protocol handshake start Note left of socket\\_get: write\\_http\\_request Note left of socket\\_get: self.transport.write(request.encode()) socket\\_get-\u0026gt;socket\\_start: self.transport.write(request.encode()) socket\\_get-\u0026gt;socket\\_start: asyncio/selector\\_events.py socket\\_get-\u0026gt;socket\\_start: self.* sock.send(data) Note right of socket\\_start: è·³å‡ºé˜»å¡ Note right of socket\\_start: ï¼ˆ[selectors.py](http://selectors.py \u0026#34;selectors.py\u0026#34;)ï¼‰for fd, event in fd\\_event\\_list: Note right of socket\\_start: ä¹‹ååå¤è¿è¡Œself.\\_ context.run(self.\\_callback, \\*self.\\_args) å¦å¤–çš„ä¸€äº›ç»†èŠ‚ï¼š\nå¯åŠ¨sen_dataå‡½æ•°ç›¸å…³çš„åç¨‹ï¼š ï¼ˆã€socket_startæ–‡ä»¶ã€‘æ­¤æ—¶åº”å½“åœ¨asyncio.get_event_loop().run_forever()ï¼‰\nã€socket_startæ–‡ä»¶ã€‘æ¥æ”¶åˆ°ã€socket_getæ–‡ä»¶çš„connectåæ‰§è¡Œå¦‚ä¸‹ç‰‡æ®µã€‘\nconnection_made await self.handshake start hand shake !!!!!! read_http_request process_request process_origin process_extensions process_subprotocol write_http_response handshake\næ­¤æ—¶å¼€å§‹æ‰§è¡Œåç¨‹ç›¸å…³é¡¹\nreference Pythonçš„å¯ç­‰å¾…å¯¹è±¡åœ¨Asyncioçš„ä½œç”¨\nhttps://so1n.me/2022/04/11/python\u0026rsquo;s_waitable_objects_in_asyncio/index.html\nPython Asyncioè°ƒåº¦åŸç†ï¼ˆï¼‰\nhttps://juejin.cn/post/7108367062463938597\nå¦‚ä½•ç»™æ‰€æœ‰çš„asyncå‡½æ•°æ·»åŠ try/catchï¼Ÿï¼ˆè¯­æ³•åˆ†æè¯æ³•åˆ†æï¼‰\nhttps://juejin.cn/post/7155434131831128094\näº‹ä»¶å¾ªç¯å’Œåç¨‹ï¼šä»ç”Ÿæˆå™¨åˆ°åç¨‹ï¼ˆæ‰‹å†™ç®€å•çš„åç¨‹å®ç°ï¼‰\nhttps://zhuanlan.zhihu.com/p/31634491\nHTTPã€TCPä¸UDPã€Socketä¸Websocketä¹‹é—´çš„è”ç³»ä¸åŒºåˆ«\nhttps://segmentfault.com/a/1190000037620675\n","date":"2022-12-04T11:23:03+08:00","permalink":"https://sanbuphy.github.io/p/websocket%E4%B8%8E%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%E5%88%9D%E6%AD%A5/","title":"websocketä¸åç¨‹çš„å‰ä¸–ä»Šç”Ÿï¼ˆåˆæ­¥ï¼‰"},{"content":"referenceï¼šhttps://www.bilibili.com/video/BV1oR4y1X7xZ/\nè¦æ³¨æ„FLOPSsçš„åŒºåˆ« å¤§Sï¼ˆfloating-point operations per secondï¼‰ å°sç®—æ³•å¤æ‚åº¦æ˜¯å¤æ•°ã€‚\nFLOPsçš„å•ä½Bçš„æ„æ€å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯GFLOPs\nNMSåº”è¯¥è¿˜æ˜¯è¦ç®—çš„ï¼Œè™½ç„¶ä¼šé™ä½FPSï¼Œä½†ä¸ç»è¿‡nmsç»“æœæ ¹æœ¬ä¸èƒ½ç”¨ã€‚\næœ€ç»ˆç»“è®ºï¼š(å¦‚æœæ„Ÿå…´è¶£å¯ä»¥å»çœ‹ä¸‹ShuffleNet V2çš„è®ºæ–‡ï¼‰ 1. Parametersä½çº¦ç­‰äºFLOPsä½ã€‚ï¼ˆFLOPså’Œè¾“å…¥è¿›æ¥çš„å›¾ç‰‡å¤§å°æœ‰å…³ï¼Œç­‰åŒå›¾ç‰‡å¤§å°ä¸‹ä¸€èˆ¬å¯è¿™ä¹ˆè®¤ä¸ºï¼Œå› ä¸ºFLOPsè¿ç®—ä¸€èˆ¬å’Œå·ç§¯ç›¸å…³ã€‚ï¼‰\n2.GFLOPsä½ ä¸ç­‰äºLatencyä½ï¼ˆGFLOPsä½ä¸ç­‰äºFPSé«˜ï¼Œæœ‰å¯èƒ½ç½‘ç»œå±‚å¤šï¼Œç½‘ç»œè®¾è®¡ä¸å¥½ )\n3.Parametersä½ ä¸ç­‰äºLatencyä½ï¼ˆ Parametersä½ ä¸ç­‰äºFPSé«˜)\nç½‘ç»œçš„è¿ç®—é€Ÿåº¦ï¼ˆçº¯ç½‘ç»œï¼Œä¸åŒ…å«å‰å¤„ç†åå¤„ç†ï¼‰å’Œå¾ˆå¤šä¸œè¥¿æœ‰å…³ 1ã€æ˜¾å¡ï¼šå¤§å¤šæ•°SOTAç®—æ³•ç”¨çš„éƒ½æ˜¯V100æˆ–è€…A100ï¼Œ\n2ã€ç½‘ç»œç»“æ„ï¼šä¸æ˜¯å‚æ•°é‡è¶Šä½é€Ÿåº¦è¶Šå¿«ï¼Œä¸æ˜¯åŠ ä¸¤ä¸ªæ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼Œç½‘ç»œçš„é€Ÿåº¦å°±è¶Šå¿«\næœ‰ä¸€ä¸ªMACçš„æ¦‚å¿µï¼ˆMemory Access Costï¼‰ï¼Œåœ¨ShuffleNet V2çš„è®ºæ–‡é‡Œæåˆ°äº†ã€‚æ·±åº¦å¯åˆ†ç¦»å·ç§¯ä¾¿æ˜¯ä¸€ä¸ªé«˜MACï¼Œä½å‚æ•°é‡çš„æ“ä½œã€‚æ·±åº¦å¯åˆ†ç¦»å·ç§¯åœ¨CPUä¸­è¡¨ç°æ›´å¥½ã€‚\n3ã€ç½‘ç»œçš„å¹¶è¡Œåº¦ï¼šlnceptionæ˜¯ä¸€ä¸ªä¸æ–­å¢åŠ ç½‘ç»œå®½åº¦çš„æ¨¡å‹ï¼Œå®ƒä½¿ç”¨ä¸åŒå·ç§¯æ ¸å¤§å°çš„å·ç§¯è¿›è¡Œç‰¹å¾æå–ã€‚ä½†å®ƒçš„å·¥ä½œé€Ÿåº¦ä¸æ˜¯ç‰¹åˆ«å¿«ã€‚åˆ†æ”¯åˆ†å¤šæ¬¡å°±è¦ç®—å¤šæ¬¡\n4ã€ç½‘ç»œçš„å±‚æ•°ï¼šé¢å¤–çš„æ“ä½œå¦‚Reluï¼ŒADDï¼Œéƒ½æ˜¯æ²¡æœ‰å‚æ•°é‡ï¼Œä½†éœ€è¦è¿ç®—æ—¶é—´çš„æ“ä½œã€‚\n5ã€CUDAã€cudnnã€æ·±åº¦å­¦ä¹ ç®—æ³•æ¡†æ¶ç‰ˆæœ¬å½±å“ã€‚1660Tiçš„æœºå­ä¸Šï¼ŒYOLOX-Sçš„FPSåœ¨torch1.7é‡Œä¸º50å¤šï¼Œtorch1.2é‡Œé¢ä¸º20å¤šã€‚\nShuffleNet: An Extremely Efficient Convolutional Neural Network for Mobile Devices reference: https://www.jianshu.com/p/a54cf8147cfc?utm_campaign=maleskine\u0026utm_content=note\u0026utm_medium=seo_notes\u0026utm_source=recommendation\nè®ºæ–‡é‡ç‚¹æ‘˜è¦\nModel Accelerationï¼ˆæ¨¡å‹åŠ é€Ÿï¼‰ è¿™ä¸ªæ–¹å‘æ—¨åœ¨ä¿ç•™é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹ç²¾ç¡®åº¦çš„æƒ…å†µä¸‹åŠ å¿«é€Ÿç‡ã€‚åœ¨ä¹‹å‰è®­ç»ƒå¥½çš„æ¨¡å‹ä¸­é€šè¿‡ä¿®å‰ªç½‘ç»œè¿æ¥ä»¥åŠå‡å°‘é€šé“å†—ä½™è¿æ¥ä»è€Œæå‡æ€§èƒ½ã€‚åœ¨ä¸æ”¹å˜å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæœ€ä¼˜åŒ–å·ç§¯ç®—æ³•è¢«åº”ç”¨åœ¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ä»¥åŠå‡å°‘å®è·µç”Ÿæ´»ä¸­æ—¶é—´æ¶ˆè€—çš„ç†è®ºã€‚æå–å¤§æ¨¡å‹ä¸­çš„ç†è®ºï¼Œæœ‰åˆ©äºæ›´åŠ ç®€å•çš„è®­ç»ƒå°çš„æ¨¡å‹ã€‚\næ¨¡å‹åŠ é€Ÿçš„æ–¹æ³•æœ‰ï¼šï¼ˆå…¶å®éƒ½æ˜¯å¸¸è¯†ï¼‰\n1ï¼‰Â ä¿®å‰ªç½‘ç»œï¼Œå‡å°‘åˆ†æ”¯ï¼ˆpruningnetwork connectionsï¼‰ã€‚\n2ï¼‰Â å¯¹äºä¸€ä¸ªè®­ç»ƒå¥½çš„ç½‘ç»œï¼ˆpre-trainedmodelï¼‰ï¼Œåœ¨æ€§èƒ½ä¸ä¸‹é™çš„æƒ…å†µä¸‹å‡å°‘å†—ä½™çš„åˆ†æ”¯ã€‚\n3ï¼‰Â é‡åŒ–ï¼ˆquantizationï¼‰å’Œå› å¼åˆ†è§£(factorization)åŠ é€Ÿã€‚\n4ï¼‰Â åœ¨ä¸æ”¹å˜å‚æ•°çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨FFTç®—æ³•å¯¹å·ç§¯è¿›è¡ŒåŠ é€Ÿã€‚\n5ï¼‰Â æå–ç½‘ç»œçš„ç²¾åéƒ¨åˆ†ï¼Œå‡å°ç½‘ç»œæ¨¡å‹ã€‚\nå…·ä½“å®ç°: ShuffleNetV2ï¼šè½»é‡çº§CNNç½‘ç»œä¸­çš„æ¡‚å† \n","date":"2022-11-25T15:07:48+08:00","permalink":"https://sanbuphy.github.io/p/%E5%A6%82%E4%BD%95%E8%A1%A1%E9%87%8F%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E7%9A%84%E8%AE%A1%E7%AE%97%E9%87%8F%E5%8F%8A%E7%BD%91%E7%BB%9C%E5%8A%A0%E9%80%9F%E7%A9%BA%E9%97%B4%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"å¦‚ä½•è¡¡é‡æ·±åº¦å­¦ä¹ ç®—æ³•çš„è®¡ç®—é‡åŠç½‘ç»œåŠ é€Ÿç©ºé—´ï¼ˆå­¦ä¹ ç¬”è®°ï¼‰"},{"content":"å»ºè®®ä½¿ç”¨é»˜è®¤å®‰è£…cudaï¼ˆåŒ…æ‹¬é©±åŠ¨ï¼‰ä»¥åŠffmpegçš„é»˜è®¤å®‰è£…åœ°å€ä»¥å…å‡ºç°å„ç§å¥‡æ€ªé—®é¢˜ã€‚\ncmake .. -D CMAKE_BUILD_TYPE=RELEASE \\ -D CMAKE_INSTALL_PREFIX=/usr/local \\ -D ENABLE_PRECOMPILED_HEADERS=OFF \\ -D INSTALL_C_EXAMPLES=OFF \\ -D INSTALL_PYTHON_EXAMPLES=OFF \\ -D BUILD_opencv_python2=OFF \\ -D BUILD_opencv_python3=ON \\ -D PYTHON_DEFAULT_EXECUTABLE=$(python3 -c \u0026#34;import sys; print(sys.executable)\u0026#34;) \\ -D PYTHON3_EXECUTABLE=$(python3 -c \u0026#34;import sys; print(sys.executable)\u0026#34;) \\ -D PYTHON3_NUMPY_INCLUDE_DIRS=$(python3 -c \u0026#34;import numpy; print (numpy.get_include())\u0026#34;) \\ -D PYTHON3_PACKAGES_PATH=$(python3 -c \u0026#34;from distutils.sysconfig import get_python_lib; print(get_python_lib())\u0026#34;) \\ -D WITH_TBB=ON \\ -D BUILD_TBB=ON \\ -D ENABLE_FAST_MATH=1 \\ -D CUDA_FAST_MATH=1 \\ -D WITH_CUBLAS=1 \\ -D WITH_V4L=ON \\ -D WITH_LIBV4L=ON \\ -D WITH_CUDA=ON \\ -D WITH_CUDNN=ON \\ -D WITH_GTK_2_X=ON \\ -D WITH_NVCUVID=ON \\ -D WITH_FFMPEG=ON \\ -D CUDA_ARCH_BIN= 8.6 \\ #æ ¹æ®è‡ªå·±çš„æ˜¾å¡æŸ¥æ‰¾CUDA_ARCH_BINè¡¨ -D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib/modules . ç‚¹äº®ffmpeg ffmepgæœ‰å¯èƒ½æ‰¾ä¸åˆ°ï¼Œéœ€è¦æŒ‰ç…§æ­£è§„æ“ä½œä¸€éffmpegã€‚ï¼ˆè®°å¾—whereis ffmpeg åˆ é™¤ç›¸å…³å†…å®¹ï¼‰\nç‚¹äº®nvcuvidç›¸å…³ï¼ˆåœ¨cudaé‚£ä¸€è¡Œï¼‰ åœ¨å®˜ç½‘ç”³è¯·ä¸‹è½½å¥½äº†sdkåè¿è¡Œï¼š\nsudo cp Interface/* /usr/include sudo cp Lib/linux/stubs/x86_64/* /usr/lib åˆ é™¤buildå†…å†…å®¹é‡æ–°cmakeå³å¯å¾—åˆ°ç»“æœ\nå¦‚æœè¿™ä¹ˆå°è¯•åä½ è¿˜æ˜¯ä¸èƒ½æ‰¾åˆ°ï¼Œä½ éœ€è¦æŠŠincludeå’Œlibçš„åœ°å€æ¢æˆcudaçš„ï¼Œå¦‚/usr/local/cuda-11.5/lib64/ ä»¥åŠ /usr/local/cuda-11.5/include ç„¶åå†ä¾æ¬¡cpï¼Œï¼ˆæˆ‘æ€€ç–‘æ˜¯å› ä¸ºcmakeæœç´¢è·¯å¾„å’Œæ ¡éªŒé€»è¾‘æ˜¯ç›´æ¥åˆ©ç”¨cudaï¼‰ï¼Œè¿™æ¬¡ä½ åº”è¯¥å¯ä»¥çœ‹è§ä»–äº†ï¼\næ³¨ï¼šå¦‚æœä½ æƒ³è¦å¸è½½opencv åœ¨åŸæ¥çš„buildæ–‡ä»¶ä¸­ä½¿ç”¨ sudo make uninstallå³å¯ï¼\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·å®‰è£…åè£…äº†ä¸€ä¸ªpythonç‰ˆæœ¬çš„tk2ã€‚0ä»€ä¹ˆçš„ï¼ˆimshowæŠ¥é”™çš„è¦æ±‚ï¼‰åæ— æ³•å†æ¬¡createReaderã€‚ã€‚ã€‚ä¹Ÿè®¸ä¸èƒ½ç›´æ¥æŠŠsdkçš„æ‹¿è¿‡å»?æˆ‘ä»¬å¯ä»¥çœ‹çœ‹é©±åŠ¨å®‰è£…çš„soç„¶åæ‹¿åˆ°å¯¹åº”cudaçš„åŒºåŸŸæˆ–è€…å¹²è„†é‡è£…ä¸€æ¬¡é©±åŠ¨ã€‚ã€‚ã€‚ã€‚ä¹Ÿè®¸è¿™æ˜¯æ›´å¥½çš„æ–¹æ³•ã€‚\nè·‘samplesæµ‹è¯• å¯¹äºcppçš„æµ‹è¯•ï¼Œå‚è€ƒä¸‹æ–‡\nhttps://zhuanlan.zhihu.com/p/357290528\nå¯¹äºgpué‡Œé¢çš„æµ‹è¯•ï¼Œä½ éœ€è¦æ–°å»ºä¸€ä¸ªbuildï¼Œç„¶åæ‹–è¿›ä½ æƒ³è¦ç¼–è¯‘çš„æ–‡ä»¶ï¼Œä½¿ç”¨\ncmake_minimum_required(VERSION 3.0.2) SET(CMAKE_BUILD_TYPE \u0026#34;Debug\u0026#34;) include_directories(include) find_package( OpenCV REQUIRED ) include_directories( ${OpenCV_INCLUDE_DIRS} ) add_executable( test opencv_test.cpp ) target_link_libraries( test ${OpenCV_LIBS} ) å…¶ä¸­æ³¨æ„add_executable( test opencv_test.cpp )éœ€è¦ä¿®æ”¹ä¸ºæ‹–è¿›æ¥çš„æ–‡ä»¶ã€‚ç›´æ¥cmake . å³å¯å¾—åˆ°ç»“æœã€‚\nReference æ¨èé˜…è¯»æ•™ç¨‹ï¼š\nhttps://blog.csdn.net/jiexijihe945/article/details/125084488\nè‹±æ–‡æ•™ç¨‹ï¼ˆå†…éƒ¨æœ‰CUDA_ARCH_BINè¡¨ï¼‰\nhttps://www.nanguoyu.com/opencv4-5-1-gpu\nç¼–è¯‘é€‰é¡¹ä¸­ffmpegè·¯å¾„ä¿®æ”¹\nhttps://blog.csdn.net/woainannanta/article/details/78260419\nopencvè¯»å–rtspç½‘ç»œæµé—®é¢˜ä¸ä¼˜åŒ–æ–¹æ¡ˆ\nhttps://blog.csdn.net/submarineas/article/details/110083906\nVPFï¼šPythonä¸­çš„ç¡¬ä»¶åŠ é€Ÿè§†é¢‘å¤„ç†æ¡†æ¶\nhttps://blog.csdn.net/submarineas/article/details/111877262\nVPFä½¿ç”¨èŒƒä¾‹\nhttps://blog.csdn.net/kkae8643150/article/details/123307662\nè¶…çº§å¤§å…¨ å®ç°åŸºäºOpencvçš„GPUè§†é¢‘ç¼–è§£ç \nhttps://note.youdao.com/ynoteshare/index.html?id=700052b0a49301059a34f20a00a830ca\u0026amp;type=note\u0026amp;_time=1638503513531\n","date":"2022-11-13T17:45:11+08:00","permalink":"https://sanbuphy.github.io/p/opencv%E6%8B%93%E5%B1%95%E5%8C%85%E7%BC%96%E8%AF%91/","title":"opencvæ‹“å±•åŒ…ç¼–è¯‘"},{"content":"æ‹‰æµæ¨æµåŸºç¡€çŸ¥è¯† ç›´æ’­-æ‹‰æµå’Œæ¨æµæ¦‚è¿°\nhttps://www.jianshu.com/p/b520c2a9b795\nå¸¸è§é—®é¢˜ error while decoding MB 0 14, bytestream 104435 ç›¸å…³é—®é¢˜åŸå› \nhttps://blog.csdn.net/puffdoudou/article/details/109779624\nopencvè¯»å–ç½‘ç»œæ‘„åƒå¤´çš„rtspæµæ—¶å‘ç”Ÿæ–­æµç°è±¡\nhttps://blog.csdn.net/qq_33764934/article/details/103482121\nä½¿ç”¨ffmpegGPUç›¸å…³æ‹“å±•åŠ é€Ÿç¼–ç è§£ç  ä¸€äº›ä¾èµ–å¯é€‰æ‹©å®‰è£…ï¼šï¼ˆæœ€å¥½ç”¨ç³»ç»Ÿé»˜è®¤é•œåƒæºï¼Œå¦åˆ™å®¹æ˜“è¢«åµŒå¥—ä¾èµ–é—®é¢˜ç”µè„‘GGï¼‰\nsudo apt-get install autoconf automake build-essential libass-dev libfreetype6-dev libtheora-dev libtool libvorbis-dev pkg-config texinfo zlib1g-dev unzip cmake yasm libx264-dev libmp3lame-dev libopus-dev libsdl1.2-dev libva-dev libvdpau-dev libxcb1-dev libxcb-shm0-dev libxcb-xfixes0-dev libfaac* libopenjpeg * libv4l-dev libvpx-dev libssl-dev\nå‚è€ƒç”¨å®˜æ–¹æ‰‹å†Œï¼š\nUsing_FFmpeg_with_NVIDIA_GPU_Hardware_Acceleration.pdf\nhttps://docs.nvidia.com/video-technologies/video-codec-sdk/pdf/Using_FFmpeg_with_NVIDIA_GPU_Hardware_Acceleration.pdf\næŒ‰ç…§åˆ†æ”¯é€‰æ‹©å¯¹åº”ç‰ˆæœ¬çš„nv-codec-headersè¿›è¡Œç¼–è¯‘å®‰è£…\nhttps://github.com/FFmpeg/nv-codec-headers\nä½ å¯ä»¥ç›´æ¥ä¸‹è½½åˆ«äººçš„dockerï¼š\nhttps://yinguobing.com/docker-image-for-nvidia-gpu-accelerated-ffmpeg-opencv/\nä¸‹è½½ï¼š\nhttps://ffmpeg.org/download.html\né¦–å…ˆä½ éœ€è¦ç¼–è¯‘H264åº“ ï¼ˆ1ï¼‰ä¸‹è½½X264 : git clone [http://git.videolan.org/git/x264.git](http://git.videolan.org/git/x264.git) ï¼ˆ2ï¼‰å®‰è£…X264ï¼š sudo ./configure â€“enable-shared â€“disable-asm sudo make sudo make install æ¥ç€é‡æ–°ç¼–è¯‘ffmpegï¼š\n./configure --enable-shared --enable-cuda --enable-cuvid --enable-nvenc --enable-libnpp \\ --enable-nonfree\\ #å¯é€‰--enable-gpl --enable-libx264 --enable-libx265 --extra-cflags=-I/usr/local/cuda/include --extra-ldflags=-L/usr/local/cuda/lib64 \\ --prefix=/usr/ æ³¨æ„ï¼Œè¿™é‡Œprefixä¹‹æ‰€ä»¥è¦æŒ‡å®šä¸º/usr/æ˜¯ä¸ºäº†è®©opencvèƒ½æ‰¾åˆ°ffmpeg å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œä½ å¯ä»¥ç”¨cmake-gui ç„¶åæ‰“å¼€grouped advancedæ‰¾åˆ°pkgcfgï¼ŒæŒ‰ç…§è¿™æ ·ç±»ä¼¼çš„å‘½åè§„åˆ™ï¼Œå†æ‰¾åˆ°ä½ ç°åœ¨æ‹¥æœ‰çš„ç›¸åº”çš„soåœ¨å³ä¸Šè§’å¢åŠ å…¥å£æ·»åŠ è¿›å»å³å¯ã€‚\nä½ ä¹Ÿå¯ä»¥å‚è€ƒï¼šhttps://www.jianshu.com/p/59da3d350488\nåˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå°±ç»“æŸäº†ï¼Œä¸ºäº†è®©å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨è®°å¾—åœ¨~/.bashrcä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼š export PATH=/usr/local/ffmpeg/bin/:$PATH ä¿å­˜åæ‰§è¡Œ source ~/.bashrc\nReference åˆ©ç”¨ffmpegè½¬æ¥æ‘„åƒå¤´RTSPæµç¡¬è§£ç \nhttps://www.pianshen.com/article/31441500162/\nffmpegä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿhwaccelã€cuvidã€h264_cuvidã€h264_nvenc https://blog.csdn.net/zengraoli/article/details/119789655\nNVIDIA FFmpeg è½¬ç æŒ‡å—ã€éå¸¸æ¨èï¼Œè‹±ä¼Ÿè¾¾å®˜æ–¹è‰¯å¿ƒä¹‹ä½œï¼Œé€‚åˆå†™ä¸ªç¬”è®°ã€‘ https://developer.nvidia.com/zh-cn/blog/nvidia-ffmpeg-transcoding-guide/\nffmpegå‘½ä»¤è¡Œä½¿ç”¨nvidia CUDA scalingé«˜é€Ÿè½¬åˆ†è¾¨ç‡è½¬ç (libnpp) https://blog.csdn.net/n66040927/article/details/84525611\nVideo Encoding Sessionså¹¶å‘æ•°ç›®é™åˆ¶(OpenEncodeSessionEx failed: out of memory) https://github.com/keylase/nvidia-patch\nhttps://blog.csdn.net/TracelessLe/article/details/113755792\nhttps://blog.csdn.net/charleslei/article/details/105761627\nhttps://www.cnblogs.com/geoffreyone/p/14715487.html\n","date":"2022-11-13T15:48:48+08:00","permalink":"https://sanbuphy.github.io/p/ffmpeg%E8%A7%86%E9%A2%91%E6%B5%81%E7%A1%AC%E8%A7%A3%E7%A0%81%E5%8A%A0%E9%80%9F/","title":"ffmpegè§†é¢‘æµç¡¬è§£ç åŠ é€Ÿ"},{"content":"ç®€å•æ“ä½œ æœ¬æ–‡æ¬è¿è‡ªè¯„è®ºåŒºï¼ˆä½†æ˜¯å¤Ÿç”¨äº†ï¼‰\nå…·ä½“è¯·çœ‹è§†é¢‘https://www.bilibili.com/video/BV19e4y1q7JJ/\nhttps://www.bilibili.com/video/BV1ne4y1S7S9/\n1.git clone // åˆ°æœ¬åœ° 2.git checkout -b xxx åˆ‡æ¢è‡³æ–°åˆ†æ”¯xxx ï¼ˆç›¸å½“äºå¤åˆ¶äº†remoteçš„ä»“åº“åˆ°æœ¬åœ°çš„xxxåˆ†æ”¯ä¸Š 3.ä¿®æ”¹æˆ–è€…æ·»åŠ æœ¬åœ°ä»£ç ï¼ˆéƒ¨ç½²åœ¨ç¡¬ç›˜çš„æºæ–‡ä»¶ä¸Šï¼‰ 4.git diff æŸ¥çœ‹è‡ªå·±å¯¹ä»£ç åšå‡ºçš„æ”¹å˜ 5.git add ä¸Šä¼ æ›´æ–°åçš„ä»£ç è‡³æš‚å­˜åŒº 6.git commit å¯ä»¥å°†æš‚å­˜åŒºé‡Œæ›´æ–°åçš„ä»£ç æ›´æ–°åˆ°æœ¬åœ°git 7.git push origin xxx å°†æœ¬åœ°çš„xxxgitåˆ†æ”¯ä¸Šä¼ è‡³githubä¸Šçš„git\nï¼ˆå¦‚æœåœ¨å†™è‡ªå·±çš„ä»£ç è¿‡ç¨‹ä¸­å‘ç°è¿œç«¯GitHubä¸Šä»£ç å‡ºç°æ”¹å˜ï¼‰ 1.git checkout main åˆ‡æ¢å›mainåˆ†æ”¯ 2.git pull origin master(main) å°†è¿œç«¯ä¿®æ”¹è¿‡çš„ä»£ç å†æ›´æ–°åˆ°æœ¬åœ° 3.git checkout xxx å›åˆ°xxxåˆ†æ”¯ 4.git rebase main æˆ‘åœ¨xxxåˆ†æ”¯ä¸Šï¼Œå…ˆæŠŠmainç§»è¿‡æ¥ï¼Œç„¶åæ ¹æ®æˆ‘çš„commitæ¥ä¿®æ”¹æˆæ–°çš„å†…å®¹ ï¼ˆä¸­é€”å¯èƒ½ä¼šå‡ºç°ï¼Œrebase conflict \u0026mdash;\u0026ndash;ã€‹æ‰‹åŠ¨é€‰æ‹©ä¿ç•™å“ªæ®µä»£ç ï¼‰ 5.git push -f origin xxx æŠŠrebaseåå¹¶ä¸”æ›´æ–°è¿‡çš„ä»£ç å†pushåˆ°è¿œç«¯githubä¸Š ï¼ˆ-f \u0026mdash;ã€‹å¼ºè¡Œï¼‰ã€ä¸€å®šè¦è®°å¾—å…ˆæ›´æ–°æœ€æ–°çš„ä»£ç åˆ†æ”¯ã€‘ 6.åŸé¡¹ç›®ä¸»äººé‡‡ç”¨pull request ä¸­çš„ squash and merge åˆå¹¶æ‰€æœ‰ä¸åŒçš„commit\nè¿œç«¯å®Œæˆæ›´æ–°å\n1.git branch -d xxx åˆ é™¤æœ¬åœ°çš„gitåˆ†æ”¯\n2.git pull origin master å†æŠŠè¿œç«¯çš„æœ€æ–°ä»£ç æ‹‰è‡³æœ¬åœ°\nè¯„è®ºåŒºï¼šè¯´çš„å¾ˆå¥½ï¼Œåˆšå…¥å¤§å‚çš„æˆ‘è¡¨ç¤ºå°±æ˜¯ç”¨çš„è¿™å¥—æµç¨‹ï¼Œåˆšè¿›æ¥å°±çŠ¯äº†ä¸€æ¬¡é”™è¯¯ï¼Œè‡ªå·±çš„åˆ†æ”¯ä¸Šé¢å¾ˆå¤šcommitç„¶åä¸­é—´mergeäº†ä¸€émasterçš„ä»£ç ä¹‹ååˆcommitäº†ï¼Œç»“æœå¯¼è‡´æœ€åPRçš„æ—¶å€™rebaseéå¸¸å›°éš¾ï¼Œå¤ªå¤šå†²çªäº†ï¼Œcommitæ•°é‡å¤ªå¤šè¢«dissäº†ã€‚æœ€åè¿˜æ˜¯åˆ é™¤äº†åˆ†æ”¯ï¼Œé‡æ–°å»ºç«‹ä¸€ä¸ªåˆ†æ”¯ï¼ŒæŠŠæ‰€æœ‰çš„æ”¹å˜é‡æ–°å†ä¸€ä¸ªcommitä¸Šé¢å®ç°äº†ä¸€éã€‚åæ¥çŸ¥é“äº†ï¼Œåƒä¸‡ä¸è¦åœ¨è‡ªå·±åˆ†æ”¯æ²¡æœ‰prå‰mergeï¼Œå¯ä»¥rebaseã€‚ã€‚ã€‚è€Œä¸”æ¯æ¬¡prä¹‹å‰æˆ‘ä»¬éƒ½è¦æ±‚ç”¨rebase -iå‘½ä»¤åœ¨æœ¬åœ°å‹ç¼©commitåˆ°ä¸€ä¸ªï¼Œç„¶åå†å»PRã€‚\ngit checkout -b xxxï¼šgit checkout xxxæ˜¯æŒ‡åˆ‡æ¢åˆ°xxxï¼ˆç”¨localåŒºçš„xxxæ›¿æ¢diskåŒºæ–‡ä»¶ï¼‰ï¼Œ-bæ„å‘³ç€branchï¼Œå³åˆ›å»ºæ–°åˆ†æ”¯ï¼Œè¿™æ¡æŒ‡ä»¤åˆèµ·æ¥æ„æ€æ˜¯åˆ›å»ºå¹¶åˆ‡æ¢åˆ°xxxã€‚ git diffï¼šæŸ¥çœ‹æš‚å­˜åŒºä¸diskåŒºæ–‡ä»¶çš„å·®å¼‚ã€‚ git add xxxï¼šå°†xxxæ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºã€‚ git commitï¼šå°†æš‚å­˜åŒºå†…å®¹æ·»åŠ åˆ°localåŒºçš„å½“å‰åˆ†æ”¯ä¸­ã€‚ git push ï¼šå°†localåŒºçš„LocalBranchNameåˆ†æ”¯æ¨é€åˆ°RemoteHostNameä¸»æœºçš„åŒååˆ†æ”¯ã€‚ï¼ˆè‹¥åŠ -fè¡¨ç¤ºæ— è§†æœ¬åœ°ä¸è¿œç¨‹åˆ†æ”¯çš„å·®å¼‚å¼ºè¡Œpushï¼‰ git pull ï¼šåŒä¸Šï¼Œä¸è¿‡æ”¹æˆä»è¿œç¨‹ä¸»æœºä¸‹è½½è¿œç¨‹åˆ†æ”¯å¹¶ä¸æœ¬åœ°åŒååˆ†æ”¯åˆå¹¶ã€‚ git rebase xxxï¼šå‡è®¾å½“å‰åˆ†æ”¯ä¸xxxåˆ†æ”¯å­˜åœ¨å…±åŒéƒ¨åˆ†commonï¼Œè¯¥æŒ‡ä»¤ç”¨xxxåˆ†æ”¯åŒ…æ‹¬commonåœ¨å†…çš„æ•´ä½“æ›¿æ¢å½“å‰åˆ†æ”¯çš„commonéƒ¨åˆ†ï¼ˆåŸå…ˆxxxåˆ†æ”¯å†…å®¹ä¸ºcommon-\u0026gt;diversityAï¼Œå½“å‰åˆ†æ”¯å†…å®¹ä¸ºcommon-\u0026gt;diversityBï¼Œæ‰§è¡Œå®Œè¯¥æŒ‡ä»¤åå½“å‰åˆ†æ”¯å†…å®¹ä¸ºcommon-\u0026gt;diversityA-\u0026gt;diversityBï¼‰ã€‚ git branch -D xxxï¼šä¸åŠ -Dè¡¨ç¤ºåˆ›å»ºæ–°localåˆ†æ”¯xxxï¼ŒåŠ -Dè¡¨ç¤ºå¼ºåˆ¶åˆ é™¤localåˆ†æ”¯xxxã€‚\nä¼˜é›…çš„æäº¤pråˆ°å¼€åŸä»“åº“ openmmlabçš„å®˜æ–¹præ•™ç¨‹\nhttps://mmcv.readthedocs.io/zh_CN/latest/community/contributing.html\nè®°å¾—å»ºç«‹æ–°åˆ†æ”¯ï¼Œç„¶åpush origin ä½ çš„æ–°åˆ†æ”¯ä»è€Œpushä»£ç åˆ°ä½ è‡ªå·±çš„ä»“åº“ï¼Œéšååœ¨githubä¸Šé€‰æ‹©å¯¹åº”åˆ†æ”¯prï¼Œè¿™æ ·ä¸ä¼šå½±å“åˆ°ä½ forkä»“åº“ä¸ä¸Šæ¸¸åº“çš„åŒæ­¥çŠ¶æ€ã€‚ï¼ˆforkåä¹Ÿå¯ä»¥äººå·¥é€‰æ‹©sysnåŒæ­¥ï¼‰å¦‚æœæƒ³è¦æ–°åšä¸€ä¸ªä¿®æ”¹å°±æ–°å¼€ä¸€ä¸ªåˆ†æ”¯åšpr commitï¼Œè¢«åˆå¹¶æˆ–è€…å–æ¶ˆåå°±å¯ä»¥åˆ é™¤è¿™ä¸ªåˆ†æ”¯ï¼Œç„¶åè®°å¾—æ¯æ¬¡æ–°å»ºåˆ†æ”¯å‰è¦å…ˆä»ä¸Šæ¸¸åº“æ‹‰å–æ›´æ–°ã€‚\nå…¶ä»–å‚è€ƒï¼šä¼˜é›…åœ°ä¿®æ”¹ä»–äººè´¡çŒ®çš„ Pull Requestï¼ˆå†™çš„éå¸¸å¥½ï¼ï¼‰\nhttps://liuyib.github.io/2020/09/19/add-commits-to-others-pr/#å‘½ä»¤è¡Œæ–¹å¼\n","date":"2022-10-30T15:00:59+08:00","permalink":"https://sanbuphy.github.io/p/git%E5%AE%8C%E6%95%B4%E5%B7%A5%E5%85%B7%E6%B5%81%E6%95%99%E7%A8%8B/","title":"Gitå®Œæ•´å·¥å…·æµæ•™ç¨‹"},{"content":"ä½œä¸ºä¸€ä¸ªå¾ˆå¤šå¥‡æ€ªé—®é¢˜\u0026amp;bugä½“è´¨çš„äººï¼Œæ­¤å¤„ç”¨äºè®°å½•å¹³æ—¶çš„å¥‡æ€å¦™æƒ³ã€‚\nhttps://zhuanlan.zhihu.com/p/83454344\nç¼–è¯‘ä¸é“¾æ¥ç›¸å…³ windowsåŠ¨æ€è¿æ¥åº“dllå±…ç„¶æ˜¯ç”¨libå¯¼å…¥ç¬¦å·ä¿¡æ¯ï¼ˆwindowsä¸“é—¨çš„ç¼–è¯‘å™¨ï¼‰ï¼ˆæ­¤æ—¶çš„libä¸è¡¨ç¤ºé™æ€è¿æ¥åº“ï¼‰ï¼Œè¿˜æ˜¯linuxé¦™å•Šã€‚ã€‚\nã€æ‰‹æŠŠæ‰‹æ•™ä½ ç¼–å†™ å¹´è½»äººçš„ç¬¬ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“-å“”å“©å“”å“©ã€‘ https://b23.tv/6pddFSv\nQï¼šç¼–è¯‘å™¨å‰åç«¯ä¹‹åŒºåˆ«æ˜¯ä¸æ˜¯åªåœ¨ä¸­é—´ä»£ç ç¿»è¯‘çš„èŒè´£éƒ¨åˆ†ï¼Ÿ\næ¯”å¦‚clangè´Ÿè´£è½¬æ¢æˆæœºå™¨æ— å…³çš„ä¸­é—´ä»£ç ã€‚ç„¶ållvmåç«¯æŠŠå®ƒå¯ä»¥è½¬æ¢æˆæœºå™¨ç›¸å…³æ±‡ç¼–ä»£ç \nAï¼š\næ“ä½œç³»ç»Ÿç›¸å…³ https://yajin.org/os2018fall/\nhttps://yajin.org/os2018fall/02_os_structures.pdf\nQï¼šç”¨æˆ·çº¿ç¨‹ä¸ºä»€ä¹ˆä¸èƒ½ç‹¬ç«‹äºå†…æ ¸çº¿ç¨‹å­˜åœ¨ï¼Ÿè‡³å°‘è¦æœ‰ä¸€ä¸ªå†…æ ¸çº¿ç¨‹â€œä¸ä»–å…³è”â€ï¼Ÿ\nAï¼š\nç¾¤å‹çš„çœ‹æ³•ï¼š\næˆ‘çš„ç†è§£æ˜¯,å¦‚æœåœ¨å¾®å†…æ ¸, æ¯”å¦‚fsæ¨¡å—åœ¨userå±‚, ç”¨æˆ·ç¨‹åºåªéœ€è¦è°ƒç”¨fsæ¨¡å—, é‚£ç”¨æˆ·ç¨‹åºé€»è¾‘ä¸Šæ˜¯æ²¡æœ‰è°ƒç”¨å†…æ ¸task, ä½†æ˜¯ç‰©ç†ä¸Šå¾®å†…æ ¸fsæ¨¡å—è‚¯å®šä¼šè°ƒç”¨å¾®å†…æ ¸å†…æ ¸å±‚çš„vmçš„taskçš„, æ‰€ä»¥ç”¨æˆ·çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹å­˜åœ¨ã€‚å¦‚æœç”¨æˆ·ç¨‹åºå’Œæ“ä½œç³»ç»Ÿåœ¨ä¸€ä¸ªç‰©ç†æœºä¸­, å¦‚æœç”¨æˆ·ç¨‹åºå’Œæ“ä½œç³»ç»Ÿè¦ç‹¬ç«‹, é¦–å…ˆèµ„æºè¦ç‹¬ç«‹, å†…å­˜å¯ä»¥åå•†ç‹¬ç«‹, æ¯”å¦‚0x00000a-0x0000fffæ˜¯æ“ä½œç³»ç»Ÿçš„, ç„¶å0x0001ffff0-0xffffffffæ˜¯ç”¨æˆ·ç¨‹åºçš„. cpu0æ˜¯ç»™æ“ä½œç³»ç»Ÿçš„, cpu1æ˜¯ç»™ç”¨æˆ·ç¨‹åºçš„. ç„¶åé€šä¿¡ç”¨ç½‘ç»œ, eth0æ˜¯æ“ä½œç³»ç»Ÿçš„, eth1æ˜¯ç”¨æˆ·ç¨‹åºçš„. è¿™æ ·çš„è¯åº”è¯¥èƒ½è®¾è®¡å‡ºç”¨æˆ·çº¿ç¨‹æ˜¯ç‹¬ç«‹çš„ã€‚\næˆ‘çš„çœ‹æ³•ï¼š\nï¼ˆä¸åŒæ“ä½œç³»ç»Ÿå®ç°ä¸åŒï¼Œè¿™é‡Œåªé’ˆå¯¹æ¯”è¾ƒç°ä»£çš„linuxã€‚)\né¦–å…ˆè¦æ³¨æ„è¿™ä¸œè¥¿ç”±äºä¸åŒæ“ä½œç³»ç»Ÿå’Œä¸åŒå¹´ä»£çš„æ•™æä¼—è¯´çº·çº­ï¼Œå¾ˆå®¹æ˜“å‡ºç°æ¦‚å¿µæ··æ·†å’Œç†è§£é”™è¯¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥æœ€æ–°çš„linuxæ‰‹å†Œä¸ºå‡†ã€‚\nåœ¨è®¨è®ºè¿™ä¸ªé—®é¢˜ä¹‹å‰é¦–å…ˆè¦æ˜ç¡®å‡ ä¸ªæ¦‚å¿µï¼ˆä»€ä¹ˆæ˜¯çº¿ç¨‹ã€ä»€ä¹ˆæ˜¯ç”¨æˆ·çº¿ç¨‹ã€‚ï¼‰ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰å¾ˆå¤šåœ°æ–¹è¯´åˆ°å¤šå¯¹ä¸€æ¨¡å‹ï¼Œå…¶å®è¿™é‡Œçš„ç”¨æˆ·çº¿ç¨‹æ›´åº”è¯¥å«åç¨‹ï¼ˆä½ çœ‹åˆ°å¾ˆå¤šåœ°æ–¹ä¼šè¯´è¿™ä¸œè¥¿ä¸éœ€è¦syscallå°±å¯ä»¥åˆ›å»ºï¼Œprocesså†…è´Ÿè´£æ‰§è¡Œæµåˆ‡æ¢æ— éœ€osï¼‰ã€‚è€Œæˆ‘ä»¬å¸¸è¯´çš„ç”¨æˆ·æ€åˆ›å»ºçš„çº¿ç¨‹å°±æ˜¯ä¸€å¯¹ä¸€æ¨¡å‹ï¼ˆpthreadsæ‰‹å†Œä¸­æ˜ç¡®æåˆ°Both of these are so-called 1:1 implementations, meaning that each thread maps to a kernel scheduling entityï¼‰ï¼Œæœ¬èº«éœ€è¦å’Œå†…æ ¸çº¿ç¨‹æŒ‚é’©ï¼ˆåˆ›å»ºè¿‡ç¨‹éœ€è¦syscallå’Œå†…æ ¸çº¿ç¨‹ç»‘å®šï¼‰ï¼Œè€Œè¿›ç¨‹æœ¬èº«çš„ä¸»çº¿ç¨‹å¿…å®šæ˜¯å’Œå†…æ ¸çº¿ç¨‹æŒ‚é’©ï¼›å¦å¤–åœ¨linuxä¸­æˆ‘ä»¬ç”¨taskå»ç§°å‘¼ä¼šæ›´åŠ åˆé€‚ï¼Œlinuxç³»ç»Ÿå±‚é¢æ²¡å¿…è¦åˆ†è¿›ç¨‹çº¿ç¨‹åªéœ€è¦taskå°±å¥½ã€‚åªæœ‰åœ¨æˆ‘ä»¬æ‰§è¡Œçš„ç¨‹åºé‡Œæœ‰éœ€æ±‚å¼€pthread è¿™é‡Œæ‰è¦å¼ºè°ƒï¼Œå®ƒä¼šå°†å¯¹åº”çš„å‡½æ•°å…¥å£ç»™å†…æ ¸çº¿ç¨‹ä»¥ä¾¿åˆ‡æ¢ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨xv6ï¼Œå†…æ ¸åˆå§‹åŒ–å®Œäº†åˆ‡æ¢initåå°±è¿›å…¥äº†ç”¨æˆ·æ€ï¼Œæ­¤åforkã€execçš„éƒ½æ˜¯å­taskï¼Œä½†æ˜¯éœ€è¦è°ƒåº¦æµåˆ‡æ¢å¾—éœ€è¦å’Œcpuè”ç³»ï¼Œè¿™å°±éœ€è¦å†…æ ¸taskæ‰èƒ½å¤Ÿè¿ä½œã€‚ï¼ˆå…¶å®è¿™é‡Œçš„å­taskæœ¬èº«å°±æ˜¯å¯ä»¥è¢«è°ƒåº¦åˆ°çš„ï¼Œå› ä¸ºå°±æ˜¯PCBï¼‰\nå›ç­”è¿™ä¸ªé—®é¢˜çš„å…³é”®æ˜¯ç†è§£æ‰€è°“çš„çº¿ç¨‹æ˜¯æ€ä¹ˆæ‹¿åˆ°cpuèµ„æºçš„ï¼Œæ‹¿åˆ°èµ„æºæ„å‘³ç€è¢«è°ƒåº¦å™¨è°ƒåº¦ã€‚ï¼ˆä¸ºä»€ä¹ˆä¸è®¨è®ºè¿›ç¨‹ï¼Ÿå› ä¸ºå®é™…ä¸Šè¿›ç¨‹åªæ˜¯ä¸€äº›å…±äº«å†…å­˜çš„taskï¼Œè€Œä¸”åœ¨linuxä¸­PCBå°±æ˜¯task_structï¼‰ã€‚é¦–å…ˆä¹‹æ‰€ä»¥æ˜¯çº¿ç¨‹è€Œä¸æ˜¯å‡½æ•°æ˜¯å› ä¸ºä»–èƒ½ä½œä¸ºè°ƒåº¦å•å…ƒï¼ˆå¯ä»¥è¢«è°ƒåº¦å™¨åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼‰ï¼Œåœ¨ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆæ¯”å¦‚paä¸­çš„scheduleï¼‰çš„çœ¼é‡Œï¼Œåªæœ‰taskæ‰æ˜¯è°ƒåº¦å•å…ƒï¼Œå³å¤„ç†å™¨ä¸Šè¿è¡Œçš„æ¯ä¸ªä»»åŠ¡éƒ½æ˜¯è°ƒåº¦å™¨ç»™åˆ†é…çš„æ‰§è¡Œæµï¼Œåªè¦æˆä¸ºæ‰§è¡Œæµå°±èƒ½å¤Ÿç‹¬ç«‹ä¸Šå¤„ç†å™¨è¿è¡Œäº†ï¼Œè€Œå†…æ ¸taskå¯ä»¥è¢«å†…æ ¸ç›´æ¥è°ƒåº¦ï¼Œä»–å¯ä»¥ç›´æ¥åšåˆ°æ“ä½œé¡µè¡¨ï¼Œç»´æŠ¤cache, è¯»å†™ç³»ç»Ÿå¯„å­˜å™¨ç­‰æ“ä½œã€‚å¦‚æœç”¨æˆ·taskï¼ˆæ¯”å¦‚åç¨‹ï¼‰ä¸éœ€è¦å†…æ ¸çº¿ç¨‹ç®¡ç†ï¼Œå®¹æ˜“å‡ºç°ä¸€äº›æ„å¤–ç°è±¡ï¼ˆè™½ç„¶è¿˜æ˜¯å¯ä»¥è®©ç³»ç»Ÿå‘æŒ‡ä»¤æ€æ­»ï¼‰ã€‚è¿™é‡Œæ¦‚å¿µæœ€å‘çš„å°±æ˜¯å¯èƒ½æ··æ·†åç¨‹å’Œåœ¨ç”¨æˆ·æ€ç”¨pthread api åˆ›å»ºçš„çº¿ç¨‹ä»¥åŠLWPè½»é‡åŒ–è¿›ç¨‹ï¼Œå®é™…ä¸Šå‰è€…å¯ä»¥é€šè¿‡æ˜¯å¦syscallæ˜¯å¦éœ€è¦å’Œå†…æ ¸äº’åŠ¨æ¥åŒºåˆ†ï¼›è€ŒLWPè½»é‡åŒ–è¿›ç¨‹åœ¨linuxä¸­æœ‰æ—¶æ˜¯å†…æ ¸çº¿ç¨‹çš„å¦ä¸€ç§ç§°å‘¼ã€‚\nä¸ºä»€ä¹ˆè¯´linuxä¸­ç”¨æˆ·æ€å¯ä»¥/éœ€è¦ç»‘å®šä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Ÿå…·ä½“çœ‹syscallï¼Œæˆ‘ä»¬åˆ›å»ºçº¿ç¨‹çš„è¿‡ç¨‹ä¼šè°ƒç”¨cloneç„¶åå’Œä¸€ä¸ªå†…æ ¸çº¿ç¨‹â€œç»‘å®šâ€ï¼ˆå¤§æ¦‚æ˜¯æŠŠä¸Šä¸‹æ–‡å­˜å‚¨åˆ°å†…æ ¸çº¿ç¨‹taskå—ä¸­è¿™æ ·å¯ä»¥è¢«osçœ‹åˆ°å’Œè°ƒåº¦ã€‚ï¼‰ç”¨æˆ·taskå®é™…ä¸Šç”¨çš„æ˜¯å†…æ ¸taskçš„pcbå—ï¼Œéœ€è¦ä¸€äº›é«˜çº§æƒé™çš„æ—¶å€™å°±ä¿å­˜ä¸Šä¸‹æ–‡å†…é™·ç„¶ååœ¨å†…æ ¸ä¸­å¤„ç†å³å¯ã€‚\nå¦‚æœæƒ³è¦æœ€å•çº¯çš„ç”¨æˆ·çº¿ç¨‹ä¹Ÿæœ‰æ‰§è¡Œçš„æƒé™ï¼Œå…³é”®æ˜¯ä½ èƒ½å¤Ÿæ€ä¹ˆåˆ‡æ¢ä»–çš„æ‰§è¡Œæµï¼Œæ­¤æ—¶åº”è¯¥åªæœ‰åç¨‹èƒ½æ»¡è¶³è¿™ä¸ªéœ€æ±‚äº†ï¼Œå¦åˆ™è¦ææƒçš„è¯å°±æ˜¯å†…æ ¸çº¿ç¨‹äº†ï¼Œå› ä¸ºèƒ½è¢«å†…æ ¸ç›´æ¥scheduleã€‚æ‰€ä»¥ä¸¥æ ¼æ¥è¯´ç‹¬ç«‹çš„ç”¨æˆ·çº¿ç¨‹æ˜¯ä¸å­˜åœ¨çš„ï¼Œå°±ç®—æ˜¯åç¨‹ä¹Ÿéœ€è¦è¿›ç¨‹è°ƒåº¦ï¼Œè€Œè¿›ç¨‹çš„cpuèµ„æºæºäºå¯¹åº”å†…æ ¸taskçš„è¢«è°ƒåº¦ã€‚\nï¼ˆæœ‰è¶£çš„æ˜¯ï¼Œlinux2.6æ‰å®Œå…¨æ”¯æŒäº†æˆ‘ä»¬ç°åœ¨æ„ä¹‰ä¸Šçš„ç”¨æˆ·æ€çº¿ç¨‹ï¼Œlinux2.6æ˜¯2003å¹´çš„å†…æ ¸ç‰ˆæœ¬ï¼Œç”±æ­¤å¯è§è®¡ç®—æœºç¡®å®æ˜¯ä¸€é—¨å¾ˆæ–°çš„å­¦ç§‘:) ï¼‰\nreferenceï¼š\næµ™å¤§è¯¾ä»¶Light-Weight Processes: Dissecting Linux Threadsï¼šhttps://yajin.org/os2018fall/04_thread_b.pdf\næ·±å…¥ç†è§£Linuxå†…æ ¸ä¹‹å†…æ ¸çº¿ç¨‹ï¼ˆä¸Šï¼‰ï¼šhttps://zhuanlan.zhihu.com/p/364898425\nå…³äºâ€œå†…æ ¸çº¿ç¨‹â€ã€â€œç”¨æˆ·çº¿ç¨‹â€æ¦‚å¿µçš„ç†è§£ï¼šhttps://blog.csdn.net/u012927281/article/details/51602898\nå›¾è§£è¿›ç¨‹ã€çº¿ç¨‹ï¼šhttps://blog.csdn.net/fuzhongmin05/article/details/119448800\nLight-Weight Processes: Dissecting Linux Threadsï¼šhttps://www.opensourceforu.com/2011/08/light-weight-processes-dissecting-linux-threads/\nWhat are Linux Processes, Threads, Light Weight Processes, and Process State:https://www.thegeekstuff.com/2013/11/linux-process-and-threads/\nman pthreads:https://man7.org/linux/man-pages/man7/pthreads.7.html\nQï¼šlinuxçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿæ€ä¹ˆè¢«åˆ›å»ºå’Œé”€æ¯ï¼Ÿå†…æ ¸taskèƒ½ä¸èƒ½è¢«å¤ç”¨ï¼Ÿ\nA: è¿™ä¸ªè¯´çš„æ¯”è¾ƒæ¸…æ¥šï¼šhttps://xieyu.github.io/blog/pthread/glibc-pthread-implement-thread-life-cycle.html\nå¦‚æœ pthread_join å‘ç”Ÿåœ¨ç»“æŸåä¸ä¹…ï¼Œèµ„æºè¿˜æœªè¢«å›æ”¶ï¼Œå‡½æ•°ä¼šç«‹å³è¿”å›ã€‚\nå¦‚æœ pthread_join å‘ç”Ÿåœ¨ç»“æŸä»¥åä¸€æ®µæ—¶é—´ï¼Œå¯èƒ½ä¼šå¾—åˆ° ESRCH (no such thread) é”™è¯¯ã€‚\nå¦‚æœ pthread_join å‘ç”Ÿåœ¨ä¹‹åå¾ˆä¹…å¾ˆä¹…å¾ˆä¹…å¾ˆä¹…ï¼Œèµ„æºè¢«é‡Šæ”¾åˆè¢«å†æ¬¡å¤ç”¨ (pthread_t æ˜¯ä¸€ä¸ªçš„ç¡®å¯èƒ½è¢«å¤ç”¨çš„æ•´æ•°)ï¼Œæˆ‘ä¸å°± join äº†å¦ä¸€ä¸ªçº¿ç¨‹äº†å—ï¼Ÿè¿™ææ€•è¦å‡ºå¤§é—®é¢˜ã€‚\nç‰¹åˆ«çš„ï¼šï¼ˆå…¶ä»–æƒ…å†µexitåéƒ½ä¼šè¢«èµ„æºå›æ”¶ï¼‰\næ²¡æœ‰taskå¤ç”¨çš„è¯´æ³•ã€‚\nreference:\njyy:http://jyywiki.cn/OS/2022/labs/M2\nç½‘ç»œç›¸å…³ pythonç›¸å…³ Q:ä¸ºä»€ä¹ˆå¼€äº†multiprocessingçš„poolå†å¼€processå°±ä¸ä¼šå‡ºç°ä¿¡æ¯ï¼Ÿ\nAï¼šä¸çŸ¥é“ï¼Œä½†ä½ è®°ä½è¦å¤šæ¬¡forkåªèƒ½ä¸€ç›´processå°±å¯¹äº†ã€‚\n","date":"2022-10-14T19:48:48+08:00","permalink":"https://sanbuphy.github.io/p/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%90%84%E7%B1%BB%E7%A5%9E%E5%A5%87%E7%9A%84%E5%B0%8F%E9%97%AE%E9%A2%98%E5%A4%A7%E5%85%A8/","title":"è®¡ç®—æœºå„ç±»ç¥å¥‡çš„å°é—®é¢˜å¤§å…¨"},{"content":"æœ€è¿‘åœ¨ä½¿ç”¨pythonè°ƒç”¨pybind11ç”Ÿæˆçš„soå‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºä¸€ä¸ªpythonç¯å¢ƒä¸‹ç”Ÿæˆçš„soï¼Œå¦ä¸€ä¸ªç¯å¢ƒç”¨ä¸äº†ã€‚ï¼ˆåˆšå¼€å§‹ä¹Ÿè¿˜æ²¡å‘ç°æ˜¯ç¯å¢ƒçš„é—®é¢˜ï¼‰\nä¸€å¼€å§‹å‘ç°çš„ç°è±¡æ˜¯èƒ½ç”¨vscodeç”Ÿæˆèƒ½ä½¿ç”¨ï¼Œä½†åœ¨pycharmä¸‹ä½¿ç”¨ä¸èƒ½ï¼›ä¸€å¼€å§‹æ€€ç–‘çš„æ˜¯pycharmé…ç½®é—®é¢˜å¯¼è‡´åº“ä¸èƒ½è¢«importï¼ˆimportäº†ä¼šæç¤ºæ‰¾ä¸åˆ°è¿™ä¸ªåº“ï¼‰ã€‚\nåé¢å‘ç°æ¢åˆ°æŸæŒ‡å®šç¯å¢ƒä¸‹å°±å¯ä»¥æˆåŠŸè¿è¡Œï¼ˆå’Œpythonç‰ˆæœ¬æœ‰å…³ï¼‰ï¼Œå†ä¹‹åå‘ç°åªæœ‰ç‰¹å®špythonç‰ˆæœ¬ç”¨python setup.py build åäº§ç”Ÿçš„soèƒ½ç”¨ç‰¹å®špythonè¿›è¡Œè°ƒç”¨ã€‚\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿåå‘ç°ä¸åŒsoæ¶‰åŠåˆ°pythonç‰ˆæœ¬çš„å‰ç¼€æ˜¯ä¸ä¸€æ ·çš„ï¼ˆæ¯”å¦‚3.7ç”Ÿæˆå°±æ˜¯37ï¼‰ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°setupçš„ç¼–è¯‘é€‰é¡¹ä¸­æ¶‰åŠåˆ°äº†æŒ‡å®šçš„pythonç‰ˆæœ¬ä¿¡æ¯ï¼›æ‰€ä»¥æˆ‘ä»¬ç¡®å®šäº†ä»–å°±æ˜¯è§£é‡Šå™¨ç‰ˆæœ¬ç›¸å…³çš„ï¼Œé‚£ä¸ºä»€ä¹ˆç‰ˆæœ¬ä¸åŒçš„soä¸å¯ä»¥è¢«pythonè¯»å–å‘¢ï¼Ÿ\nåœ¨importä¸€ä¸ªsoåº“é‡Œçš„ç±»æˆ–å‡½æ•°æ—¶ï¼Œæœ‰æ—¶å‘ç°soæ–‡ä»¶åˆ†æ˜å°±åœ¨é‚£è·¯å¾„ä¸‹ï¼Œå¯æ˜¯æ€»æ˜¯æŠ¥é”™ModuleNotFoundError: No module namedï¼Œè¿™ç§é”™è¯¯çš„å¯èƒ½åŸå› æœ‰:\n1.é¦–å…ˆè¦ç¡®ä¿soæ‰€åœ¨çš„è·¯å¾„å·²ç»åŒ…å«åœ¨sys.pathé‡Œäº†ï¼Œå¦‚æœsoæ‰€åœ¨ç›®å½•å·²ç»æ˜¯åœ¨pythoné»˜è®¤çš„ç³»ç»Ÿè·¯å¾„é‡Œï¼Œä¾‹å¦‚/usr/lib/python3.6/dist-packages/æˆ–è€…/usr/local/lib/python3.6/dist-packages/ä¹‹ä¸‹çš„ä»»ä½•å±‚çº§çš„ç›®å½•ï¼Œä¸ç”¨åšä»»ä½•è®¾ç½®ï¼Œå¦‚æœæ˜¯å…¶ä»–è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®PYTHONPATHæˆ–è€…ç¨‹åºé‡Œä½¿ç”¨sys.path.insert()æˆ–sys.path.append()æŠŠè·¯å¾„æ·»åŠ åˆ°sys.pathé‡Œæ¥ã€‚\n2.è·¯å¾„åŒ…å«æ­£ç¡®äº†ï¼Œæ£€æŸ¥soåº“çš„å‘½åçš„å‰ç¼€å’Œimportæ˜¯å¦ä¸ä¸€è‡´ï¼Œè¿™ç§soåº“çš„å‘½åæ˜¯æœ‰ä¸€å®šè§„åˆ™çš„ï¼Œä¾‹å¦‚ï¼ŒLinuxä¸Šä¸€èˆ¬æ˜¯\u0026lt;so_name\u0026gt;.cpython---linux-gnu.soï¼Œåœ¨importæ—¶æŒ‡å®šçš„åå­—éœ€è¦å’Œ\u0026lt;so_name\u0026gt;ä¿æŒä¸€è‡´ã€‚\n3.å‘½åæ­£ç¡®äº†ï¼Œæ£€æŸ¥åé¢çš„åç¼€cpython---linux-gnu.soæ˜¯å¦åœ¨ä½ å½“å‰ä½¿ç”¨çš„pythonç‰ˆæœ¬çš„æ”¯æŒèŒƒå›´å†…ï¼Œä¾‹å¦‚ï¼Œä½ çš„soåº“æ˜¯python3çš„ï¼Œå¯ä½ åœ¨è¯¯æ“ä½œä¸‹åœ¨ä½¿ç”¨python2è¿è¡Œç¨‹åºï¼Œæˆ–è€…ä½ çš„soåº“æ˜¯é’ˆå¯¹python3.5çš„(soåç¼€é‡Œçš„python-version=35m)ï¼Œä½†ä½ å½“å‰ä½¿ç”¨çš„æ˜¯python3.6ï¼Œä¹Ÿä¸è¡Œï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯åœ¨åªå®‰è£…äº†ä¸€ç§ç‰ˆæœ¬çš„pythonçš„ç¯å¢ƒé‡Œï¼Œè¿è¡Œpythonç¨‹åºå‰ï¼Œæœ€å¥½æ£€æŸ¥ä¸€ä¸‹pythonç‰ˆæœ¬æ˜¯å¦æ˜¯ä½ æ‰€å¸Œæœ›çš„ï¼Œè¿™ä¸ªæ˜¯åœ¨å®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„pythonçš„ç¯å¢ƒä¸‹æˆ–è€…å‡çº§äº†pythonç‰ˆæœ¬åç»å¸¸ä¸ç»æ„ä¸‹æ˜“çŠ¯çš„é”™è¯¯ï¼Œæœ‰æ—¶è¿˜è¢«å‘æµªè´¹å¾ˆå¤šæ—¶é—´æŸ¥æ‰¾åŸå› ï¼Œé™¤äº†soåº“åˆ†æ˜åœ¨é‚£é‡Œå´æ€»æ˜¯æŠ¥ModuleNotFoundErrorï¼Œè¿˜æœ‰å…¶ä»–ä¸ƒä¸ƒå…«å…«å¥‡æ€ªçš„é”™è¯¯ï¼ŒæŸ¥æ‰¾åŸå› æœ€åå‘ç°æ˜¯pythonç‰ˆæœ¬ç”¨é”™äº†ï¼Œæ°”å¾—è¡€å†²è„‘é—¨ã€‚\n4.è·¯å¾„å­˜åœ¨å†²çªï¼Œsoåˆ†æ˜åœ¨æŸä¸ªå·²åŒ…å«çš„ç›®å½•ä¸‹å­˜åœ¨ï¼Œæ²¡æœ‰å…¶ä»–çš„é”™è¯¯ï¼Œå¯è¿˜æ€»æ˜¯æŠ¥é”™ModuleNotFoundErrorï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯å¾ˆå‘äººçš„ï¼ŒèŠ±è´¹äº†å¾ˆä¹…æ—¶é—´æƒ³ä¸å‡ºåŸå› æ¥ï¼Œå°±æ˜¯æ²¡æƒ³åˆ°å¯èƒ½è·¯å¾„ä¸Šå­˜åœ¨é‡åçš„å†²çªï¼Œä¾‹å¦‚ï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨pythonä»£ç è°ƒç”¨mediapipeæ—¶å‡ºç°æŠ¥é”™ModuleNotFoundError: No module named \u0026lsquo;mediapipe.python._framework_bindings\u0026rsquo;ï¼Œå…¶ä»–ä»€ä¹ˆé”™è¯¯åŸå› éƒ½æ²¡å‘ç°ï¼Œéƒé—·åœ°ç†¬å¤œï¼Œæœ€åå‘ç°è™½ç„¶/usr/local/lib/python3.6/site-packages/mediapipe/python/_framework_bindings.cpython-36m-x86_64-linux-gnu.soæ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯åœ¨è¿è¡Œç¨‹åºçš„å·¥ä½œç›®å½•ä¸‹ä¹Ÿæœ‰ä¸ªä½¿ç”¨è¿‡ç”¨æ¥buildå‡ºmeaidpipeçš„wheelåŒ…çš„æºç ç›®å½•ï¼Œç”±äºå½“å‰å·¥ä½œç›®å½•åŠ å…¥äº†sys.pathé‡Œæœ€å‰é¢ï¼Œäºæ˜¯pythonæœç´¢è·¯å¾„æ—¶è‡ªç„¶æ˜¯ä¼˜å…ˆæ‰¾çš„/workspace/mediapipe/python/\u0026hellip;ï¼Œè¿™ä¸ªä¸‹é¢ç¡®å®æ˜¯æ²¡æœ‰é‚£ä¸ªsoæ–‡ä»¶ï¼Œäºæ˜¯æŠŠè¿™é‡Œçš„mediapipeç›®å½•æ”¹åæˆ–è€…ç§»èµ°ï¼Œé—®é¢˜å°±æ¶ˆå¤±äº†ã€‚\n5.æœ€åï¼Œå¦‚æœæ˜¯è‡ªå·±å®ç°çš„soåº“ï¼Œè¦æƒ³èƒ½è¢«python importï¼Œsoåº“çš„å†…éƒ¨å®ç°æŒ‰è§„èŒƒæ¥ã€‚\næ€ä¹ˆç¡®è®¤ä½ å½“å‰ä½¿ç”¨çš„pythonç‰ˆæœ¬æ”¯æŒå“ªäº›åç¼€çš„åº“èƒ½è¢«importå‘¢ï¼Œå¾ˆç®€å•ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç :\nimport importlib.machinery print(importlib.machinery.all_suffixes()) æ­¤æ—¶ä½ å°±èƒ½çœ‹åˆ°ä¸Šè¿°soç†Ÿæ‚‰çš„èº«å½±ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰äº›soèƒ½å¤Ÿè¢«importçš„åº•å±‚åŸå› ã€‚\rReference\nhttps://blog.csdn.net/XCCCCZ/article/details/111089151\n","date":"2022-10-14T19:08:27+08:00","permalink":"https://sanbuphy.github.io/p/pybind11%E7%94%9F%E6%88%90%E7%9A%84so%E6%97%A0%E6%B3%95%E8%A2%ABimport%E9%97%AE%E9%A2%98/","title":"pybind11ç”Ÿæˆçš„soæ— æ³•è¢«importé—®é¢˜"},{"content":"æœ€è¿‘é‡åˆ°è¦è®©rtmpåœ¨å‰ç«¯å±•ç¤ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“flashå·²ç»ä¸å†è¢«æ”¯æŒäº†ï¼Œç°åœ¨æ”¯æŒçš„æ˜¯httpä¼ è¾“åè®®ã€‚\nå¦‚æœè¦æµè§ˆå™¨å‰ç«¯å±•ç¤ºé™¤äº†å¼‚æ­¥ç›´æ¥å±•ç¤ºçš„æ–¹æ³•å°±æ˜¯ç”¨http-flvã€‚\nä¸€ã€å®‰è£…http-flvç‰ˆçš„nginx å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« https://sanbuphy.github.io/p/opencvè¯»å–è§†é¢‘å›¾åƒå¤„ç†åæ¨æµrtmp/\nå¯ä»¥è¿›è¡ŒåŸºç¡€çš„é…ç½®ï¼Œå”¯ä¸€çš„å·®åˆ«å°±æ˜¯å®‰è£…çš„æ—¶å€™é€‰å–çš„åŒ…ä¸ºï¼š\ngit clone https://github.com/winshining/nginx-http-flv-module.git\nä¹Ÿå’Œæˆ‘ä»¬ä¹‹å‰çš„rtmpåŒ…ä¸€æ ·æ”¾åœ¨åŒçº§ç›®å½•ï¼Œç„¶åè¿›å…¥nginxï¼š\nï¼ˆæ³¨æ„ï¼Œä¸éœ€è¦å¸¦ä¸Šrtmpçš„é™„åŠ æ¨¡å—ï¼Œå› ä¸ºhttpflvæ¨¡å—åŒ…å«äº†rtmpåŒ…çš„åŸºç¡€åŠŸèƒ½ï¼‰\n./configure --add-module=../nginx-http-flv-module make -j8 sudo make install å®‰è£…ç»“æŸåç”¨åŒæ ·çš„æ–¹æ³•ç‚¹äº®nginxçš„åˆå§‹åŒ–\nå¦‚æœä½ å·²ç»å®‰è£…äº†nginxï¼Œä½ åªéœ€è¦whereis nginxï¼Œç„¶årm -rfå¯¹åº”çš„æ–‡ä»¶å¤¹å³å¯ã€‚\näºŒã€ä¿®æ”¹nginxé…ç½® æŒ‰ä¹‹å‰æ–‡ç« åŒæ ·çš„æ–¹æ³•ç”¨codeæˆ–è€…å…¶ä»–æ–¹å¼è¿›å…¥ /usr/local/nginx/conf/nginx.conf ï¼ŒæŒ‰ç…§å¦‚ä¸‹è§„åˆ™ä¿®æ”¹ï¼š\n# åœ¨serverå†…çš„location /stat.xslä¹‹ä¸‹åŠ å…¥å¦‚ä¸‹å­—æ ·ï¼ŒåŒæ—¶åˆ«å¿˜äº†æŠŠstat.xslçš„rootåœ°å€æ”¹æˆhttp-flvçš„ location /live{ flv_live on; #æ‰“å¼€ HTTP æ’­æ”¾ FLV ç›´æ’­æµåŠŸèƒ½ chunked_transfer_encoding on; #æ”¯æŒ \u0026#39;Transfer-Encoding: chunked\u0026#39; æ–¹å¼å›å¤ add_header \u0026#39;Access-Control-Allow-Origin\u0026#39; \u0026#39;*\u0026#39;; #æ·»åŠ é¢å¤–çš„ HTTP å¤´ add_header \u0026#39;Access-Control-Allow-Credentials\u0026#39; \u0026#39;true\u0026#39;; #æ·»åŠ é¢å¤–çš„ HTTP å¤´ } # åœ¨åŸæ¥rtmpé…ç½®çš„åœ°æ–¹åŠ å…¥å¦‚ä¸‹å­—æ · application http_flv{ live on; } ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡ä¿®æ”¹å®Œé…ç½®ä¸€å®šè¦è®°å¾—sudo /usr/local/nginx/sbin/nginx -s reload\nps:è¿™é‡Œæœ‰ä¸ªå‘å°±æ˜¯æˆ‘æ”¹äº†worker_processesåå°±ä¸èƒ½è¿è¡Œäº†ã€‚ã€‚è¿™ä¸ªå…·ä½“ç»†èŠ‚å¯ä»¥æœç´¢ï¼Œå®é™…ä¸Šæ¯”è¾ƒå¤æ‚ã€‚\nä¸‰ã€å¼€å§‹æ¨æµ æŒ‰ç…§å‰æ–‡åŒæ ·çš„æ–¹å¼ä½ å¯ä»¥ç›´æ¥æ¨é€æˆrtmpæµï¼Œå¦‚æœä½ æƒ³è¦æ¨é€æˆhttp-flvæ”¯æŒçš„æ ¼å¼åˆ™ä¿®æ”¹ï¼š\nrtmp = \u0026#39;rtmp://localhost:1935/mylive/test\u0026#39; #æŠŠåŸæ¥çš„rtmpæ¨é€åœ°å€ä¿®æ”¹ä¸ºå¦‚ä¸‹: rtmp = \u0026#39;rtmp://localhost:1935/http_flv/test\u0026#39; ç„¶åå†ä½¿ç”¨htmlæ¨¡æ¿è¿›è¡Œç›´æ¥æŸ¥çœ‹ï¼ˆflv.jsï¼‰\nã€æ­¤å¤„éœ€è¦ä¿®æ”¹url: 'http://ä½ çš„ip/live?port=1935\u0026amp;app=http_flv\u0026amp;stream=test',ä¸ºä½ çš„ipã€‘ï¼ˆè¿™ä¸ªæ˜¯ç»™å‰ç«¯æ‹‰æµçš„åœ°å€ï¼‰\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta content=\u0026#34;text/html; charset=utf-8\u0026#34; http-equiv=\u0026#34;Content-Type\u0026#34;\u0026gt; \u0026lt;title\u0026gt;flv.js demo\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; .mainContainer { display: block; width: 640px; } .urlInput { display: block; width: 100%; margin-top: 8px; margin-bottom: 8px; } .centeredVideo { display: block; width: 100%; height: 320px; } .controls { display: block; width: 100%; text-align: left; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;mainContainer\u0026#34;\u0026gt; \u0026lt;video id=\u0026#34;videoElement\u0026#34; class=\u0026#34;centeredVideo\u0026#34; controls autoplay width=\u0026#34;640\u0026#34; height=\u0026#34;320\u0026#34;\u0026gt;Your browser is too old which doesn\u0026#39;t support HTML5 video.\u0026lt;/video\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;br\u0026gt; \u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt; \u0026lt;button onclick=\u0026#34;flv_start()\u0026#34;\u0026gt;å¼€å§‹\u0026lt;/button\u0026gt; \u0026lt;button onclick=\u0026#34;flv_pause()\u0026#34;\u0026gt;æš‚åœ\u0026lt;/button\u0026gt; \u0026lt;button onclick=\u0026#34;flv_destroy()\u0026#34;\u0026gt;åœæ­¢\u0026lt;/button\u0026gt; \u0026lt;input style=\u0026#34;width:100px\u0026#34; type=\u0026#34;text\u0026#34; name=\u0026#34;seekpoint\u0026#34; /\u0026gt; \u0026lt;button onclick=\u0026#34;flv_seekto()\u0026#34;\u0026gt;è·³è½¬\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.bootcdn.net/ajax/libs/flv.js/1.5.0/flv.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; var player = document.getElementById(\u0026#39;videoElement\u0026#39;); if (flvjs.isSupported()) { var flvPlayer = flvjs.createPlayer({ type: \u0026#39;flv\u0026#39;, isLive: true, enableWorker:true, enableStashBuffer:false, stashInitialSize:128, url: \u0026#39;http://ä½ çš„ip/live?port=1935\u0026amp;app=http_flv\u0026amp;stream=test\u0026#39;, }); flvPlayer.attachMediaElement(videoElement); flvPlayer.load(); flv_start(); } function flv_start() { player.play(); } function flv_pause() { player.pause(); } function flv_destroy() { player.pause(); player.unload(); player.detachMediaElement(); player.destroy(); player = null; } function flv_seekto() { player.currentTime = parseFloat(document.getElementsByName(\u0026#39;seekpoint\u0026#39;)[0].value); } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç‚¹å‡»å¼€å§‹æ’­æ”¾ï¼Œæ­¤æ—¶ä½ å·²ç»å¯ä»¥çœ‹åˆ°é¡µé¢ä¸Šå‘ˆç°äº†ï¼\nè¿™é‡Œè¿˜è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœä½ ä¿®æ”¹äº†ä¸»æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ˆæ¯”å¦‚80åˆ°8080ï¼‰ï¼Œ\nä½ éœ€è¦ä¿®æ”¹ 'http://ä½ çš„ip/live?port=1935\u0026amp;app=http_flv\u0026amp;stream=test'\nä¸º 'http://ä½ çš„ip:æ–°ç«¯å£/live?port=1935\u0026amp;app=http_flv\u0026amp;stream=test'\nåˆ‡è®°åˆ‡è®°\nReference rtmpã€http-flvè§†é¢‘ç›´æ’­ä»¥åŠé…åˆè§†é¢‘å¤„ç†ç®—æ³•çš„å®ç°\nhttps://zhuanlan.zhihu.com/p/375548523\nFFmpeg + nginx-http-flv-module + flv.js å®ç°è§†é¢‘æµæ’­æ”¾\nhttps://hasaik.com/posts/358f95d9.html\nä¸ä¾èµ–flashrtspæµé€šè¿‡ffmpeg+nginx-http-flvè½¬æˆrtmpä»¥åŠhttp-flvæµå¹¶é€šè¿‡flv.jsåœ¨é¡µé¢æ’­æ”¾(é™„å¸¦æ‰€ç”¨çš„å·¥å…·ä¸‹è½½)\nhttps://www.361shipin.com/blog/1542511538894536704\n","date":"2022-10-14T17:56:50+08:00","permalink":"https://sanbuphy.github.io/p/%E5%88%A9%E7%94%A8nginx%E7%9A%84%E8%BD%AC%E6%8E%A8%E6%B5%81http-flv/","title":"åˆ©ç”¨Nginxçš„è½¬æ¨æµhttp-flv"},{"content":"å‰è¨€ï¼š æ•´ä¸ªæ¢ç´¢è¿‡ç¨‹æºäºä¸¤å¥è¯ï¼š\n1ã€è®¡ç®—æœºä¸–ç•Œæ²¡æœ‰é­”æ³•ï¼Œæœºå™¨æ°¸è¿œæ˜¯å¯¹çš„ï¼Œè®©è‡ªå·±èˆ’æœæ‰ä¼šæœ‰åŠ¨åŠ›ï¼ˆæ¯”å¦‚è°ƒè¯•ï¼‰â€”â€”jyy\n2ã€ä»ä»Šå¤©å¼€å§‹, ä¸è¦å·æ‡’äº†ï¼›RTFM + STFW â€”â€”yzh\nstackoverflowçœŸå¿ƒæ•‘å¤§å‘½- -\nä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ubuntu20.04ç³»ç»Ÿç¯å¢ƒï¼Œæœ€å¥½ä½¿ç”¨ubuntu22.04ï¼ˆè¿™ä¸ªå¯ä»¥çœå»ç¬¬å››æ­¥ï¼‰ï¼Œè€Œä¸”åœ¨20ä¸Šä¸èƒ½æ˜¾ç¤ºcsrå¯„å­˜å™¨ï¼Œ22ä¸Šå¯ä»¥å®Œç¾è§‚å¯Ÿmepcç­‰ç­‰ã€‚\nç»è¿‡æˆ‘çš„å……åˆ†æµ‹è¯•ï¼ˆåŒ…æ‹¬æµ‹è¯•äº†äº‘æœåŠ¡å™¨ï¼‰ï¼Œæœ€å¥½çš„ä½“éªŒæ˜¯22.04ç‰ˆæœ¬çš„ubuntuï¼ˆwslå’Œè™šæ‹Ÿæœºéƒ½å¯ä»¥ï¼‰ã€‚\nå¦‚æœä½ æƒ³ç”¨ubuntu20å®Œæˆä¹Ÿå¯ä»¥ï¼Œåªè¦åœ¨æƒ³è¦çœ‹csrç›¸å…³å¯„å­˜å™¨çš„æ—¶å€™å…³é—­xmlï¼ˆç¬¬å››æ­¥æåˆ°çš„target xmlï¼‰å°±å¯ä»¥ç”¨gdbå‘½ä»¤æ‰“å°å‡ºç›¸å…³csræˆ–è®¾ç½®ç›‘è§†ç‚¹ï¼ˆç›‘è§†ç‚¹åé¢åŠ ä¸Š,xå¯ä»¥å˜æˆåå…­è¿›åˆ¶å¦‚$mepc,xï¼‰ã€‚å¦‚æœå¼€å¯xmlåªèƒ½çœ‹åˆ°åŸºç¡€çš„32ä¸ªå¯„å­˜å™¨ï¼Œå¹¶ä¸”ä¸èƒ½ç”¨ç›‘è§†ç‚¹å’Œæ‰“å°å‡ºcsrå¯„å­˜å™¨çš„ç›¸å…³å†…å®¹ï¼Œä½†è¿™ä¹Ÿè¶³å¤Ÿé™ªä¼´ä½ ä¸€æ®µæ—¶é—´äº†ã€‚\nâ€œGet out of your comfort zone.â€ ä¸è¦æƒ§æ€•è°ƒè¯•ä»»ä½•ä¸€éƒ¨åˆ† ä¸€å®šè¦ç›¸ä¿¡æ˜¯å¯ä»¥ä¼˜é›…åœ°åšåˆ°çš„ ä¸€ã€å‡†å¤‡å·¥ä½œ ğŸ’¡ä¸ºäº†èƒ½æœ‰ä¸€ä¸ªæµç•…æ„‰å¿«çš„æ—…é€”ï¼Œä½ åº”è¯¥æ‹¥æœ‰å¹¶å®‰è£…ä»¥ä¸‹ä¾èµ–ç¨‹åº: 1ã€https://pdos.csail.mit.edu/6.828/2021/tools.html\næ¥ä¸‹æ¥æˆ‘ä»¬å¯èƒ½ä¼šåå¤ä½¿ç”¨â€œæ ¹ç›®å½•â€ï¼Œä»–çš„æ„æ€æ˜¯ç›´æ¥åœ¨xv6-labs-2021æ–‡ä»¶å¤¹ä¸‹è¿›è¡Œæ“ä½œã€‚\nğŸ’¡æ³¨æ„ï¼šå¦‚æœä½ æƒ³è¦ç”¨vscodeè¿œç¨‹è°ƒè¯•æœåŠ¡å™¨ä¸Šçš„xv6ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªé“¾æ¥çš„æ•™ç¨‹\nhttp://hitsz-cslab.gitee.io/os-labs/remote_env_gdb/\näºŒã€ç¬¬ä¸€æ¬¡è¿è¡Œ ğŸ’¡ 1ã€ä½ éœ€è¦æ ¹æ®lab0ï¼šhttps://pdos.csail.mit.edu/6.828/2022/labs/util.html æˆåŠŸåœ¨å‘½ä»¤è¡Œè¿è¡Œqemu 2ã€æ ¹æ®åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º.vscodeæ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»ºå¦‚ä¸‹å†…å®¹çš„ä¸¤ä¸ªæ–‡ä»¶ï¼šlaunch.jsonã€tasks.json 3ã€ä¿®æ”¹.gdbinit.tmpl-riscvæ–‡ä»¶å†…å®¹ 4ã€ç”¨è™”è¯šçš„å¿ƒæ€æŒ‰ä¸‹é”®ç›˜ä¸Šçš„F5\n//launch.json { \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;debug xv6\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;cppdbg\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;program\u0026#34;: \u0026#34;${workspaceFolder}/kernel/kernel\u0026#34;, \u0026#34;args\u0026#34;: [], \u0026#34;stopAtEntry\u0026#34;: true, \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34;, \u0026#34;miDebuggerServerAddress\u0026#34;: \u0026#34;127.0.0.1:26000\u0026#34;, //è¿™é‡Œå®é™…ä¸Šå¯ä»¥ç”¨å„ç§èƒ½è°ƒè¯•çš„gdbï¼Œå¦‚æœæ‰¾ä¸åˆ°ä½ å¯ä»¥ä½¿ç”¨which gdb-multiarch //ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†èƒ½åœ¨ubuntu20.04è°ƒå‡ºå¯„å­˜å™¨ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨riscv64çš„gdb \u0026#34;miDebuggerPath\u0026#34;: \u0026#34;/usr/bin/gdb-multiarch\u0026#34;, \u0026#34;environment\u0026#34;: [], \u0026#34;externalConsole\u0026#34;: false, \u0026#34;MIMode\u0026#34;: \u0026#34;gdb\u0026#34;, \u0026#34;preLaunchTask\u0026#34;: \u0026#34;xv6build\u0026#34;, \u0026#34;setupCommands\u0026#34;: [ { \u0026#34;description\u0026#34;: \u0026#34;pretty printing\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;-enable-pretty-printing\u0026#34;, \u0026#34;ignoreFailures\u0026#34;: true, }, ], //ç”¨äºgdbè°ƒè¯•çš„å·¥å…·ï¼Œå¯ä»¥å‘ç°gdbå‡ºé”™çš„åŸå›  // \u0026#34;logging\u0026#34;: { // \u0026#34;engineLogging\u0026#34;: true, // \u0026#34;programOutput\u0026#34;: true, // } } ] } // tasks.json { \u0026#34;version\u0026#34;: \u0026#34;2.0.0\u0026#34;, \u0026#34;tasks\u0026#34;: [ { \u0026#34;label\u0026#34;: \u0026#34;xv6build\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;shell\u0026#34;, \u0026#34;isBackground\u0026#34;: true, \u0026#34;command\u0026#34;: \u0026#34;make qemu-gdb\u0026#34;, \u0026#34;problemMatcher\u0026#34;: [ { \u0026#34;pattern\u0026#34;: [ { \u0026#34;regexp\u0026#34;: \u0026#34;.\u0026#34;, \u0026#34;file\u0026#34;: 1, \u0026#34;location\u0026#34;: 2, \u0026#34;message\u0026#34;: 3 } ], \u0026#34;background\u0026#34;: { \u0026#34;beginsPattern\u0026#34;: \u0026#34;.*Now run \u0026#39;gdb\u0026#39; in another window.\u0026#34;, // è¦å¯¹åº”ç¼–è¯‘æˆåŠŸå,ä¸€å¥echoçš„å†…å®¹. æ­¤å¤„å¯¹åº” Makefile Line:170 \u0026#34;endsPattern\u0026#34;: \u0026#34;.\u0026#34; } } ] } ] } éƒ½åˆ›å»ºåæˆ‘ä»¬å‘ç°ç›´æ¥F5ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯.gdbinitä¸­çš„target remoteé—®é¢˜ï¼Œä¸ºäº†è§£å†³æˆ‘ä»¬ç›´æ¥ä¿®æ”¹.gdbinit.tmpl-riscvæ–‡ä»¶å†…å®¹ï¼ˆä»makefileä¸­æˆ‘ä»¬èƒ½å¤ŸçŸ¥é“æ˜¯ä»–åˆ›é€ äº†.gdbinitï¼‰\nç„¶åmake cleanå†æ¬¡f5åå³å¯å‘ç°ä»–å®‰é™çš„åœåœ¨äº†mainï¼\nä¸‰ã€è¿è¡Œç”¨æˆ·ç¨‹åº ğŸ’¡ æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å³å¯å¾—åˆ°ç»“æœï¼Œæˆ–è€…å‚è€ƒjyyçš„æ–¹æ³•ï¼šhttps://jyywiki.cn/OS/2022/slides/18.slides#/2/2\nåœ¨å‚è€ƒâ€œMIT 6.S081 xv6è°ƒè¯•ä¸å®Œå…¨æŒ‡åŒ—â€åæˆåŠŸæ‰¾åˆ°äº†æœ€ç®€å•çš„æ–¹æ³•ï¼Œå½“æˆ‘ä»¬ç›´æ¥f5ç‚¹äº®åï¼Œå…ˆä¸è¦åšä»»ä½•æ“ä½œï¼Œæˆ‘ä»¬ä»¥lsç¨‹åºä¸ºä¾‹ï¼Œé¦–å…ˆè¿›å…¥ls.cçš„mainå¤„æ‰“ä¸‹æ–­ç‚¹ï¼ˆä¸€å®šè¦åœ¨mainæœ‰ï¼‰\næ­¤æ—¶çš„æ–­ç‚¹æ˜¯æ²¡æœ‰ç”Ÿæ•ˆçš„ï¼Œæˆ‘ä»¬åœ¨å·¦ä¸‹è§’çš„æ–­ç‚¹ä¹Ÿå¯ä»¥çœ‹åˆ°ä»–æ˜¯ç°è‰²çš„ï¼š\næ¥ä¸‹æ¥æˆ‘ä»¬åœ¨è°ƒè¯•æ§åˆ¶å°è¾“å…¥-exec file ./user/_ls ï¼ˆä»–çš„ç›¸å¯¹åœ°å€ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å‘ç°ä»–è¯»å–åˆ°äº†ç¬¦å·è¡¨ä¿¡æ¯ï¼š\nè®©æˆ‘ä»¬æŒ‰ä¸‹â€œæ’­æ”¾â€è®©ç¨‹åºè·‘åˆ°è¾“å…¥å¤„ï¼Œç„¶ååœ¨ç»ˆç«¯è¾“å…¥lså¹¶å›è½¦ï¼Œä½ ä¼šå‘ç°ä»–å·²ç»åœåœ¨äº†ç”¨æˆ·ç¨‹åºä¸­ï¼Œä¹Ÿå¯ä»¥è¿›å…¥æ±‡ç¼–æ–‡ä»¶ï¼š\næ­¤æ—¶å·²ç»å¯ä»¥æ„‰å¿«çš„è°ƒè¯•ç”¨æˆ·ç¨‹åºäº†~ä½ å¯ä»¥å‚è€ƒreference1ä¸­çš„ä¸å®Œå…¨æŒ‡åŒ—ï¼Œç”¨vscodeå°è¯•è°ƒè¯•ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åºã€‚\nå¦‚æœä½ å‘ç°è¿™lsåœæ­¢è¿˜æ²¡æœ‰æˆåŠŸï¼Œè¯·æŒ‰ç…§ç±»ä¼¼çš„æ­¥éª¤å…ˆåœåœ¨initï¼Œå†å°è¯•åœåœ¨lsï¼ˆå…·ä½“ä»€ä¹ˆæ˜¯initè¯·RTSCï¼‰\nå››ã€æ¢å¤å¯„å­˜å™¨æ˜¾ç¤º é€šå¸¸æ¥è¯´ï¼Œå½“æˆ‘ä»¬æ‰“å¼€äº†vscodeï¼Œå·¦è¾¹éƒ½åº”è¯¥æ˜¾ç¤ºå‡ºå¯„å­˜å™¨ä¿¡æ¯ï¼š\nä½†å¦‚æœæˆ‘ä»¬åœ¨ubuntu20.04ä¸­æ‰“å¼€è°ƒè¯•åï¼Œä¼šæƒŠå¥‡çš„å‘ç°ï¼Œå®Œå…¨æ²¡æœ‰æ˜¾ç¤ºï¼\nvscodeæ²¡æœ‰å¯„å­˜å™¨ï¼Œè¿™å®Œå…¨ä¸èƒ½å¿ï¼å¿ƒæ€ä¸€å¼€å§‹å°±æœ‰ç‚¹å°å´©äº†ï¼Œä¸è¿‡åˆ«ç€æ€¥ï¼Œè®©æˆ‘ä»¬å…ˆæ‰“å¼€ä½äºlaunchçš„gdbæ—¥å¿—çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼š\næ—¥å¿—å‘Šè¯‰æˆ‘ä»¬æœ‰ä¸ªå«åšustatusçš„å¯„å­˜å™¨æ— æ³•æ˜¾ç¤ºï¼Œåº”è¯¥æ˜¯gdbä¸æ”¯æŒï¼ˆç„¶è€Œæˆ‘ä»¬ä¹Ÿç¡®å®åªè§è¿‡mstatus\u0026hellip;ï¼‰é‚£ä¹ˆå…³é”®çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªregisteré—®é¢˜ã€‚\nï¼ˆæˆ‘è¿˜å°è¯•ä¿®æ”¹äº†å„ç§makefileç­‰ç­‰ã€‚ã€‚ã€‚ä½†å¹¶æœªå¥æ•ˆï¼Œå®é™…ä¸Šå’Œé—®é¢˜æ— å…³æ•…ä¸å†é‡å¤è¯´æ˜ï¼‰\n4.1æœ‰å…³gdbç‰ˆæœ¬çš„å‘é—®é¢˜ï¼ˆå¹¶éè§£å†³æ–¹æ³•ï¼‰ ç»è¿‡ä¸€é¡¿æœç´¢ï¼Œæˆ‘å‘ç°æœ‰äººä¹Ÿé‡åˆ°äº†ç±»ä¼¼çš„E14é”™è¯¯é—®é¢˜ï¼Œä»–è¯´è¦æ›´æ–°gdbï¼Œä½†æˆ‘ä»¬ä»”ç»†ä¸€æƒ³ï¼Œåœ¨ubuntu20ç‰ˆæœ¬ä¸‹çš„è½¯ä»¶æºåªæœ‰9ç‰ˆæœ¬çš„gdbï¼Œå“ªæ¥çš„12ï¼Ÿï¼ˆ22ä¸Šå®Œç¾è¿è¡Œçš„gdbç‰ˆæœ¬æ˜¯12ï¼‰\nè€Œä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡-exec show versionå‘ç°æ­¤æ—¶è¿è¡Œçš„gdbç¡®å®æ˜¯9ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ç†ç”±ç›¸ä¿¡è¿™ç¡®å®æ˜¯gdbçš„é—®é¢˜ã€‚\næå‰å¸è½½äº†gdbåŠå…¶gdb-multiarchå¹¶ä¸€é¡¿æ“ä½œçŒ›å¦‚è™æ‰¾åˆ°äº†gdbçš„æºç ï¼š\nhttps://www.sourceware.org/gdb/\néšä¾¿æ‰¾äº†ä¸ªæ•™ç¨‹ç¼–è¯‘åçœ‹äº†ä¸€ä¸‹gdb -vä»¥åŠgdb-multiarch -véƒ½æ²¡æœ‰å®‰è£…ã€‚ã€‚å¿ƒæ€åˆä¸å¥½äº†\nå¥½é‚£å’±ä»¬æ¢ä¸ªæ–¹æ³•ç¼–è¯‘ä¸€ä¸‹ï¼Œä¸€é¡¿æ“ä½œçŒ›å¦‚è™æ‰¾åˆ°äº†riscv64-unknown-elf-gdbï¼š\nhttp://rcore-os.cn/rCore-Tutorial-deploy/docs/pre-lab/gdb.html\nä¸€é¡¿æ“ä½œç¼–è¯‘åï¼ˆè®°å¾—ä¿®æ”¹launchï¼‰è¿˜æ˜¯ä¸è¡Œ\u0026hellip;..å¼€å§‹æ€€ç–‘äººç”Ÿäº†ï¼Œè€æ¿ä½ è¿™rvæ˜¯ä¸æ˜¯å‡çš„å•Šï¼Ÿ\nçªç„¶æƒ³åˆ°ustatuså¥½åƒç¡®å®æ²¡æœ‰åœ¨rvå‡ºç°è¿‡ï¼Œé‚£çœ‹æ¥ä¸èƒ½é”™æ€ªä»–ï¼Œä¹Ÿè®¸æ˜¯qemuä¹‹ç±»çš„é…ç½®é—®é¢˜ã€‚\næ­¤æ—¶æˆ‘å†æ¬¡æŒ‰ç…§è¿™ä¸ªå¸–å­æåˆ°çš„é—®é¢˜è¿›è¡Œç¼–è¯‘make CXXFLAGS=\u0026quot;-static-libstdc++\u0026quot;ï¼šï¼ˆå…¶å®åé¢å‘ç°ä¸éœ€è¦é™æ€ç¼–è¯‘ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰\nhttps://stackoverflow.com/questions/32773255/how-to-update-gdb-to-most-current-stable-version\næ­¤æ—¶å¯ä»¥å‘ç°gdbç‰ˆæœ¬æˆåŠŸæ˜¾ç¤ºä¸ºgdb 12ä½†æ˜¯ä»ç„¶æ²¡æœ‰gdb-multiarchï¼Œä¹Ÿæ— æ³•ç›´æ¥å§è¿™ä¸ªç‰ˆæœ¬çš„gdbåŠ å…¥åˆ°launchä¾›vscodeä½¿ç”¨ã€‚äºæ˜¯æˆ‘ä»¬éœ€è¦å†æ¢ä¸€ä¸ªç¼åˆæ€ªçš„gdbï¼ˆæˆ‘åé¢å‘ç°gdbå…¶å®å¯ä»¥åŒ…å«å„ç§æ¶æ„ä¹Ÿå¯ä»¥åˆ‡æ¢ï¼‰\næ­¤æ—¶æˆ‘æ‰“ç®—å°†gdbæ›´æ–°åˆ°ä¸22åŒæ­¥çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å‘ç°Ubuntu22ç‰ˆæœ¬ä¸­çš„gdbæ‰“å°ç‰ˆæœ¬æ˜¯ä¸ä¼šå‡ºç°â€”target=riscvä¹‹ç±»å­—æ ·çš„ï¼Œåªæœ‰gnu-linuxã€‚æ‰€ä»¥æˆ‘å†ä¸€æ¬¡å°è¯•ç¼–è¯‘å®Œæ•´çš„gdbï¼ŒåŠ ä¸Šäº†--enable-targets=allï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥æ›´æ¢launchçš„gdbä¸ºgdbäº†ï¼ˆä¹‹å‰åªèƒ½gdb-multiarchæˆ–è€…riscv64ï¼Œç°åœ¨çš„gdbæ˜¯èåˆäº†å„ç§æ¡†æ¶çš„è¶…çº§ç¼åˆæ€ªï¼‰ï¼Œè¿›å»åå†æ¬¡è§‚å¯Ÿå¯„å­˜å™¨\u0026hellip;\u0026hellip;..è¿˜æ˜¯ä¸€ç‰‡ç©ºç™½\nåˆå¼€å§‹æ€€ç–‘äººç”Ÿäº†ï¼Œè¯´å¥½çš„gdbç‰ˆæœ¬å‘¢ï¼Ÿç—›å®šæ€ç—›åç›´æ¥æ”¾å¼ƒäº†è¿™ä¸ªé—®é¢˜è§£å†³è·¯çº¿ï¼Œè®©æˆ‘ä»¬å›åˆ°æœ€å¼€å§‹çš„åœ°æ–¹â€”â€”åˆ°åº•é‚£ä¸ªå¥‡æ€ªçš„é—®é¢˜æ˜¯æ€ä¹ˆå‡ºç°çš„ï¼Ÿ\n4.2ç›´æ¥è§£å†³é—®é¢˜ ğŸ’¡å¤ªé•¿ä¸çœ‹ç‰ˆï¼š 1ã€F5è¿è¡Œæƒ…å†µä¸‹åœ¨è°ƒè¯•æ§åˆ¶å°ä¸­è¾“å…¥-exec maintenance print xml-tdesc ï¼Œå®Œæ•´å¤åˆ¶è¾“å‡ºçš„å†…å®¹åå­˜æ”¾åœ¨æ ¹ç›®å½•ä¸‹çš„myxml.xmlæ–‡ä»¶å¤¹ä¸‹ï¼ˆåå­—ä¹Ÿå¯ä»¥çœ‹ä½ å–œæ¬¢ä¿®æ”¹ï¼‰\n2ã€ä¿å­˜æ–‡ä»¶å¹¶ç»“æŸè°ƒè¯•ï¼Œåœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œmake clean 3ã€ä¿®æ”¹launch.jsonä¸ºï¼š\n{ \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;debug xv6\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;cppdbg\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;program\u0026#34;: \u0026#34;${workspaceFolder}/kernel/kernel\u0026#34;, \u0026#34;args\u0026#34;: [], \u0026#34;stopAtEntry\u0026#34;: true, \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34;, \u0026#34;miDebuggerServerAddress\u0026#34;: \u0026#34;127.0.0.1:26000\u0026#34;, //çœ‹ä½ å–œæ¬¢å¯ä»¥ä¿®æ”¹æˆä»€ä¹ˆèƒ½ç”¨çš„gdbï¼Œä¸ºäº†é˜²æ­¢å¥‡æ€ªç°è±¡æˆ‘é€‰æ‹©äº†rv \u0026#34;miDebuggerPath\u0026#34;: \u0026#34;/usr/local/bin/riscv64-unknown-elf-gdb\u0026#34;, \u0026#34;environment\u0026#34;: [], \u0026#34;externalConsole\u0026#34;: false, \u0026#34;MIMode\u0026#34;: \u0026#34;gdb\u0026#34;, \u0026#34;preLaunchTask\u0026#34;: \u0026#34;xv6build\u0026#34;, \u0026#34;setupCommands\u0026#34;: [ { \u0026#34;description\u0026#34;: \u0026#34;pretty printing\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;-enable-pretty-printing\u0026#34;, \u0026#34;ignoreFailures\u0026#34;: true, }, //åœ¨è¿™é‡ŒåŠ è½½äº†å¯„å­˜å™¨ä¿¡æ¯è¡¨ { \u0026#34;text\u0026#34;: \u0026#34;set tdesc filename myxml.xml\u0026#34;, } ], //ç”¨äºgdbè°ƒè¯•çš„å·¥å…·ï¼Œå¯ä»¥å‘ç°gdbå‡ºé”™çš„åŸå›  // \u0026#34;logging\u0026#34;: { // \u0026#34;engineLogging\u0026#34;: true, // \u0026#34;programOutput\u0026#34;: true, // } } ] } 3ã€F5è¿è¡Œåå‘ç°å·²ç»å®‰é™çš„åœåœ¨mainï¼Œæ­¤æ—¶ä½ ä¼šå‘ç°å¯„å­˜å™¨æ¢å¤äº† 4ã€ä¸ºäº†å®šåˆ¶åŒ–xmlï¼Œä½ å¯ä»¥ä¿®æ”¹å†…éƒ¨ç»“æ„ä½†è¦éµå®ˆregnumæ’åºï¼Œå…·ä½“è¯·è‡ªè¡Œå°è¯•\nèŠ±äº†æ›´å¤šæ—¶é—´æœç´¢logä¸­æåˆ°çš„ç›¸å…³å…³é”®è¯ï¼Œæœ€åé”å®šäº†ä¸€ä¸ªå¸–å­ï¼šhttps://stackoverflow.com/questions/72759791/why-does-gdb-do-not-show-all-risc-v-csrs-when-debugging-bare-metal-program-runniï¼ˆéå¸¸å…³é”®çš„å¸–å­ä¸ç„¶è¦èŠ±æ›´å¤šæ—¶é—´ææ˜ç™½ï¼‰\næˆ‘ä¸€ç›´åœ¨æ€è€ƒæ€ä¹ˆæ‰èƒ½\u0026quot;hack\u0026quot;gdbï¼Œä¹Ÿå°±æ˜¯è®©ä»–ä¸å»è¯»å–é‚£ä¸ªå¯„å­˜å™¨çš„ä¿¡æ¯ï¼ˆæ¯•ç«Ÿgdbåªæ˜¯ä¸€ä¸ªç¨‹åºï¼æ˜¯ç¨‹åºå°±å¯ä»¥æ”¹ï¼‰ï¼Œåœ¨è¿™ä¸ªå¸–å­æˆ‘æ‰¾åˆ°äº†æ½œåœ¨çš„è§£å†³æ–¹æ³•ã€‚æˆ‘ä»¬é€šè¿‡-exec maintenance print xml-tdescæˆåŠŸåœ¨vscodeçœ‹åˆ°äº†xmlä¿¡æ¯ï¼Œæ ¹æ®æè¿°æˆ‘ä»¬çŸ¥é“gdbæ˜¯é€šè¿‡qemuç»™çš„xmlå¾—åˆ°å¯„å­˜å™¨ä¿¡æ¯çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªæƒ³æ³•ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ä¸åˆ©ç”¨ä»–ç»™çš„xmlè¿›è¡Œå¯„å­˜å™¨è¯»å–ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå·±çš„xmlå‘¢ï¼Ÿï¼ˆå› ä¸ºå®ƒèƒ½ä¿å­˜ï¼Œèƒ½ä¿å­˜å°±ä¸€å®šå¯ä»¥è¯»å–ï¼‰\nä¸€é¡¿æ“ä½œçŒ›å¦‚è™æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³æ–¹æ³•set tdesc filename xxxxxå…¶ä¸­xxxæ˜¯ä½ ä¿å­˜çš„xmlçš„ç›¸å¯¹åœ°å€ï¼ˆè¿™é‡Œæˆ‘ç›´æ¥å¤åˆ¶ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„xmläº†ï¼‰ã€‚åœ¨é‡Œé¢æˆ‘ä»¬å‘ç°äº†ç½ªé­ç¥¸é¦–ustatusç›´æ¥è¿›è¡Œåˆ å»æ“ä½œï¼Œç„¶åæ“æ“å°æ‰‹å¼€å§‹è¿›è¡Œè®¾ç½®å·¥ä½œã€‚\nä¸€å¼€å§‹æˆ‘å¾ˆé«˜å…´ä»–åœ¨è¿è¡Œä¸­åŠ è½½ä¸ä¼šæŠ¥é”™ï¼Œä½†å‘ç°è¿™æ ·è¿˜æ˜¯æ˜¾ç¤ºä¸äº†å¯„å­˜å™¨ï¼Œä¹Ÿè®¸ä»–è¦åœ¨å¼€å¤´ä¿®æ”¹æ‰æœ‰ç”¨ï¼Ÿäºæ˜¯æˆ‘ä¿®æ”¹äº†launchè®©ä»–åœ¨å¼€å¤´åŠ è½½\u0026hellip;\næˆåŠŸç‚¹äº®~\nè‡³æ­¤ï¼Œæˆ‘ä»¬èƒ½ç›¸å¯¹æ„‰å¿«çš„ç•…æ¸¸vscodeçš„è°ƒè¯•ä¸–ç•Œäº†ã€‚\näº”ã€ä¿®å¤æ³¨é‡Šé«˜äº® è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†bearï¼ˆå…·ä½“åŸç†å¯çœ‹jyy18è¯¾ï¼šï¼‰ï¼Œbear makeåˆ›é€ çš„compile_commands.json è¿˜éœ€è¦è®©ä»–ç”Ÿæ•ˆ\nğŸ’¡ ä½ å¯ä»¥å‚è€ƒhttps://zhangjk98.xyz/6.S081-VSCode-prepare-and-kernel-debugging/ä¸­æåˆ°çš„æ–¹æ³• ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ•™ç¨‹ï¼šhttps://simplestupidcode.github.io/post/2022062501.html\nä½ è¿˜å¯ä»¥é…åˆä½¿ç”¨ctrl+pè¾“å…¥æ–‡ä»¶è·³è½¬æ–‡ä»¶ä¸ctrl+pè¾“å…¥#åŠ ä¸Šå‡½æ•°åæŸ¥æ‰¾å‡½æ•°ç›¸åº”éƒ¨åˆ†æ¥è¾…åŠ©æŸ¥æ‰¾ ï¼ˆè¿™é‡Œç¬”è€…å°è¯•äº†ç¬¬ä¸€æ­¥clangæ²¡æœ‰å®Œå…¨è¿è¡Œï¼Œä¼šæç¤ºtypedefçš„é—®é¢˜ï¼ŒæŒ‰ç…§ç¬¬ä¸€ä¸ªåšä¸»çš„è¯´æ³•åšäº†è¿˜æ˜¯ä¸è¡Œï¼Œä½†æ˜¯å¾ˆç¥å¥‡çš„åœ¨åŠ å…¥ç¬¬äºŒä¸ªåšä¸»çš„cpp_properties.jsonåå°±å¯ä»¥è·‘èµ·æ¥äº†ä¹Ÿå¯ä»¥è·³è½¬\u0026hellip;.è®¡ç®—æœºçœŸç¥å¥‡å•Šï¼Œå¦‚æœä½ ä¸èƒ½ç”¨å…¶ä¸­çš„ä¸€ä¸ªæˆåŠŸè·³è½¬å’Œå…¼å®¹è¿è¡Œï¼Œå¯ä»¥å°è¯•ä¸¤ä¸ªéƒ½åŠ ä¸Šï¼Œç„¶åmake cleanåé‡æ–°make æˆ–è€…é‡å¯vscodeä¸clangæ’ä»¶ã€‚ï¼‰\nå…­ã€è°ƒè¯•æ§åˆ¶å°ä¸­çœç•¥exec ğŸ’¡ç›´æ¥æŒ‰ç…§ä¸‹åˆ—æ“ä½œå³å¯\nå·æ‡’è¦å·åˆ°åº•ï¼æ­¤æ—¶æˆ‘ä»¬å‘ç°æ¯æ¬¡éƒ½è¦è¾“å…¥-execè¿›è¡Œgdbæ“ä½œï¼Œè¿™æœªå…æœ‰äº›å¤ªéº»çƒ¦äº†ï¼ˆæˆ‘è§‚æ‘©äº†vscodeåœ¨githubä¸Šè¢«ä¸€ç¾¤äººé”kuangè¯„penï¼Œä¸ºäº†è®©vscodeçš„è°ƒè¯•æ§åˆ¶å°èƒ½æ›´åŠ æ¥è¿‘gdbçš„åŸç”Ÿä½“éªŒï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œï¼š\n1ã€åœ¨vscodeä¸­æœç´¢æ’ä»¶multi-command\n2ã€åœ¨.vscodeä¸­åˆ›å»ºä¸€ä¸ªsettings.jsonæ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š\n{ \u0026#34;multiCommand.commands\u0026#34;: [ { \u0026#34;command\u0026#34;: \u0026#34;multiCommand.enterExec\u0026#34;, \u0026#34;sequence\u0026#34;: [ \u0026#34;repl.action.acceptInput\u0026#34;, {\u0026#34;command\u0026#34;: \u0026#34;editor.action.insertSnippet\u0026#34;, \u0026#34;args\u0026#34;: {\u0026#34;snippet\u0026#34;: \u0026#34;-exec \u0026#34;}} ] } ] } 3ã€åˆ†åˆ«æŒ‰ä¸‹ctrl+k ctrl+s æˆ–è€…åœ¨é¦–é€‰é¡¹ä¸­æ‰“å¼€é”®ç›˜å¿«æ·æ–¹å¼è®¾ç½®ï¼Œåœ¨å³ä¸Šè§’æ‰¾åˆ°å¹¶ç‚¹å‡»ï¼š\næ­¤æ—¶èƒ½çœ‹åˆ°keybindings.jsonï¼Œç„¶åç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š\n[ { \u0026#34;key\u0026#34;: \u0026#34;enter\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;extension.multiCommand.execute\u0026#34; , \u0026#34;args\u0026#34;: { \u0026#34;command\u0026#34;: \u0026#34;multiCommand.enterExec\u0026#34; }, \u0026#34;when\u0026#34;: \u0026#34;inDebugRepl\u0026#34; }, ] æ¥ä¸‹æ¥å°±é‡æ–°å¼€å§‹è°ƒè¯•ï¼Œç„¶åä½ ä¼šæƒŠå¥‡çš„å‘ç°å›è½¦çš„æ—¶å€™å·²ç»èƒ½å¤Ÿè‡ªåŠ¨è¡¥å…¨execäº†ï¼Œä½“éªŒæ„‰å¿«ä½¿ç”¨åŸç”Ÿgdbçš„å¿«ä¹å§ï¼\nä¸ƒã€è¿½è¸ªå‡½æ•°è°ƒç”¨çš„è¸ªè¿¹ ğŸ’¡ 1ã€ä½ éœ€è¦ä¸‹è½½jyy29è¯¾ä¸­æåˆ°çš„traceï¼Œç„¶åå°†å®ƒæ”¾åœ¨ æ ¹ç›®å½•/mkfs çš„æ–‡ä»¶å¤¹ä¸‹ 2ã€å¦‚æœä½ æ˜¯ubuntu22.04ç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥è¿è¡Œgdb -ex 'source mkfs/trace.py' mkfs/mkfs å¦‚æœä½ æ˜¯ubuntu20.04ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œè¯·å‚è€ƒä¸‹æ–‡æåˆ°çš„è§£å†³æ–¹æ³• 3ï¼ˆå¯é€‰ï¼‰ã€å¦‚æœä½ æƒ³çœ‹åˆ°æ›´çŒ›çš„çŠ¶æ€æœºè¿‡ç¨‹ï¼Œä½ å¯ä»¥å‚è€ƒè¿™ä¸ªgithubçš„æ–¹æ³•\nåœ¨ä»£ç çš„æµ·æ´‹ä¸­ï¼Œç”¨è‚‰çœ¼çœ‹ä»£ç æ˜¾ç„¶æ˜¯ä¼šè¶…è½½çš„ï¼Œä¹Ÿæå…¶è€—è´¹æ—¶é—´ï¼›è¿›è¡Œè°ƒè¯•ä¸€æ­¥æ­¥çœ‹å®¹æ˜“è·³è¿‡å…³é”®æ­¥éª¤ä¸å¾—è¿”å›ï¼Œä»¤äººæ‡Šæ¼ä¸å·²ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬è·å¾—æ›´å¿«ä¹çš„debugä½“éªŒï¼Ÿâ€”â€”traceï¼Œæƒ³æƒ³çœ‹è¶…çº§æ­¦å™¨straceï¼Œitraceå§ï¼Œä»–èƒ½è®©æˆ‘ä»¬ä¸€çª¥å†…æ ¸ç”¨æˆ·æ€çš„è°ƒç”¨å¥¥ç§˜ã€‚ï¼ˆä¿—è¯è¯´å¾—å¥½ï¼Œè¯»ä»£ç ä¸å¦‚è¯»æ‰§è¡Œï¼‰\nå½“ç„¶ï¼Œå¦‚æœæƒ³è¦æ›´ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥è®©gdbç”Ÿæˆå†å²è®°å½•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ç±»ä¼¼paä¸­å®åŒ…è£¹çš„æ–¹å¼ï¼Œè‡ªå·±åšä¸€ä¸ªæ—¥å¿—å¹¶ä¿å­˜è¾“å‡ºåˆ°æ–‡æœ¬å½“ä¸­ï¼Œè¿™æ˜¯æ‰€æœ‰ç¨‹åºéƒ½é€šç”¨çš„ä¸€ç§æ–¹å¼ã€‚\næŒ‰ç…§æç¤ºçš„æ“ä½œåæˆ‘ä»¬å¾ˆè‡ªç„¶å¯ä»¥å¾—åˆ°ç»“æœï¼ˆå…¶ä»–ä»£ç å…¶å®é€»è¾‘å¥½ç†è§£ä¸€äº›ï¼Œä¸»è¦æ˜¯æ–‡ä»¶ç³»ç»Ÿå†™çš„å®åœ¨æ˜¯å¤ªé‚ªé—¨äº†ï¼‰\nä½†ä½ å¯èƒ½ä¼šæƒ³ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½è¿ç§»åˆ°å…¶ä»–åœ°æ–¹å‘¢ï¼Ÿæˆ‘åšäº†ä¸€äº›å°è¯•ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚staticçš„å‡½æ•°æ˜¾ç¤ºä¸äº†å¯¹åº”å‚æ•°ï¼Œå†…æ ¸è°ƒè¯•æ²¡æœ‰å°è¯•æˆåŠŸï¼‰ï¼Œå¦‚æœä½ æƒ³ä½“éªŒæˆ–è€…é­”æ”¹ï¼Œå¯ä»¥å‚è€ƒæ”¹è¿›æˆ‘çš„æ–¹æ³•çœ‹çœ‹èƒ½ä¸èƒ½åšçš„æ›´å¥½ï¼š\nTRACED = \u0026#39;main ls\u0026#39;.split() IGNORE = \u0026#39;buf fd\u0026#39;.split() class trace(gdb.Breakpoint): def stop(self): f, bt = gdb.selected_frame(), [] while f and f.is_valid(): if (name := f.name()) in TRACED: lvars = [f\u0026#39;{sym.name}={sym.value(f)}\u0026#39; for sym in f.block() if sym.is_argument and sym.name not in IGNORE] bt.append(f\u0026#39;\\033[32m{name}\\033[0m({\u0026#34;, \u0026#34;.join(lvars)})\u0026#39;) f = f.older() print(\u0026#39; \u0026#39; * (len(bt) - 1) + bt[0]) return False # won\u0026#39;t stop at this breakpoint gdb.execute(\u0026#39;target remote localhost:26000\u0026#39;) gdb.execute(\u0026#39;set prompt off\u0026#39;) gdb.execute(\u0026#39;set pagination off\u0026#39;) gdb.execute(\u0026#39;file ./user/_ls\u0026#39;) for fn in TRACED: trace(fn) å°†ä»£ç ä¿å­˜ä¸ºmytraceæ”¾åœ¨æ ¹ç›®å½•åæ‰§è¡Œgdb -ex 'source mytrace.py' ï¼Œç„¶ååœ¨å…¶ä»–åœ°æ–¹make qemu-gdb ï¼Œæ­¤æ—¶å‘ç°æ‰“å¼€gdbçš„ç»ˆç«¯æœ‰ååº”äº†ä½†æ²¡æœ‰å¼€å§‹ï¼Œä½ éœ€è¦è¾“å…¥cï¼Œå›è½¦åå°±å‘ç°xv6è¿è¡Œèµ·æ¥äº†ï¼Œç„¶åæŒ‰ä¸‹lsï¼Œä½ å°±å¯ä»¥çœ‹åˆ°ä»–æ‰“å°äº†å¯¹åº”çš„è°ƒç”¨æ ˆå’Œå‚æ•°äº†ï¼Œä½†è¿™ä¸ªtraceå¯¹äºlså®åœ¨æ˜¯æ€é¸¡ç”¨ç‰›åˆ€ï¼ˆå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡vscodeè°ƒè¯•å°±éå¸¸æ¸…æ¥šæµç¨‹äº†ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ›´å¤æ‚çš„æƒ…å†µï¼ˆæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸‹å†ä½¿ç”¨å®ƒã€‚ä½†ä¸ç®¡å¦‚ä½•ï¼Œæˆ‘ä»¬çš„è°ƒè¯•æ­¦å™¨åº“åˆä¸€æ¬¡å¢åŠ äº†ã€‚\n7.1 Remote \u0026lsquo;g\u0026rsquo; packet reply is too long ä½ å¯èƒ½ä¼šè§åˆ°å½¢å¦‚\u0026quot;Remote \u0026lsquo;g\u0026rsquo; packet reply is too long\u0026quot;ç›¸å…³çš„é—®é¢˜ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºgdbç‰ˆæœ¬ä¸æ”¯æŒæˆ–è€…å¤ªä½ï¼Œä½ å¯ä»¥æ›´æ”¹gdbä¸ºgdb-multiarchæˆ–è€…riscv64-unknown-elf-gdbï¼Œå¦‚æœéƒ½ä¸è¡Œï¼Œä½ éœ€è¦é‡æ–°ç¼–è¯‘å‡çº§gdbç‰ˆæœ¬ï¼Œå¯ä»¥é€‰æ‹©7.2çš„æ–¹å¼ï¼Œæˆ–è€…å‚è€ƒè¿™ä¸ªæ–¹å¼é‡æ–°ç¼–è¯‘gdbï¼šhttp://rcore-os.cn/rCore-Tutorial-deploy/docs/pre-lab/gdb.html\nå¦‚æœè¿˜ä¸èƒ½è§£å†³ï¼Œä½ å¯ä»¥å‚è€ƒè¿™é‡Œå¯¹è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ï¼šhttps://github.com/Alan-Lee123/TOSView\n7.2æµ·è±¡è¿ç®—ç¬¦ç­‰pythonä¸æ”¯æŒçš„é—®é¢˜ æ³¨æ„ï¼šä½ å¯èƒ½ä¼šåœ¨è¿™é‡Œé‡åˆ°:=è¿ç®—ç¬¦çš„é—®é¢˜ï¼Œè¿™æ˜¯ç¼–è¯‘gdbé€‰æ‹©çš„pythonå¤ªä½çš„é—®é¢˜ï¼Œä½ éœ€è¦é‡æ–°ç¼–è¯‘è¿‡gdbçš„ç‰ˆæœ¬è®©ä»–èƒ½å¤Ÿæ”¯æŒï¼š\né¦–å…ˆå‚è€ƒ4.1ä¸‹è½½gdbæºç ï¼Œç„¶åè¿›å…¥ä¸»é¡µé¢ååˆ†åˆ«è¿è¡Œ\n(è¿™ä¸ªç›¸å½“äºé€‰æ‹©èœå•ï¼Œæˆ‘é€‰æ‹©ç¼–è¯‘äº†æ”¯æŒå…¨ä½“ç³»ç»“æ„çš„gdbï¼ŒåŒæ—¶å†…ç½®pythonç‰ˆæœ¬æ˜¯3.8ï¼‰\n./configure --with-python=/usr/bin/python3.8 --enable-targets=all --enable-64-bit-bfd make -j8 sudo make install å®‰è£…æˆåŠŸåå†æ¬¡è¿è¡Œå³å¯æˆåŠŸï¼\n7.3 å‚æ•°æ˜¾ç¤º\u0026lt;optimized out\u0026gt; å¦‚æ ‡é¢˜æ‰€ç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦é™ä½ä¼˜åŒ–ç­‰çº§å°±å¥½ï¼Œåœ¨makefileä¸­æ‰¾åˆ°-o2æ”¹æˆ-o0ï¼Œå¹¶ä¸”æ³¨æ„åˆ°æœ‰å…³ç¼–è¯‘é€‰é¡¹ä¸­æœ‰-oéœ€è¦æ”¹æˆ-o2ï¼ˆæ¯”å¦‚è°ƒè¯•å†…æ ¸ä¸­çš„ï¼‰ï¼Œä¿®æ”¹åé‡æ–°ç¼–è¯‘å°±å¯ä»¥è§£å†³é—®é¢˜\nå¤–ä¼ ï¼švscodeå’Œgdbæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ é€šè¿‡ä¸€æ³¢æ¢ç´¢ï¼Œæˆ‘ä»¬å¯¹vscodeçš„è¿è¡ŒåŸç†æœ‰äº†ä¸€ç‚¹å¥½å¥‡å¿ƒï¼ˆå½“ç„¶å¯¹gdbè°ƒè¯•ä¹Ÿæœ‰ï¼Œä¸ºä»€ä¹ˆè¦tcpï¼Ÿï¼‰\næˆ‘æ‰¾åˆ°äº†è¿™äº›ç›¸å…³èµ„æ–™ï¼ˆæœ‰ç©ºå†å†™ä¸ªåšå®¢å¥½äº†ï¼‰ï¼š\nhttps://fed.taobao.org/blog/taofed/do71ct/vscode-debug-source-analyse/\nhttps://blog.csdn.net/m0_37621078/article/details/113886458\næœ‰å…³æ–­ç‚¹çš„æ•…äº‹ä¹Ÿæœ‰å¾ˆå¤šå¯ä»¥è¯´\u0026hellip;æ¯”å¦‚é€šè¿‡æ›´æ¢Int3ä¸­æ–­æŒ‡ä»¤ä½¿å¾—æ–­ç‚¹å¯ä»¥ç”Ÿæ•ˆï¼Œç­‰åˆ°ç»“æŸæ¢å¤ä¸ºåŸæ¥çš„æŒ‡ä»¤ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼˜åŒ–ç­‰çº§é«˜äº†æœ‰æ—¶å€™åœä¸ä¸‹æ¥ï¼Œå› ä¸ºæ²¡æœ‰å¯¹åº”çš„æŒ‡ä»¤å¯ä»¥æ›¿æ¢ï¼‰\nè°¢è°¢ä½ çœ‹åˆ°æœ€åï¼Œå¦‚æœæœ‰é—®é¢˜æˆ–è€…æœ‰æ›´ä¼˜é›…çš„æ–¹å¼æ¬¢è¿æå‡ºæˆ–è€…å‘é€é‚®ä»¶:\nphysicoada@gmail.com\nä¹Ÿæ¬¢è¿æ¥æˆ‘çš„githubæ¥æ‰¾æˆ‘ç©ï¼š\nhttps://github.com/sanbuphy\nReference åŸºæœ¬ç¯èŠ‚çš„æ‰“é€š MIT 6.S081 xv6è°ƒè¯•ä¸å®Œå…¨æŒ‡åŒ—ï¼ˆåŒ…å«äº†å¸¸è§é—®é¢˜ï¼‰\nhttps://www.cnblogs.com/KatyuMarisaBlog/p/13727565.html\nä»é›¶å¼€å§‹ä½¿ç”¨Vscodeè°ƒè¯•XV6ï¼ˆåŒ…å«äº†taskä¸launchï¼‰\nhttps://zhuanlan.zhihu.com/p/501901665\n6.S081çš„è°ƒè¯•å’ŒVSCodeç¯å¢ƒé…ç½®ï¼ˆä»£ç æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨ä»¥åŠé£æ ¼åŒ–ï¼‰\nhttps://zhangjk98.xyz/6.S081-VSCode-prepare-and-kernel-debugging/\nå¦‚æœgdbè°ƒè¯•æŠ¥é”™Cannot access memory at addressï¼Œä¹Ÿè®¸éœ€è¦åœ¨.gdbinit.tmpl-riscvåŠ ä¸€æ¡set riscv use-compressed-breakpoints yes\næœ‰å…³gdbé—®é¢˜çš„æ’æŸ¥ ç¼–è¯‘gdbæœ€æ–°ç‰ˆ\nhttps://stackoverflow.com/questions/32773255/how-to-update-gdb-to-most-current-stable-version\næ‰“å°å¯„å­˜å™¨ç›¸å…³xmlæ–‡ä»¶\nhttps://stackoverflow.com/questions/72759791/why-does-gdb-do-not-show-all-risc-v-csrs-when-debugging-bare-metal-program-runni\nä¿®æ”¹å¯„å­˜å™¨å®šä¹‰\nhttps://blog.csdn.net/abeldeng/article/details/80325364\næœ‰å…³vscodeé…ç½® launchçš„ä¸€äº›å‚æ•°è®²è§£\nhttps://blog.csdn.net/ZCShouCSDN/article/details/60466707\nä¼˜é›…çš„é…ç½®launch.jsonï¼š\nhttps://www.barretlee.com/blog/2019/03/18/debugging-in-vscode-tutorial/\nexecçœç•¥\nhttps://github.com/Microsoft/vscode-cpptools/issues/106#issuecomment-829008826\nå…¶ä»–\nhttps://www.lagerdata.com/articles/vscode-and-gdb\n","date":"2022-09-29T08:50:40+08:00","permalink":"https://sanbuphy.github.io/p/%E4%BC%98%E9%9B%85%E7%9A%84%E8%B0%83%E8%AF%95%E5%9C%A8vscode%E4%B8%8A%E5%AE%8C%E7%BE%8E%E8%B0%83%E8%AF%95xv6%E5%AE%8C%E7%BB%93/","title":"ä¼˜é›…çš„è°ƒè¯•â€”åœ¨vscodeä¸Šå®Œç¾è°ƒè¯•xv6ï¼ˆå®Œç»“ï¼‰"},{"content":" ä»è¿™æˆ‘è¶Šæ¥è¶Šæ„Ÿå—åˆ°ç³»ç»Ÿå¤æ‚åº¦ä¸Šå‡å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œä¹Ÿæ˜ç™½äº†æŠ½è±¡çš„æ ¹æœ¬ç›®çš„ã€‚\næŠ½è±¡æ˜¯ä¸ºäº†é™ä½å¤æ‚åº¦ï¼Œä¸ºäº†ç³»ç»Ÿèƒ½å¤Ÿæ›´å¥½çš„åšå¤§ä»¥åŠç¨³å¥å’Œæ’é”™ã€‚\nè€Œä¸”æŠ½è±¡èƒ½è®©ä½ åˆ‡æ¢ä¸åŒçš„â€œåç»­ç¨‹åºâ€è¿›è¡Œæµ‹è¯•ï¼Œç”šè‡³åœ¨å¤§æ¦‚ç‡æ­£ç¡®çš„è½½ä½“ä¸Šè¿›è¡ŒdiffæŸ¥çœ‹åˆ°åº•æ˜¯å“ªä¸€å±‚å‡ºç°äº†é—®é¢˜ï¼ˆå‚è€ƒå„ç§nativeï¼‰\nå¦‚ä½•ç›¸ä¿¡æŠ½è±¡æ˜¯å¯¹çš„ï¼Ÿâ€”â€”å¯¹æ¯ä¸€ä¸ªæŠ½è±¡å±‚å®Œæˆåçš„å……åˆ†æµ‹è¯•ã€‚\nå–„ç”¨assertæ˜¯é­”æ³•ï¼\nï¼ˆä¸ªäººèƒ½åŠ›å—é™ï¼ŒæŒ‚åœ¨äº†2é˜¶çš„æœ€åpalé˜¶æ®µã€‚ã€‚ã€‚ä¹Ÿè®¸æœ‰æœºä¼šèƒ½è¯·æ•™å¤§ä½¬è§£å†³ä¸€ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥åšç¬¬ä¸‰é˜¶æ®µäº†ï¼Œå¾ˆå¯æƒœï¼Œä½†ä¹Ÿåªèƒ½è¿™æ ·äº†ã€‚ï¼‰\nèœå¾—æ‰¿è®¤ï¼Œæˆ‘çš„èƒ½åŠ›å¯èƒ½æš‚æ—¶å°±åˆ°æ­¤ä¸ºæ­¢äº†ï¼›è¿˜æ˜¯å¾ˆæƒ³åšå®Œçš„ï¼Œä½†æ˜¯ä»æ—¶é—´æˆæœ¬å’Œèƒ½åŠ›ä¼°è®¡ä¸Šæ˜¯ä¸è¡Œäº†ã€‚ã€‚ã€‚\nç­‰ä»¥åå˜å¼ºäº†å†æŒ‘æˆ˜ä¸€æ¬¡ã€‚\n2022å¹´9æœˆ16æ—¥è®°\nä¸Šä¸‹æ–‡åˆ‡æ¢ è‡ªä»æœ‰äº†ä¸Šä¸‹æ–‡åˆ‡æ¢åï¼Œç¨‹åºä¹Ÿå°±æœ‰äº†è¿›ç¨‹çš„æ¦‚å¿µã€‚ï¼ˆä»é™æ­¢åˆ°è¿åŠ¨çš„é£è·ƒ ~~Â·ï¼‰\nå‡è®¾è¿›ç¨‹Aè¿è¡Œçš„è¿‡ç¨‹ä¸­è§¦å‘äº†ç³»ç»Ÿè°ƒç”¨, é™·å…¥åˆ°å†…æ ¸. æ ¹æ®__am_asm_trap()çš„ä»£ç , Açš„ä¸Šä¸‹æ–‡ç»“æ„(Context)å°†ä¼šè¢«ä¿å­˜åˆ°Açš„æ ˆä¸Š. åœ¨PA3ä¸­, ç³»ç»Ÿè°ƒç”¨å¤„ç†å®Œæ¯•ä¹‹å, __am_asm_trap()ä¼šæ ¹æ®æ ˆä¸Šä¿å­˜çš„ä¸Šä¸‹æ–‡ç»“æ„æ¥æ¢å¤Açš„ä¸Šä¸‹æ–‡.\nå¦‚æœæˆ‘ä»¬å…ˆä¸ç€æ€¥æ¢å¤Açš„ä¸Šä¸‹æ–‡, è€Œæ˜¯å…ˆå°†æ ˆé¡¶æŒ‡é’ˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹Bçš„æ ˆä¸Š, é‚£ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢? ç”±äºBçš„æ ˆä¸Šå­˜æ”¾äº†ä¹‹å‰Bä¿å­˜çš„ä¸Šä¸‹æ–‡ç»“æ„, æ¥ä¸‹æ¥çš„æ“ä½œå°±ä¼šæ ¹æ®è¿™ä¸€ç»“æ„æ¥æ¢å¤Bçš„ä¸Šä¸‹æ–‡. ä¸Šä¸‹æ–‡åˆ‡æ¢å…¶å®å°±æ˜¯ä¸åŒè¿›ç¨‹ä¹‹é—´çš„æ ˆåˆ‡æ¢!\nè¿›ç¨‹æ§åˆ¶å— æœ‰ä¸å°‘ä¿¡æ¯éƒ½æ˜¯è¿›ç¨‹ç›¸å…³çš„, é™¤äº†åˆšæ‰æåˆ°çš„ä¸Šä¸‹æ–‡æŒ‡é’ˆcpä¹‹å¤–, ä¸Šæ–‡æåˆ°çš„æ ˆç©ºé—´ä¹Ÿæ˜¯å¦‚æ­¤. ä¸ºäº†æ–¹ä¾¿å¯¹è¿™äº›è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯è¿›è¡Œç®¡ç†, æ“ä½œç³»ç»Ÿä½¿ç”¨ä¸€ç§å«è¿›ç¨‹æ§åˆ¶å—(PCB, process control block)çš„æ•°æ®ç»“æ„, ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªPCB. Nanos-liteä½¿ç”¨ä¸€ä¸ªè”åˆä½“æ¥æŠŠå…¶å®ƒä¿¡æ¯æ”¾ç½®åœ¨è¿›ç¨‹å †æ ˆçš„åº•éƒ¨. ä»£ç ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹åˆ†é…äº†ä¸€ä¸ª32KBçš„å †æ ˆ, å·²ç»è¶³å¤Ÿä½¿ç”¨äº†, ä¸ä¼šå‡ºç°æ ˆæº¢å‡ºå¯¼è‡´UB. åœ¨è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™, åªéœ€è¦æŠŠPCBä¸­çš„cpæŒ‡é’ˆè¿”å›ç»™CTEçš„__am_irq_handle()å‡½æ•°å³å¯, å‰©ä½™éƒ¨åˆ†çš„ä»£ç ä¼šæ ¹æ®ä¸Šä¸‹æ–‡ç»“æ„æ¢å¤ä¸Šä¸‹æ–‡.\nå†…æ ¸çº¿ç¨‹ å¯¹äºåˆšåˆšåŠ è½½å®Œçš„è¿›ç¨‹, æˆ‘ä»¬è¦æ€ä¹ˆåˆ‡æ¢åˆ°å®ƒæ¥è®©å®ƒè¿è¡Œèµ·æ¥å‘¢?? ç­”æ¡ˆå¾ˆç®€å•, æˆ‘ä»¬åªéœ€è¦åœ¨è¿›ç¨‹çš„æ ˆä¸Šäººå·¥åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ç»“æ„, ä½¿å¾—å°†æ¥åˆ‡æ¢çš„æ—¶å€™å¯ä»¥æ ¹æ®è¿™ä¸ªç»“æ„æ¥æ­£ç¡®åœ°æ¢å¤ä¸Šä¸‹æ–‡å³å¯. æˆ‘ä»¬å…ˆæŠŠNanos-liteä¸­ç›´æ¥å®šä¹‰çš„ä¸€äº›æµ‹è¯•å‡½æ•°ä½œä¸ºç¨‹åº. Nanos-liteæä¾›äº†ä¸€ä¸ªæµ‹è¯•å‡½æ•°hello_fun()(åœ¨nanos-lite/src/proc.cä¸­å®šä¹‰), æˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡, ç„¶ååˆ‡æ¢åˆ°å®ƒæ¥æ‰§è¡Œ. è¿™æ ·çš„æ‰§è¡Œæµæœ‰ä¸€ä¸ªä¸“é—¨çš„åç§°, å«\u0026quot;å†…æ ¸çº¿ç¨‹\u0026quot;(kernel thread).\nåˆ›å»ºå†…æ ¸çº¿ç¨‹çš„ä¸Šä¸‹æ–‡æ˜¯é€šè¿‡CTEæä¾›çš„kcontext()å‡½æ•° (åœ¨abstract-machine/am/src/$ISA/nemu/cte.cä¸­å®šä¹‰)æ¥å®ç°çš„, åœ¨Nanos-liteä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªcontext_kload()å‡½æ•°æ¥è¿›è¡Œè¿›ä¸€æ­¥çš„å°è£…: å®ƒä¼šè°ƒç”¨kcontext()æ¥åˆ›å»ºä¸Šä¸‹æ–‡, å¹¶æŠŠè¿”å›çš„æŒ‡é’ˆè®°å½•åˆ°PCBçš„cpä¸­\nä¸Šä¸‹æ–‡çš„åˆ›å»ºå’Œåˆ‡æ¢æ˜¯CTEçš„å·¥ä½œ, è€Œå…·ä½“åˆ‡æ¢åˆ°å“ªä¸ªä¸Šä¸‹æ–‡, åˆ™æ˜¯ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®šçš„, è¿™é¡¹ä»»åŠ¡å«åšè¿›ç¨‹è°ƒåº¦ è¿›ç¨‹è°ƒåº¦æ˜¯ç”±schedule()å‡½æ•°(åœ¨nanos-lite/src/proc.cä¸­å®šä¹‰)æ¥å®Œæˆçš„, å®ƒç”¨äºè¿”å›å°†è¦è°ƒåº¦çš„è¿›ç¨‹ä¸Šä¸‹æ–‡. å› æ­¤, æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼æ¥è®°å½•å½“å‰æ­£åœ¨è¿è¡Œå“ªä¸€ä¸ªè¿›ç¨‹, è¿™æ ·æˆ‘ä»¬æ‰èƒ½åœ¨schedule()ä¸­è¿”å›å¦ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡\næˆ‘ä»¬è®©schedule()æ€»æ˜¯åˆ‡æ¢åˆ°pcb[0]. æ³¨æ„å®ƒçš„ä¸Šä¸‹æ–‡æ˜¯é€šè¿‡kcontext()åˆ›å»ºçš„, åœ¨schedule()ä¸­æ‰å†³å®šè¦åˆ‡æ¢åˆ°å®ƒ, ç„¶ååœ¨CTEçš„__am_asm_trap()ä¸­æ‰çœŸæ­£åœ°æ¢å¤è¿™ä¸€ä¸Šä¸‹æ–‡.\nåŠªåŠ›ç†è§£äº†ä¸€ä¸‹ï¼Œç„¶åå†™äº†ä¸ªæ±‡ç¼–ï¼ŒæˆåŠŸç‚¹äº®~ï¼ˆä¸»è¦å¡åœ¨kcontexå¦‚ä½•ä¼ é€areaï¼‰\nè¿™é‡Œè¿˜è¦æ€è€ƒä¸€ä¸‹areaåˆ°åº•æ€ä¹ˆæ‰æ˜¯å¯¹çš„ã€‚å¼€å¤´åœ°å€kstack.startåº”è¯¥æ‹¿è°ï¼Ÿé‚£æ®µç©ºé—´åº”è¯¥ä»å“ªè¾¹å¼€å§‹ç•Œå®šï¼ˆè¿™ä¹Ÿæ˜¯éœ€è¦ç†è§£çš„å‘ï¼‰\nå†…æ ¸çº¿ç¨‹çš„å‚æ•° æˆ‘ä»¬æ¥åˆ›å»ºä¸¤ä¸ªå†…æ ¸çº¿ç¨‹, ç»™å®ƒä»¬ä¼ é€’ä¸åŒçš„å‚æ•°, ç„¶ååœ¨è¾“å‡ºçš„ä¿¡æ¯ä¸­æŠŠå‚æ•°ä¹Ÿä¸€åŒè¾“å‡º, è¿™æ ·æˆ‘ä»¬å°±èƒ½çœ‹åˆ°æ‰§è¡Œæµåœ¨ä¸¤ä¸ªå†…æ ¸çº¿ç¨‹ä¹‹é—´æ¥å›åˆ‡æ¢äº†! æˆ‘ä»¬åªéœ€è¦è®©kcontext()æŒ‰ç…§è°ƒç”¨çº¦å®šå°†argæ”¾ç½®åœ¨æ­£ç¡®çš„ä½ç½®, å°†æ¥hello_fun()æ‰§è¡Œçš„æ—¶å€™å°±å¯ä»¥è·å–æ­£ç¡®çš„å‚æ•°äº†.\næ„Ÿå¹è¿™ä¸ªè®¾è®¡çœŸèªæ˜~\nå®ç°ä¸Šä¸‹æ–‡åˆ‡æ¢(2) æ ¹æ®è®²ä¹‰çš„ä¸Šè¿°å†…å®¹, å®ç°ä»¥ä¸‹åŠŸèƒ½:\nä¿®æ”¹CTEçš„kcontext()å‡½æ•°, ä½¿å…¶æ”¯æŒå‚æ•°argçš„ä¼ é€’\né€šè¿‡kcontext()åˆ›å»ºç¬¬äºŒä¸ªä»¥hello_fun()ä¸ºå…¥å£çš„å†…æ ¸çº¿ç¨‹, å¹¶ä¼ é€’ä¸åŒçš„å‚æ•°\nä¿®æ”¹Nanos-liteçš„schedule()å‡½æ•°, ä½¿å…¶è½®æµè¿”å›ä¸¤ä¸ªä¸Šä¸‹æ–‡\nä½ å¯ä»¥è‡ªè¡Œçº¦å®šç”¨ä½•ç§ç±»å‹æ¥è§£æå‚æ•°arg(æ•´æ•°, å­—ç¬¦, å­—ç¬¦ä¸², æŒ‡é’ˆç­‰çš†å¯), ç„¶åä¿®æ”¹hello_fun()ä¸­çš„è¾“å‡ºä»£ç , æ¥æŒ‰ç…§ä½ çº¦å®šçš„æ–¹å¼è§£æarg. å¦‚æœä½ çš„å®ç°æ­£ç¡®, ä½ å°†ä¼šçœ‹åˆ°hello_fun()ä¼šè½®æµè¾“å‡ºä¸åŒå‚æ•°çš„ä¿¡æ¯.\nè¿™é‡Œè¦æƒ³æƒ³ï¼Œriscvç”¨ä»€ä¹ˆæ–¹æ³•ä¼ å‚å‘¢ï¼Ÿç„¶åæ€è€ƒä¸€ä¸‹ä¼šä¸ä¼šå’Œæˆ‘ä»¬ä¹‹å‰çš„æ“ä½œæœ‰æ²¡æœ‰å†²çªï¼ˆæœ¬è´¨æ˜¯æ‰§è¡Œé¡ºåºçš„é—®é¢˜ï¼Œå®é™…ä¸Šæ²¡ä»»ä½•é—®é¢˜ï¼‰\nä¸ºä»€ä¹ˆè¿™é‡Œå«åšå†…æ ¸çº¿ç¨‹ï¼Ÿæˆ‘çš„æƒ³æ³•æ˜¯å› ä¸ºä»–åœ¨nanoså†…éƒ¨è°ƒç”¨å®ç°ï¼Œå¹¶ä¸”å¯ä»¥è¾¾åˆ°å¿«é€Ÿçš„æ‰§è¡Œæµåˆ‡æ¢çš„æ•ˆæœã€‚\nåœ¨çœŸå®çš„æ“ä½œç³»ç»Ÿä¸­, å†…æ ¸ä¸­çš„å¾ˆå¤šåå°ä»»åŠ¡, å®ˆæŠ¤æœåŠ¡å’Œé©±åŠ¨ç¨‹åºéƒ½æ˜¯ä»¥å†…æ ¸çº¿ç¨‹çš„å½¢å¼å­˜åœ¨çš„. å¦‚æœä½ æ‰§è¡Œps aux, ä½ å°±ä¼šçœ‹åˆ°ç³»ç»Ÿä¸­æœ‰å¾ˆå¤šCOMMANDä¸­å¸¦æœ‰ä¸­æ‹¬å·çš„å†…æ ¸çº¿ç¨‹(ä¾‹å¦‚[kthreadd]). è€Œåˆ›å»ºå’Œæ‰§è¡Œå®ƒä»¬çš„åŸç†, ä¹Ÿæ˜¯å’Œä¸Šé¢çš„å®éªŒå†…å®¹éå¸¸ç›¸ä¼¼(å½“ç„¶å…·ä½“å®ç°è‚¯å®šä¼šæœ‰æ‰€ä¸åŒ).\næœ‰å…³ä¸€äº›è°ƒç”¨çº¦å®šï¼š\nç”¨æˆ·è¿›ç¨‹ åˆ›å»ºç”¨æˆ·è¿›ç¨‹ä¸Šä¸‹æ–‡ åœ¨PA3çš„æ‰¹å¤„ç†ç³»ç»Ÿä¸­, æˆ‘ä»¬åœ¨naive_uload()ä¸­ç›´æ¥é€šè¿‡å‡½æ•°è°ƒç”¨è½¬ç§»åˆ°ç”¨æˆ·è¿›ç¨‹çš„ä»£ç , é‚£æ—¶å€™ä½¿ç”¨çš„è¿˜æ˜¯å†…æ ¸åŒºçš„æ ˆ\næ€ä¹ˆçŸ¥é“çš„ï¼Ÿå› ä¸ºnaive_uloadè·³è½¬çš„entryæœ¬è´¨æ˜¯åœ¨nanosçš„æ—¶å€™è°ƒç”¨å‡½æ•°ï¼Œå‡ºå…¥æ ˆéƒ½åœ¨å†…éƒ¨å®Œæˆã€‚\nå¦‚æœå†…æ ¸çº¿ç¨‹å‘ç”Ÿäº†æ ˆæº¢å‡º, æ€ä¹ˆåŠ?\nå¦‚æœèƒ½æ£€æµ‹å‡ºæ¥, æœ€å¥½çš„æ–¹æ³•å°±æ˜¯è§¦å‘kernel panic, å› ä¸ºè¿™æ—¶å€™å†…æ ¸çš„æ•°æ®å·²ç»ä¸å†å¯ä¿¡, å¦‚æœå°†ä¸€ä¸ªè¢«ç ´åçš„æ•°æ®å†™å›ç£ç›˜, å°†ä¼šé€ æˆæ— æ³•æ¢å¤çš„æ¯ç­æ€§æŸå.\nå¥½æ¶ˆæ¯æ˜¯, å†…æ ¸çº¿ç¨‹çš„æ­£ç¡®æ€§å¯ä»¥ç”±å†…æ ¸å¼€å‘äººå‘˜æ¥ä¿è¯, è¿™è‡³å°‘è¦æ¯”ä¿è¯é‚£äº›æ¥è·¯ä¸æ˜çš„ç”¨æˆ·è¿›ç¨‹çš„æ­£ç¡®æ€§è¦ç®€å•å¤šäº†. è€Œåæ¶ˆæ¯åˆ™æ˜¯, å¤§éƒ¨åˆ†çš„å†…æ ¸bugéƒ½æ˜¯ç¬¬ä¸‰æ–¹é©±åŠ¨ç¨‹åºå¯¼è‡´çš„: æ ˆæº¢å‡ºç®—æ˜¯å°‘è§çš„äº†, æ›´å¤šçš„æ˜¯use-after-free, double-free, è¿˜æœ‰éš¾ä»¥æ‰æ‘¸çš„å¹¶å‘bug. è€Œé¢å¯¹æµ·é‡çš„ç¬¬ä¸‰æ–¹é©±åŠ¨ç¨‹åº, å†…æ ¸å¼€å‘äººå‘˜ä¹Ÿéš¾ä»¥é€ä¸€ä¿è¯å…¶æ­£ç¡®æ€§. å¦‚æœä½ æƒ³åˆ°ä¸€ä¸ªå¯ä»¥æå‡é©±åŠ¨ç¨‹åºä»£ç è´¨é‡çš„æ–¹æ³•, é‚£å°±æ˜¯ä¸ºè®¡ç®—æœºç³»ç»Ÿé¢†åŸŸä½œå‡ºè´¡çŒ®äº†.\nNanos-liteå’ŒNavyä½œäº†ä¸€é¡¹çº¦å®š: Nanos-liteæŠŠæ ˆé¡¶ä½ç½®è®¾ç½®åˆ°GPRxä¸­, ç„¶åç”±Navyé‡Œé¢çš„_startæ¥æŠŠæ ˆé¡¶ä½ç½®çœŸæ­£è®¾ç½®åˆ°æ ˆæŒ‡é’ˆå¯„å­˜å™¨ä¸­.\nè¿™é‡Œæˆ‘å®ç°åä¸€ç›´å‡ºä¸æ¥ã€‚ã€‚ï¼ˆé¦–å…ˆè®°å¾—ä¸èƒ½åœ¨initåŠ è½½ç¨‹åºäº†ï¼‰\næœ€åå‘ç°åŸæ¥æ˜¯å±€éƒ¨å˜é‡å’Œå…¨å±€çš„é—®é¢˜ï¼ˆæˆ‘æŠŠå‚æ•°è®¾ç½®åœ¨initï¼Œinitç»“æŸååœ¨stackä¸Šçš„å‚æ•°è‡ªåŠ¨æ²¡äº†ã€‚ã€‚ã€‚æ‰€ä»¥å°±æ‰¾ä¸åˆ°äº†ï¼‰ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ç›´æ¥ä¼ å…¥æˆ–è€…æ˜¯å…¨å±€å˜é‡\næ­¤æ—¶æœ‰ç‚¹â€œä¸€èµ·å¡â€çš„æ„Ÿè§‰ï¼Œæœ¬è´¨æ˜¯å› ä¸ºpal çš„å±å¹•ioçš„æ—¶å€™å°±åˆ‡æ¢å»è·‘helloäº†ã€‚ï¼ˆyieldï¼‰\né—®ï¼šå¦‚ä½•éªŒè¯ä»™å‰‘å¥‡ä¾ ä¼ ç¡®å®åœ¨ä½¿ç”¨ç”¨æˆ·æ ˆè€Œä¸æ˜¯å†…æ ¸æ ˆ? åªè¦è·å–palå†…éƒ¨çš„åœ°å€ä¿¡æ¯åœ¨ä»€ä¹ˆèŒƒå›´å³å¯ã€‚\nè¿˜å¥½æ£€æŸ¥äº†ä¸€ä¸‹è¿™ä¸ªï¼Œä¸€çœ‹å‘ç°æˆ‘çš„palè¿˜æ˜¯åœ¨å†…æ ¸ï¼Œç›´æ¥ç¿»è½¦- -\nåé¢æ€è€ƒäº†ä¸€ä¸‹å‘ç°åº”è¯¥æ˜¯stackåˆ†é…çš„é—®é¢˜ã€‚ã€‚è¿™ç‚¹ä¸Šè®²ä¹‰ç¡®å®ä¸éª—äºº è€è€å®å®å®ç°å°±è¡Œäº†ã€‚\nè®¤çœŸæ³¨æ„è¿™å¥è¯ï¼šâ€œç›®å‰æˆ‘ä»¬è®©Nanos-liteæŠŠheap.endä½œä¸ºç”¨æˆ·è¿›ç¨‹çš„æ ˆé¡¶, ç„¶åæŠŠè¿™ä¸ªæ ˆé¡¶èµ‹ç»™ç”¨æˆ·è¿›ç¨‹çš„æ ˆæŒ‡é’ˆå¯„å­˜å™¨å°±å¯ä»¥äº†.â€\nç”¨æˆ·è¿›ç¨‹çš„å‚æ•° æœ€é€‚åˆå­˜æ”¾å‚æ•°å’Œç¯å¢ƒå˜é‡çš„åœ°æ–¹å°±æ˜¯ç”¨æˆ·æ ˆäº†, å› ä¸ºåœ¨é¦–æ¬¡åˆ‡æ¢åˆ°ç”¨æˆ·è¿›ç¨‹çš„æ—¶å€™, ç”¨æˆ·æ ˆä¸Šçš„å†…å®¹å°±å·²ç»å¯ä»¥è¢«ç”¨æˆ·è¿›ç¨‹è®¿é—®. äºæ˜¯æ“ä½œç³»ç»Ÿåœ¨åŠ è½½ç”¨æˆ·è¿›ç¨‹çš„æ—¶å€™, è¿˜éœ€è¦è´Ÿè´£æŠŠargc/argv/envpä»¥åŠç›¸åº”çš„å­—ç¬¦ä¸²æ”¾åœ¨ç”¨æˆ·æ ˆä¸­, æŠŠå®ƒä»¬çš„å­˜æ”¾æ–¹å¼å’Œä½ç½®ä½œä¸ºå’Œç”¨æˆ·è¿›ç¨‹çš„çº¦å®šä¹‹ä¸€, è¿™æ ·ç”¨æˆ·è¿›ç¨‹åœ¨_startä¸­å°±å¯ä»¥æ ¹æ®çº¦å®šè®¿é—®å®ƒä»¬äº†.\nhttps://github.com/riscv-non-isa/riscv-elf-psabi-doc ABIæ‰‹å†Œæœ‰ä¸€èŠ‚Process Initializationçš„å†…å®¹, **é‡Œé¢è¯¦ç»†çº¦å®šäº†æ“ä½œç³»ç»Ÿéœ€è¦ä¸ºç”¨æˆ·è¿›ç¨‹çš„åˆå§‹åŒ–æä¾›å“ªäº›ä¿¡æ¯. **ä¸è¿‡åœ¨æˆ‘ä»¬çš„Project-Nç³»ç»Ÿé‡Œé¢, æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç®€åŒ–ç‰ˆçš„Process Initializationå°±å¤Ÿäº†: æ“ä½œç³»ç»Ÿå°†argc/argv/envpåŠå…¶ç›¸å…³å†…å®¹æ”¾ç½®åˆ°ç”¨æˆ·æ ˆä¸Š, ç„¶åå°†GPRxè®¾ç½®ä¸ºargcæ‰€åœ¨çš„åœ°å€.\nè¿™é‡Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ•°ç»„ä¸€æ—¦ä½œä¸ºå‚æ•°ä¼ å…¥åå°±é€€åŒ–æˆäº†æŒ‡é’ˆï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½æ±‚å¾—æ­£ç¡®çš„å¤§å°å‘¢ï¼Ÿä¸€ä¸ªæœºæ™ºçš„æ–¹å¼æ˜¯åœ¨æœ«å°¾ç•™ä¸ªNULLï¼ˆå¾ˆå¤šä¸œè¥¿éƒ½å‚è€ƒäº†è¿™ä¸ªè®¾è®¡ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥éšæ„éå†æ±‚å¾—æ•°ç»„å¤§å°äº†ã€‚\næ¯æ¬¡æ“ä½œå·®ç‚¹å¿˜è®°æ“ä½œæ ˆé¡¶å¯¼è‡´ç¿»è½¦ï¼Œä¸€é¡¿æ“ä½œçŒ›å¦‚è™å®‰æ’å¥½äº†ç”¨æˆ·æ ˆçš„ç©ºé—´çŠ¶å†µï¼ŒæˆåŠŸè·³è¿‡å¼€å¤´ã€‚ï¼ˆpalçš„ä»£ç å†™çš„ç¡®å®æ¯”è¾ƒé€šä¿—ï¼‰\nå®ç°å¸¦å‚æ•°çš„SYS_execve ç”¨æˆ·è¿›ç¨‹çš„å‚æ•°è¿˜æ˜¯åº”è¯¥ç”±ç”¨æˆ·æ¥æŒ‡å®šçš„.æœ€å¥½èƒ½æœ‰ä¸€ä¸ªæ–¹æ³•èƒ½æŠŠç”¨æˆ·æŒ‡å®šçš„å‚æ•°å‘Šè¯‰æ“ä½œç³»ç»Ÿ, è®©æ“ä½œç³»ç»Ÿæ¥æŠŠæŒ‡å®šçš„å‚æ•°æ”¾åˆ°æ–°è¿›ç¨‹çš„ç”¨æˆ·æ ˆé‡Œé¢. ä¸ºäº†å®ç°å¸¦å‚æ•°çš„SYS_execve, æˆ‘ä»¬å¯ä»¥åœ¨sys_execve()ä¸­ç›´æ¥è°ƒç”¨context_uload(). ä½†æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¦‚ä¸‹çš„ä¸€äº›ç»†èŠ‚, ä¸ºäº†æ–¹ä¾¿æè¿°, æˆ‘ä»¬å‡è®¾ç”¨æˆ·è¿›ç¨‹Aå°†è¦é€šè¿‡SYS_execveæ¥æ‰§è¡Œå¦ä¸€ä¸ªæ–°ç¨‹åºB.\nå¦‚ä½•åœ¨Açš„æ‰§è¡Œæµä¸­åˆ›å»ºç”¨æˆ·è¿›ç¨‹B?\nå¦‚ä½•ç»“æŸAçš„æ‰§è¡Œæµ?\næˆ‘ä»¬å¯ä»¥ä»æ ˆåº•(heap.end)åˆ°æ ˆé¡¶(æ ˆæŒ‡é’ˆspå½“å‰çš„ä½ç½®)åˆ—å‡ºç”¨æˆ·æ ˆä¸­çš„å†…å®¹:\nNanos-liteä¹‹å‰ä¸ºAä¼ é€’çš„ç”¨æˆ·è¿›ç¨‹å‚æ•°(argc/argv/envp)\nAä»_startå¼€å§‹è¿›è¡Œå‡½æ•°è°ƒç”¨çš„æ ˆå¸§, è¿™ä¸ªæ ˆå¸§ä¼šä¸€ç›´ç”Ÿé•¿, ç›´åˆ°è°ƒç”¨äº†libosä¸­çš„execve()\nCTEä¿å­˜çš„ä¸Šä¸‹æ–‡ç»“æ„, è¿™æ˜¯ç”±äºAåœ¨execve()ä¸­æ‰§è¡Œäº†ç³»ç»Ÿè°ƒç”¨è‡ªé™·æŒ‡ä»¤å¯¼è‡´çš„\nNanos-liteä»__am_irq_handle()å¼€å§‹è¿›è¡Œå‡½æ•°è°ƒç”¨çš„æ ˆå¸§, è¿™ä¸ªæ ˆå¸§ä¼šä¸€ç›´ç”Ÿé•¿, ç›´åˆ°è°ƒç”¨äº†SYS_execveçš„ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°\né€šè¿‡ä¸Šè¿°åˆ†æ, æˆ‘ä»¬å¾—å‡ºä¸€ä¸ªé‡è¦çš„ç»“è®º: åœ¨åŠ è½½Bæ—¶, Nanos-liteä½¿ç”¨çš„æ˜¯Açš„ç”¨æˆ·æ ˆ! è¿™æ„å‘³ç€åœ¨Açš„æ‰§è¡Œæµç»“æŸä¹‹å‰, Açš„ç”¨æˆ·æ ˆæ˜¯ä¸èƒ½è¢«ç ´åçš„. å› æ­¤heap.endé™„è¿‘çš„ç”¨æˆ·æ ˆæ˜¯ä¸èƒ½è¢«Bå¤ç”¨çš„, æˆ‘ä»¬åº”è¯¥ç”³è¯·ä¸€æ®µæ–°çš„å†…å­˜ä½œä¸ºBçš„ç”¨æˆ·æ ˆ\nå¯ä»¥è®©context_uload()ç»Ÿä¸€é€šè¿‡è°ƒç”¨new_page()å‡½æ•°æ¥è·å¾—ç”¨æˆ·æ ˆçš„å†…å­˜ç©ºé—´. new_page()å‡½æ•°åœ¨nanos-lite/src/mm.cä¸­å®šä¹‰, å®ƒä¼šé€šè¿‡ä¸€ä¸ªpfæŒ‡é’ˆæ¥ç®¡ç†å †åŒº, ç”¨äºåˆ†é…ä¸€æ®µå¤§å°ä¸ºnr_page * 4KBçš„è¿ç»­å†…å­˜åŒºåŸŸ, å¹¶è¿”å›è¿™æ®µåŒºåŸŸçš„é¦–åœ°å€. æˆ‘ä»¬è®©context_uload()é€šè¿‡new_page()æ¥åˆ†é…32KBçš„å†…å­˜ä½œä¸ºç”¨æˆ·æ ˆ, è¿™å¯¹PAä¸­çš„ç”¨æˆ·ç¨‹åºæ¥è¯´å·²ç»è¶³å¤Ÿä½¿ç”¨äº†.\næ“ä½œç³»ç»Ÿä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„AMåº”ç”¨, å¾ˆå¤šæ—¶å€™å¯¹åŠ¨æ€å†…å­˜ç”³è¯·å´æœ‰æ›´ä¸¥æ ¼çš„è¦æ±‚, ä¾‹å¦‚ç”³è¯·ä¸€æ®µèµ·å§‹åœ°å€æ˜¯4KBæ•´æ•°å€çš„å†…å­˜åŒºåŸŸ, malloc()é€šå¸¸ä¸èƒ½æ»¡è¶³è¿™æ ·çš„è¦æ±‚. å› æ­¤æ“ä½œç³»ç»Ÿä¸€èˆ¬éƒ½ä¼šè‡ªå·±æ¥ç®¡ç†å †åŒº, è€Œä¸ä¼šè°ƒç”¨klibä¸­çš„malloc(). åœ¨æ“ä½œç³»ç»Ÿä¸­ç®¡ç†å †åŒºæ˜¯MM(Memory Manager)æ¨¡å—çš„å·¥ä½œ\nä¸€å¼€å§‹ç†è§£é”™äº†ä»€ä¹ˆæ˜¯Aè¿˜ä»¥ä¸ºhelloæ˜¯Aã€‚ã€‚ã€‚ã€‚ã€‚ç„¶åè¢«æé†’åçœ‹äº†å¥½å‡ éå‘ç°åŸæ¥æ˜¯è¿™ä¸ªæ„æ€= = ï¼ˆè”ç³»ä¸€ä¸‹PAçš„ä¸Šæ–‡ï¼Œææ¸…æ¥šåˆ°åº•æ˜¯ä»€ä¹ˆè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹åœ¨å½“ä¸‹æ˜¯ä»€ä¹ˆï¼Œè¦æ¢æˆä»€ä¹ˆè¿›ç¨‹ï¼‰\nä¸€é¡¿æ“ä½œçŒ›å¦‚è™æˆåŠŸï¼š\nè¿™é‡Œè¿è¡ŒntermåˆæŒ‚äº†ï¼ˆå…¶ä»–éƒ½å¯ä»¥ï¼‰æˆ‘å“­äº†- - åˆå¼€å§‹æ’æŸ¥é—®é¢˜ï¼Œå‘ç°ä¼ å…¥argcå°±ä¼šæŒ‚ã€‚ã€‚ã€‚å…·ä½“åŸå› ä¸æ˜ï¼Œåˆè¦ç»§ç»­æ’æŸ¥ã€‚æœ€åå‘ç°æ˜¯argvé£æ‰çš„é—®é¢˜ï¼ˆæ²¡æœ‰å‚æ•°çš„æ—¶å€™å¦‚æœä¼ å…¥æŒ‡é’ˆæ‹¦ä¸ä½ï¼‰\næ€»ç»“ï¼šä½ å¿…é¡»ææ¸…æ¥šä¸Šä¸‹æ–‡æ˜¯æ€ä¹ˆä»åˆ›å»ºåˆ°è°ƒåº¦çš„å…¨è¿‡ç¨‹ï¼Œè¿™æ ·æ‰èƒ½ç†è§£å…³é”®çš„æ¯ä¸€ä¸ªç»†èŠ‚ã€‚\nè¿è¡ŒBusybox æˆ‘çš„ä¸çŸ¥é“ä¸ºå•¥é‡åˆ°äº†è‡´å‘½çš„ldé”™è¯¯ã€‚ã€‚ã€‚ã€‚æ²¡åŠæ³•è·‘\nåªèƒ½æ”¾å¼ƒäº†ï¼ˆå¾ˆç¥å¥‡çš„ldç¬¦å·ç¼ºå¤±ï¼‰\nè™½ç„¶æˆ‘åé¢æš´åŠ›è°ƒæ•´äº†æºç å¯ä»¥ç¼–è¯‘é€šè¿‡äº†- -ä½†æ˜¯åªèƒ½catä¹‹ç±»çš„åŸºç¡€åŠŸèƒ½ã€‚ã€‚ã€‚\nç„¶åä¸çŸ¥é“ä¸ºä»€ä¹ˆè®©è™šæ‹Ÿæœºèµ°äº†å‡ æ¬¡å¿«ç…§ï¼Œå°±å¯ä»¥ç”¨äº†- -åªèƒ½è¯´è®¡ç®—æœºçœŸç¥å¥‡å‘€ã€‚ã€‚ã€‚\nWCä¹Ÿå®Œç¾è¿è¡Œ~\nâ€”skipä¹ŸåŒç†å®Œç»“~ è¿™é˜¶æ®µæœ€ä¸»è¦çš„å°±æ˜¯éº»çƒ¦ã€‚ã€‚å¾ˆå¤šæ—¶å€™å¯èƒ½ä¸€ä¸å°å¿ƒargvå°±ä¼šçˆ†ç‚¸ã€‚\nç¬¬ä¸€é˜¶æ®µç»“æŸ,è¿™ä¸€é˜¶æ®µçš„å…³é”®å°±æ˜¯1ï¼šä¸Šä¸‹æ–‡æ‰§è¡Œæµæ˜¯æ€ä¹ˆä¿å­˜å’Œåˆ‡æ¢çš„ 2ï¼šæœ‰å…³å‚æ•°çš„æŒ‡é’ˆå°ç»ƒä¹ \nä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š\nç»ˆç«¯å¦‚ä½•è¯»å–ç”¨æˆ·çš„æŒ‰é”®? å„ç§ç­‰å¾…é”®ç›˜äº‹ä»¶ã€‚ã€‚ã€‚\nShellå¦‚ä½•è¿›è¡Œå‘½ä»¤çš„è§£æ? å¯ä»¥ç±»ä¼¼eval,ç„¶åè¦æ³¨æ„argvçš„ç»´æŠ¤\nåº“å‡½æ•°å¦‚ä½•æ ¹æ®å‘½ä»¤è§£æå‡ºçš„å­—ç¬¦ä¸²æœç´¢åˆ°å¯æ‰§è¡Œæ–‡ä»¶? execvpï¼Œç»´æŠ¤äº†ä¸€ä¸ªPATH\næ“ä½œç³»ç»Ÿå¦‚ä½•åŠ è½½æ‰§è¡Œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶? ç»´æŠ¤å‚æ•°è¡¨è¿›å…¥ä¸€ä¸ª_startï¼Œå¤„ç†åæ‰è¿›è¡ŒçœŸæ­£çš„mainï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢å’Œè·³è½¬ï¼‰\nç¨‹åºå’Œå†…å­˜ä½ç½®ï¼ˆå¾ˆæ„Ÿäººçš„é˜…è¯»ç¯èŠ‚ï¼‰ ç»å¯¹ä»£ç  ä¸€èˆ¬æ¥è¯´, ç¨‹åºçš„å†…å­˜ä½ç½®æ˜¯åœ¨é“¾æ¥æ—¶åˆ»(link time)ç¡®å®šçš„(Navy-appsä¸­çš„ç¨‹åºå°±æ˜¯è¿™æ ·), ä»¥å‰çš„ç¨‹åºå‘˜ç”šè‡³åœ¨ç¨‹åºä¸­ä½¿ç”¨ç»å¯¹åœ°å€æ¥è¿›è¡Œå†…å­˜è®¿é—®, è¿™ä¸¤ç§ä»£ç ç§°ä¸ºç»å¯¹ä»£ç (absolute code). ç»å¯¹ä»£ç ä¼šå‡è®¾ç¨‹åºä¸­çš„å¯¹è±¡(å‡½æ•°å’Œæ•°æ®)ä½äºæŸä¸ªå›ºå®šçš„ä½ç½®, ç»å¯¹ä»£ç åªèƒ½åœ¨å›ºå®šçš„å†…å­˜ä½ç½®æ‰èƒ½æ­£ç¡®è¿è¡Œ.\næ“ä½œç³»ç»Ÿåœ¨åŠ è½½æ—¶åˆ»åˆ†é…çš„ç©ºé—²å†…å­˜ä½ç½®, å¹¶ä¸æ€»æ˜¯èƒ½è®©è¿™ç§ç¨‹åºæ­£ç¡®è¿è¡Œ. å› æ­¤, è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ, å°±æ˜¯è®©æ“ä½œç³»ç»Ÿè®°å½•ç¨‹åºçš„åŠ è½½ä½ç½®, å½“ä¸€ä¸ªç¨‹åºè¯•å›¾åŠ è½½åˆ°ä¸€ä¸ªå·²ç»è¢«ä½¿ç”¨çš„å†…å­˜ä½ç½®æ—¶, åŠ è½½å°†ä¼šå¤±è´¥, æ“ä½œç³»ç»Ÿå°†è¿”å›ä¸€ä¸ªé”™è¯¯. ä¸ºäº†é¿å…åŠ è½½å¤±è´¥, ä¸€ä¸ªæ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªç¨‹åºç»´æŠ¤å¤šä¸ªä¸åŒåŠ è½½åœ°å€çš„ç‰ˆæœ¬, æœŸæœ›å…¶ä¸­æœ‰ä¸€ä¸ªç‰ˆæœ¬å¯ä»¥è¢«æˆåŠŸåŠ è½½.\nå¯é‡å®šä½ä»£ç  ä¸ºä»€ä¹ˆä¸€å®šè¦æå‰ç¡®å®šä¸€ä¸ªç¨‹åºçš„åŠ è½½ä½ç½®å‘¢? å¦‚æœæˆ‘ä»¬æŠŠé“¾æ¥æ—¶çš„é‡å®šä½é˜¶æ®µå¾€åæ¨è¿Ÿ, ä¸å°±å¯ä»¥æ‰“ç ´ç»å¯¹ä»£ç çš„é™åˆ¶äº†å—?\näºæ˜¯æœ‰ç¨‹åºå‘˜å¼€å‘äº†ä¸€ç±»\u0026quot;è‡ªé‡å®šä½(self-relocation)\u0026ldquo;çš„ç‰¹æ®Šç¨‹åº, è¿™ç§ç¨‹åºå¯ä»¥**åœ¨å¼€å§‹è¿è¡Œçš„æ—¶å€™, å…ˆæŠŠè‡ªå·±é‡å®šä½åˆ°å…¶å®ƒå†…å­˜ä½ç½®, **ç„¶åå†å¼€å§‹çœŸæ­£çš„è¿è¡Œ. è¿™ç§é‡å®šä½ç±»å‹ç§°ä¸º\u0026rdquo;è¿è¡Œæ—¶(run time)é‡å®šä½\u0026quot;.\nä½†å¯¹å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿæ¥è¯´, è¿™å¹¶æ²¡æœ‰çœŸæ­£è§£å†³é—®é¢˜, å› ä¸ºç¨‹åºåœ¨è¿è¡Œæ—¶åˆ»å¹¶ä¸çŸ¥é“é‡å®šä½çš„ç›®æ ‡å†…å­˜ä½ç½®æ˜¯å¦ç©ºé—².\næ—¢ç„¶åªæœ‰æ“ä½œç³»ç»Ÿæ‰çŸ¥é“å†…å­˜æ˜¯å¦ç©ºé—², é‚£å°±å¹²è„†è®©åŠ è½½å™¨æ¥è¿›è¡Œé‡å®šä½å§, äºæ˜¯æœ‰äº†\u0026quot;åŠ è½½æ—¶(load time)é‡å®šä½\u0026quot;çš„è¯´æ³•. å…·ä½“åœ°, åŠ è½½å™¨ä¼šç”³è¯·ä¸€ä¸ªç©ºé—²çš„å†…å­˜ä½ç½®, ç„¶åå°†ç¨‹åºåŠ è½½åˆ°è¿™ä¸ªå†…å­˜ä½ç½®, å¹¶æŠŠç¨‹åºé‡å®šä½åˆ°è¿™ä¸ªå†…å­˜ä½ç½®, ä¹‹åæ‰ä¼šæ‰§è¡Œè¿™ä¸ªç¨‹åº. ä»Šå¤©çš„GNU/Linuxå°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥æ’å…¥å†…æ ¸æ¨¡å—çš„.\nä½ç½®æ— å…³ä»£ç  PIC æœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥èŠ‚çœé‡å®šä½çš„å¼€é”€, ç”šè‡³ä¸è¿›è¡Œé‡å®šä½å‘¢? ä½†é“¾æ¥æ—¶çš„é‡å®šä½åˆå¯èƒ½ä¼šäº§ç”Ÿç»å¯¹ä»£ç , è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€å¸Œæœ›çš„ . å¦‚æœç¨‹åºä¸­çš„æ‰€æœ‰å¯»å€, éƒ½æ˜¯é’ˆå¯¹ç¨‹åºä½ç½®æ¥è¿›è¡Œç›¸å¯¹å¯»å€æ“ä½œ, è¿™æ ·çš„ç¨‹åºå°±å¯ä»¥è¢«åŠ è½½åˆ°ä»»æ„ä½ç½®æ‰§è¡Œ, è€Œä¸ä¼šå‡ºç°ç»å¯¹ä»£ç çš„é—®é¢˜\nè¿™å°±æ˜¯PIC(position-independent code, ä½ç½®æ— å…³ä»£ç )çš„åŸºæœ¬æ€æƒ³. ä»Šå¤©çš„åŠ¨æ€åº“éƒ½æ˜¯PIC, è¿™æ ·å®ƒä»¬å°±å¯ä»¥è¢«åŠ è½½åˆ°ä»»æ„çš„å†…å­˜ä½ç½®äº†. æ­¤å¤–, å¦‚æœä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å…¨éƒ¨ç”±PICç»„æˆ, é‚£ä¹ˆå®ƒæœ‰ä¸€ä¸ªæ–°åå­—, å«PIE(position-independent executable, ä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶). ç¼–è¯‘å™¨å¯ä»¥é€šè¿‡ç‰¹å®šçš„é€‰é¡¹ç¼–è¯‘å‡ºPIE.\nPIEä¹‹æ‰€ä»¥èƒ½åšåˆ°ä½ç½®æ— å…³, å…¶å®æ˜¯è¦ä¾èµ–äºç¨‹åºä¸­ä¸€ä¸ªå«GOT(global offset table, å…¨å±€åç§»é‡è¡¨)çš„æ•°æ®ç»“æ„\nä½†æ€»æœ‰ä¸€äº›åŒ…å«ç»å¯¹ä»£ç çš„ç¨‹åº, è€ƒè™‘åˆ°å…¼å®¹é—®é¢˜, è¿˜éœ€è¦æƒ³åŠæ³•è¿è¡Œå®ƒä»¬. æœ‰æ²¡æœ‰æ›´å¥½çš„, ä¸€åŠ³æ°¸é€¸çš„æ–¹æ¡ˆå‘¢?\nè™šå®äº¤é”™çš„é­”æ³• ç»å¯¹ä»£ç ç»è¿‡ç¼–è¯‘é“¾æ¥ä¹‹å, ç¨‹åºçœ‹åˆ°çš„å†…å­˜åœ°å€å°±ä¼šç¡®å®šä¸‹æ¥äº†, åŠ è½½è¿è¡Œçš„æ—¶å€™å°±ä¼šè®©ç¨‹åºä½¿ç”¨è¿™ä¸€å†…å­˜åœ°å€, æ¥ä¿è¯ç¨‹åºå¯ä»¥æ­£ç¡®è¿è¡Œ. ä¸€ç§å°è¯•æ˜¯æŠŠç¨‹åºçœ‹åˆ°çš„å†…å­˜å’Œå®ƒè¿è¡Œæ—¶å€™çœŸæ­£ä½¿ç”¨çš„å†…å­˜è§£è€¦å¼€æ¥. è¿™å°±æ˜¯è™šæ‹Ÿå†…å­˜çš„æ€æƒ³.\næœ‰äº†è™šæ‹Ÿå†…å­˜ä¹‹å, è¿›ç¨‹åªéœ€è¦è®¤ä¸ºè‡ªå·±è¿è¡Œåœ¨è™šæ‹Ÿåœ°å€ä¸Šå°±å¯ä»¥äº†, çœŸæ­£è¿è¡Œçš„æ—¶å€™, æ‰æŠŠè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€. æˆ‘ä»¬åªè¦**æŠŠç¨‹åºé“¾æ¥åˆ°ä¸€ä¸ªå›ºå®šçš„è™šæ‹Ÿåœ°å€, åŠ è½½çš„æ—¶å€™æŠŠå®ƒä»¬åŠ è½½åˆ°ä¸åŒçš„ç‰©ç†åœ°å€, å¹¶ç»´æŠ¤å¥½è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³», **\nå…³é”®ï¼šç¡¬ä»¶æŠŠç‰©ç†åœ°å€æ˜ å°„æˆè™šæ‹Ÿåœ°å€ï¼Œç»´æŠ¤åœ°å€æ˜ å°„åŠŸèƒ½ã€‚æ“ä½œç³»ç»Ÿå†³å®šå…·ä½“è¦æŠŠè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°å“ªäº›ç‰©ç†åœ°å€ã€‚\nè™šæ‹Ÿå†…å­˜æœºåˆ¶æ˜¯ä¸€ä¸ªè½¯ç¡¬ååŒæ‰èƒ½å·¥ä½œçš„æœºåˆ¶: æ“ä½œç³»ç»ŸåŠ è½½è¿›ç¨‹çš„æ—¶å€™å†³å®šè¦æŠŠè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°å“ªäº›ç‰©ç†åœ°å€;\nç­‰åˆ°è¿›ç¨‹çœŸæ­£è¿è¡Œä¹‹å‰, è¿˜éœ€è¦é…ç½®MMU, æŠŠä¹‹å‰å†³å®šå¥½çš„æ˜ å°„è½å®åˆ°ç¡¬ä»¶ä¸Š, è¿›ç¨‹è¿è¡Œçš„æ—¶å€™, MMUå°±ä¼šè¿›è¡Œåœ°å€è½¬æ¢, æŠŠè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿå¸Œæœ›çš„ç‰©ç†åœ°å€. ï¼ˆæ³¨æ„åˆ°è¿™ä¸ªæ˜ å°„æ˜¯è¿›ç¨‹ç›¸å…³çš„: ä¸åŒçš„è¿›ç¨‹æœ‰ä¸åŒçš„æ˜ å°„,ï¼‰\nåˆ†æ®µ MMUåœ°å€æ˜ å°„æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯, ç‰©ç†åœ°å€=è™šæ‹Ÿåœ°å€+åç§»é‡ã€‚å³æ®µå¼è™šæ‹Ÿå†…å­˜ç®¡ç†æœºåˆ¶, ç®€ç§°åˆ†æ®µæœºåˆ¶. æŠŠç‰©ç†å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªæ®µ, ä¸åŒçš„è¿›ç¨‹å°±æ”¾åˆ°ä¸åŒçš„æ®µä¸­è¿è¡Œ, è¿›ç¨‹ä¸éœ€è¦å…³å¿ƒè‡ªå·±å…·ä½“åœ¨å“ªä¸€ä¸ªæ®µé‡Œé¢, æ“ä½œç³»ç»Ÿåªè¦è®©ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„åç§»ï¼Œè¿›ç¨‹ä¹‹é—´å°±ä¸ä¼šç›¸äº’å¹²æ‰°\nMinixå°±æ˜¯è¿™æ ·å·¥ä½œçš„, ä¸€äº›ç®€å•çš„åµŒå…¥å¼ç³»ç»Ÿå’Œå®æ—¶ç³»ç»Ÿ, ä¹Ÿæ˜¯é€šè¿‡åˆ†æ®µæœºåˆ¶æ¥è¿›è¡Œè™šå­˜ç®¡ç†.\nä½†æ˜¯å¾ˆå¤æ‚+æ€§èƒ½ä¸é«˜ï¼Œå®é™…ä¸Šç°åœ¨æ²¡ä»€ä¹ˆäººç”¨è¿™ä¸ªäº†ã€‚ã€‚ã€‚ã€‚ã€‚\nè¶…è¶Šå®¹é‡çš„ç•Œé™ è¿™éƒ¨åˆ†æˆ‘çœ‹çš„æœ‰ç‚¹åƒåŠ›ï¼Œå‚è€ƒäº†ä¸€äº›å…¶ä»–èµ„æ–™ï¼š\nhttps://blog.csdn.net/jinking01/article/details/107098437\nhttps://blog.csdn.net/starter____ _/article/details/100998087\nhttps://www.cnblogs.com/wkfvawl/p/11700301.html\nä¸ºä»€ä¹ˆ Linux é»˜è®¤é¡µå¤§å°æ˜¯ 4KB\nhttps://draveness.me/whys-the-design-linux-default-page/\nå…¶ä¸­é¡µç›®å½•é¡¹å’Œé¡µè¡¨é¡¹çš„ç»“æ„æ˜¯\npresentä½è¡¨ç¤ºç‰©ç†é¡µæ˜¯å¦å¯ç”¨, ä¸å¯ç”¨çš„æ—¶å€™åˆåˆ†ä¸¤ç§æƒ…å†µ:\nç‰©ç†é¡µé¢ç”±äºäº¤æ¢æŠ€æœ¯è¢«äº¤æ¢åˆ°ç£ç›˜ä¸­äº†, Page fault\nå›¾è®¿é—®ä¸€ä¸ªæœªæ˜ å°„çš„çº¿æ€§åœ°å€, å¹¶æ²¡æœ‰å®é™…çš„ç‰©ç†é¡µä¸ä¹‹ç›¸å¯¹åº”, å°±æ˜¯ä¸€ä¸ªéæ³•æ“ä½œ\nR/Wä½è¡¨ç¤ºç‰©ç†é¡µæ˜¯å¦å¯å†™\nU/Sä½è¡¨ç¤ºè®¿é—®ç‰©ç†é¡µæ‰€éœ€è¦çš„æƒé™, å¦‚æœä¸€ä¸ªring 3çš„è¿›ç¨‹å°è¯•è®¿é—®ä¸€ä¸ªring 0çš„é¡µé¢, å½“ç„¶ä¹Ÿä¼šè¢«åˆ¤å®šä¸ºéæ³•æ“ä½œ\nåˆ†é¡µ äº‹å®ä¸Š, æˆ‘ä»¬éœ€è¦ä¸€ç§æŒ‰éœ€åˆ†é…çš„è™šå­˜ç®¡ç†æœºåˆ¶. ä¹‹æ‰€ä»¥åˆ†æ®µæœºåˆ¶ä¸å¥½å®ç°æŒ‰éœ€åˆ†é…, å°±æ˜¯å› ä¸ºæ®µçš„ç²’åº¦å¤ªå¤§äº†, ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡, æˆ‘ä»¬éœ€è¦åå…¶é“è€Œè¡Œä¹‹: æŠŠè¿ç»­çš„å­˜å‚¨ç©ºé—´åˆ†å‰²æˆå°ç‰‡æ®µ, ä»¥è¿™äº›å°ç‰‡æ®µä¸ºå•ä½è¿›è¡Œç»„ç»‡, åˆ†é…å’Œç®¡ç†. è¿™æ­£æ˜¯åˆ†é¡µæœºåˆ¶çš„æ ¸å¿ƒæ€æƒ³\nåˆ†é¡µæœºåˆ¶å¼•å…¥äº†ä¸€ä¸ªå«\u0026quot;é¡µè¡¨\u0026quot;çš„ç»“æ„, é¡µè¡¨ä¸­çš„æ¯ä¸€ä¸ªè¡¨é¡¹è®°å½•äº†ä¸€ä¸ªè™šæ‹Ÿé¡µåˆ°ç‰©ç†é¡µçš„æ˜ å°„å…³ç³», æ¥**æŠŠä¸å¿…è¿ç»­çš„ç‰©ç†é¡µé¢é‡æ–°ç»„ç»‡æˆè¿ç»­çš„è™šæ‹Ÿåœ°å€ç©ºé—´. **\næ“ä½œç³»ç»Ÿé¦–å…ˆéœ€è¦ä»¥ç‰©ç†é¡µä¸ºå•ä½å¯¹å†…å­˜è¿›è¡Œç®¡ç†. **æ¯å½“åŠ è½½ç¨‹åºçš„æ—¶å€™, å°±ç»™ç¨‹åºåˆ†é…ç›¸åº”çš„ç‰©ç†é¡µ(æ³¨æ„è¿™äº›ç‰©ç†é¡µä¹‹é—´ä¸å¿…è¿ç»­), å¹¶ä¸ºç¨‹åºå‡†å¤‡ä¸€ä¸ªæ–°çš„é¡µè¡¨, åœ¨é¡µè¡¨ä¸­å¡«å†™ç¨‹åºç”¨åˆ°çš„è™šæ‹Ÿé¡µåˆ°è¿™äº›ç‰©ç†é¡µçš„æ˜ å°„å…³ç³». **\nç­‰åˆ°ç¨‹åºè¿è¡Œçš„æ—¶å€™, æ“ä½œç³»ç»Ÿå°±**æŠŠä¹‹å‰ä¸ºè¿™ä¸ªç¨‹åºå¡«å†™å¥½çš„é¡µè¡¨è®¾ç½®åˆ°MMUä¸­, MMUå°±ä¼šæ ¹æ®é¡µè¡¨çš„å†…å®¹è¿›è¡Œåœ°å€è½¬æ¢, **æŠŠç¨‹åºçš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿæ‰€å¸Œæœ›çš„ç‰©ç†åœ°å€ç©ºé—´ä¸Š.\næ¯ä¸€å¼ é¡µç›®å½•å’Œé¡µè¡¨éƒ½æœ‰1024ä¸ªè¡¨é¡¹, æ¯ä¸ªè¡¨é¡¹çš„å¤§å°éƒ½æ˜¯4å­—èŠ‚, ï¼ˆ4kï¼‰\né™¤äº†åŒ…å«é¡µè¡¨(æˆ–è€…ç‰©ç†é¡µ)çš„åŸºåœ°å€, è¿˜åŒ…å«ä¸€äº›æ ‡å¿—ä½ä¿¡æ¯. è¦æ”¾åœ¨å¯„å­˜å™¨ä¸­æ˜¯ä¸å¯èƒ½çš„, å› æ­¤å®ƒä»¬è¦æ”¾åœ¨å†…å­˜ä¸­. ä¸ºäº†æ‰¾åˆ°é¡µç›®å½•, i386æä¾›äº†ä¸€ä¸ªCR3(control register 3)å¯„å­˜å™¨, ä¸“é—¨ç”¨äºå­˜æ”¾é¡µç›®å½•çš„åŸºåœ°å€. è¿™æ ·,** é¡µçº§åœ°å€è½¬æ¢å°±ä»CR3å¼€å§‹ä¸€æ­¥ä¸€æ­¥åœ°è¿›è¡Œ, æœ€ç»ˆå°†è™šæ‹Ÿåœ°å€è½¬æ¢æˆçœŸæ­£çš„ç‰©ç†åœ°å€, è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä¸€æ¬¡page table walk.**\næ€»ç»“ï¼šæ“ä½œç³»ç»Ÿè´Ÿè´£å†™å¥½å°çº¸æ¡å’Œåˆ†é…å…³ç³»ï¼ŒMMUè´Ÿè´£æ‰§è¡Œå°çº¸æ¡ã€‚\né—®ï¼šè™šå­˜ç®¡ç†ä¸­PICçš„å¥½å¤„ æˆ‘ä»¬ä¹‹å‰æåˆ°, PICçš„å…¶ä¸­ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å°†ä»£ç åŠ è½½åˆ°ä»»æ„å†…å­˜ä½ç½®æ‰§è¡Œ. å¦‚æœé…åˆè™šå­˜ç®¡ç†, PICè¿˜æœ‰ä»€ä¹ˆæ–°çš„å¥½å¤„å‘¢? (Hint: åŠ¨æ€åº“å·²ç»åœ¨äº«å—è¿™äº›å¥½å¤„äº†)\né—®ï¼šç†è§£åˆ†é¡µç»†èŠ‚ i386ä¸æ˜¯ä¸€ä¸ª32ä½çš„å¤„ç†å™¨å—, ä¸ºä»€ä¹ˆè¡¨é¡¹ä¸­çš„åŸºåœ°å€ä¿¡æ¯åªæœ‰20ä½, è€Œä¸æ˜¯32ä½? ç­”ï¼šé¡µè¡¨ä¿¡æ¯è¡¨ç¤ºæœ¬èº«éœ€è¦2^12çš„ç©ºé—´ï¼Œå³4kb\næ‰‹å†Œä¸Šæåˆ°è¡¨é¡¹(åŒ…æ‹¬CR3)ä¸­çš„åŸºåœ°å€éƒ½æ˜¯ç‰©ç†åœ°å€, ç‰©ç†åœ°å€æ˜¯å¿…é¡»çš„å—? èƒ½å¦ä½¿ç”¨è™šæ‹Ÿåœ°å€? æ•´ä¸ªé¡µè¡¨çš„åŸºå€å­˜æ”¾åœ¨ CR3 å¯„å­˜å™¨é‡Œã€‚CR3 å­˜æ”¾çš„æ˜¯ç‰©ç†åœ°å€ï¼Œè¿™æ˜¯æ•´ä¸ªåœ°å€è½¬æ¢æœ€æ ¹æœ¬çš„åŸºç¡€ã€‚åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼ŒCR3 å¿…é¡»å¡«å…¥ç‰©ç†åœ°å€ï¼Œå¦åˆ™æ²¡åŠæ³•è¿›è¡Œåœ°å€è½¬æ¢äº†ã€‚è¿™ä¸ªä¸œè¥¿æ˜¯è¦è®© MMU \u0026ldquo;çœ‹\u0026quot;çš„ï¼Œå®ƒæ˜¯ä¸ªç¡¬ä»¶ï¼Œåªèƒ½çœ‹å¾—æ‡‚ç‰©ç†åœ°å€ã€‚\næ¯ä¸ªé¡µè¡¨é¡¹ï¼ˆPML4E, PDPTE, PDEï¼ŒPTEï¼‰é‡Œçš„åŸºå€ï¼Œéƒ½æ˜¯ç‰©ç†åœ°å€ã€‚\nä½†æ˜¯ï¼Œæ•´ä¸ªé¡µè½¬æ¢è¡¨ç»“æ„æ˜¯å­˜æ”¾å†…å­˜é‡Œï¼Œå±äºè™šæ‹Ÿåœ°å€ã€‚ä¹Ÿå°±æ˜¯ï¼šé¡µè½¬æ¢è¡¨ç»“æ„éœ€è¦è¿›è¡Œå†…å­˜æ˜ å°„ã€‚\nä¸ºä»€ä¹ˆä¸é‡‡ç”¨ä¸€çº§é¡µè¡¨? æˆ–è€…è¯´é‡‡ç”¨ä¸€çº§é¡µè¡¨ä¼šæœ‰ä»€ä¹ˆç¼ºç‚¹? å½“è™šæ‹Ÿç©ºé—´å·¨å¤§çš„æ—¶å€™ï¼Œé¡µè¡¨é¡¹å¢å¤šï¼Œé¡µè¡¨æœ¬èº«å æ®çš„ç©ºé—´ä¹Ÿä¼šéå¸¸åºå¤§ã€‚\nå¯¹äº32ä½è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå‡è®¾é¡µé¢å¤§å°ä¸º4Kï¼Œé¡µè¡¨é¡¹å¤§å°ä¸º4å­—èŠ‚ï¼š\nä¸€ä¸ªè¿›ç¨‹æœ‰4G/4k = 2^20ä¸ªé¡µé¢ å› ä¸ºä¸€ä¸ªé¡µé¢éœ€è¦ä¸€ä¸ªé¡µè¡¨é¡¹æ¥å¯¹åº”ï¼Œæ‰€ä»¥ï¼Œè¿›ç¨‹çš„é¡µè¡¨é¡¹ä¸ªæ•°ä¹Ÿä¸º2^20ä¸ª ä¸éš¾å¾—å‡ºè¯¥è¿›ç¨‹çš„é¡µè¡¨å ç”¨äº† 2^20 * 4 / 4096(4k) = 1024ä¸ªé¡µé¢çš„å¤§å°\næ²¡æœ‰å¿…è¦è®©æ•´ä¸ªé¡µè¡¨å¸¸é©»å†…å­˜ï¼Œå› ä¸ºè¿›ç¨‹åœ¨ä¸€æ®µæ—¶é—´å†…å¯èƒ½åªéœ€è¦è®¿é—®æŸå‡ ä¸ªç‰¹å®šçš„é¡µé¢ã€‚\né—®ï¼šç©ºæŒ‡é’ˆçœŸçš„æ˜¯\u0026quot;ç©º\u0026quot;çš„å—? ç¨‹åºè®¾è®¡è¯¾ä¸Šè€å¸ˆå‘Šè¯‰ä½ , å½“ä¸€ä¸ªæŒ‡é’ˆå˜é‡çš„å€¼ç­‰äºNULLæ—¶, ä»£è¡¨ç©º, ä¸æŒ‡å‘ä»»ä½•ä¸œè¥¿. ä»”ç»†æƒ³æƒ³, çœŸçš„æ˜¯è¿™æ ·å—? å½“ç¨‹åºå¯¹ç©ºæŒ‡é’ˆè§£å¼•ç”¨çš„æ—¶å€™, è®¡ç®—æœºå†…éƒ¨å…·ä½“éƒ½åšäº†äº›ä»€ä¹ˆ? ä½ å¯¹ç©ºæŒ‡é’ˆçš„æœ¬è´¨æœ‰ä»€ä¹ˆæ–°çš„è®¤è¯†?\nè¿›ç¨‹è¯•å›¾è®¿é—®ä¸€ä¸ªæœªæ˜ å°„çš„çº¿æ€§åœ°å€, å¹¶æ²¡æœ‰å®é™…çš„ç‰©ç†é¡µä¸ä¹‹ç›¸å¯¹åº”ï¼Œå‡ºç°é”™è¯¯ã€‚\næˆ–è€…è®¿é—®æ²¡æœ‰æƒé™çš„åœ°å€é¡µï¼Œå¯¼è‡´ç›´æ¥å‡ºé”™ã€‚\nLinux ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹ç©ºé—´çš„ 0x0 è™šæ‹Ÿåœ°å€å¼€å§‹çš„çº¿æ€§åŒº(memory region)éƒ½ä¼šè¢«æ˜ å°„åˆ°ä¸€ä¸ªç”¨æˆ·æ€æ²¡æœ‰è®¿é—®æƒé™çš„é¡µä¸Šã€‚é€šè¿‡è¿™æ ·çš„æ˜ å°„ï¼Œå†…æ ¸å¯ä»¥ä¿è¯æ²¡æœ‰åˆ«çš„é¡µä¼šæ˜ å°„åˆ°è¿™ä¸ªåŒºåŸŸã€‚\nç¼–è¯‘å™¨æŠŠç©ºæŒ‡é’ˆå½“åšÂ 0Â å¯¹å¾…ï¼Œå¼€å¿ƒåœ°è®©ä½ å»è®¿é—®ç©ºæŒ‡é’ˆã€‚\nç¼ºé¡µå¼‚å¸¸å¤„ç†ç¨‹åºè¢«è°ƒç”¨ï¼Œå› ä¸ºåœ¨ 0x0 çš„é¡µæ²¡æœ‰åœ¨ç‰©ç†å†…å­˜é‡Œé¢ã€‚\nç¼ºé¡µå¼‚å¸¸å¤„ç†ç¨‹åºå‘ç°ä½ æ²¡æœ‰è®¿é—®çš„æƒé™ã€‚\nå†…æ ¸å‘é€Â SIGSEGVÂ ä¿¡å·ç»™è¿›ç¨‹ï¼Œè¯¥ä¿¡å·é»˜è®¤æ˜¯è®©è¿›ç¨‹è‡ªæ€ã€‚\nå‡ºè‡ªhttps://www.quora.com/What-actually-happens-when-dereferencing-a-NULL-pointer-Usually-the-process-terminates-Does-the-reaction-depend-on-the-operating-system-or-is-it-controlled-by-the-compiler-Is-it-mandatory-that-NULL-always-be-defined-as-â€œ0â€-with-proper-casting\nè¿™ä¸ªæ–‡ç« ä¸é”™ï¼ŒLinux Cç¨‹åºçœŸçš„ä¸èƒ½è®¿é—®NULLæŒ‡é’ˆå—ï¼š\nhttps://cloud.tencent.com/developer/article/1536302\nçŠ¶æ€æœºè§†è§’ä¸‹çš„è™šå­˜ç®¡ç†æœºåˆ¶ fvm()å‡½æ•°å¯ä»¥è®¤ä¸ºæ˜¯ç³»ç»Ÿå¯„å­˜å™¨SRçš„ä¸€éƒ¨åˆ†, æ“ä½œç³»ç»Ÿé€šè¿‡ä¿®æ”¹SRæ¥å¯¹è™šå­˜è¿›è¡Œç®¡ç†\nåœ¨åˆ†é¡µæœºåˆ¶ä¸Šè¿è¡ŒNanos-lite ä¸ºäº†è®©map()å¡«å†™çš„æ˜ å°„ç”Ÿæ•ˆ, æˆ‘ä»¬è¿˜éœ€è¦åœ¨NEMUä¸­å®ç°åˆ†é¡µæœºåˆ¶. å…·ä½“åœ°, æˆ‘ä»¬éœ€è¦å®ç°ä»¥ä¸‹ä¸¤ç‚¹:\nå¦‚ä½•åˆ¤æ–­CPUå½“å‰æ˜¯å¦å¤„äºåˆ†é¡µæ¨¡å¼?\nåˆ†é¡µåœ°å€è½¬æ¢çš„å…·ä½“è¿‡ç¨‹åº”è¯¥å¦‚ä½•å®ç°?\nä½†è¿™ä¸¤ç‚¹éƒ½æ˜¯ISAç›¸å…³çš„, äºæ˜¯NEMUå°†å®ƒä»¬æŠ½è±¡æˆç›¸åº”çš„API:\n// æ£€æŸ¥å½“å‰ç³»ç»ŸçŠ¶æ€ä¸‹å¯¹å†…å­˜åŒºé—´ä¸º[vaddr, vaddr + len), ç±»å‹ä¸ºtypeçš„è®¿é—®æ˜¯å¦éœ€è¦ç»è¿‡åœ°å€è½¬æ¢.\nint isa_mmu_check(vaddr_t vaddr, int len, int type);\n// å¯¹å†…å­˜åŒºé—´ä¸º[vaddr, vaddr + len), ç±»å‹ä¸ºtypeçš„å†…å­˜è®¿é—®è¿›è¡Œåœ°å€è½¬æ¢\npaddr_t isa_mmu_translate(vaddr_t vaddr, int len, int type);\nriscv32çš„Sv32åˆ†é¡µæœºåˆ¶å’Œx86éå¸¸ç±»ä¼¼, åªä¸è¿‡å¯„å­˜å™¨çš„åå­—å’Œé¡µè¡¨é¡¹ç»“æ„æœ‰æ‰€ä¸åŒ: åœ¨riscv32ä¸­, é¡µç›®å½•åŸºåœ°å€å’Œåˆ†é¡µä½¿èƒ½ä½éƒ½æ˜¯ä½äºsatpå¯„å­˜å™¨ä¸­. è‡³äºé¡µè¡¨é¡¹ç»“æ„çš„å·®å¼‚, è¿™é‡Œå°±ä¸è¯¦ç»†è¯´æ˜äº†, è¿˜æ˜¯RTFMå§.\nä½ éœ€è¦ç†è§£åˆ†é¡µåœ°å€è½¬æ¢çš„è¿‡ç¨‹, ç„¶åå®ç°isa_mmu_check()(åœ¨nemu/src/isa/$ISA/include/isa-def.hä¸­å®šä¹‰) å’Œisa_mmu_translate()(åœ¨nemu/src/isa/$ISA/system/mmu.cä¸­å®šä¹‰), ä½ å¯ä»¥æŸ¥é˜…NEMUçš„ISAç›¸å…³APIè¯´æ˜æ–‡æ¡£æ¥äº†è§£å®ƒä»¬çš„è¡Œä¸º. å¦å¤–ç”±äºæˆ‘ä»¬ä¸æ‰“ç®—å®ç°ä¿æŠ¤æœºåˆ¶, åœ¨isa_mmu_translate()çš„å®ç°ä¸­, ä½ åŠ¡å¿…ä½¿ç”¨assertionæ£€æŸ¥é¡µç›®å½•é¡¹å’Œé¡µè¡¨é¡¹çš„present/validä½, å¦‚æœå‘ç°äº†ä¸€ä¸ªæ— æ•ˆçš„è¡¨é¡¹, åŠæ—¶ç»ˆæ­¢NEMUçš„è¿è¡Œ, å¦åˆ™è°ƒè¯•å°†ä¼šéå¸¸å›°éš¾. è¿™é€šå¸¸æ˜¯ç”±äºä½ çš„å®ç°é”™è¯¯å¼•èµ·çš„, è¯·æ£€æŸ¥å®ç°çš„æ­£ç¡®æ€§.\næˆ‘å‚è€ƒäº†ä¸€äº›å…¶ä»–çš„å…³äºé¡µè¡¨å™è¿°ï¼š\nhttps://xy-plus.gitbook.io/rcore-step-by-step/ye-biao-jian-jie\ncsrå¯„å­˜å™¨ï¼š\nåœ°å€å’Œé¡µè¡¨é¡¹çš„æ„æˆï¼š\næ­¤æ—¶ä¸€ç§æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šå°†å…¨éƒ¨ç‰©ç†å†…å­˜åŒºåŸŸæ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚æ­¤æ—¶è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€ä¹‹é—´ä¼šæœ‰ä¸€ç§ç®€å•çš„å¯¹åº”å…³ç³»ï¼Œç§°ä¸º çº¿æ€§æ˜ å°„ ï¼Œå…·ä½“å…³ç³»å¼å¦‚ä¸‹ï¼š\nvirtual address = physical address + offset\nå…·ä½“çš„é¡µè¡¨è½¬æ¢è¿‡ç¨‹ï¼š\næ³¨æ„åˆ°riscv32 ä¸­æ‰€æœ‰é¡µé¢éƒ½æ˜¯ 4k å¯¹é½ï¼Œå› æ­¤ä»»ä½•é¡µè¡¨åŸºåœ°å€çš„ä½ 12 ä½ä¸€å®šæ˜¯ 0 ã€‚è¿™ä½¿å¾—æˆ‘ä»¬åœ¨ä¿å­˜é¡µè¡¨åŸºå€çš„æ—¶å€™åªéœ€è¦ä¿å­˜å…¶é«˜ 22 ä½ï¼ˆPPNï¼‰ã€‚\næˆ‘æ€è€ƒäº†å¾ˆä¹…é¡µç›®å½•é¡¹çš„æ¯ä¸€é¡¹æ€ä¹ˆå®ç°â€¦â€¦â€¦ç„¶åå°ä¼™ä¼´æé†’ä¸éœ€è¦é‚£ä¹ˆå¤æ‚ï¼Œåªè¦æœ€ç®€å•çš„åœ°å€ç´¢å¼•å°±å¥½â€¦ é¡¿æ—¶æ³ªæµæ»¡é¢ã€‚\nç„¶åæˆ‘ä»¬è¿˜è¦çŸ¥é“ä¸€ç‚¹å°±æ˜¯ï¼Œmapåªéœ€è¦å®ç°å¡«å†™ä¸€çº§å’ŒäºŒçº§é¡µè¡¨ï¼Œç„¶åä¸€çº§å°±æ˜¯ç”¨VAï¼ŒäºŒçº§æ˜¯ç”¨VA+PAï¼ˆå›¾ä¸Šéƒ½æœ‰ï¼Œä¸€ä¸ªæ˜¯æ­£å‘æ€è€ƒä¸€ä¸ªæ˜¯åå‘æ€è€ƒï¼ï¼‰\nå¦‚æœä½ æ„Ÿåˆ°å¾ˆå›°éš¾ï¼ŒæŠŠè¿™ä¸ªè¿‡ç¨‹çš„æ¯ä¸€æ­¥å†™ä¸‹æ¥ï¼ˆç¬¬ä¸€æ­¥åšä»€ä¹ˆï¼Œç¬¬äºŒéƒ¨åšä»€ä¹ˆï¼Œéƒ½è¦ç»†åŒ–ï¼å†™å¾—å‡ºæ¥æ‰æ˜¯æ‡‚äº†ï¼Œæ²¡å†™å‡ºæ¥å°±æ²¡çœŸçš„æ‡‚ã€‚ï¼‰\nè€Œä¸”è¿˜è¦æ³¨æ„çœ‹çœ‹mapçš„å¾ªç¯ï¼Œå…·ä½“çš„æºç æ˜¯æ€ä¹ˆæ ·èµ°çš„ï¼Œè¦æ³¨æ„æ˜¯é¡ºåºæ˜ å°„ï¼Œæ‰€ä»¥ä¸éœ€è¦è€ƒè™‘å¾ˆå¤šèŠ±é‡Œèƒ¡å“¨çš„é—®é¢˜ã€‚ï¼ˆä»€ä¹ˆæ—¶å€™æ‰è¦åˆ›é€ æ–°é¡µè¡¨ï¼Ÿçœ‹å¾ªç¯å…¶å®å°±çŸ¥é“äº†ã€‚ï¼‰\næ­¤æ—¶è¿˜è¦æ³¨æ„ä¸€ä¸ªç‚¹ï¼š\nå¯¹äºä¸åŒisaçš„æ˜ å°„ï¼Œæˆ‘ä»¬è·‘çš„ç®—æ˜¯å®¢æˆ·ç¨‹åºï¼ˆæ‰€æœ‰çš„éƒ½æ˜¯amä¸Šçš„å®¢æˆ·ç¨‹åºï¼‰ï¼Œç„¶åçœŸæ­£çš„è½¬æ¢åˆ°ç‰©ç† è¿˜è¦gueståˆ°hostï¼ˆè¿™ä¸ªé—®é¢˜å¾ˆå‘ï¼‰ã€‚å…¶å®å°±æ˜¯ä¸€ä¸ªé—®é¢˜ï¼š\nç¡¬ä»¶å±‚ä½ æ€ä¹ˆè§£å¼•ç”¨ï¼Ÿï¼Ÿæ€ä¹ˆè·å–è½¯ä»¶çš„ä¿¡æ¯ï¼Ÿï¼Ÿï¼Ÿè¦ç”¨ä»€ä¹ˆæ‰èƒ½è¯»å–åˆ°è½¯ä»¶çš„ä¿¡æ¯ï¼Ÿï¼Ÿæ€ä¹ˆreadï¼Ÿ è¿™æ˜¯éå¸¸å…³é”®ä¸”é‡è¦çš„é—®é¢˜ï¼Œæ€ä¹ˆåœ¨nemuå®ç°â€œè§£å¼•ç”¨â€\nè°ƒä¸å‡ºæ¥ï¼Œæƒ³å“­ï¼Œå‘ç°æ˜¯æˆ‘çš„é¡µè¡¨é¡¹åŠ æ³•æœ‰ç‚¹é—®é¢˜ï¼ˆæ„Ÿè§‰æ˜¯æŒ‡é’ˆä¹‹ç±»çš„è¿ç®—é—®é¢˜ï¼‰ï¼Œç„¶åä¸€ä¸ªä¸ªä»”ç»†ä¿®æ”¹ï¼Œå‘ç°é—®é¢˜å‡ºåœ¨æœ€åçš„é¡µè¡¨é¡¹ï¼Œä¸€é¡¿å°è¯•åç»ˆäºè°ƒå‡ºæ¥äº† å“­çQWQ å¤ªå¥½å“­äº†\nå®åœ¨ç»·ä¸ä½äº†ï¼Œå€Ÿç”¨äº†é˜¿å°¼äºšçš„mmuè¿›è¡Œdiffå„ç§ç¥å¥‡çš„æ®µé”™è¯¯ã€‚\nè¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨é¡µè¡¨ç›¸å…³è®¡ç®—çš„æ—¶å€™è¦è®°å¾—è½¬æ¢ä¸€ä¸‹æŒ‡é’ˆã€‚ã€‚ã€‚åˆ«ç”¨æŒ‡é’ˆåšåŠ æ³•è¿ç®—ã€‚ã€‚\nè¿™ä¸œè¥¿è®©æˆ‘æ€€ç–‘äº†è‡ªå·±100æ¬¡æ˜¯ä¸æ˜¯ä¸é€‚åˆåšPA\nåœ¨åˆ†é¡µæœºåˆ¶ä¸Šè¿è¡Œç”¨æˆ·è¿›ç¨‹ ç›®å‰è¿™ä¸ªåœ°å€ç©ºé—´é™¤äº†å†…æ ¸æ˜ å°„ä¹‹å¤–å°±æ²¡æœ‰å…¶å®ƒå†…å®¹äº†, å…·ä½“å¯ä»¥å‚è€ƒabstract-machine/am/src/$ISA/nemu/vme.c.\nä¸è¿‡, æ­¤æ—¶loader()ä¸èƒ½ç›´æ¥æŠŠç”¨æˆ·è¿›ç¨‹åŠ è½½åˆ°å†…å­˜ä½ç½®0x40000000é™„è¿‘äº†, å› ä¸ºè¿™ä¸ªåœ°å€å¹¶ä¸åœ¨å†…æ ¸çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­, å†…æ ¸ä¸èƒ½ç›´æ¥è®¿é—®å®ƒ. loader()è¦åšçš„äº‹æƒ…æ˜¯, è·å–ç¨‹åºçš„å¤§å°ä¹‹å, ä»¥é¡µä¸ºå•ä½è¿›è¡ŒåŠ è½½:\nç”³è¯·ä¸€é¡µç©ºé—²çš„ç‰©ç†é¡µ\né€šè¿‡map()æŠŠè¿™ä¸€ç‰©ç†é¡µæ˜ å°„åˆ°ç”¨æˆ·è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­. ç”±äºAM nativeå®ç°äº†æƒé™æ£€æŸ¥, ä¸ºäº†è®©ç¨‹åºå¯ä»¥åœ¨AM nativeä¸Šæ­£ç¡®è¿è¡Œ, ä½ è°ƒç”¨map()çš„æ—¶å€™éœ€è¦å°†protè®¾ç½®æˆå¯è¯»å¯å†™å¯æ‰§è¡Œ\nä»æ–‡ä»¶ä¸­è¯»å…¥ä¸€é¡µçš„å†…å®¹åˆ°è¿™ä¸€ç‰©ç†é¡µä¸­\nè¿™ä¸€åˆ‡éƒ½æ˜¯ä¸ºäº†è®©ç”¨æˆ·è¿›ç¨‹åœ¨å°†æ¥å¯ä»¥æ­£ç¡®åœ°è¿è¡Œ:** ç”¨æˆ·è¿›ç¨‹åœ¨å°†æ¥ä½¿ç”¨è™šæ‹Ÿåœ°å€è®¿é—®å†…å­˜, åœ¨loaderä¸ºç”¨æˆ·è¿›ç¨‹ç»´æŠ¤çš„æ˜ å°„ä¸‹, è™šæ‹Ÿåœ°å€è¢«è½¬æ¢æˆç‰©ç†åœ°å€, é€šè¿‡è¿™ä¸€ç‰©ç†åœ°å€è®¿é—®åˆ°çš„ç‰©ç†å†…å­˜, æ°å¥½å°±æ˜¯ç”¨æˆ·è¿›ç¨‹æƒ³è¦è®¿é—®çš„æ•°æ®.**\nå¦ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ç”¨æˆ·æ ˆ, å’Œloader()ç±»ä¼¼, æˆ‘ä»¬éœ€è¦æŠŠnew_page()ç”³è¯·å¾—åˆ°çš„ç‰©ç†é¡µé€šè¿‡map()æ˜ å°„åˆ°ç”¨æˆ·è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­. æˆ‘ä»¬æŠŠç”¨æˆ·æ ˆçš„è™šæ‹Ÿåœ°å€å®‰æ’åœ¨ç”¨æˆ·è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„æœ«å°¾, ä½ å¯ä»¥é€šè¿‡as.area.endæ¥å¾—åˆ°æœ«å°¾çš„ä½ç½®, ç„¶åæŠŠç”¨æˆ·æ ˆçš„ç‰©ç†é¡µæ˜ å°„åˆ°[as.area.end - 32KB, as.area.end)è¿™æ®µè™šæ‹Ÿåœ°å€ç©ºé—´.\næœ€å, ä¸ºäº†è®©è¿™ä¸€åœ°å€ç©ºé—´ç”Ÿæ•ˆ, æˆ‘ä»¬è¿˜éœ€è¦å°†å®ƒè½å®åˆ°MMUä¸­. å…·ä½“åœ°, æˆ‘ä»¬å¸Œæœ›åœ¨CTEæ¢å¤è¿›ç¨‹ä¸Šä¸‹æ–‡çš„æ—¶å€™æ¥åˆ‡æ¢åœ°å€ç©ºé—´. ä¸ºæ­¤, æˆ‘ä»¬éœ€è¦å°†è¿›ç¨‹çš„åœ°å€ç©ºé—´æè¿°ç¬¦æŒ‡é’ˆas-\u0026gt;ptråŠ å…¥åˆ°ä¸Šä¸‹æ–‡ä¸­, æ¡†æ¶ä»£ç å·²ç»å®ç°äº†è¿™ä¸€åŠŸèƒ½(è§abstract-machine/am/include/arch/$ISA-nemu.h), åœ¨x86ä¸­è¿™ä¸€æˆå‘˜ä¸ºcr3, è€Œåœ¨mips32/riscv32ä¸­åˆ™ä¸ºpdir. ä½ è¿˜éœ€è¦\nä¿®æ”¹ucontext()çš„å®ç°, åœ¨åˆ›å»ºçš„ç”¨æˆ·è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­è®¾ç½®åœ°å€ç©ºé—´æè¿°ç¬¦æŒ‡é’ˆ\nåœ¨__am_irq_handle()çš„å¼€å¤´è°ƒç”¨__am_get_cur_as() (åœ¨abstract-machine/am/src/$ISA/nemu/vme.cä¸­å®šä¹‰), æ¥å°†å½“å‰çš„åœ°å€ç©ºé—´æè¿°ç¬¦æŒ‡é’ˆä¿å­˜åˆ°ä¸Šä¸‹æ–‡ä¸­\nåœ¨__am_irq_handle()è¿”å›å‰è°ƒç”¨__am_switch() (åœ¨abstract-machine/am/src/$ISA/nemu/vme.cä¸­å®šä¹‰)æ¥åˆ‡æ¢åœ°å€ç©ºé—´, å°†è¢«è°ƒåº¦è¿›ç¨‹çš„åœ°å€ç©ºé—´è½å®åˆ°MMUä¸­\nè¿™é‡Œé‡åˆ°çš„ç¬¬ä¸€ä¸ªå¤§å‘å°±æ˜¯æ€ä¹ˆä¼˜é›…çš„æ”¹å†™loaderï¼ˆå·®ç‚¹å¿˜äº†å…·ä½“ç¨‹åºå¤´è¡¨çš„æˆåˆ†äº†ï¼Œåˆå»çœ‹ä¹¦å¤ä¹ äº†ä¸€éã€‚ã€‚ã€‚ï¼‰\nç„¶ååˆå¿˜äº†asé‡Œé¢å…¶å®æ˜¯æœ‰ä¸ªptrçš„ã€‚ã€‚ã€‚ã€‚\nå†™loaderå®åœ¨èšŒåŸ ä½äº†ï¼ˆæµ®èºäº†ï¼‰ï¼Œå¼€å§‹æŠ±å¤§è…¿ï¼ˆå¡åœ¨å…·ä½“é¡µè¯»å–æ€è·¯ä¸Šï¼‰\næ­¤æ—¶æˆ‘åˆè¢«vaddr_ifetchæ²¡å®ç°å¡äº†ä¸€æ™šä¸Š - -ã€‚ã€‚ã€‚ã€‚ã€‚ï¼ˆä¸€ç›´åˆ°ä¸äº†mmuï¼Œç›´æ¥è¯´æˆ‘è¦è®¿é—®çš„åœ°æ–¹é£˜äº†ã€‚ã€‚ã€‚ã€‚ï¼‰å‡ºç°äº†è¶…è¾¹ç•Œæç¤ºã€‚é€šè¿‡æ’æŸ¥æŒ‡ä»¤å¯ä»¥çŸ¥é“æˆ‘ä»¬æ‰§è¡Œå‰ä¼šè¿›è¡Œfetch_decodeâ€”â€”isa_fetch_decodeâ€”â€”instr_fetchâ€”â€”vaddr_ifetchï¼Œå°±å‘ç°äº†é—®é¢˜æºã€‚ã€‚\nç„¶åå‘ç°ç¥å¥‡mepcä¹‹ç±»éƒ½ä¸º0çš„é—®é¢˜ã€‚ã€‚ã€‚ã€‚å¼€å§‹æ€€ç–‘ä¸Šä¸‹æ–‡æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ã€‚ã€‚ã€‚ä¸€é¡¿æ“ä½œçŒ›å¦‚è™è°ƒäº†ä¸€ä¸‹ç”¨æˆ·æ ˆç›¸å…³ï¼Œè§£å†³\nè¿™é‡Œè¦é‡æ–°å®ç°ä¸€ä¸‹sbrkçš„æ˜ å°„\nï¼ˆç¬”è€…åœ¨è¿™ä¸€é˜¶æ®µæ‰“å‡ºäº†GGï¼‰\né—®ï¼šå†…æ ¸æ˜ å°„çš„ä½œç”¨ å¯¹äºx86å’Œriscv32, åœ¨protect()ä¸­åˆ›å»ºåœ°å€ç©ºé—´çš„æ—¶å€™, æœ‰ä¸€å¤„ä»£ç ç”¨äºæ‹·è´å†…æ ¸æ˜ å°„:\n// map kernel space\nmemcpy(updir, kas.ptr, PGSIZE);\nå°è¯•æ³¨é‡Šè¿™å¤„ä»£ç , é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ, ä½ ä¼šçœ‹åˆ°å‘ç”Ÿäº†é”™è¯¯. è¯·è§£é‡Šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ä¸ªé”™è¯¯.\n","date":"2022-09-16T08:50:40+08:00","permalink":"https://sanbuphy.github.io/p/nju%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%BE%E7%A8%8B%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C-pa4%E7%AC%94%E8%AE%B0%E5%A4%A7%E7%BB%93%E5%B1%80/","title":"NJUè®¡ç®—æœºè¯¾ç¨‹åŸºç¡€å®éªŒ PA4ç¬”è®°ï¼ˆå¤§ç»“å±€ï¼‰"},{"content":"Reference https://blog.csdn.net/zong596568821xp/article/details/92790502\nhttps://blog.csdn.net/u014303844/article/details/80394101\nä¸€äº›å…³äºnginxçš„å¸¸è§æ“ä½œï¼š\nhttps://kalacloud.com/blog/how-to-install-nginx-on-ubuntu-20-04/\nnginx rtmpé…ç½®ç›¸å…³å®˜æ–¹æ‰‹å†Œï¼š\nhttps://github.com/arut/nginx-rtmp-module/wiki/Directives#server\næ¯”è¾ƒå…¨çš„ä¸­æ–‡å¯å‚è€ƒconfæ–‡ä»¶å†…å®¹è§£æ\nhttps://www.jianshu.com/p/15316e0f3de1\nå› ä¸ºä¸šåŠ¡ä¸Šéœ€æ±‚éœ€è¦å°†æµæ‹‰ä¸‹æ¥å¤„ç†åè½¬ä¸ºå…¶ä»–æµæ¨é€å‡ºå»ï¼Œä¹‹å‰çš„åšå®¢å†…å®¹æ¶‰åŠåˆ°çš„æ˜¯rtspæµçš„å¤„ç†ï¼Œè¿™æ¬¡åˆ©ç”¨nginxæœåŠ¡å™¨è½¬å‘æ¨rtmpæµã€‚ï¼ˆæ‹‰æµåå¯ä»¥è¿›è¡Œä»»ä½•å›¾åƒå¤„ç†ï¼‰\næ“ä½œç¯å¢ƒï¼šUbuntu 20.04 + python3\nNginxæœåŠ¡å™¨æ­å»º å› ä¸ºè¦å°†å¤„ç†è¿‡çš„å›¾ç‰‡ä¸²æˆrtmpç æµï¼Œå› æ­¤ï¼Œéœ€è¦æ­å»ºä¸€ä¸ªrtmpæœåŠ¡å™¨ï¼Œå¸¸ç”¨çš„æ–¹æ¡ˆæ˜¯NginxæœåŠ¡å™¨ã€‚\nå®‰è£…ä¾èµ– sudo apt-get install openssl libssl-dev sudo apt-get install libpcre3 libpcre3-dev sudo apt-get install zlib1g-dev å®‰è£…nginx é¦–å…ˆä¸‹è½½nginxï¼š\nhttp://nginx.org/en/download.html\né€‰æ‹©ç¨³å®šç‰ˆæœ¬å³å¯ï¼Œæ¯”å¦‚http://nginx.org/download/nginx-1.22.0.tar.gz\nä»¥åŠnginx-rtmp-module:\ngit clone https://github.com/arut/nginx-rtmp-module.git å°†ä¸¤è€…æ”¾åœ¨åŒçº§ç›®å½•çš„æ–‡ä»¶å¤¹ä¸‹ï¼š\nä¹‹åè¿›å…¥nginxçš„æ–‡ä»¶å¤¹ï¼Œä¾æ¬¡è¿è¡ŒæŒ‡ä»¤è¿›è¡Œç¼–è¯‘ï¼š\n./configure --add-module=../nginx-rtmp-module make sudo make install å®‰è£…åçš„ä¸€äº›ä¿¡æ¯ï¼š\nnginxå®‰è£…ç›®å½• /usr/local/nginx nginxé…ç½®ç›®å½• /usr/local/nginx/conf/nginx.conf nginxè¿è¡Œç›®å½• /usr/local/nginx/sbin/nginx \u0026ndash;options è¿è¡ŒæŒ‡ä»¤å¯åŠ¨nginx:\nsudo /usr/local/nginx/sbin/nginx åœ¨æµè§ˆå™¨ä¸­è¾“å…¥localhostï¼Œè‹¥çœ‹åˆ°å¦‚ä¸‹ç”»é¢ï¼Œè¡¨ç¤ºè¿è¡ŒæˆåŠŸ\né…ç½®nginxç”¨äºæ¨æµè½¬å‘ å¯ä»¥é‡‡å–vimæˆ–è€…vscodeè¿›è¡Œç¼–è¾‘\nè¿™é‡Œé‡‡ç”¨vscodeï¼Œé¦–å…ˆè¿è¡Œ\ncode /usr/local/nginx/conf/nginx.conf æ¥ç€æ‰¾åˆ°å¯¹åº”ä½ç½®è¿›è¡Œå¡«å……ï¼š\n#åœ°å€ä¸º /usr/local/nginx/conf/nginx.conf #æ³¨æ˜ï¼šè¯·å‹¿ç›´æ¥è¦†ç›–åŸæ¥çš„confæ–‡ä»¶,è¿™åªæ˜¯éƒ¨åˆ†æœ‰å…³ç›´æ’­çš„å†…å®¹ #é…ç½®RTMPï¼Œè¿™ä¸ªé…ç½®æ ¼å¼åœ¨githubçš„readmeä¸Šæœ‰è¯¦ç»†è¯´æ˜ rtmp { server { listen 1935; #æœåŠ¡ç«¯å£--é»˜è®¤ chunk_size 4096; #æ•°æ®ä¼ è¾“å—çš„å¤§å°--é»˜è®¤ #è®¾ç½®ç›´æ’­çš„applicationåç§°æ˜¯ mylive application mylive{ live on; #live onè¡¨ç¤ºå¼€å¯ç›´æ’­æ¨¡å¼ } } } #è¯·åœ¨httpé‡Œé¢æ‰¾åˆ°server http{ ...#è¿™é‡Œæœ‰ä¸€äº›å…¶ä»–çš„é…ç½® #å¤åˆ¶ç²˜è´´è¿™ä¸ªæ›¿æ¢åŸæ¥çš„server server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } location /pop/video { alias /var/video; } location /info { rtmp_stat all; rtmp_stat_stylesheet stat.xsl; } location /stat.xsl { root html; #è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€ä¸ªæ›¿æ¢ } } å¦‚å›¾æ‰€ç¤ºï¼š\né…ç½®å®Œä¹‹åï¼Œéœ€è¦é‡å¯nginx\nsudo /usr/local/nginx/sbin/nginx -s reload\næ¥ä¸‹æ¥é…ç½®æœåŠ¡å™¨çš„ç›‘æ§ä¿¡æ¯æ˜¾ç¤ºï¼Œä¿®æ”¹ä¹‹å‰serverçš„ä¸€ä¸ªè·¯å¾„ä¿¡æ¯,æŠŠè¿™ä¸ªè·¯å¾„æ”¹æˆå¼€å¤´ä¸‹è½½å¥½çš„moduleçš„ç»å¯¹è·¯å¾„ï¼ˆå› ä¸ºé‚£é‡Œé¢æœ‰ä¸ªstat.xslï¼‰ï¼š\nä¿å­˜åé‡å¯nginxï¼Œç„¶åç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥localhost/infoå¯çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š\nè‡³æ­¤ï¼Œå®Œæˆäº†rtmp-nginxæœåŠ¡å™¨çš„å…¨éƒ¨é…ç½®\næ¨æµä»£ç éƒ¨åˆ† import cv2 import subprocess rtsp = \u0026#34;éšä¾¿é€‰ä¸ªè§†é¢‘æºæµ‹è¯•\u0026#34; rtmp = \u0026#39;rtmp://localhost:1935/mylive/test\u0026#39; # è¯»å–è§†é¢‘å¹¶è·å–å±æ€§ cap = cv2.VideoCapture(rtsp) size = (int(cap.get(cv2.CAP_PROP_FRAME_WIDTH)), int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))) sizeStr = str(size[0]) + \u0026#39;x\u0026#39; + str(size[1]) print(\u0026#34;sezie is\\n\u0026#34;,sizeStr) command = [\u0026#39;ffmpeg\u0026#39;, \u0026#39;-y\u0026#39;, \u0026#39;-an\u0026#39;, \u0026#39;-f\u0026#39;, \u0026#39;rawvideo\u0026#39;, \u0026#39;-vcodec\u0026#39;,\u0026#39;rawvideo\u0026#39;, \u0026#39;-pix_fmt\u0026#39;, \u0026#39;bgr24\u0026#39;, \u0026#39;-s\u0026#39;, sizeStr, \u0026#39;-r\u0026#39;, \u0026#39;15\u0026#39;, \u0026#39;-i\u0026#39;, \u0026#39;-\u0026#39;, \u0026#39;-c:v\u0026#39;, \u0026#39;libx264\u0026#39;, \u0026#39;-pix_fmt\u0026#39;, \u0026#39;yuv420p\u0026#39;, \u0026#39;-preset\u0026#39;, \u0026#39;ultrafast\u0026#39;, \u0026#39;-f\u0026#39;, \u0026#39;flv\u0026#39;, rtmp] pipe = subprocess.Popen(command , shell=False , stdin=subprocess.PIPE ) while cap.isOpened(): success,frame1 = cap.read() # print(frame1.shape()) if success: #=================è¿›è¡Œä¸€äº›å›¾åƒå¤„ç†================= frame = cv2.rectangle(frame1,(50,200),(900,400),[0,255,255],2) #=================è¿›è¡Œä¸€äº›å›¾åƒå¤„ç†================= if cv2.waitKey(1) \u0026amp; 0xFF == ord(\u0026#39;q\u0026#39;): break pipe.stdin.write(frame1.tostring()) cap.release() pipe.terminate() è¿è¡Œä¸Šè¿°ä»£ç ï¼Œç„¶ååœ¨nginxæœåŠ¡å™¨infoä¸Šå¯æŸ¥çœ‹æ¨æµæƒ…å†µ\nä¹‹åç”¨ffplayæˆ–è€…VLCç­‰å®¢æˆ·ç«¯è½¯ä»¶å³å¯æŸ¥çœ‹æ¨æµè§†é¢‘\nå¯èƒ½é‡åˆ°çš„å‘ï¼š æ¨é€æ—¶çš„fpsé€‰å–è¦å’Œæºç›¸è¿‘ï¼Œä¸è¦è‡ªå·±éšæ„è·³å¸§ã€‚ã€‚ã€‚ã€‚å¦åˆ™speedä¼šå¾ˆå¥‡è‘©çš„å»¶è¿Ÿã€‚ä»¥1.0å·¦å³ä¸ºå‡†ã€‚\nå¿«é€Ÿé‡å¯å¯ä»¥å†™ä¸€ä¸ªshellï¼š\necho ä½ çš„sudoå¯†ç  | sudo -S /usr/local/nginx/sbin/nginx xdg-open http://localhost/info ","date":"2022-09-03T11:56:50+08:00","permalink":"https://sanbuphy.github.io/p/opencv%E8%AF%BB%E5%8F%96%E8%A7%86%E9%A2%91%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E5%90%8E%E6%8E%A8%E6%B5%81rtmp/","title":"opencvè¯»å–è§†é¢‘å›¾åƒå¤„ç†åæ¨æµrtmp"},{"content":" 4ã€ç®€æ˜“æ–‡ä»¶ç³»ç»Ÿ å¯¹ç”¨æˆ·ç¨‹åºæ¥è¯´, å®ƒæ€ä¹ˆçŸ¥é“æ–‡ä»¶ä½äºramdiskçš„å“ªä¸€ä¸ªä½ç½®å‘¢? æ›´ä½•å†µæ–‡ä»¶ä¼šåŠ¨æ€åœ°å¢åˆ , ç”¨æˆ·ç¨‹åºå¹¶ä¸çŸ¥æƒ…. è¿™è¯´æ˜, æŠŠramdiskçš„è¯»å†™æ¥å£ç›´æ¥æä¾›ç»™ç”¨æˆ·ç¨‹åºæ¥ä½¿ç”¨æ˜¯ä¸å¯è¡Œçš„. æ“ä½œç³»ç»Ÿè¿˜éœ€è¦åœ¨å­˜å‚¨ä»‹è´¨çš„é©±åŠ¨ç¨‹åºä¹‹ä¸Šä¸ºç”¨æˆ·ç¨‹åºæä¾›ä¸€ç§æ›´é«˜çº§çš„æŠ½è±¡, é‚£å°±æ˜¯æ–‡ä»¶.\nå®šä¹‰ä¸€ä¸ªç®€æ˜“æ–‡ä»¶ç³»ç»Ÿsfs(Simple File System):\næ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„\nå†™æ–‡ä»¶æ—¶ä¸å…è®¸è¶…è¿‡åŸæœ‰æ–‡ä»¶çš„å¤§å°\næ–‡ä»¶çš„æ•°é‡æ˜¯å›ºå®šçš„, ä¸èƒ½åˆ›å»ºæ–°æ–‡ä»¶\næ²¡æœ‰ç›®å½•(/a/b/cï¼‰\næ—¢ç„¶æ–‡ä»¶çš„æ•°é‡å’Œå¤§å°éƒ½æ˜¯å›ºå®šçš„, æˆ‘ä»¬è‡ªç„¶å¯ä»¥æŠŠæ¯ä¸€ä¸ªæ–‡ä»¶åˆ†åˆ«å›ºå®šåœ¨ramdiskä¸­çš„æŸä¸€ä¸ªä½ç½®. ä¸ºäº†è®°å½•ramdiskä¸­å„ä¸ªæ–‡ä»¶çš„åå­—å’Œå¤§å°, æˆ‘ä»¬è¿˜éœ€è¦ä¸€å¼ \u0026quot;æ–‡ä»¶è®°å½•è¡¨\nnanos-lite/Makefileä¿®æ”¹åç„¶åè¿è¡Œmake ARCH=riscv32-nemu update\nå°±ä¼šè‡ªåŠ¨ç¼–è¯‘Navyä¸­çš„ç¨‹åº, å¹¶æŠŠnavy-apps/fsimg/ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹æ•´åˆæˆramdiské•œåƒnavy-apps/build/ramdisk.img, åŒæ—¶ç”Ÿæˆè¿™ä¸ªramdiské•œåƒçš„æ–‡ä»¶è®°å½•è¡¨navy-apps/build/ramdisk.h, Nanos-liteçš„Makefileä¼šé€šè¿‡è½¯è¿æ¥æŠŠå®ƒä»¬é“¾æ¥åˆ°é¡¹ç›®ä¸­.\nå¦‚æœä½ ä¿®æ”¹äº†Navyä¸­çš„å†…å®¹, è¯·è®°å¾—é€šè¿‡ä¸Šè¿°å‘½ä»¤æ¥æ›´æ–°é•œåƒæ–‡ä»¶.\n\u0026ldquo;æ–‡ä»¶è®°å½•è¡¨\u0026quot;å…¶å®æ˜¯ä¸€ä¸ªæ•°ç»„, æ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªç»“æ„ä½“:\ntypedef struct {\nchar *name; // æ–‡ä»¶å\nsize_t size; // æ–‡ä»¶å¤§å°\nsize_t disk_offset; // æ–‡ä»¶åœ¨ramdiskä¸­çš„åç§»\n} Finfo;\næœ€åŸºæœ¬çš„æ–‡ä»¶è¯»å†™æ“ä½œ:\nsize_t read(const char *filename, void *buf, size_t len);\nsize_t write(const char *filename, void *buf, size_t len);\næ“ä½œç³»ç»Ÿä¸­å­˜åœ¨ä¸å°‘\u0026quot;æ²¡æœ‰åå­—\u0026quot;çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚ç®¡é“ä¼ è¾“ç»™å¦ä¸€ä¸ªå·¥å…·çš„æ ‡å‡†è¾“å…¥ï¼Œlessç­‰ï¼‰. ä¸ºäº†ç»Ÿä¸€ç®¡ç†å®ƒä»¬, **é€šè¿‡ä¸€ä¸ªç¼–å·æ¥è¡¨ç¤ºæ–‡ä»¶, æ–‡ä»¶æè¿°ç¬¦(file descriptor). **\nä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹åº”ä¸€ä¸ªæ­£åœ¨æ‰“å¼€çš„æ–‡ä»¶, ç”±æ“ä½œç³»ç»Ÿæ¥ç»´æŠ¤æ–‡ä»¶æè¿°ç¬¦åˆ°å…·ä½“æ–‡ä»¶çš„æ˜ å°„. äºæ˜¯æˆ‘ä»¬å¾ˆè‡ªç„¶åœ°é€šè¿‡open()ç³»ç»Ÿè°ƒç”¨æ¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶, å¹¶è¿”å›ç›¸åº”çš„æ–‡ä»¶æè¿°ç¬¦\nint open(const char *pathname, int flags, int mode);\nç”±äºsfsçš„æ–‡ä»¶æ•°ç›®æ˜¯å›ºå®šçš„, æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æŠŠæ–‡ä»¶è®°å½•è¡¨çš„ä¸‹æ ‡ä½œä¸ºç›¸åº”æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™ç”¨æˆ·ç¨‹åº. åœ¨è¿™ä»¥å, æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ¥æ ‡è¯†æ–‡ä»¶:\nsize_t read(int fd, void *buf, size_t len);\nsize_t write(int fd, const void *buf, size_t len);\nint close(int fd);\næˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªå·²ç»æ‰“å¼€çš„æ–‡ä»¶å¼•å…¥åç§»é‡å±æ€§open_offset, æ¥è®°å½•ç›®å‰æ–‡ä»¶æ“ä½œçš„ä½ç½®. æ¯æ¬¡å¯¹æ–‡ä»¶è¯»å†™äº†å¤šå°‘ä¸ªå­—èŠ‚, åç§»é‡å°±å‰è¿›å¤šå°‘.\nåç§»é‡å¯ä»¥é€šè¿‡lseek()ç³»ç»Ÿè°ƒç”¨æ¥è°ƒæ•´, ä»è€Œå¯ä»¥å¯¹æ–‡ä»¶ä¸­çš„ä»»æ„ä½ç½®è¿›è¡Œè¯»å†™:\nsize_t lseek(int fd, size_t offset, int whence);\nä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ç¨‹åºè¿›è¡Œæ ‡å‡†è¾“å…¥è¾“å‡º, æ“ä½œç³»ç»Ÿå‡†å¤‡äº†ä¸‰ä¸ªé»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦:\n#define FD_STDIN 0\n#define FD_STDOUT 1\n#define FD_STDERR 2\nå®ƒä»¬åˆ†åˆ«å¯¹åº”æ ‡å‡†è¾“å…¥stdin, æ ‡å‡†è¾“å‡ºstdoutå’Œæ ‡å‡†é”™è¯¯stderr. æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„printf, æœ€ç»ˆä¼šè°ƒç”¨write(FD_STDOUT, buf, len)è¿›è¡Œè¾“å‡º; è€Œscanfå°†ä¼šé€šè¿‡è°ƒç”¨read(FD_STDIN, buf, len)è¿›è¡Œè¯»å…¥.\nnanos-lite/src/fs.cä¸­å®šä¹‰çš„file_tableä¼šåŒ…å«nanos-lite/src/files.h, å…¶ä¸­å‰é¢è¿˜æœ‰3ä¸ªç‰¹æ®Šçš„æ–‡ä»¶: stdin, stdoutå’Œstderrçš„å ä½è¡¨é¡¹, å®ƒä»¬åªæ˜¯ä¸ºäº†ä¿è¯sfså’Œçº¦å®šçš„æ ‡å‡†è¾“å…¥è¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦ä¿æŒä¸€è‡´, ä¾‹å¦‚æ ¹æ®çº¦å®šstdoutçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯1, è€Œæˆ‘ä»¬æ·»åŠ äº†ä¸‰ä¸ªå ä½è¡¨é¡¹ä¹‹å, æ–‡ä»¶è®°å½•è¡¨ä¸­çš„1å·ä¸‹æ ‡ä¹Ÿå°±ä¸ä¼šåˆ†é…ç»™å…¶å®ƒçš„æ™®é€šæ–‡ä»¶äº†.\næ ¹æ®ä»¥ä¸Šä¿¡æ¯, æˆ‘ä»¬å°±å¯ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å®ç°ä»¥ä¸‹çš„æ–‡ä»¶æ“ä½œäº†:\nint fs_open(const char *pathname, int flags, int mode);\nsize_t fs_read(int fd, void *buf, size_t len);\nsize_t fs_write(int fd, const void *buf, size_t len);\nsize_t fs_lseek(int fd, size_t offset, int whence);\nint fs_close(int fd);\nè¿™äº›æ–‡ä»¶æ“ä½œå®é™…ä¸Šæ˜¯ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨åœ¨å†…æ ¸ä¸­çš„å®ç°. ç”±äºsfsä¸­æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æ˜¯å›ºå®šçš„, ä¸ä¼šäº§ç”Ÿæ–°æ–‡ä»¶, å› æ­¤\u0026rdquo;fs_open()æ²¡æœ‰æ‰¾åˆ°pathnameæ‰€æŒ‡ç¤ºçš„æ–‡ä»¶\u0026quot;å±äºå¼‚å¸¸æƒ…å†µ, ä½ éœ€è¦ä½¿ç”¨assertionç»ˆæ­¢ç¨‹åºè¿è¡Œ.\nä¸ºäº†ç®€åŒ–å®ç°, æˆ‘ä»¬å…è®¸æ‰€æœ‰ç”¨æˆ·ç¨‹åºéƒ½å¯ä»¥å¯¹æ‰€æœ‰å·²å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œè¯»å†™, è¿™æ ·ä»¥å, æˆ‘ä»¬åœ¨å®ç°fs_open()çš„æ—¶å€™å°±å¯ä»¥å¿½ç•¥flagså’Œmodeäº†.\nä½¿ç”¨ramdisk_read()å’Œramdisk_write()æ¥è¿›è¡Œæ–‡ä»¶çš„çœŸæ­£è¯»å†™.\nç”±äºæ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„, åœ¨å®ç°fs_read(), fs_write()å’Œfs_lseek()çš„æ—¶å€™, æ³¨æ„åç§»é‡ä¸è¦è¶Šè¿‡æ–‡ä»¶çš„è¾¹ç•Œ.\né™¤äº†å†™å…¥stdoutå’Œstderrä¹‹å¤–(ç”¨putch()è¾“å‡ºåˆ°ä¸²å£), å…¶ä½™å¯¹äºstdin, stdoutå’Œstderrè¿™ä¸‰ä¸ªç‰¹æ®Šæ–‡ä»¶çš„æ“ä½œå¯ä»¥ç›´æ¥å¿½ç•¥.\nç”±äºsfsæ²¡æœ‰ç»´æŠ¤æ–‡ä»¶æ‰“å¼€çš„çŠ¶æ€, fs_close()å¯ä»¥ç›´æ¥è¿”å›0, è¡¨ç¤ºæ€»æ˜¯å…³é—­æˆåŠŸ.\næœ€åä½ è¿˜éœ€è¦åœ¨Nanos-liteå’ŒNavyçš„libosä¸­æ·»åŠ ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨, æ¥è°ƒç”¨ç›¸åº”çš„æ–‡ä»¶æ“ä½œ.\nä¸€å¼€å§‹çœ‹ä¸æ‡‚è¡¨è¾¾çš„æ„æ€æ˜¯å•¥ã€‚ã€‚ã€‚çœ‹ç€çœ‹ç€æ‰“ç®—å…ˆå†™äº†å†è¯´ã€‚ä¸€é¡¿æ“ä½œçŒ›å¦‚è™æˆåŠŸï¼šï¼ˆè‡ªç”±åˆ‡æ¢æ–‡ä»¶ï¼Œæ‹¦æˆªäº†å¥‡æ€ªçš„æƒ…å†µï¼‰\nä¸€å¼€å§‹ä¸€ç›´æƒ³ä¸åˆ°æ€ä¹ˆåœ¨loaderå¯¹æ®µå¤´è¡¨å¤„ç†éƒ¨åˆ†å¯ä»¥éš”ç¦»å¯¹ramdisk_readçš„ä¾èµ–ï¼Œå› ä¸ºå‚æ•°æ•°ç›®ä¸åŒ¹é…ã€‚éšåçªç„¶æƒ³åˆ°å¯ä»¥ç”¨lseekè®¾ç½®åç§»å†è¯»å†™æ“ä½œï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç»“æ„ä½“åç§»é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæŠ½è±¡å°±æ˜¯å¯ä»¥è¢«å®Œæˆçš„äº†ã€‚ä¸€é¡¿æ“ä½œçŒ›å¦‚è™è§£é™¤äº†loaderçš„è€¦åˆã€‚\n(è¿™é‡Œè¦æ³¨æ„navyç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼Œè¯·æŒ‰ç…§manå¡«å†™å¦åˆ™åƒå¤§äºï¼æ‰‹å†Œï¼æ‰‹å†Œï¼æ‰‹å†Œï¼ï¼‰\næˆ‘è¿™é‡Œè¿˜é‡åˆ°ä¸€ä¸ªå¾ˆå‘çš„é—®é¢˜ï¼šè¾¹ç•Œæ‹¦æˆªï¼Œè‡ªå·±æŠŠè‡ªå·±å‘äº†ï¼Œå› ä¸ºå®é™…ä¸Šå¤±è´¥è¿”å›-1å³å¯ï¼Œæˆ‘è‡ªå·±ç»™è‡ªå·±panicäº†- -ã€‚ã€‚ã€‚ã€‚è¿™ä»¶äº‹æƒ…å‘Šè¯‰æˆ‘ä»¬ï¼Œå¥½å¥½æŒ‰ç…§mançš„è§„å®šä¸è¦è‡ªå·±èŠ±é‡Œèƒ¡å“¨QAQ\nä¸ºäº†æ›´å¥½çš„è°ƒè¯•ï¼Œå­¦ä¹ ponyå“¥æ–¹æ³•ç»™logæ¢äº†ä¸ªçš®è‚¤ï¼š\nhttps://cloud.tencent.com/developer/article/1142372\nä¸€åˆ‡çš†æ–‡ä»¶ æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼å¯¹è®¾å¤‡çš„åŠŸèƒ½è¿›è¡ŒæŠ½è±¡, å‘ç”¨æˆ·ç¨‹åºæä¾›ç»Ÿä¸€çš„æ¥å£.\nå†…å­˜æ˜¯ä»¥å­—èŠ‚ç¼–å€çš„, å¤©ç„¶å°±æ˜¯ä¸€ä¸ªå­—èŠ‚åºåˆ—, å› è€Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ramdiskä½œä¸ºå­—èŠ‚åºåˆ—ä¹Ÿæ›´åŠ æ˜¾è€Œæ˜“è§äº†\nç®¡é“(shellå‘½ä»¤ä¸­çš„|)æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„å­—èŠ‚åºåˆ—, æœ¬è´¨ä¸Šå®ƒæ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªé˜Ÿåˆ—ç¼“å†²åŒº\nç£ç›˜ä¹Ÿå¯ä»¥çœ‹æˆä¸€ä¸ªå­—èŠ‚åºåˆ—: æˆ‘ä»¬å¯ä»¥ä¸ºç£ç›˜ä¸Šçš„æ¯ä¸€ä¸ªå­—èŠ‚è¿›è¡Œç¼–å·, ä¾‹å¦‚ç¬¬xæŸ±é¢ç¬¬yç£å¤´ç¬¬zæ‰‡åŒºä¸­çš„ç¬¬nå­—èŠ‚, æŠŠç£ç›˜ä¸Šçš„æ‰€æœ‰å­—èŠ‚æŒ‰ç…§ç¼–å·çš„å¤§å°è¿›è¡Œæ’åˆ—, ä¾¿å¾—åˆ°äº†ä¸€ä¸ªå­—èŠ‚åºåˆ—\nsocket(ç½‘ç»œå¥—æ¥å­—)ä¹Ÿæ˜¯ä¸€ç§å­—èŠ‚åºåˆ—, å®ƒæœ‰ä¸€ä¸ªç¼“å†²åŒº,** è´Ÿè´£å­˜æ”¾æ¥æ”¶åˆ°çš„ç½‘ç»œæ•°æ®åŒ…**,ä¸Šå±‚åº”ç”¨å°†socketä¸­çš„å†…å®¹çœ‹åšæ˜¯å­—èŠ‚åºåˆ—, å¹¶é€šè¿‡ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶æ“ä½œæ¥å¤„ç†å®ƒä»¬. æˆ‘ä»¬åœ¨PA2ä¸­ä»‹ç»äº†DiffTest, å¦‚æœä½ RTFSC, å°±ä¼šå‘ç°å…¶ä¸­çš„qemu-diffå°±æ˜¯é€šè¿‡socketä¸QEMUè¿›è¡Œé€šä¿¡çš„, è€Œæ“ä½œsocketçš„æ–¹å¼å°±æ˜¯fgetc()å’Œfputc()\næ“ä½œç³»ç»Ÿæä¾›çš„ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½, å¦‚éšæœºæ•°ç”Ÿæˆå™¨, ä¹Ÿå¯ä»¥çœ‹æˆä¸€ä¸ªæ— ç©·é•¿çš„å­—èŠ‚åºåˆ—\næ–‡ä»¶å°±æ˜¯å­—èŠ‚åºåˆ—, é‚£å¾ˆè‡ªç„¶åœ°, ä¸Šé¢è¿™äº›äº”èŠ±å…«é—¨çš„å­—èŠ‚åºåˆ—åº”è¯¥éƒ½å¯ä»¥çœ‹æˆæ–‡ä»¶. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–‡ä»¶çš„æ¥å£æ¥æ“ä½œè®¡ç®—æœºä¸Šçš„ä¸€åˆ‡, è€Œä¸å¿…å¯¹å®ƒä»¬è¿›è¡Œè¯¦ç»†çš„åŒºåˆ†: ä¾‹å¦‚ navy-apps/Makefileçš„ramdiskè§„åˆ™é€šè¿‡ç®¡é“æŠŠå„ä¸ªshellå·¥å…·çš„è¾“å…¥è¾“å‡ºè¿èµ·æ¥, ç”Ÿæˆæ–‡ä»¶è®°å½•è¡¨\nè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ çœŸå®æ–‡ä»¶ç³»ç»Ÿ, å…¶å®æ˜¯æŒ‡å…·ä½“å¦‚ä½•æ“ä½œæŸä¸€ç±»æ–‡ä»¶ã€‚\nVFSå…¶å®æ˜¯å¯¹ä¸åŒç§ç±»çš„çœŸå®æ–‡ä»¶ç³»ç»Ÿçš„æŠ½è±¡,** å®ƒç”¨ä¸€ç»„APIæ¥æè¿°äº†è¿™äº›çœŸå®æ–‡ä»¶ç³»ç»Ÿçš„æŠ½è±¡è¡Œä¸º, å±è”½äº†çœŸå®æ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„å·®å¼‚,** ä¸Šå±‚æ¨¡å—(æ¯”å¦‚ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°)ä¸å¿…å…³å¿ƒå½“å‰æ“ä½œçš„æ–‡ä»¶å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹, åªè¦è°ƒç”¨è¿™ä¸€ç»„APIå³å¯å®Œæˆç›¸åº”çš„æ–‡ä»¶æ“ä½œ\nåªè¦æŠŠçœŸå®æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æ–¹å¼åŒ…è£…æˆVFSçš„API, ä¸Šå±‚æ¨¡å—æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç , å°±èƒ½æ”¯æŒä¸€ä¸ªæ–°çš„çœŸå®æ–‡ä»¶ç³»ç»Ÿäº†\nå…¶ä¸­ReadFnå’ŒWriteFnåˆ†åˆ«æ˜¯ä¸¤ç§å‡½æ•°æŒ‡é’ˆ, å®ƒä»¬ç”¨äºæŒ‡å‘çœŸæ­£è¿›è¡Œè¯»å†™çš„å‡½æ•°, å¹¶è¿”å›æˆåŠŸè¯»å†™çš„å­—èŠ‚æ•°. æœ‰äº†è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆ, æˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ä»¶è®°å½•è¡¨ä¸­å¯¹ä¸åŒçš„æ–‡ä»¶è®¾ç½®ä¸åŒçš„è¯»å†™å‡½æ•°, å°±å¯ä»¥é€šè¿‡f-\u0026gt;read()å’Œf-\u0026gt;write()çš„æ–¹å¼æ¥è°ƒç”¨å…·ä½“çš„è¯»å†™å‡½æ•°äº†.\nç”±äºç‰¹æ®Šæ–‡ä»¶çš„æ•°é‡å¾ˆå°‘, æˆ‘ä»¬çº¦å®š, å½“ä¸Šè¿°çš„å‡½æ•°æŒ‡é’ˆä¸ºNULLæ—¶, è¡¨ç¤ºç›¸åº”æ–‡ä»¶æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶, é€šè¿‡ramdiskçš„APIæ¥è¿›è¡Œæ–‡ä»¶çš„è¯»å†™, è¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦ä¸ºå¤§å¤šæ•°çš„æ™®é€šæ–‡ä»¶æ˜¾å¼æŒ‡å®šramdiskçš„è¯»å†™å‡½æ•°äº†.\næˆ‘ä»¬æŠŠæ–‡ä»¶çœ‹æˆå­—èŠ‚åºåˆ—, å¤§éƒ¨åˆ†å­—èŠ‚åºåˆ—éƒ½æ˜¯\u0026quot;é™æ­¢\u0026quot;çš„, ä¾‹å¦‚å¯¹äºramdiskå’Œç£ç›˜ä¸Šçš„æ–‡ä»¶, å¦‚æœæˆ‘ä»¬ä¸å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹, å®ƒä»¬å°±ä¼šä¸€ç›´ä½äºåŒä¸€ä¸ªåœ°æ–¹, è¿™æ ·çš„å­—èŠ‚åºåˆ—å…·æœ‰\u0026quot;ä½ç½®\u0026quot;çš„æ¦‚å¿µ; ä½†æœ‰ä¸€äº›ç‰¹æ®Šçš„å­—èŠ‚åºåˆ—å¹¶ä¸æ˜¯è¿™æ ·, ä¾‹å¦‚é”®å…¥æŒ‰é”®çš„å­—èŠ‚åºåˆ—æ˜¯\u0026quot;æµåŠ¨\u0026quot;çš„, è¢«è¯»å‡ºä¹‹åå°±ä¸å­˜åœ¨äº†, è¿™æ ·çš„å­—èŠ‚åºåˆ—ä¸­çš„å­—èŠ‚ä¹‹é—´åªæœ‰é¡ºåºå…³ç³», ä½†æ— æ³•ç¼–å·, å› æ­¤å®ƒä»¬æ²¡æœ‰\u0026quot;ä½ç½®\u0026quot;çš„æ¦‚å¿µ. å±äºå‰è€…çš„æ–‡ä»¶æ”¯æŒlseekæ“ä½œ, å­˜å‚¨è¿™äº›æ–‡ä»¶çš„è®¾å¤‡ç§°ä¸º\u0026quot;å—è®¾å¤‡\u0026quot;; è€Œå±äºåè€…çš„æ–‡ä»¶åˆ™ä¸æ”¯æŒlseekæ“ä½œ, ç›¸åº”çš„è®¾å¤‡ç§°ä¸º\u0026quot;å­—ç¬¦è®¾å¤‡\u0026quot;. çœŸå®çš„æ“ä½œç³»ç»Ÿè¿˜ä¼šå¯¹lseekæ“ä½œè¿›è¡ŒæŠ½è±¡, æˆ‘ä»¬åœ¨Nanos-liteä¸­è¿›è¡Œäº†ç®€åŒ–, å°±ä¸å®ç°è¿™ä¸€æŠ½è±¡äº†.\næ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„IOE æœ‰äº†VFS, è¦æŠŠIOEæŠ½è±¡æˆæ–‡ä»¶å°±éå¸¸ç®€å•äº†.\nä¸²å£. åœ¨Nanos-liteä¸­, stdoutå’Œstderréƒ½ä¼šè¾“å‡ºåˆ°ä¸²å£. ä¹‹å‰ä½ å¯èƒ½ä¼šé€šè¿‡åˆ¤æ–­fdæ˜¯å¦ä¸º1æˆ–2, æ¥å†³å®šsys_write()æ˜¯å¦å†™å…¥åˆ°ä¸²å£. ç°åœ¨æœ‰äº†VFS, æˆ‘ä»¬å°±ä¸éœ€è¦è®©ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°å…³å¿ƒè¿™äº›ç‰¹æ®Šæ–‡ä»¶çš„æƒ…å†µäº†: æˆ‘ä»¬åªéœ€è¦åœ¨nanos-lite/src/device.cä¸­å®ç°serial_write(), ç„¶ååœ¨æ–‡ä»¶è®°å½•è¡¨ä¸­è®¾ç½®ç›¸åº”çš„å†™å‡½æ•°, å°±å¯ä»¥å®ç°ä¸Šè¿°åŠŸèƒ½äº†. ç”±äºä¸²å£æ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡, å¯¹åº”çš„å­—èŠ‚åºåˆ—æ²¡æœ‰\u0026quot;ä½ç½®\u0026quot;çš„æ¦‚å¿µ, å› æ­¤serial_write()ä¸­çš„offsetå‚æ•°å¯ä»¥å¿½ç•¥. å¦å¤–Nanos-liteä¹Ÿä¸æ‰“ç®—æ”¯æŒstdinçš„è¯»å…¥, å› æ­¤åœ¨æ–‡ä»¶è®°å½•è¡¨ä¸­è®¾ç½®ç›¸åº”çš„æŠ¥é”™å‡½æ•°å³å¯.\nè¿™ä¸€æ­¥æ¯”è¾ƒç®€å•ï¼Œå°±æŒ‰ç…§æè¿°åŠ å…¥å³å¯ï¼ŒæŠŠfswriteè¿›è¡Œä¸€ä¸‹æŠ½è±¡\nåœ¨Nanos-liteä¸­, æˆ‘ä»¬ä¹Ÿæä¾›ä¸€ä¸ªSYS_gettimeofdayç³»ç»Ÿè°ƒç”¨, ç”¨æˆ·ç¨‹åºå¯ä»¥é€šè¿‡å®ƒè¯»å‡ºå½“å‰çš„ç³»ç»Ÿæ—¶é—´.\næ ¹æ®ä»¥å‰çš„amä¾è‘«èŠ¦ç”»ç“¢ï¼ˆå®é™…ä¸Šæˆ‘ä»¬èƒ½çŸ¥é“amå°±æ˜¯ä¸ºäº†è¿™æ—¶å€™åšå‡†å¤‡ï¼‰\næ›¿æ¢æˆNDLåº“çš„è¿‡ç¨‹ä¸­ï¼Œæ³¨æ„NDLçš„å¯¼å…¥ï¼ˆæƒ³æƒ³makeçš„æ—¶å€™æ€ä¹ˆæœç´¢åº“ï¼‰\nå¦ä¸€ä¸ªè¾“å…¥è®¾å¤‡æ˜¯é”®ç›˜, æŒ‰é”®ä¿¡æ¯å¯¹ç³»ç»Ÿæ¥è¯´æœ¬è´¨ä¸Šå°±æ˜¯åˆ°æ¥äº†ä¸€ä¸ªäº‹ä»¶. ä¸€ç§ç®€å•çš„æ–¹å¼æ˜¯æŠŠäº‹ä»¶ä»¥æ–‡æœ¬çš„å½¢å¼è¡¨ç°å‡ºæ¥, æˆ‘ä»¬å®šä¹‰ä»¥ä¸‹ä¸¤ç§äº‹ä»¶,\næŒ‰ä¸‹æŒ‰é”®äº‹ä»¶, å¦‚kd RETURNè¡¨ç¤ºæŒ‰ä¸‹å›è½¦é”®\næ¾å¼€æŒ‰é”®äº‹ä»¶, å¦‚ku Aè¡¨ç¤ºæ¾å¼€Aé”®\næŒ‰é”®åç§°ä¸AMä¸­çš„å®šä¹‰çš„æŒ‰é”®åç›¸åŒ, å‡ä¸ºå¤§å†™. æ­¤å¤–, ä¸€ä¸ªäº‹ä»¶ä»¥æ¢è¡Œç¬¦\\nç»“æŸ.\næˆ‘ä»¬é‡‡ç”¨æ–‡æœ¬å½¢å¼æ¥æè¿°äº‹ä»¶æœ‰ä¸¤ä¸ªå¥½å¤„, é¦–å…ˆæ–‡æœ¬æ˜¾ç„¶æ˜¯ä¸€ç§å­—èŠ‚åºåˆ—, è¿™ä½¿å¾—äº‹ä»¶å¾ˆå®¹æ˜“æŠ½è±¡æˆæ–‡ä»¶; æ­¤å¤–æ–‡æœ¬æ–¹å¼ä½¿å¾—ç”¨æˆ·ç¨‹åºå¯ä»¥å®¹æ˜“å¯è¯»åœ°è§£æäº‹ä»¶çš„å†…å®¹. Nanos-liteå’ŒNavyçº¦å®š, ä¸Šè¿°äº‹ä»¶æŠ½è±¡æˆä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶/dev/events, å®ƒéœ€è¦æ”¯æŒè¯»æ“ä½œ, ç”¨æˆ·ç¨‹åºå¯ä»¥ä»ä¸­è¯»å‡ºæŒ‰é”®äº‹ä»¶, ä½†å®ƒä¸å¿…æ”¯æŒlseek, å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡.\nè¿™é‡Œå…³é”®é—®é¢˜è¦ç†è§£ï¼šé”®å…¥æŒ‰é”®çš„å­—èŠ‚åºåˆ—æ˜¯\u0026quot;æµåŠ¨\u0026quot;çš„, è¢«è¯»å‡ºä¹‹åå°±ä¸å­˜åœ¨äº†, å®ƒä»¬æ²¡æœ‰\u0026quot;ä½ç½®\u0026quot;çš„æ¦‚å¿µ. å±äºåè€…çš„æ–‡ä»¶åˆ™ä¸æ”¯æŒlseekæ“ä½œ, ç›¸åº”çš„è®¾å¤‡ç§°ä¸º\u0026quot;å­—ç¬¦è®¾å¤‡\u0026quot;ï¼Œè¯´æ˜æˆ‘ä»¬éœ€è¦è®©æ•°æ®ç›´æ¥è¢«â€œè¯»å‡ºâ€ï¼Œä¹Ÿå°±æ˜¯è¯»å‡½æ•°ä¸­äº¤äº’è¿‡ç¨‹èƒ½ç›´æ¥æŠŠæ•°æ®ä¼ é€åˆ°æˆ‘ä»¬éœ€è¦çš„åœ°æ–¹ã€‚\nç­”ï¼šå®é™…ä¸Šfopenå¾—åˆ°çš„FILEä¹Ÿæ˜¯å¯ä»¥é€šè¿‡è½¬æ¢å¾—åˆ°æœ€åçš„fdçš„ï¼Œä½†æ˜¯ä¹‹æ‰€ä»¥ä¸ç”¨æ˜¯å› ä¸ºå¯èƒ½é”™è¯¯ä½¿ç”¨äº†freadï¼Œå› ä¸ºè¿™ç³»åˆ—çš„è¯»å†™æ“ä½œå®é™…ä¸Šæ˜¯å¯¹FILEé‡Œé¢çš„ç¼“å†²åŒºè¿›è¡Œæ“ä½œçš„ï¼Œè€Œæˆ‘ä»¬çš„è®¾å¤‡æ–‡ä»¶éœ€è¦ç›´æ¥æŠŠæˆ‘ä»¬éœ€è¦çš„bufæ‰“å°ã€‚\næ³¨æ„å¯¹å¥½å„ç±»æ¥å£ï¼ˆè¿”å›å€¼ 0å’Œ1ä»¥åŠå¯¹åº”çš„bufä¼ è¾“é“¾å³å¯å¾—åˆ°ç»“æœï¼‰\nNanos-liteéœ€è¦åšçš„, ä¾¿æ˜¯æŠŠæ˜¾å­˜æŠ½è±¡æˆæ–‡ä»¶. æ˜¾å­˜æœ¬èº«ä¹Ÿæ˜¯ä¸€æ®µå­˜å‚¨ç©ºé—´, å®ƒä»¥è¡Œä¼˜å…ˆçš„æ–¹å¼å­˜å‚¨äº†å°†è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„åƒç´ . Nanos-liteå’ŒNavyçº¦å®š, æŠŠæ˜¾å­˜æŠ½è±¡æˆæ–‡ä»¶/dev/fb(fbä¸ºframe bufferä¹‹æ„), å®ƒéœ€è¦æ”¯æŒå†™æ“ä½œå’Œlseek, ä»¥ä¾¿äºæŠŠåƒç´ æ›´æ–°åˆ°å±å¹•çš„æŒ‡å®šä½ç½®ä¸Š.\nå…¶ä¸­\u0026quot;ç”»å¸ƒ\u0026quot;æ˜¯ä¸€ä¸ªé¢å‘ç¨‹åºçš„æ¦‚å¿µ, ç¨‹åºç»˜å›¾æ—¶çš„åæ ‡éƒ½æ˜¯é’ˆå¯¹ç”»å¸ƒæ¥è®¾å®šçš„, è¿™æ ·ç¨‹åºå°±æ— éœ€å…³å¿ƒç³»ç»Ÿå±å¹•çš„å¤§å°, ä»¥åŠéœ€è¦å°†å›¾åƒç»˜åˆ¶åˆ°ç³»ç»Ÿå±å¹•çš„å“ªä¸€ä¸ªä½ç½®. NDLå¯ä»¥æ ¹æ®ç³»ç»Ÿå±å¹•å¤§å°ä»¥åŠç”»å¸ƒå¤§å°, æ¥å†³å®šå°†ç”»å¸ƒ\u0026quot;è´´\u0026quot;åˆ°å“ªé‡Œ, ä¾‹å¦‚è´´åˆ°å±å¹•å·¦ä¸Šè§’æˆ–è€…å±…ä¸­, ä»è€Œå°†ç”»å¸ƒçš„å†…å®¹å†™å…¥åˆ°frame bufferä¸­æ­£ç¡®çš„ä½ç½®.\nNDL_DrawRect()çš„åŠŸèƒ½å’ŒPA2ä¸­ä»‹ç»çš„ç»˜å›¾æ¥å£æ˜¯éå¸¸ç±»ä¼¼çš„. ä½†ä¸ºäº†å®ç°å®ƒ, NDLè¿˜éœ€è¦çŸ¥é“å±å¹•å¤§å°çš„ä¿¡æ¯. Nanos-liteå’ŒNavyçº¦å®š, å±å¹•å¤§å°çš„ä¿¡æ¯é€šè¿‡/proc/dispinfoæ–‡ä»¶æ¥è·å¾—, å®ƒéœ€è¦æ”¯æŒè¯»æ“ä½œ. navy-apps/README.mdä¸­å¯¹è¿™ä¸ªæ–‡ä»¶å†…å®¹çš„æ ¼å¼è¿›è¡Œäº†çº¦å®š, ä½ éœ€è¦é˜…è¯»å®ƒ. è‡³äºå…·ä½“çš„å±å¹•å¤§å°, ä½ éœ€è¦é€šè¿‡IOEçš„ç›¸åº”APIæ¥è·å–.\næŠŠVGAæ˜¾å­˜æŠ½è±¡æˆæ–‡ä»¶ å®ç°fb_write()(åœ¨nanos-lite/src/device.cä¸­å®šä¹‰), ç”¨äºæŠŠbufä¸­çš„lenå­—èŠ‚å†™åˆ°å±å¹•ä¸Šoffsetå¤„. ä½ éœ€è¦å…ˆä»offsetè®¡ç®—å‡ºå±å¹•ä¸Šçš„åæ ‡, ç„¶åè°ƒç”¨IOEæ¥è¿›è¡Œç»˜å›¾. å¦å¤–æˆ‘ä»¬çº¦å®šæ¯æ¬¡ç»˜å›¾åæ€»æ˜¯é©¬ä¸Šå°†frame bufferä¸­çš„å†…å®¹åŒæ­¥åˆ°å±å¹•ä¸Š.\nåœ¨NDLä¸­å®ç°NDL_DrawRect(), é€šè¿‡å¾€/dev/fbä¸­çš„æ­£ç¡®ä½ç½®å†™å…¥åƒç´ ä¿¡æ¯æ¥ç»˜åˆ¶å›¾åƒ. ä½ éœ€è¦æ¢³ç†æ¸…æ¥šç³»ç»Ÿå±å¹•(å³frame buffer), NDL_OpenCanvas()æ‰“å¼€çš„ç”»å¸ƒ, ä»¥åŠNDL_DrawRect()æŒ‡ç¤ºçš„ç»˜åˆ¶åŒºåŸŸä¹‹é—´çš„ä½ç½®å…³ç³».\nè®©Nanos-liteè¿è¡Œnavy-apps/tests/bmp-test, å¦‚æœå®ç°æ­£ç¡®, ä½ å°†ä¼šçœ‹åˆ°å±å¹•ä¸Šæ˜¾ç¤ºProject-Nçš„logo.\nè¿™é‡Œæˆ‘ä¸€ç›´å¡ç€æ²¡åšå‡ºæ¥ï¼Œä¸»è¦æ˜¯ä¸ç†è§£fb_writeå’ŒNDL_DrawRectåˆ°åº•è¦åšä»€ä¹ˆã€‚å®é™…ä¸Šè¦ç†è§£çš„æ˜¯ï¼Œç»˜åˆ¶å·¥ä½œå·²ç»è¢«amå®Œæˆäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å§æ•°æ®å…¨éƒ¨ä¸¢è¿‡å»å³å¯ã€‚è€Œé‡è¦çš„æ˜¯åœ¨fsçš„ç‰¹åˆ«writeä¸­æ ¹æ®amçš„æ¥å£æŠŠæˆ‘ä»¬çš„æ•°æ®å–‚è¿‡å»ï¼ˆéœ€è¦w,h,x,yçš„ä¿¡æ¯ï¼‰ï¼Œè€ŒNDLæ˜¯ä¸ºå–‚è¿‡å»è€Œå‡†å¤‡çš„ã€‚\nã€å…¶å®å°±è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨navyä¸­çš„è¯»å†™å…¶å®éƒ½æ˜¯ä¾é fså®Œæˆï¼Œæ‰€ä»¥å¯¹åº”çš„buffå’Œlenéƒ½æ˜¯åœ¨navyæ‰è¿›è¡Œå¤„ç†ï¼Œå› ä¸ºé‚£æ‰æ˜¯çœŸæ­£è°ƒç”¨å¤„ç†çš„å‡½æ•°ï¼Œæƒ³æƒ³ä»–ä»¬æ‹¿åˆ°çš„ä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸æ˜¯ä¸€æ ·ã€‘\nç²¾å½©çº·å‘ˆçš„åº”ç”¨ç¨‹åº miniSDLçš„ä»£ç ä½äºnavy-apps/libs/libminiSDL/ç›®å½•ä¸‹, å®ƒç”±6ä¸ªæ¨¡å—ç»„æˆ:\ntimer.c: æ—¶é’Ÿç®¡ç†\nevent.c: äº‹ä»¶å¤„ç†\nvideo.c: ç»˜å›¾æ¥å£\nfile.c: æ–‡ä»¶æŠ½è±¡\naudio.c: éŸ³é¢‘æ’­æ”¾\ngeneral.c: å¸¸è§„åŠŸèƒ½, åŒ…æ‹¬åˆå§‹åŒ–, é”™è¯¯ç®¡ç†ç­‰\næˆ‘ä»¬å¯ä»¥é€šè¿‡NDLæ¥æ”¯æ’‘miniSDLçš„åº•å±‚å®ç°, è®©miniSDLå‘ç”¨æˆ·ç¨‹åºæä¾›æ›´ä¸°å¯Œçš„åŠŸèƒ½, è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨Navyä¸Šè¿è¡Œæ›´å¤æ‚çš„ç¨‹åºäº†. miniSDLä¸­çš„APIå’ŒSDLåŒå, ä½ å¯ä»¥é€šè¿‡RTFMæ¥æŸ¥é˜…è¿™äº›APIçš„å…·ä½“è¡Œä¸º. å¦å¤–miniSDLä¸­çš„å¤§éƒ¨åˆ†APIéƒ½æ²¡æœ‰å®ç°, ä½ æœ€å¥½æƒ³ä¸ªåŠæ³•è®©ç¨‹åºç”¨åˆ°æŸä¸ªæœªå®ç°APIçš„æ—¶å€™æé†’ä½ , å¦åˆ™ä½ å¯èƒ½éš¾ä»¥ç†è§£ç”±æ­¤å¯¼è‡´çš„å¤æ‚ç¨‹åºéé¢„æœŸè¡Œä¸º.\nè™½ç„¶Navyçš„nativeå’ŒAMä¸­çš„nativeåŒå, ä½†å®ƒä»¬çš„æœºåˆ¶æ˜¯ä¸åŒçš„: åœ¨AM nativeä¸Šè¿è¡Œçš„ç³»ç»Ÿ, éœ€è¦AM, Nanos-lite, libos, libcè¿™äº›æŠ½è±¡å±‚æ¥æ”¯æ’‘ä¸Šè¿°çš„è¿è¡Œæ—¶ç¯å¢ƒ, åœ¨AMä¸­çš„ARCH=native, åœ¨Navyä¸­å¯¹åº”çš„æ˜¯ISA=am_native; è€Œåœ¨Navy nativeä¸­, ä¸Šè¿°è¿è¡Œæ—¶ç¯å¢ƒæ˜¯ç›´æ¥ç”±Linux nativeå®ç°çš„.\né—®ï¼šç¥å¥‡çš„LD_PRELOAD bmp-testéœ€è¦æ‰“å¼€ä¸€ä¸ªè·¯å¾„ä¸º/share/pictures/projectn.bmpçš„æ–‡ä»¶, ä½†åœ¨Linux nativeä¸­, è¿™ä¸ªè·¯å¾„å¯¹åº”çš„æ–‡ä»¶å¹¶ä¸å­˜åœ¨. ä½†æˆ‘ä»¬è¿˜æ˜¯æŠŠbmp-testæˆåŠŸè¿è¡Œèµ·æ¥äº†, ä½ çŸ¥é“è¿™æ˜¯å¦‚ä½•å®ç°çš„å—? å¦‚æœä½ æ„Ÿå…´è¶£, å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæœç´¢LD_PRELOADç›¸å…³çš„å†…å®¹.\nç­”ï¼šLD_PRELOADæ˜¯Linuxç³»ç»Ÿçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸ä½ å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå·±çš„æˆ–æ˜¯æ›´å¥½çš„å‡½æ•°ï¼ˆæ— éœ€åˆ«äººçš„æºç ï¼‰ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥ç¨‹åºï¼Œä»è€Œè¾¾åˆ°ç‰¹å®šçš„ç›®çš„ã€‚\nSDL2å¸¸ç”¨å‡½æ•°\u0026amp;ç»“æ„åˆ†æ:SDL_Surface\u0026amp;SDL_GetWindowSurface\u0026amp;SDL_LoadBMP\nhttps://blog.csdn.net/qq_25333681/article/details/89789479\nå¹»ç¯ç‰‡æ˜¾ç¤ºï¼š\nè¿™é‡Œçš„pdfè½¬æ¢ä¸€å¼€å§‹æˆ‘è¿˜ä»¥ä¸ºåªèƒ½è½¬æ¢å¼€å¤´é‚£å¼ pdfã€‚ã€‚ã€‚ç»è¿‡æŸ¥èµ„æ–™åæˆåŠŸè½¬äº†å…¶ä»–é¡µé¢~\næœ‰å¯èƒ½ä¼šå‡ºç°æ•°å­—é”®çˆ†ç‚¸çš„é—®é¢˜ï¼Œè¯·æ³¨æ„æ˜¯å¦æ¸…é™¤ç¼“å­˜ä»¥åŠé”®ç›˜typeã€‚\næ¥ä¸‹æ¥å®ç°menuï¼Œæœ‰ç‚¹ç—›ä¸æ¬²ç”Ÿã€‚ã€‚ã€‚\nå…¶å®SDL_FillRectçš„å…³é”®æ˜¯è¦ç†è§£ä»€ä¹ˆæ˜¯åƒç´ ã€‚ã€‚ã€‚å…¶å®åƒç´ æ˜¯ä¸€ä¸ªâ€œæ•°ç»„â€é‡Œé¢æ ¹æ®00rrrggbb00rrrggbbè¿™æ ·çš„æ–¹å¼æ’åˆ—ä¸‹å»ï¼ˆ4byteçš„æƒ…å†µï¼‰ï¼Œç†è§£äº†è¿™ç‚¹å°±å¥½åŠäº†ã€‚ç†è§£ç”»å¸ƒå¹¶ä¸æ˜¯è¦ç”»ä¸Šå»ï¼Œåªæ˜¯å‡†å¤‡ç”»å¸ƒã€‚\næ¥ä¸‹æ¥æœ€éš¾çš„å°±æ˜¯SDL_BlitSurfaceçš„å®ç°ï¼š\nå®ç°åèƒ½çœ‹åˆ°è¿™æ ·çš„ç”»é¢ï¼šå¼€å§‹èœå•ï¼ˆè¿˜æ²¡æœ‰execveçš„åŠŸèƒ½ï¼‰\nNTerm (NJU Terminal) Flappy Bird è¿™é‡Œæˆ‘é¦–å½“å…¶å†²é‡åˆ°äº†çˆ†ç‚¸é—®é¢˜ï¼šfe_readå‡ºè¾¹ç•Œï¼Œä½†å®é™…ä¸Šæ˜¯æ‰‹å†Œæ²¡è¯»å¥½çš„é—®é¢˜ã€‚ã€‚ã€‚ã€‚ï¼ˆè¢«ponyå“¥æ‹¯æ•‘ç³»åˆ—ï¼‰\nç„¶ååˆé‡åˆ°äº†- -ç¥å¥‡çš„æŒ‰é”®æ²¡ååº”çš„æƒ…å†µã€‚ã€‚ã€‚ã€‚åé¢å‘ç°æ˜¯å¯¹â€œäº‹ä»¶â€ä¸å¤Ÿç†è§£ã€‚ã€‚ã€‚å¦‚æœä½ ä¹Ÿé‡åˆ°äº†è¯·ä»”ç»†é˜…è¯»äº‹ä»¶çš„å®šä¹‰ç„¶ååæ€ä¸‹æŸä¸ªå‡½æ•°æ˜¯å¦è¿”å›æ­£ç¡®ã€‚ã€‚ã€‚ã€‚\nä»™å‰‘å¥‡ä¾ ä¼  é¦–å…ˆå¾ˆå¿«å°±æ‰¾åˆ°äº†dataï¼ˆå°±æ˜¯dataï¼Œå…¶ä»–èŠ±é‡Œèƒ¡å“¨çš„ä¸ç®—ï¼‰ç„¶åä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸€å¨å¤§å†™æ–‡ä»¶å‘ç°æ®µé”™è¯¯ã€‚ã€‚ã€‚ã€‚è¿™é‡Œæ˜¯ä¸ªå‘\nã€å…·ä½“æŸ¥æ‰¾è¿‡ç¨‹å¼€gdbï¼Œä½ ä¼šå‘ç°å‡ºé”™çš„åœ°æ–¹ã€‚ã€‚ã€‚ã€‚ã€‚å»ºè®®ä¸è¦æ”¾è¿‡è¿™ä¸ªè¿‡ç¨‹ã€‚ã€‘\né¦–å…ˆåœ¨palä¸‹è¿è¡Œmake ISA=native gdb æŸ¥æ‰¾æ®µé”™è¯¯çš„åŸå› ï¼Œæ­¤æ—¶ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªioé”™è¯¯ï¼Œfp=NULLï¼ˆ0x0ï¼‰ï¼Œé‚£ä¹ˆæ˜¯ä»€ä¹ˆæ–‡ä»¶æ‰“å¼€é”™è¯¯å‘¢ï¼Ÿ\næ³¨æ„åˆ°è®²ä¹‰ï¼šæ­¤å¤–, ä½ è¿˜éœ€è¦åˆ›å»ºé…ç½®æ–‡ä»¶sdlpal.cfg, å…·ä½“è¯·é˜…è¯»repo/docs/README.mdå’Œrepo/docs/sdlpal.cfg.example.\nä¸€é¡¿æ“ä½œæ‰¾åˆ°äº†cfgæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªè¦æ”¾åœ¨é‚£å‘¢ï¼Ÿ\nå…ˆåœ¨makefileä¸­åŠ å…¥-g æ–¹ä¾¿è°ƒè¯•ï¼ˆå…·ä½“ä»€ä¹ˆåœ°æ–¹è‡ªå·±æ‰¾appsï¼‰ï¼Œç„¶ååœ¨palä¸‹ç»§ç»­gdbï¼Œrç»“æŸåbtæ‰“å°å †æ ˆä¿¡æ¯ï¼Œè¿™æ—¶å€™ä½ å°±ä¼šå‘ç°è®¿é—®æŸä¸ªæ–‡ä»¶å‡ºé”™äº†ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶å³å¯ï¼ˆæˆ–è€…æŠŠcfgæ”¾è¿›å»ã€‚ï¼‰ã€‚å¦‚æœä½ å‘ç°ä»–éœ€è¦è®¿é—®æŸä¸ªshare/gamesä¹‹ç±»çš„æ–‡ä»¶ä¿¡æ¯ï¼Œæ£€æŸ¥ä¸‹æœ‰æ²¡æœ‰ï¼Œç„¶åæƒ³æƒ³åœ¨ä¹‹å‰çš„å°é¸Ÿä¸‹åšäº†ä»€ä¹ˆæ“ä½œã€‚\nåå¤æµ‹è¯•ç›´åˆ°make ISA=native runä¸æŠ¥é”™ï¼Œæ­¤æ—¶ä½ å°±å‘ç°make run å¯ä»¥è¿è¡Œäº†ï¼\nä½†æ˜¯åœ¨è¿™é‡Œnativeè¿˜ä¸èƒ½è¿è¡Œï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å¤„ç†è°ƒè‰²ç›˜ï¼ˆè¿™é‡Œå…³é”®çš„æ˜¯ç†è§£è°ƒè‰²ç›˜ï¼‰\næ³¨æ„åˆ°æ­¤æ—¶çš„pixelsåªæ˜¯ç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦åšçš„å°±æ˜¯å–å‡ºçœŸæ­£çš„åƒç´ åšæˆçœŸæ­£çš„pixelså–‚ç»™NDLå³å¯ã€‚\nå¦‚æœé‡åˆ°æœ‰äº›updateè¿˜æ˜¯æ²¡æœ‰å»é™¤çš„å¥‡æ€ªæƒ…å†µï¼Œå»ºè®®åœ¨palé‡æ–°installåå†update runçœ‹çœ‹ã€‚\nå¤„ç†å®ŒæˆåæˆåŠŸè·‘native~:\næ¥ä¸‹æ¥å‘ç°è·‘nemuè¿˜æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œä¸»è¦æ˜¯updateå®ç°ä¸å¯¹ï¼Œåˆè¦è¿”å·¥ä¸€ä¸‹ndlã€‚ã€‚ã€‚ã€‚ã€‚ï¼ˆæ³¨æ„åˆ°è¿™é‡Œçš„srcâ†’wå’Œwå…¶å®æ˜¯æœ‰åŒºåˆ«çš„ã€‚æˆ‘ä»¬éœ€è¦ç†è§£ä»¥ä¸‹å‡ ç‚¹ï¼šã€æˆ‘åœ¨è¿™å¡äº†ç‰¹åˆ«ä¹…ã€‚ã€‚ã€‘\nNDL_DrawRectçš„xywhå¯¹pixelsåšä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆ\nSDL_UpdateRectçš„xywhè¦å¯¹surfaceåšä»€ä¹ˆä¸ºä»€ä¹ˆï¼Ÿ\nå®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªæŠ å›¾çš„è¿‡ç¨‹ã€‚whæ˜¯æˆ‘ä»¬åœ¨è¿è¡Œä¸­éœ€è¦æ‰£å‡ºçš„èŒƒå›´ï¼Œè€Œå®é™…ä¸Šçš„sæ˜¯ç”»å¸ƒï¼Œæˆ‘ä»¬è¦æŠŠx,yåç§»å¤„çš„ä¸œè¥¿ä»surfaceæŠ å‡ºæ¥ç„¶åæ›´æ–°åˆ°NDLä¸­ï¼Œè®©ä»–æ›´æ–°åˆ°å±å¹•ã€‚\nç„¶åè¿™é‡Œæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘çš„x,yå±…ä¸­é€»è¾‘æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºæ²¡æœ‰æ—§xyçš„ä¿¡æ¯åªæ˜¯å¼ºåˆ¶æ›´æ–°ï¼Œå®¹æ˜“å‡ºé—®é¢˜ï¼Œæ¢äº†ä¸€ç‰ˆæ–°çš„é€»è¾‘æ­£å¸¸äº†ã€‚\næˆ‘çš„fpsåªæœ‰6å·¦å³ï¼Œæœ‰å°ä¼™ä¼´æœ€é«˜11ï¼Œä¸è¿‡è¿˜æ˜¯æ„Ÿè§‰å¾ˆæµç•…çš„~\nåˆšè·‘å‡ºæ¥çš„æ—¶å€™æˆ‘æ˜¯ç‰¹åˆ«å¼€å¿ƒçš„ï¼Œé«˜å…´äº†ä¸€æ™šä¸Šç¡ä¸ç€ã€‚\næ˜¾å¡è¯»å†™æ˜¯æˆ‘çš„ä¸€ç”Ÿä¹‹æ•Œï¼ŒçœŸçš„èŠ±äº†å¾ˆä¹…å»ç†è§£åƒç´ çš„ç»˜åˆ¶ï¼Œè¿™ä¸ªè¿˜æ˜¯éœ€è¦åŠ¨æ‰‹ä¼šæ¯”è¾ƒç›´è§‚ã€‚\né—®ï¼šä»™å‰‘å¥‡ä¾ ä¼ çš„æ¡†æ¶æ˜¯å¦‚ä½•å·¥ä½œçš„? æˆ‘ä»¬åœ¨PA2ä¸­è®¨è®ºè¿‡ä¸€ä¸ªæ¸¸æˆçš„åŸºæœ¬æ¡†æ¶, å°è¯•é˜…è¯»ä»™å‰‘å¥‡ä¾ ä¼ çš„ä»£ç , æ‰¾å‡ºåŸºæœ¬æ¡†æ¶æ˜¯é€šè¿‡å“ªäº›å‡½æ•°å®ç°çš„. æ‰¾åˆ°ä¹‹å, å¯èƒ½ä¼šå¯¹ä½ è°ƒè¯•ä»™å‰‘å¥‡ä¾ ä¼ å¸¦æ¥ä¸€å®šçš„å¸®åŠ©. è™½ç„¶ä»™å‰‘å¥‡ä¾ ä¼ çš„ä»£ç å¾ˆå¤š, ä½†ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜, ä½ å¹¶ä¸éœ€è¦é˜…è¯»å¤§é‡çš„ä»£ç .\né—®ï¼šä»™å‰‘å¥‡ä¾ ä¼ çš„è„šæœ¬å¼•æ“ åœ¨navy-apps/apps/pal/repo/src/game/script.cä¸­æœ‰ä¸€ä¸ªPAL_InterpretInstruction()çš„å‡½æ•°, å°è¯•å¤§è‡´äº†è§£è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å’Œè¡Œä¸º. ç„¶åå¤§èƒ†çŒœæµ‹ä¸€ä¸‹, ä»™å‰‘å¥‡ä¾ ä¼ çš„å¼€å‘è€…æ˜¯å¦‚ä½•å¼€å‘è¿™æ¬¾æ¸¸æˆçš„? ä½ å¯¹\u0026quot;æ¸¸æˆå¼•æ“\u0026quot;æ˜¯å¦æœ‰æ–°çš„è®¤è¯†?\nam-kernels å¼€å±€ä¸€æ¡ç‹—å†…å®¹å…¨é å·åå®ç°ï¼ˆåŸºæœ¬ä¸Šnativeèƒ½è·‘å°±èƒœåˆ©ï¼‰\nè¿™é‡Œå¦‚æœå‡ºç°æ‰¾ä¸åˆ°æ–‡ä»¶é”™è¯¯ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹å­æ–‡ä»¶\nFCEUX ä¸€å¼€å§‹å¡ç€æ®µé”™è¯¯ã€‚ã€‚ã€‚ç„¶åæ‰“å°åå‘ç°å…¶å®æ˜¯romæ²¡æœ‰ä¸œè¥¿ æ˜¯ä¸ªNULL ã€‚ã€‚\nç¿»äº†ä¸€ä¸‹æºç åæç„¶å¤§æ‚Ÿï¼ŒæˆåŠŸè°ƒå‡º~\nå¿«ä¹å¡æ¯”\nå±•ç¤ºä½ çš„æ‰¹å¤„ç†ç³»ç»Ÿ è¿™é‡Œæˆ‘å®ç°execveåé‡åˆ°äº†é­”æ•°çˆ†ç‚¸çš„æƒ…å†µã€‚ã€‚ã€‚ã€‚æœ€åå‘ç°æ˜¯æœ‰ä¸ªåœ°æ–¹åç§»æ²¡æœ‰æ¸…é›¶- -ã€‚ã€‚ã€‚ã€‚ã€‚éš¾æ€ªè¯»å–ä¸æ­£ç¡®ï¼ˆæ€»æ„Ÿè§‰æ˜¯è¯»å†™çš„é—®é¢˜ï¼‰ä¿®æ”¹åä¸€åˆ‡æ­£å¸¸~\nç„¶åèœå•menuä¸€ç›´æœ‰ä¸æ˜¾ç¤ºçš„æƒ…å†µã€‚ã€‚ã€‚æ„Ÿåˆ°éå¸¸ä¼¤å¿ƒ\nç„¶åponyå“¥æ•™æˆ‘gdbè°ƒè¯•åå‘ç°ä¸€ä¸ªçª—å£åˆ›å»ºçš„é—®é¢˜- -ï¼Œä¸çŸ¥é“åŸå› æ˜¯ä»€ä¹ˆ,æœ€åæ’æŸ¥æºç å‘ç°åŸæ¥åˆæ˜¯ä¸€ä¸ªapiæ²¡è®¤çœŸçœ‹æ‰‹å†Œæ¼çš„å‘ï¼ˆä¹‹å‰è¢«è‡ªå·±åˆ æ‰äº†ä¸€å¥ï¼‰ã€‚ã€‚ã€‚ã€‚opençª—å£ï¼Œéš¾æ€ªä¸€ç›´ä¸æ˜¾ç¤ºã€‚\nä¿®æ”¹åæ­£å¸¸ï¼šï¼ˆç»™ä¸åŒæ¸¸æˆåŠ ä¸ªé€€å‡ºï¼Œå°±éå¸¸å¸…æ°”äº†ï¼ï¼‰\næœ€åå¤„ç†äº†ä¸€ä¸‹execvpç›¸å…³å†…å®¹ é¡ºåˆ©å®Œæˆ ~~(åŸæ¥ä¸éœ€è¦è‡ªå·±å®ç°ã€‚ã€‚ã€‚å®³æˆ‘ä¹‹å‰è¿˜ä»¥ä¸ºè¦è‡ªå·±è®¾å®šenv\nï¼ˆä¸å¤ªå®Œç¾çš„åœ°æ–¹å°±æ˜¯ä¸ä¼šæ¸…å±~ï¼‰\næ¥ä¸‹æ¥å¼€å§‹æ¥å—pa4çš„æŠ˜ç£¨ã€‚ã€‚ã€‚\n","date":"2022-08-28T08:50:40+08:00","permalink":"https://sanbuphy.github.io/p/nju%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%BE%E7%A8%8B%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C-pa3%E7%AC%94%E8%AE%B0%E4%BA%8C/","title":"NJUè®¡ç®—æœºè¯¾ç¨‹åŸºç¡€å®éªŒ PA3ç¬”è®°ï¼ˆäºŒï¼‰"},{"content":" å†™åœ¨å‰é¢ï¼šæ„Ÿè°¢ponyã€æ¨å©†å©†ç­‰ç¾¤å‹çš„è®¨è®ºå’Œå¸®åŠ©ï¼Œè®©æˆ‘å¯¹PAæœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚\nå…³äºé—®é¢˜éƒ¨åˆ†ï¼šè¯·éµå®ˆå­¦æœ¯è¯šä¿¡ï¼Œæœ‰å…³æé—®éƒ½è¦è‡ªå·±æ€è€ƒï¼ˆç¬”è®°ä¹Ÿä¸ä¼šæ¶‰åŠåˆ°ä»»ä½•ç›´æ¥ç»™å‡ºä»£ç çš„éƒ¨åˆ†ï¼Œæœ‰å…³è‡ªå·±çš„å¿ƒå¾—ä½“ä¼šå¾ˆå¯èƒ½æ˜¯é”™çš„ï¼Œè¯·è‡ªå·±æ€è€ƒã€‚éµå®ˆä»¥ä¸‹åè®®ï¼š\n1ã€æœ€ç®€å•çš„æ“ä½œç³»ç»Ÿ Nanos-liteæ˜¯è¿è¡Œåœ¨AMä¹‹ä¸Š, AMçš„APIåœ¨Nanos-liteä¸­éƒ½æ˜¯å¯ç”¨çš„. è™½ç„¶æ“ä½œç³»ç»Ÿå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¦‚å¿µ, ä½†åœ¨AMçœ‹æ¥, å®ƒåªæ˜¯ä¸€ä¸ªè°ƒç”¨AM APIçš„æ™®é€šCç¨‹åºè€Œå·², Nanos-liteç›®å‰çš„è¡Œä¸º:\næ‰“å°Project-Nçš„logo, å¹¶é€šè¿‡Log()è¾“å‡ºhelloä¿¡æ¯å’Œç¼–è¯‘æ—¶é—´. åœ¨Nanos-liteä¸­, Log()å®é€šè¿‡ä½ åœ¨klibä¸­ç¼–å†™çš„printf()è¾“å‡º, æœ€ç»ˆä¼šè°ƒç”¨TRMçš„putch().\nè°ƒç”¨init_device()å¯¹è®¾å¤‡è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ. ç›®å‰init_device()ä¼šç›´æ¥è°ƒç”¨ioe_init().\nåœ¨NEMUä¸­å¯¹ç£ç›˜è¿›è¡Œæ¨¡æ‹Ÿæ˜¯ä¸€ä¸ªç•¥æ˜¾å¤æ‚å·¥ä½œ, å…ˆè®©Nanos-liteæŠŠå…¶ä¸­çš„ä¸€æ®µå†…å­˜ä½œä¸ºç£ç›˜æ¥ä½¿ç”¨. è¿™æ ·çš„ç£ç›˜æœ‰ä¸€ä¸ªä¸“é—¨çš„åå­—, å«ramdisk.\ninit_fs()å’Œinit_proc(), åˆ†åˆ«ç”¨äºåˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿå’Œåˆ›å»ºè¿›ç¨‹, ç›®å‰å®ƒä»¬å‡æœªè¿›è¡Œæœ‰æ„ä¹‰çš„æ“ä½œ, å¯ä»¥å¿½ç•¥å®ƒä»¬.\nè°ƒç”¨panic()ç»“æŸNanos-liteçš„è¿è¡Œ.\nå›é¡¾å†å², è¦å®ç°ä¸€ä¸ªæœ€ç®€å•çš„æ“ä½œç³»ç»Ÿ, å°±è¦å®ç°ä»¥ä¸‹ä¸¤ç‚¹åŠŸèƒ½:\nç”¨æˆ·ç¨‹åºæ‰§è¡Œç»“æŸä¹‹å, å¯ä»¥è·³è½¬åˆ°æ“ä½œç³»ç»Ÿçš„ä»£ç ç»§ç»­æ‰§è¡Œ\næ“ä½œç³»ç»Ÿå¯ä»¥åŠ è½½ä¸€ä¸ªæ–°çš„ç”¨æˆ·ç¨‹åºæ¥æ‰§è¡Œ\nï¼ˆæ²¡é”™ï¼Œå°±æ˜¯forkä¸execveï¼‰\nä¸ºäº†æ“ä½œç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬æ‰€å¸Œæœ›æ˜¯ä¸€ç§å¯ä»¥é™åˆ¶å…¥å£çš„æ‰§è¡Œæµåˆ‡æ¢æ–¹å¼,è€Œä¸åƒç”¨æˆ·ç¨‹åºé‚£æ ·å¯ä»¥éšæ„åˆ‡æ¢PCè·³è½¬ï¼š\ni386ï¼šä¿æŠ¤æ¨¡å¼(protected mode)å’Œç‰¹æƒçº§(privilege level)\nmips32å¤„ç†å™¨ï¼šå†…æ ¸æ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼\nriscv32ï¼šæœºå™¨æ¨¡å¼(M-mode), ç›‘æ§è€…æ¨¡å¼(S-mode)å’Œç”¨æˆ·æ¨¡å¼(U-mode)\næœ€å‰å®³çš„æ˜¯ç¡¬ä»¶æ£€æŸ¥ï¼šå¦‚mips32éƒ½æ˜¯é€šè¿‡ç¡¬ä»¶æ£€æŸ¥ï¼Œåªè¦è½¯ä»¶è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šé¢, éƒ½æ— æ³•é€ƒå‡ºè¿™ä¸€å¤©ç½‘. ç¡¬ä»¶ä¿æŠ¤æœºåˆ¶ä½¿å¾—æ¶æ„ç¨‹åºæ°¸è¿œæ— æ³•å…¨èº«è€Œé€€,\nåœ¨ç¡¬ä»¶ä¸­åŠ å…¥ä¸€äº›ä¸ç‰¹æƒçº§æ£€æŸ¥ç›¸å…³çš„é—¨ç”µè·¯(ä¾‹å¦‚æ¯”è¾ƒå™¨ç”µè·¯), å¦‚æœå‘ç°äº†éæ³•æ“ä½œ, å°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ä¿¡å·, è®©CPUè·³è½¬åˆ°ä¸€ä¸ªçº¦å®šå¥½çš„ç›®æ ‡ä½ç½®, å¹¶è¿›è¡Œåç»­å¤„ç†.\nç›´æ¥çœ‹çœ‹æ•ˆæœï¼š\næ­¤æ—¶ä¼šå‡ºç°å¼‚å¸¸ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡å®ç°csrwä¼ªæŒ‡ä»¤ï¼Œä½†è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä¸­æ–‡æ–‡æ¡£æœ‰ä¸ªé”™è¯¯ï¼Œä»csrwiçš„å¯ä»¥æ¨æµ‹è¿™é‡Œåº”è¯¥æ˜¯csrrwï¼Œä¹Ÿå¯ä»¥ç›´æ¥çœ‹è‹±æ–‡æ–‡æ¡£çš„è¯´æ˜\nè¿™é‡Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªåè¯â€œæ§åˆ¶çŠ¶æ€å¯„å­˜å™¨â€ï¼Œåº”è¯¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹ä¸‹æ–‡ä¸­å¯¹æ§åˆ¶çŠ¶æ€å¯„å­˜å™¨çš„è§£é‡Šã€‚\n2ã€ç©¿è¶Šæ—¶ç©ºçš„æ—…ç¨‹ ç¡¬ä»¶éœ€è¦æä¾›ä¸€ç§å¯ä»¥é™åˆ¶å…¥å£çš„æ‰§è¡Œæµåˆ‡æ¢æ–¹å¼. è¿™ç§æ–¹å¼å°±æ˜¯è‡ªé™·æŒ‡ä»¤, ç¨‹åºæ‰§è¡Œè‡ªé™·æŒ‡ä»¤ä¹‹å, å°±ä¼šé™·å…¥åˆ°æ“ä½œç³»ç»Ÿé¢„å…ˆè®¾ç½®å¥½çš„è·³è½¬ç›®æ ‡. è¿™ä¸ªè·³è½¬ç›®æ ‡ä¹Ÿç§°ä¸ºå¼‚å¸¸å…¥å£åœ°å€.\néæ³•æŒ‡ä»¤å¯ä»¥å®šä¹‰æˆ\u0026quot;ä¸å±äºISAæ‰‹å†Œæè¿°èŒƒå›´çš„æŒ‡ä»¤\u0026quot;, è€Œè‡ªé™·æŒ‡ä»¤å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ— æ¡ä»¶å¤±è´¥. riscv32æä¾›ecallæŒ‡ä»¤ä½œä¸ºè‡ªé™·æŒ‡ä»¤, å¹¶æä¾›ä¸€ä¸ªmtvecå¯„å­˜å™¨æ¥å­˜æ”¾å¼‚å¸¸å…¥å£åœ°å€. ä¸ºäº†ä¿å­˜ç¨‹åºå½“å‰çš„çŠ¶æ€, riscv32æä¾›äº†ä¸€äº›ç‰¹æ®Šçš„ç³»ç»Ÿå¯„å­˜å™¨, å«æ§åˆ¶çŠ¶æ€å¯„å­˜å™¨(CSRå¯„å­˜å™¨). åœ¨PAä¸­, æˆ‘ä»¬åªä½¿ç”¨å¦‚ä¸‹3ä¸ªCSRå¯„å­˜å™¨:\n**mepcå¯„å­˜å™¨ **- å­˜æ”¾è§¦å‘å¼‚å¸¸çš„PC\nmstatuså¯„å­˜å™¨ - å­˜æ”¾å¤„ç†å™¨çš„çŠ¶æ€\nmcauseå¯„å­˜å™¨ - å­˜æ”¾è§¦å‘å¼‚å¸¸çš„åŸå› \nriscv32è§¦å‘å¼‚å¸¸åç¡¬ä»¶çš„å“åº”è¿‡ç¨‹å¦‚ä¸‹:\nå°†å½“å‰PCå€¼ä¿å­˜åˆ°mepcå¯„å­˜å™¨\nåœ¨mcauseå¯„å­˜å™¨ä¸­è®¾ç½®å¼‚å¸¸å·\nä»mtvecå¯„å­˜å™¨ä¸­å–å‡ºå¼‚å¸¸å…¥å£åœ°å€\nè·³è½¬åˆ°å¼‚å¸¸å…¥å£åœ°å€\nä¸Šè¿°ä¿å­˜ç¨‹åºçŠ¶æ€ä»¥åŠè·³è½¬åˆ°å¼‚å¸¸å…¥å£åœ°å€çš„å·¥ä½œ, éƒ½æ˜¯ç¡¬ä»¶è‡ªåŠ¨å®Œæˆçš„\næ‰€ä»¥æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœè¦è¡¥å…¨csrwæŒ‡ä»¤ï¼Œé¦–å…ˆè¦èƒ½åŒºåˆ†ä¸åŒçš„æ§åˆ¶çŠ¶æ€å¯„å­˜å™¨ï¼Œå…·ä½“æ€ä¹ˆåŒºåˆ†å‘¢ï¼Œ\né¦–å…ˆä¿®å¤ä¸€ä¸‹å¯¹åº”çš„æŒ‡ä»¤ï¼Œæ­¤æ—¶è¦æ³¨æ„çš„æ˜¯CSRå¯„å­˜å™¨çš„å®ç°æ–¹æ³•ã€‚\næ³¨æ„åˆ°ï¼šThe standard RISC-V ISA sets aside a 12-bit encoding space (csr[11:0]) for up to 4,096 CSRs.\næ­¤æ—¶éœ€è¦æŸ¥é˜…çš„æ˜¯æ–°æ‰‹å¤§ç¤¼åŒ…ï¼ˆå…·ä½“æ˜¯å“ªä¸ªéœ€è¦è‡ªå·±RTFMï¼‰ä¹‹Control and Status Registersâ€”â€”CSR Listingçš„Currently allocated RISC-V machine-level CSR addresses\nå› ä¸ºæ­¤æ—¶ç«‹å³æ•°ä½ç½®å¯¹åº”çš„å°±æ˜¯CSRåœ°å€ï¼Œæ‰“å°å‡ºæ¥åå‘ç°æ˜¯0x305æŸ¥æ‰‹å†Œåå‘ç°ä¹Ÿç¡®å®æ˜¯mtvecâ€”â€”Machine trap-handler base address.\næ ¹æ®æ‰‹å†Œçš„åœ°å€è¿›è¡ŒåŒ¹é…å¹¶å­˜å…¥å¯„å­˜å™¨ã€‚\nçŠ¶æ€æœºè§†è§’ä¸‹çš„å¼‚å¸¸å“åº”æœºåˆ¶ SR[mepc] \u0026lt;- PC ï¼ˆå‘ç”Ÿå¼‚å¸¸çš„pcï¼‰\nSR[mcause] \u0026lt;- ä¸€ä¸ªæè¿°å¤±è´¥åŸå› çš„å·ç  PC \u0026lt;- SR[mtvec] ï¼ˆå¼‚å¸¸å…¥å£åœ°å€ï¼‰\nfex: S -\u0026gt; {0, 1}, ç»™å®šçŠ¶æ€æœºçš„ä»»æ„çŠ¶æ€S, fex(S)éƒ½å¯ä»¥å”¯ä¸€è¡¨ç¤ºå½“å‰PCæŒ‡å‘çš„æŒ‡ä»¤æ˜¯å¦å¯ä»¥æˆåŠŸæ‰§è¡Œ\nå°†ä¸Šä¸‹æ–‡ç®¡ç†æŠ½è±¡æˆCTE ç¨‹åºçš„çŠ¶æ€, åœ¨æ“ä½œç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç­‰ä»·çš„æœ¯è¯­, å«\u0026quot;ä¸Šä¸‹æ–‡\u0026quot;.AMçš„ä¸€ç±»æ–°çš„APIä¸­åå­—å«CTE(ConText Extension).\nä¸IOEä¸€æ ·, ä¸Šä¸‹æ–‡ç®¡ç†çš„å…·ä½“å®ç°ä¹Ÿæ˜¯æ¶æ„ç›¸å…³çš„: ä¾‹å¦‚ä¸Šæ–‡æåˆ°, x86/mips32/riscv32ä¸­åˆ†åˆ«é€šè¿‡int/syscall/ecallæŒ‡ä»¤æ¥è¿›è¡Œè‡ªé™·, nativeä¸­ç”šè‡³å¯ä»¥é€šè¿‡ä¸€äº›ç¥å¥‡çš„åº“å‡½æ•°æ¥æ¨¡æ‹Ÿç›¸åº”çš„åŠŸèƒ½\næ“ä½œç³»ç»Ÿçš„å¤„ç†è¿‡ç¨‹å…¶å®éœ€è¦å“ªäº›ä¿¡æ¯ï¼š\nå¼•å‘è¿™æ¬¡æ‰§è¡Œæµåˆ‡æ¢çš„åŸå› , æ˜¯ç¨‹åºé™¤0, éæ³•æŒ‡ä»¤, è¿˜æ˜¯è§¦å‘æ–­ç‚¹, åˆæˆ–è€…æ˜¯ç¨‹åºè‡ªæ„¿é™·å…¥æ“ä½œç³»ç»Ÿ? ç¨‹åºçš„ä¸Šä¸‹æ–‡äº†ï¼ˆå¯„å­˜å™¨ï¼‰\næŠŠè¿™ä¸¤ç‚¹ä¿¡æ¯æŠ½è±¡æˆä¸€ç§ç»Ÿä¸€çš„è¡¨ç¤ºæ–¹å¼, å°±å¯ä»¥å®šä¹‰å‡ºCTEçš„API.\nå¯¹äºåˆ‡æ¢åŸå› , æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ç§ç»Ÿä¸€çš„æè¿°æ–¹å¼å³å¯. CTEå®šä¹‰äº†åä¸º\u0026quot;äº‹ä»¶\u0026quot;çš„æ•°æ®ç»“æ„(è§abstract-machine/am/include/am.h)\nå…¶ä¸­eventè¡¨ç¤ºäº‹ä»¶ç¼–å·, causeå’Œrefæ˜¯ä¸€äº›æè¿°äº‹ä»¶çš„è¡¥å……ä¿¡æ¯, msgæ˜¯äº‹ä»¶ä¿¡æ¯å­—ç¬¦ä¸², æˆ‘ä»¬åœ¨PAä¸­åªä¼šç”¨åˆ°event. ç„¶å, æˆ‘ä»¬åªè¦å®šä¹‰ä¸€äº›ç»Ÿä¸€çš„äº‹ä»¶ç¼–å·(ä¸Šè¿°æšä¸¾å¸¸é‡), è®©æ¯ä¸ªæ¶æ„åœ¨å®ç°å„è‡ªçš„CTE APIæ—¶, éƒ½ç»Ÿä¸€é€šè¿‡ä¸Šè¿°ç»“æ„ä½“æ¥æè¿°æ‰§è¡Œæµåˆ‡æ¢çš„åŸå› ,\nå¯¹äºä¸Šä¸‹æ–‡, æˆ‘ä»¬åªèƒ½å°†æè¿°ä¸Šä¸‹æ–‡çš„ç»“æ„ä½“ç±»å‹åç»Ÿä¸€æˆContextè‡³äºå…¶ä¸­çš„å…·ä½“å†…å®¹, å°±æ— æ³•è¿›ä¸€æ­¥è¿›è¡ŒæŠ½è±¡äº†. è¿™ä¸»è¦æ˜¯å› ä¸ºä¸åŒæ¶æ„ä¹‹é—´ä¸Šä¸‹æ–‡ä¿¡æ¯çš„å·®å¼‚è¿‡å¤§ï¼ˆæ¯”å¦‚å„ç§å¯„å­˜å™¨ï¼‰,åœ¨AMä¸­, Contextçš„å…·ä½“æˆå‘˜ä¹Ÿæ˜¯ç”±ä¸åŒçš„æ¶æ„è‡ªå·±å®šä¹‰çš„, æ¯”å¦‚x86-nemuçš„Contextç»“æ„ä½“åœ¨abstract-machine/am/include/arch/x86-nemu.h\nä¸è¿‡å¤§å¤šæ•°æƒ…å†µä¸‹, æ“ä½œç³»ç»Ÿå¹¶ä¸éœ€è¦å•ç‹¬è®¿é—®Contextç»“æ„ä¸­çš„æˆå‘˜. CTEä¹Ÿæä¾›äº†ä¸€äº›çš„æ¥å£, æ¥è®©æ“ä½œç³»ç»Ÿåœ¨å¿…è¦çš„æ—¶å€™è®¿é—®å®ƒä»¬, ä»è€Œä¿è¯æ“ä½œç³»ç»Ÿçš„ç›¸å…³ä»£ç ä¸æ¶æ„æ— å…³.\næœ€åè¿˜æœ‰å¦å¤–ä¸¤ä¸ªç»Ÿä¸€çš„API:\nbool cte_init(Context* (*handler)(Event ev, Context *ctx))ç”¨äºè¿›è¡ŒCTEç›¸å…³çš„åˆå§‹åŒ–æ“ä½œ. å…¶ä¸­å®ƒè¿˜æ¥å—ä¸€ä¸ªæ¥è‡ªæ“ä½œç³»ç»Ÿçš„äº‹ä»¶å¤„ç†å›è°ƒå‡½æ•°çš„æŒ‡é’ˆ, å½“å‘ç”Ÿäº‹ä»¶æ—¶,** CTEå°†ä¼šæŠŠäº‹ä»¶å’Œç›¸å…³çš„ä¸Šä¸‹æ–‡ä½œä¸ºå‚æ•°, æ¥è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°, äº¤ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œåç»­å¤„ç†**.\nvoid yield()ç”¨äºè¿›è¡Œè‡ªé™·æ“ä½œ, ä¼šè§¦å‘ä¸€ä¸ªç¼–å·ä¸ºEVENT_YIELDäº‹ä»¶.** ä¸åŒçš„ISAä¼šä½¿ç”¨ä¸åŒçš„è‡ªé™·æŒ‡ä»¤æ¥è§¦å‘è‡ªé™·æ“ä½œ**,\nQï¼šAMç©¶ç«Ÿç»™ç¨‹åºæä¾›äº†å¤šå¤§çš„æ ˆç©ºé—´å‘¢? äº‹å®ä¸Š, å¦‚æœä½ åœ¨PA2çš„æ—¶å€™å°è¯•åŠªåŠ›äº†è§£æ¯ä¸€å¤„ç»†èŠ‚, ä½ å·²ç»çŸ¥é“è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆäº†;\nAï¼š\n_stack_top = ALIGN(0x1000);\n. = _stack_top + 0x8000;\n_stack_pointer = .;\nend = .;\n_end = .;\n_heap_start = ALIGN(0x1000);\næ³¨æ„åŒºåˆ«ï¼š\n/* Minimum stack size for a signal handler. */\n#define MINSIGSTKSZ 2048\n/* System default stack size. */\n#define SIGSTKSZ 8192\næ’æ’­ä¸€ä¸ªæ½œåœ¨å¤§å‘ ã€å‘ç°è€…ä¸ºjyyosç¾¤çš„æ¨å©†å©†ï¼Œä¹Ÿæ˜¯ä¸€ä½è¶…ç¥çš„å¤§ä½¬ã€‘ï¼š\næ¶‰åŠåˆ°raå¯„å­˜å™¨ç›¸å…³è·³è½¬çš„é¡ºåºé—®é¢˜ï¼Œè¦ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªé¡ºåºæ“ä½œ\nä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› æ˜¯å¦‚æœæˆ‘ä»¬çš„æºæ“ä½œæ•°å’Œç›®çš„æ“ä½œæ•°å¯„å­˜å™¨åˆšå¥½æ˜¯åŒä¸€ä¸ªçš„æ—¶å€™ï¼ˆæ¯”å¦‚raï¼‰ï¼Œé‡å¤å†™å…¥ä¼šç›´æ¥è¦†ç›–å€¼ï¼Œå¦‚æœæˆ‘ä»¬å…ˆç”¨pc+4èµ‹å€¼ï¼Œå¾ˆå¯èƒ½å†æ¬¡ä½¿ç”¨çš„æ—¶å€™å°±ä¼šå‡ºå¤§é—®é¢˜ï¼Œå€¼è¢«æå‰è¦†ç›–äº†ï¼ï¼ï¼\nå°è¯•åœ¨Nanos-liteä¸­è§¦å‘ä¸€æ¬¡è‡ªé™·æ“ä½œ è®¾ç½®å¼‚å¸¸å…¥å£åœ°å€ æŒ‰ç…§ISAçš„çº¦å®šæ¥è®¾ç½®å¼‚å¸¸å…¥å£åœ°å€, å°†æ¥åˆ‡æ¢æ‰§è¡Œæµæ—¶æ‰èƒ½è·³è½¬åˆ°æ­£ç¡®çš„å¼‚å¸¸å…¥å£. è¿™æ˜¾ç„¶æ˜¯æ¶æ„ç›¸å…³çš„è¡Œä¸º, å› æ­¤æˆ‘ä»¬æŠŠè¿™ä¸€è¡Œä¸ºæ”¾å…¥CTEä¸­, è€Œä¸æ˜¯è®©Nanos-liteç›´æ¥æ¥è®¾ç½®å¼‚å¸¸å…¥å£åœ°å€. ä½ éœ€è¦åœ¨nanos-lite/include/common.hä¸­å®šä¹‰å®HAS_CTE, è¿™æ ·ä»¥å, Nanos-liteä¼šå¤šè¿›è¡Œä¸€é¡¹åˆå§‹åŒ–å·¥ä½œ: è°ƒç”¨init_irq()å‡½æ•°, è¿™æœ€ç»ˆä¼šè°ƒç”¨ä½äºabstract-machine/am/src/nemu/isa/$ISA/cte.cä¸­çš„cte_init()å‡½æ•°. cte_init()å‡½æ•°ä¼šåšä¸¤ä»¶äº‹æƒ…, ç¬¬ä¸€ä»¶å°±æ˜¯è®¾ç½®å¼‚å¸¸å…¥å£åœ°å€\ncte_init()å‡½æ•°åšçš„ç¬¬äºŒä»¶äº‹æ˜¯æ³¨å†Œä¸€ä¸ªäº‹ä»¶å¤„ç†å›è°ƒå‡½æ•°, è¿™ä¸ªå›è°ƒå‡½æ•°ç”±Nanos-liteæä¾›,\nå¯¹äºriscv32æ¥è¯´, ç›´æ¥å°†å¼‚å¸¸å…¥å£åœ°å€è®¾ç½®åˆ°mtvecå¯„å­˜å™¨ä¸­å³å¯. å®ç°å®Œå„ç§æŒ‡ä»¤æ¡†æ¶åæˆ‘ä»¬èƒ½çœ‹åˆ°\nè¿™æ—¶è¿˜æ²¡å®Œå…¨å®ç°ecallï¼Œè¿›å…¥å®ç°è¿‡ç¨‹ï¼š\nä½ éœ€è¦å®ç°ä¸Šæ–‡æåˆ°çš„æ–°æŒ‡ä»¤, å¹¶å®ç°isa_raise_intr()å‡½æ•°. ç„¶åé˜…è¯»cte_init()çš„ä»£ç , æ‰¾å‡ºç›¸åº”çš„å¼‚å¸¸å…¥å£åœ°å€.\nå®ç°å, é‡æ–°è¿è¡ŒNanos-lite, å¦‚æœä½ å‘ç°NEMUç¡®å®è·³è½¬åˆ°ä½ æ‰¾åˆ°çš„å¼‚å¸¸å…¥å£åœ°å€, è¯´æ˜ä½ çš„å®ç°æ­£ç¡®\nä½ éœ€è¦åœ¨è‡ªé™·æŒ‡ä»¤çš„è¾…åŠ©å‡½æ•°ä¸­è°ƒç”¨isa_raise_intr()\næ­¤æ—¶å…ˆå®ç°isa_raise_intrï¼Œæ¨¡æ‹Ÿä¸Šæ–‡æåˆ°çš„å¼‚å¸¸å“åº”æœºåˆ¶ï¼š\nä¼šå‘ç°æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªNOï¼Œè€Œè¿™ä¸ªå¼‚å¸¸NOå¯ä»¥åœ¨yieldçš„ä»£ç ä¸­â€œé¢†ç•¥åˆ°æ€ä¹ˆè·å–â€ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä»–çš„æ±‡ç¼–ä»£ç asm volatile(\u0026quot;li a7, -1; ecall\u0026quot;); å¯ä»¥çŒœæƒ³æ˜¯ä¸æ˜¯å’Œa7æœ‰å…³å‘¢ï¼Ÿè¿™æ—¶å€™å¯ä»¥æ‹¿å‡ºa7çœ‹çœ‹ã€‚è‡³äºæ€ä¹ˆæ‹¿å‡ºï¼Œè¿™ä¸ªå°±æ˜¯åŸºç¡€æ“ä½œäº†ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå…¶å®æ˜¯é”™è¯¯çš„ï¼Œä¹‹åä¼šè¯´ä¸ºä»€ä¹ˆï¼‰\nåŒæ—¶æˆ‘ä»¬å†çœ‹åˆ°asm volatile(\u0026quot;csrw mtvec, %0\u0026quot; : : \u0026quot;r\u0026quot;(__am_asm_trap));\nè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œé¦–å…ˆæˆ‘ä»¬èƒ½çŸ¥é“åº”è¯¥æ˜¯æŠŠå¯„å­˜å™¨çš„å€¼å†™å…¥æ§åˆ¶çŠ¶æ€å¯„å­˜å™¨ï¼ˆæœ‰ç†ç”±çŒœæµ‹è¿™å°±æ˜¯å¼‚å¸¸åœ°å€ï¼‰ï¼Œé‚£åé¢çš„\u0026quot;r\u0026quot;æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\næˆ‘ä»¬å¯ä»¥å¯¹ç…§ä¸€ä¸‹çŸ¥é“äº†é‚£æ˜¯è¾“å…¥æ“ä½œæ•°ï¼Œæˆ‘ä»¬æœ‰ç†ç”±çŒœæµ‹è¿™å°±æ˜¯ä¸ºäº†æŠŠtrapç›¸å…³çš„åœ°å€å­˜åˆ°mtvecï¼Œåœ¨å¦å¤–ä¸€ä¸ªæ–‡ä»¶å¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„ä¸œè¥¿\næ­¤æ—¶å¤§èƒ†çŒœæµ‹è¿™å°±æ˜¯å¼‚å¸¸ç›¸å…³å…¥å£ã€‚\nä¸€é¡¿æ“ä½œçŒ›å¦‚è™å®ç°äº†ecallè°ƒç”¨ï¼Œæ‰¾äº†ä¸ªåœ°æ–¹åŠ å…¥äº†å¼‚å¸¸å¤„ç†çš„å¯„å­˜å™¨ï¼š\nå¼€diffæ£€æŸ¥å‘ç°äº†é—®é¢˜ï¼š\nä¸ºå•¥æ˜¯bå‘¢ï¼Ÿæˆ‘ä»¬å‘ç°è¿™å…¶å®æ˜¯mcauseçš„è¿”å›å€¼ï¼Œéš¾é“ä¸æ˜¯å‰é¢çš„li a7 -1å—ï¼Ÿï¼Ÿï¼Ÿ\nç»è¿‡æœç´¢æ‰‹å†Œå¯ä»¥æŸ¥åˆ°é‚£å…¶å®è¡¨ç¤ºä¸€ç§environment callã€‚\nç»è¿‡æŸ¥é˜…èµ„æ–™ï¼š\nRISC-Vä¸­ç³»ç»Ÿè°ƒç”¨é€šè¿‡ï¼ˆenvironment callï¼‰æ¥å®ç°ã€‚åœ¨U-modeã€S-modeã€M-modeä¸‹æ‰§è¡Œ ecallåˆ†åˆ«ä¼šè§¦å‘environment-call-from-U-modeå¼‚å¸¸ã€environment-call-from-S-modeå¼‚å¸¸ã€environment-call-from-M-modeå¼‚å¸¸ã€‚åœ¨ç³»ç»Ÿè°ƒç”¨çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨U-modeä¸‹æ‰§è¡Œ ecallè§¦å‘environment-call-from-U-modeå¼‚å¸¸ï¼Œå¹¶ç”±S-modeä¸­è¿è¡Œçš„å†…æ ¸å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚\nåœ¨head.Sä¸­å†…æ ¸booté˜¶æ®µæ—¶ï¼Œè®¾ç½® medeleg å¯„å­˜å™¨ä¸ºç”¨æˆ·æ¨¡å¼ç³»ç»Ÿè°ƒç”¨æ·»åŠ å¼‚å¸¸å§”æ‰˜ã€‚ åœ¨æ²¡æœ‰è®¾ç½®å¼‚å¸¸å§”æ‰˜çš„æƒ…å†µä¸‹ï¼ŒecallæŒ‡ä»¤äº§ç”Ÿçš„å¼‚å¸¸ç”±M-modeæ¥å¤„ç†ï¼Œè€Œä¸æ˜¯äº¤ç”±å†…æ ¸æ‰€åœ¨çš„S-modeè¿›è¡Œå¤„ç†ã€‚é€šè¿‡ medeleg ä¸­è®¾ç½®ç›¸åº”çš„ä½ï¼Œå¯ä»¥å°†environment-call-from-U-modeå¼‚å¸¸ç›´æ¥äº¤ç”±S-modeå¤„ç†ã€‚\né“¾æ¥ï¼šhttps://www.zhihu.com/question/24960401/answer/2308952497 æ¥æºï¼šçŸ¥ä¹ é‚£ä¹ˆé‡Œé¢çš„U,S,Mæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä»¥æ”¯æŒç°ä»£æ“ä½œç³»ç»Ÿçš„RISC-Vå¤„ç†å™¨ä¸ºä¾‹, å®ƒä»¬å­˜åœ¨M, S, Uä¸‰ä¸ªç‰¹æƒæ¨¡å¼, åˆ†åˆ«ä»£è¡¨æœºå™¨æ¨¡å¼, ç›‘ç®¡è€…æ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼. Mæ¨¡å¼ç‰¹æƒçº§æœ€é«˜, Uæ¨¡å¼ç‰¹æƒçº§æœ€ä½ã€‚æ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº†åˆ°åº•æ˜¯ä»€ä¹ˆè°ƒç”¨ã€‚\nåä¸­ç§‘æŠ€å¤§å­¦æ“ä½œç³»ç»Ÿå›¢é˜Ÿï¼šhttps://gitee.com/hustos/pke-doc/blob/master/chapter1_riscv.md\nç³»ç»Ÿå‘ç”Ÿä¸­æ–­ï¼ˆæˆ‘ä»¬ç”¨ä¸­æ–‡çš„â€œä¸­æ–­â€è¿™ä¸ªåè¯æ¥æŒ‡ä»£å¹¿ä¹‰çš„ä¸­æ–­ï¼Œå¹¶éä»¥ä¸Šçš„interruptï¼‰æ—¶æ‰§è¡Œçš„è¿™æ®µç¨‹åºï¼Œå¾€å¾€è¢«ç§°ä¸ºä¸­æ–­ä¾‹ç¨‹ï¼ˆinterrupt routineï¼‰ã€‚å› ä¸ºäº‹ä»¶çš„å¤šæ ·æ€§ï¼Œç³»ç»Ÿå¯èƒ½æœ‰å¤šä¸ªè¿™æ ·çš„ä¸­æ–­ä¾‹ç¨‹ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æŠŠè¿™äº›ä¾‹ç¨‹çš„å…¥å£æ”¾åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œè€Œè¿™å¼ è¡¨ä¸€èˆ¬ç§°ä¸ºä¸­æ–­å‘é‡è¡¨ï¼ˆinterrupt tableï¼‰ã€‚RV64Gå¤„ç†å™¨åœ¨å‘ç”Ÿä¸­æ–­åï¼Œä¼šå°†å‘ç”Ÿçš„ä¸­æ–­ç±»å‹ã€ç¼–å·è‡ªåŠ¨è®°å½•ï¼ˆç¡¬ä»¶å®Œæˆï¼‰åˆ°ç›®æ ‡æ¨¡å¼çš„CSRä¸­ã€‚å‡è®¾å‘ç”Ÿä¸­æ–­çš„ç›®æ ‡æ¨¡å¼ä¸ºMæ¨¡å¼ï¼Œåˆ™ä¸­æ–­çš„è¿™äº›ä¿¡æ¯ä¼šè®°å½•åˆ°mcauseå¯„å­˜å™¨ã€‚ è¡¨1.7åˆ—å‡ºäº†mcauseçš„å¯èƒ½å–å€¼ä»¥åŠå¯¹åº”çš„ä¸­æ–­ä¿¡æ¯\né‚£ä¹ˆa7åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Œä»man syscallå¯ä»¥æŸ¥åˆ°ï¼ŒåŸæ¥åªæ˜¯ç”¨äºå­˜æ”¾syscallè°ƒç”¨å·çš„åœ°æ–¹ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„mcauseï¼Œåªæ˜¯ä¸ºäº†è§¦å‘è‡ªé™·æ“ä½œ,ä¸åŒISAçš„å®ç°ä¸åŒçš„(å¯ä»¥å…¨å±€æœç´¢yield)\nï¼ˆè‡³äºä¸ºä»€ä¹ˆæ˜¯-1ï¼Œå’Œå°ä¼™ä¼´è®¨è®ºè¿˜æ˜¯ä¸ªè¿·ï¼‰\næ¥ä¸‹æ¥ç›®çš„å°±æ˜¯æ‰¾åˆ°æ­£ç¡®çš„mcauseï¼Œä»€ä¹ˆæ‰æ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦ä½ æŸ¥æ‰‹å†Œç†è§£PAæœ‰å‡ ç§æ¨¡å¼äº†ï¼Œä»¥åŠç†è§£ä¸ºä»€ä¹ˆè¯´åœ¨åé¢æˆ‘ä»¬ä¼šå†æ¬¡ç”¨åˆ°isa_raise_intr()å‡½æ•°ã€‚ï¼ˆæƒ³æƒ³isa_raise_intr()çš„ç¿»è¯‘æ˜¯ä»€ä¹ˆï¼Ÿå¹¶ä¸æ˜¯å¼‚å¸¸æŒ‡ä»¤ï¼‰\nä½ å¯ä»¥ç”¨diffæ£€æŸ¥è‡ªå·±å®ç°çš„å¯¹ä¸å¯¹ã€‚\né€šè¿‡diffæ£€æŸ¥ï¼š\nä¿å­˜ä¸Šä¸‹æ–‡ ç°åœ¨çš„é€šç”¨å¯„å­˜å™¨, é‡Œé¢å­˜æ”¾çš„éƒ½æ˜¯æ‰§è¡Œæµåˆ‡æ¢ä¹‹å‰çš„å†…å®¹. è¿™äº›å†…å®¹ä¹Ÿæ˜¯ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†, å¦‚æœä¸ä¿å­˜å°±è¦†ç›–å®ƒä»¬, å°†æ¥å°±æ— æ³•æ¢å¤è¿™ä¸€ä¸Šä¸‹æ–‡äº†. ä½†é€šå¸¸ç¡¬ä»¶å¹¶ä¸è´Ÿè´£ä¿å­˜å®ƒä»¬, å› æ­¤éœ€è¦é€šè¿‡è½¯ä»¶ä»£ç æ¥ä¿å­˜å®ƒä»¬çš„å€¼. riscv32åˆ™é€šè¿‡swæŒ‡ä»¤å°†å„ä¸ªé€šç”¨å¯„å­˜å™¨ä¾æ¬¡å‹æ ˆ.\né™¤äº†é€šç”¨å¯„å­˜å™¨ä¹‹å¤–, ä¸Šä¸‹æ–‡è¿˜åŒ…æ‹¬:\n**è§¦å‘å¼‚å¸¸æ—¶çš„PCå’Œå¤„ç†å™¨çŠ¶æ€. **epc/mepcå’Œstatus/mstatuså¯„å­˜å™¨, å¼‚å¸¸å“åº”æœºåˆ¶æŠŠå®ƒä»¬ä¿å­˜åœ¨ç›¸åº”çš„ç³»ç»Ÿå¯„å­˜å™¨ä¸­, æˆ‘ä»¬è¿˜éœ€è¦å°†å®ƒä»¬ä»ç³»ç»Ÿå¯„å­˜å™¨ä¸­è¯»å‡º, ç„¶åä¿å­˜åœ¨å †æ ˆä¸Š.\n**å¼‚å¸¸å·. **å¼‚å¸¸å·å·²ç»ç”±ç¡¬ä»¶ä¿å­˜åœ¨cause/mcauseå¯„å­˜å™¨ä¸­, æˆ‘ä»¬è¿˜éœ€è¦å°†å…¶ä¿å­˜åœ¨å †æ ˆä¸Š.\nåœ°å€ç©ºé—´. è¿™æ˜¯ä¸ºPA4å‡†å¤‡çš„,å°†åœ°å€ç©ºé—´ä¿¡æ¯ä¸0å·å¯„å­˜å™¨å…±ç”¨å­˜å‚¨ç©ºé—´, åæ­£0å·å¯„å­˜å™¨çš„å€¼æ€»æ˜¯0, ä¹Ÿä¸éœ€è¦ä¿å­˜å’Œæ¢å¤. æˆ‘ä»¬æš‚æ—¶ä¸ä½¿ç”¨åœ°å€ç©ºé—´ä¿¡æ¯, ä½ ç›®å‰å¯ä»¥å¿½ç•¥å®ƒä»¬çš„å«ä¹‰.\né—®ï¼šå¼‚å¸¸å·çš„ä¿å­˜ Q:x86é€šè¿‡è½¯ä»¶æ¥ä¿å­˜å¼‚å¸¸å·, æ²¡æœ‰ç±»ä¼¼causeçš„å¯„å­˜å™¨. mips32å’Œriscv32ä¹Ÿå¯ä»¥è¿™æ ·å—? ä¸ºä»€ä¹ˆ?\nAï¼šæˆ‘è®¤ä¸ºå¯ä»¥ï¼Œå› ä¸ºå¼‚å¸¸åœ°å€ä¹‹ç±»çš„éƒ½èƒ½ä¿å­˜åˆ°ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œé‚£ä¹ˆriscvä¹Ÿå¯ä»¥æœ‰ã€‚\né‡æ–°ç»„ç»‡Contextç»“æ„ä½“ ä½ çš„ä»»åŠ¡å¦‚ä¸‹:\nå®ç°è¿™ä¸€è¿‡ç¨‹ä¸­çš„æ–°æŒ‡ä»¤, è¯¦æƒ…è¯·RTFM.\nç†è§£ä¸Šä¸‹æ–‡å½¢æˆçš„è¿‡ç¨‹å¹¶RTFSC, ç„¶åé‡æ–°ç»„ç»‡abstract-machine/am/include/arch/$ISA-nemu.h ä¸­å®šä¹‰çš„Contextç»“æ„ä½“çš„æˆå‘˜, ä½¿å¾—è¿™äº›æˆå‘˜çš„å®šä¹‰é¡ºåºå’Œ abstract-machine/am/src/$ISA/nemu/trap.Sä¸­æ„é€ çš„ä¸Šä¸‹æ–‡ä¿æŒä¸€è‡´.\néœ€è¦æ³¨æ„çš„æ˜¯, è™½ç„¶æˆ‘ä»¬ç›®å‰æš‚æ—¶ä¸ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„åœ°å€ç©ºé—´ä¿¡æ¯, ä½†ä½ åœ¨é‡æ–°ç»„ç»‡Contextç»“æ„ä½“æ—¶ä»ç„¶éœ€è¦æ­£ç¡®åœ°å¤„ç†åœ°å€ç©ºé—´ä¿¡æ¯çš„ä½ç½®, å¦åˆ™ä½ å¯èƒ½ä¼šåœ¨PA4ä¸­é‡åˆ°éš¾ä»¥ç†è§£çš„é”™è¯¯.\nå®ç°ä¹‹å, ä½ å¯ä»¥åœ¨__am_irq_handle()ä¸­é€šè¿‡printfè¾“å‡ºä¸Šä¸‹æ–‡cçš„å†…å®¹, ç„¶åé€šè¿‡ç®€æ˜“è°ƒè¯•å™¨è§‚å¯Ÿè§¦å‘è‡ªé™·æ—¶çš„å¯„å­˜å™¨çŠ¶æ€, ä»è€Œæ£€æŸ¥ä½ çš„Contextå®ç°æ˜¯å¦æ­£ç¡®.\nè¿™éƒ¨åˆ†å…³é”®æ˜¯ç†è§£ç»“æ„ä½“å’Œæ±‡ç¼–è¯­è¨€çš„å…³ç³»ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š\nstruct test { char ch; short s; int i; long l; }; int fun(void) { int ret; struct test tmp; ret=0; tmp.ch=\u0026#39;a\u0026#39;; tmp.s=123; tmp.i=1234; tmp.l=12345; return ret; } æ±‡ç¼–ä»£ç ï¼š\npushl %ebp movl %esp, %ebp subl $16, %esp //ret=0; movl $0, -16(%ebp) //tmp.ch=\u0026#39;a\u0026#39;; movb $97, -12(%ebp) //tmp.s=123; movw $123, -10(%ebp) //tmp.i=1234; movl $1234, -8(%ebp) //tmp.l=12345; movl $12345, -4(%ebp) //è¿”å›å€¼ movl -16(%ebp), %eax leave ret ä»é¡ºåºä¸Šæˆ‘ä»¬å°±çŸ¥é“æ ¹æ®å‹å…¥æ ˆè¯¥å¦‚ä½•ç»„ç»‡ç»“æ„ä½“äº†ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨handlerå¤„ç†åçœ‹åˆ°ç»“æœã€‚\né—®ï¼šå¿…ç­”é¢˜(éœ€è¦åœ¨å®éªŒæŠ¥å‘Šä¸­å›ç­”) - ç†è§£ä¸Šä¸‹æ–‡ç»“æ„ä½“çš„å‰ä¸–ä»Šç”Ÿ ä½ ä¼šåœ¨__am_irq_handle()ä¸­çœ‹åˆ°æœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç»“æ„æŒ‡é’ˆc, cæŒ‡å‘çš„ä¸Šä¸‹æ–‡ç»“æ„ç©¶ç«Ÿåœ¨å“ªé‡Œ? è¿™ä¸ªä¸Šä¸‹æ–‡ç»“æ„åˆæ˜¯æ€ä¹ˆæ¥çš„? å…·ä½“åœ°, è¿™ä¸ªä¸Šä¸‹æ–‡ç»“æ„æœ‰å¾ˆå¤šæˆå‘˜, æ¯ä¸€ä¸ªæˆå‘˜ç©¶ç«Ÿåœ¨å“ªé‡Œèµ‹å€¼çš„? $ISA-nemu.h, trap.S, ä¸Šè¿°è®²ä¹‰æ–‡å­—, ä»¥åŠä½ åˆšåˆšåœ¨NEMUä¸­å®ç°çš„æ–°æŒ‡ä»¤, è¿™å››éƒ¨åˆ†å†…å®¹åˆæœ‰ä»€ä¹ˆè”ç³»?\nç­”ï¼šæœ¬è´¨æ˜¯Context* (user_handler)(Event, Context)çš„ç»“æ„ä½“æŒ‡é’ˆã€‚å…¶ä¸­å®šä¹‰åœ¨am.hï¼Œèµ‹å€¼åœ¨cte_inité˜¶æ®µåˆå§‹åŒ–\nï¼ˆæ€€ç–‘å°±æ˜¯ä¸ºäº†è½¯ä»¶å­˜å‚¨ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æ‰€è°“çš„ä¿å­˜åˆ°å †æ ˆï¼ˆSçš„è¿‡ç¨‹ï¼‰ï¼‰\nå…·ä½“çš„Contextæ˜¯æ€ä¹ˆè¢«åŠ è½½çš„ï¼Ÿ\né¦–å…ˆæˆ‘ä»¬èƒ½åœ¨Sä¸­æ‰¾åˆ°.globl __am_asm_trapï¼Œå…¶ä¸­.globlå…³é”®å­—ä½œç”¨æ˜¯\nèƒ½è¢«é“¾æ¥åï¼Œå°±ä¼šå’Œexternç›¸å¯¹åº”ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¡®å®š__am_irq_trap æ˜¯å¯ä»¥åœ¨é“¾æ¥è¿‡ç¨‹æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„\nå†å›é¡¾Sä»£ç ï¼Œæˆ‘ä»¬å‘ç°è¿™ç¡®å®å°±æ˜¯ç»“æ„ä½“çš„pushè¿‡ç¨‹ã€‚æœ€å¼€å§‹æ˜¯å¯„å­˜å™¨ï¼Œæœ€åæ˜¯mepcã€‚ï¼ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰“å°ç»“æ„ä½“æŒ‡é’ˆçš„è®¯æ¯æ¥çœ‹çœ‹æ˜¯ä¸æ˜¯å¯¹åº”çš„ä½ç½®ï¼ˆæ¯”å¦‚mepcï¼‰ã€‚ï¼‰åŒæ—¶æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°jal __am_irq_handleï¼Œè¿™é‡Œå°±çœŸæ­£è·³è½¬åˆ°äº†æ¡†æ¶ä»£ç ã€‚ä½†è¿™ä¸ªæ˜æ˜æ˜¯Context ï¼Œå“ªæ¥çš„Contextï¼Ÿ\nå¯ä»¥åˆç†çŒœæµ‹åº”è¯¥æ˜¯mv a0,sp ä¸­ä¼ å…¥spå¾—åˆ°äº†contextçš„æŒ‡é’ˆä¿¡æ¯Context *cï¼Œè€Œç»“æ„ä½“æŒ‡é’ˆçš„ç¬¬ä¸€ä¸ªæˆå‘˜çš„åœ°å€ä¹Ÿå³æ˜¯ç»“æ„ä½“æŒ‡é’ˆçš„åœ°å€ã€‚\näº‹ä»¶åˆ†å‘ __am_irq_handle()çš„ä»£ç ä¼šæŠŠæ‰§è¡Œæµåˆ‡æ¢çš„åŸå› æ‰“åŒ…æˆäº‹ä»¶, ç„¶åè°ƒç”¨åœ¨cte_init()ä¸­æ³¨å†Œçš„äº‹ä»¶å¤„ç†å›è°ƒå‡½æ•°ï¼ˆuser_handlerï¼‰, å°†äº‹ä»¶äº¤ç»™Nanos-liteæ¥å¤„ç†\nå®ç°å®Œæˆåå‘ç°å¡åœ¨è‡ªç°å¼‚å¸¸çš„æ­»å¾ªç¯,ä¹‹åä¼šè§£å†³è¿™ä¸ªé—®é¢˜\næ¢å¤ä¸Šä¸‹æ–‡ ä»£ç å°†ä¼šä¸€è·¯è¿”å›åˆ°trap.Sçš„__am_asm_trap()ä¸­, æ¥ä¸‹æ¥çš„äº‹æƒ…å°±æ˜¯æ¢å¤ç¨‹åºçš„ä¸Šä¸‹æ–‡. __am_asm_trap()å°†æ ¹æ®ä¹‹å‰ä¿å­˜çš„ä¸Šä¸‹æ–‡å†…å®¹, æ¢å¤ç¨‹åºçš„çŠ¶æ€, æœ€åæ‰§è¡Œ\u0026quot;å¼‚å¸¸è¿”å›æŒ‡ä»¤\u0026quot;è¿”å›åˆ°ç¨‹åºè§¦å‘å¼‚å¸¸ä¹‹å‰çš„çŠ¶æ€.\néœ€è¦æ³¨æ„ä¹‹å‰è‡ªé™·æŒ‡ä»¤ä¿å­˜çš„PCrã€‚iscv32çš„ecall, ä¿å­˜çš„æ˜¯è‡ªé™·æŒ‡ä»¤çš„PC, å› æ­¤éœ€è¦åœ¨é€‚å½“çš„åœ°æ–¹å¯¹ä¿å­˜çš„PCåŠ ä¸Š4, ä½¿å¾—å°†æ¥è¿”å›åˆ°è‡ªé™·æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤.\nä»€ä¹ˆå«åšåˆé€‚çš„åœ°æ–¹ï¼Ÿæˆ‘ä»¬è¯¥æƒ³æƒ³ä»€ä¹ˆå«åšæ¢å¤ä¸Šä¸‹æ–‡â€”â€”ç”¨ä»€ä¹ˆæ¢å¤ï¼Ÿ\næ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨æ¢å¤çš„åœ°æ–¹å°†pc+4ã€‚\né—®ï¼šä»åŠ 4æ“ä½œçœ‹CISCå’ŒRISC äº‹å®ä¸Š, è‡ªé™·åªæ˜¯å…¶ä¸­ä¸€ç§å¼‚å¸¸ç±»å‹. æœ‰ä¸€ç§æ•…éšœç±»å¼‚å¸¸, å®ƒä»¬è¿”å›çš„PCå’Œè§¦å‘å¼‚å¸¸çš„PCæ˜¯åŒä¸€ä¸ª, ä¾‹å¦‚ç¼ºé¡µå¼‚å¸¸, åœ¨ç³»ç»Ÿå°†æ•…éšœæ’é™¤å, å°†ä¼šé‡æ–°æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤è¿›è¡Œé‡è¯•, å› æ­¤å¼‚å¸¸è¿”å›çš„PCæ— éœ€åŠ 4. æ‰€ä»¥æ ¹æ®å¼‚å¸¸ç±»å‹çš„ä¸åŒ, æœ‰æ—¶å€™éœ€è¦åŠ 4, æœ‰æ—¶å€™åˆ™ä¸éœ€è¦åŠ .\nè¿™æ—¶å€™, æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘è¿™æ ·çš„ä¸€ä¸ªé—®é¢˜äº†: å†³å®šè¦ä¸è¦åŠ 4çš„, æ˜¯ç¡¬ä»¶è¿˜æ˜¯è½¯ä»¶å‘¢? CISCå’ŒRISCçš„åšæ³•æ­£å¥½ç›¸å, CISCéƒ½äº¤ç»™ç¡¬ä»¶æ¥åš, è€ŒRISCåˆ™äº¤ç»™è½¯ä»¶æ¥åš. æ€è€ƒä¸€ä¸‹, è¿™ä¸¤ç§æ–¹æ¡ˆå„æœ‰ä»€ä¹ˆå–èˆ? ä½ è®¤ä¸ºå“ªç§æ›´åˆç†å‘¢? ä¸ºä»€ä¹ˆ?\nç­”ï¼šriscvä¸æ”¯æŒç”¨ç¡¬ä»¶ï¼Œåªæœ‰ä¸€ä¸ªï¼Œæ˜¯å› ä¸ºpcè¦å­˜åœ¨mepcé‡Œï¼Œmepcåªæœ‰1ä¸ªï¼Œx86æ‰§è¡Œåˆ°intæŒ‡ä»¤åä¼šç›´æ¥æŠŠflags,cs,ipå‹æ ˆã€‚x86æ˜¯ç¡¬ä»¶åšçš„ (by pony)\nè€Œä¸”æˆ‘å€¾å‘äºx86æ”¾åœ¨ç¡¬ä»¶ä¸»è¦æ˜¯æŒ‡ä»¤å¤ªå¤šï¼Œæ”¾åœ¨è½¯ä»¶ä¼šæ‹–æ…¢é€Ÿåº¦è€Œä¸”å¯èƒ½ä¼šå¯¼è‡´å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ã€‚\né—®ï¼šå¿…ç­”é¢˜(éœ€è¦åœ¨å®éªŒæŠ¥å‘Šä¸­å›ç­”) - ç†è§£ç©¿è¶Šæ—¶ç©ºçš„æ—…ç¨‹ ä»Nanos-liteè°ƒç”¨yield()å¼€å§‹, åˆ°ä»yield()è¿”å›çš„æœŸé—´, è¿™ä¸€è¶Ÿæ—…ç¨‹å…·ä½“ç»å†äº†ä»€ä¹ˆ? è½¯(AM, Nanos-lite)ç¡¬(NEMU)ä»¶æ˜¯å¦‚ä½•ç›¸äº’ååŠ©æ¥å®Œæˆè¿™è¶Ÿæ—…ç¨‹çš„? ä½ éœ€è¦è§£é‡Šè¿™ä¸€è¿‡ç¨‹ä¸­çš„æ¯ä¸€å¤„ç»†èŠ‚, åŒ…æ‹¬æ¶‰åŠçš„æ¯ä¸€è¡Œæ±‡ç¼–ä»£ç /Cä»£ç çš„è¡Œä¸º, å°¤å…¶æ˜¯ä¸€äº›æ¯”è¾ƒå…³é”®çš„æŒ‡ä»¤/å˜é‡. äº‹å®ä¸Š, ä¸Šæ–‡çš„å¿…ç­”é¢˜\u0026quot;ç†è§£ä¸Šä¸‹æ–‡ç»“æ„ä½“çš„å‰ä¸–ä»Šç”Ÿ\u0026quot;å·²ç»æ¶µç›–äº†è¿™è¶Ÿæ—…ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†, ä½ å¯ä»¥æŠŠå®ƒçš„å›ç­”åŒ…å«è¿›æ¥.\nåˆ«è¢«\u0026quot;æ¯ä¸€è¡Œä»£ç \u0026quot;å“åˆ°äº†, è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±å¤§çº¦50è¡Œä»£ç , è¦å®Œå…¨ç†è§£é€å½»å¹¶ä¸æ˜¯ä¸å¯èƒ½çš„. æˆ‘ä»¬ä¹‹æ‰€ä»¥è®¾ç½®è¿™é“å¿…ç­”é¢˜, æ˜¯ä¸ºäº†å¼ºè¿«ä½ ç†è§£æ¸…æ¥šè¿™ä¸ªè¿‡ç¨‹ä¸­çš„æ¯ä¸€å¤„ç»†èŠ‚. è¿™ä¸€ç†è§£æ˜¯å¦‚æ­¤é‡è¦, ä»¥è‡³äºå¦‚æœä½ ç¼ºå°‘å®ƒ, æ¥ä¸‹æ¥ä½ é¢å¯¹bugå‡ ä¹æ˜¯æŸæ‰‹æ— ç­–\nç­”ï¼šæš‚æ—¶å‚è€ƒç†è§£ä¸Šä¸‹æ–‡ç»“æ„ä½“çš„å‰ä¸–ä»Šç”Ÿ\n3ã€ç”¨æˆ·ç¨‹åºå’Œç³»ç»Ÿè°ƒç”¨ è¿™éƒ¨åˆ†å¼ºçƒˆæ¨èå…ˆçœ‹è¢å¦ˆå¦ˆæœ‰å…³é“¾æ¥å’Œå¯æ‰§è¡Œæ–‡ä»¶çš„è®²è§£\nç®€ç›´æ˜¯æ‰‹æŠŠæ‰‹å–‚ç»™ä½ ï¼š\nhttps://www.bilibili.com/video/BV1kE411X7S5\nåŠ è½½ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åº åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯æŠŠå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®æ”¾ç½®åœ¨æ­£ç¡®çš„å†…å­˜ä½ç½®,\nç„¶åè·³è½¬åˆ°ç¨‹åºå…¥å£, ç¨‹åºå°±å¼€å§‹æ‰§è¡Œäº†. æ›´å…·ä½“çš„, ä¸ºäº†å®ç°loader()å‡½æ•°, æˆ‘ä»¬éœ€è¦è§£å†³ä»¥ä¸‹é—®é¢˜:\nå¯æ‰§è¡Œæ–‡ä»¶åœ¨å“ªé‡Œ?\nä»£ç å’Œæ•°æ®åœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„å“ªä¸ªä½ç½®?\nä»£ç å’Œæ•°æ®æœ‰å¤šå°‘?\n\u0026ldquo;æ­£ç¡®çš„å†…å­˜ä½ç½®\u0026quot;åœ¨å“ªé‡Œ?\nå…¶ä¸­, navy-apps/libs/libcä¸­æ˜¯ä¸€ä¸ªåä¸ºNewlibçš„é¡¹ç›®, å®ƒæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºåµŒå…¥å¼ç³»ç»Ÿæä¾›çš„Cåº“, åº“ä¸­çš„å‡½æ•°å¯¹è¿è¡Œæ—¶ç¯å¢ƒçš„è¦æ±‚æä½. ç”¨æˆ·ç¨‹åºçš„å…¥å£ä½äºnavy-apps/libs/libos/src/crt0/start/$ISA.Sä¸­çš„_start()å‡½æ•°, è¿™é‡Œçš„crtæ˜¯C RunTimeçš„ç¼©å†™, 0çš„å«ä¹‰è¡¨ç¤ºæœ€å¼€å§‹. _start()å‡½æ•°ä¼šè°ƒç”¨navy-apps/libs/libos/src/crt0/crt0.cä¸­çš„call_main()å‡½æ•°, ç„¶åè°ƒç”¨ç”¨æˆ·ç¨‹åºçš„main()å‡½æ•°, ä»main()å‡½æ•°è¿”å›åä¼šè°ƒç”¨exit()ç»“æŸè¿è¡Œ.\næˆ‘ä»¬çº¦å®šç›®å‰ç”¨æˆ·ç¨‹åºéœ€è¦è¢«é“¾æ¥åˆ°å†…å­˜ä½ç½®0x83000000é™„è¿‘, Navyå·²ç»è®¾ç½®å¥½äº†ç›¸åº”çš„é€‰é¡¹(è§navy-apps/scripts/$ISA.mkä¸­çš„LDFLAGSå˜é‡).\næ³¨ï¼šè¿™é‡Œæˆ‘çš„ç”µè„‘åœ¨make ISA=riscv32çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼Œæˆ‘æ€€ç–‘æ˜¯äº¤å‰æ±‡ç¼–ç¯å¢ƒå†²çªã€‚ã€‚ä¸æ˜ç™½(assert.hç›¸å…³è¯´undefined reference to `__assert_fail\u0026rsquo;ï¼‰äºæ˜¯ä»å¦å¤–ä¸€ä¸ªç”µè„‘å¼„æ¥äº†ç¼–è¯‘é€šè¿‡çš„æ–‡ä»¶ã€‚\nå¯æ‰§è¡Œæ–‡ä»¶ä½äºramdiskåç§»ä¸º0å¤„, è®¿é—®å®ƒå°±å¯ä»¥å¾—åˆ°ç”¨æˆ·ç¨‹åºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚.\né—®ï¼šå †å’Œæ ˆåœ¨å“ªé‡Œ? æˆ‘ä»¬æåˆ°äº†ä»£ç å’Œæ•°æ®éƒ½åœ¨å¯æ‰§è¡Œæ–‡ä»¶é‡Œé¢, ä½†å´æ²¡æœ‰æåˆ°å †(heap)å’Œæ ˆ(stack). ä¸ºä»€ä¹ˆå †å’Œæ ˆçš„å†…å®¹æ²¡æœ‰æ”¾å…¥å¯æ‰§è¡Œæ–‡ä»¶é‡Œé¢? é‚£ç¨‹åºè¿è¡Œæ—¶åˆ»ç”¨åˆ°çš„å †å’Œæ ˆåˆæ˜¯æ€ä¹ˆæ¥çš„? AMçš„ä»£ç æ˜¯å¦èƒ½ç»™ä½ å¸¦æ¥ä¸€äº›å¯å‘?\nç­”ï¼šè¿™äº›ä»£ç å’Œæ•°æ®æœ¬èº«éƒ½æ˜¯é™æ€çš„ã€‚ç¨‹åºè¦æƒ³è¿è¡Œï¼Œé¦–å…ˆè¦OSè´Ÿè´£ä¸ºå…¶åˆ›å»ºè¿›ç¨‹ï¼Œå¹¶åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸ºå…¶ä»£ç æ®µå’Œæ•°æ®æ®µå»ºç«‹æ˜ å°„ã€‚å…‰æœ‰ä»£ç æ®µå’Œæ•°æ®æ®µæ˜¯ä¸å¤Ÿçš„ï¼Œè¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¿˜è¦æœ‰å…¶åŠ¨æ€ç¯å¢ƒï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯å †æ ˆã€‚\nå†…æ ¸åœ¨åˆ›å»ºè¿›ç¨‹çš„æ—¶å€™ï¼Œåœ¨åˆ›å»ºtask_structçš„åŒæ—¶ï¼Œä¼šä¸ºè¿›ç¨‹åˆ›å»ºç›¸åº”çš„å †æ ˆã€‚æ¯ä¸ªè¿›ç¨‹ä¼šæœ‰ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªç”¨æˆ·æ ˆï¼Œå­˜åœ¨äºç”¨æˆ·ç©ºé—´ï¼Œä¸€ä¸ªå†…æ ¸æ ˆï¼Œå­˜åœ¨äºå†…æ ¸ç©ºé—´ã€‚\né—®ï¼šå¦‚ä½•è¯†åˆ«ä¸åŒæ ¼å¼çš„å¯æ‰§è¡Œæ–‡ä»¶? å¦‚æœä½ åœ¨GNU/Linuxä¸‹æ‰§è¡Œä¸€ä¸ªä»Windowsæ‹·è¿‡æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶, å°†ä¼šæŠ¥å‘Š\u0026quot;æ ¼å¼é”™è¯¯\u0026rdquo;. æ€è€ƒä¸€ä¸‹, GNU/Linuxæ˜¯å¦‚ä½•çŸ¥é“\u0026quot;æ ¼å¼é”™è¯¯\u0026quot;çš„?\nç­”ï¼š\nä¸åŒç»„ç»‡å½¢å¼å½¢æˆäº†ä¸åŒæ ¼å¼çš„å¯æ‰§è¡Œæ–‡ä»¶, ä¾‹å¦‚Windowsä¸»æµçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯PE(Portable Executable)æ ¼å¼, è€ŒGNU/Linuxä¸»è¦ä½¿ç”¨ELF(Executable and Linkable Format)æ ¼å¼. å› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹, ä½ ä¸èƒ½åœ¨Windowsä¸‹æŠŠä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ°GNU/Linuxä¸‹æ‰§è¡Œ, åä¹‹äº¦ç„¶. ELFæ˜¯GNU/Linuxå¯æ‰§è¡Œæ–‡ä»¶çš„æ ‡å‡†æ ¼å¼, è¿™æ˜¯å› ä¸ºGNU/Linuxéµå¾ªSystem V ABI(Application Binary Interface).\nE:å¯æ‰§è¡Œ Lï¼šé“¾æ¥\né€šè¿‡è§£ææ•°æ®ç»“æ„å¯ä»¥å¾—åˆ°ä¿¡æ¯ã€‚æ¯”å¦‚ELFå¤´ã€‚\nELFæ–‡ä»¶æä¾›äº†ä¸¤ä¸ªè§†è§’æ¥ç»„ç»‡ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶,\nä¸€ä¸ªæ˜¯é¢å‘é“¾æ¥è¿‡ç¨‹çš„sectionè§†è§’, è¿™ä¸ªè§†è§’æä¾›äº†ç”¨äºé“¾æ¥ä¸é‡å®šä½çš„ä¿¡æ¯(ä¾‹å¦‚ç¬¦å·è¡¨); å¦ä¸€ä¸ªæ˜¯é¢å‘æ‰§è¡Œçš„segmentè§†è§’, è¿™ä¸ªè§†è§’æä¾›äº†ç”¨äºåŠ è½½å¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯. å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttps://blog.csdn.net/GoolyOh/article/details/119801160\nä¸€ä¸ªsegmentå¯èƒ½ç”±0ä¸ªæˆ–å¤šä¸ªsectionç»„æˆ, ä½†ä¸€ä¸ªsectionå¯èƒ½ä¸è¢«åŒ…å«äºä»»ä½•segmentä¸­.\nprogram header tableçš„ä¸€ä¸ªè¡¨é¡¹æè¿°äº†ä¸€ä¸ªsegmentçš„æ‰€æœ‰å±æ€§, åŒ…æ‹¬ç±»å‹, è™šæ‹Ÿåœ°å€, æ ‡å¿—, å¯¹é½æ–¹å¼, ä»¥åŠæ–‡ä»¶å†…åç§»é‡å’Œsegmentå¤§å°.\nåŠ è½½ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¹¶ä¸æ˜¯åŠ è½½å®ƒæ‰€åŒ…å«çš„æ‰€æœ‰å†…å®¹, åªè¦åŠ è½½é‚£äº›ä¸è¿è¡Œæ—¶åˆ»ç›¸å…³çš„å†…å®¹å°±å¯ä»¥äº†, ä¾‹å¦‚è°ƒè¯•ä¿¡æ¯å’Œç¬¦å·è¡¨å°±ä¸å¿…åŠ è½½. æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­segmentçš„Typeå±æ€§æ˜¯å¦ä¸ºPT_LOADæ¥åˆ¤æ–­ä¸€ä¸ªsegmentæ˜¯å¦éœ€è¦åŠ è½½.\né—®ï¼šå†—ä½™çš„å±æ€§? ä½¿ç”¨readelfæŸ¥çœ‹ä¸€ä¸ªELFæ–‡ä»¶çš„ä¿¡æ¯, ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªsegmentåŒ…å«ä¸¤ä¸ªå¤§å°çš„å±æ€§, åˆ†åˆ«æ˜¯FileSizå’ŒMemSiz, è¿™æ˜¯ä¸ºä»€ä¹ˆ? å†ä»”ç»†è§‚å¯Ÿä¸€ä¸‹, ä½ ä¼šå‘ç°FileSizé€šå¸¸ä¸ä¼šå¤§äºç›¸åº”çš„MemSiz, è¿™åˆæ˜¯ä¸ºä»€ä¹ˆ?\nç­”ï¼š ç›¸å¯¹æ–‡ä»¶åç§»OffsetæŒ‡å‡ºç›¸åº”segmentçš„å†…å®¹ä»ELFæ–‡ä»¶çš„ç¬¬Offsetå­—èŠ‚å¼€å§‹,åœ¨æ–‡ä»¶ä¸­çš„å¤§å°ä¸ºFileSiz, å®ƒéœ€è¦è¢«åˆ†é…åˆ°ä»¥VirtAddrä¸ºé¦–åœ°å€çš„è™šæ‹Ÿå†…å­˜ä½ç½®, åœ¨å†…å­˜ä¸­å®ƒå ç”¨å¤§å°ä¸ºMemSiz.\nè¿™ä¸ªsegmentä½¿ç”¨çš„å†…å­˜å°±æ˜¯[VirtAddr, VirtAddr + MemSiz)è¿™ä¸€è¿ç»­åŒºé—´, ç„¶åå°†segmentçš„å†…å®¹ä»ELFæ–‡ä»¶ä¸­è¯»å…¥åˆ°è¿™ä¸€å†…å­˜åŒºé—´, æƒ³æƒ³ä¸ºä»€ä¹ˆè¦é¢„ç•™nobitsçš„ç©ºé—´â€”â€”æœ¬è´¨æ˜¯.bssç›¸å…³ã€‚\nä½ éœ€è¦æ‰¾å‡ºæ¯ä¸€ä¸ªéœ€è¦åŠ è½½çš„segmentçš„Offset, VirtAddr, FileSizå’ŒMemSizè¿™äº›å‚æ•°. å…¶ä¸­ç›¸å¯¹æ–‡ä»¶åç§»OffsetæŒ‡å‡ºç›¸åº”segmentçš„å†…å®¹ä»ELFæ–‡ä»¶çš„ç¬¬Offsetå­—èŠ‚å¼€å§‹, åœ¨æ–‡ä»¶ä¸­çš„å¤§å°ä¸ºFileSiz, å®ƒéœ€è¦è¢«åˆ†é…åˆ°ä»¥VirtAddrä¸ºé¦–åœ°å€çš„è™šæ‹Ÿå†…å­˜ä½ç½®, åœ¨å†…å­˜ä¸­å®ƒå ç”¨å¤§å°ä¸ºMemSiz. ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªsegmentä½¿ç”¨çš„å†…å­˜å°±æ˜¯[VirtAddr, VirtAddr + MemSiz)è¿™ä¸€è¿ç»­åŒºé—´, ç„¶åå°†segmentçš„å†…å®¹ä»ELFæ–‡ä»¶ä¸­è¯»å…¥åˆ°è¿™ä¸€å†…å­˜åŒºé—´, å¹¶å°†[VirtAddr + FileSiz, VirtAddr + MemSiz)å¯¹åº”çš„ç‰©ç†åŒºé—´æ¸…é›¶.\né—®ï¼šä¸ºä»€ä¹ˆè¦æ¸…é›¶? ä¸ºä»€ä¹ˆéœ€è¦å°† [VirtAddr + FileSiz, VirtAddr + MemSiz) å¯¹åº”çš„ç‰©ç†åŒºé—´æ¸…é›¶?\n.bssæ¸…é›¶çš„åŸå› :(æ³¨æ„åˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡ä¹Ÿåœ¨bssï¼‰\nè½¬è½½è‡ªï¼šhttp://www.zhihu.com/question/23147702/answer/23738366\nBSSæ®µæ¸…é›¶çš„åŸå› æ˜¯å› ä¸ºè¿™ä¸ªæ®µæ˜¯BSS è¦è¯´ä¸ºä»€ä¹ˆè¦æœ‰BSSçš„è¯ï¼Œå†å²å°±æ¯”è¾ƒä¹…è¿œäº†ã€‚ BSSæ®µæˆ‘æ‰€çŸ¥é“çš„èµ·æºæ˜¯Unixæœ€åˆçš„æ—¶å€™ï¼ˆå½“ç„¶ï¼Œä¸æ’é™¤å¯èƒ½æœ‰æ›´æ—©çš„æƒ…å†µï¼‰ã€‚å˜é‡åˆ†ä¸¤ç§ï¼šå±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡ã€‚æ ¹æ®Cè¯­æ³•çš„è§„å®šï¼Œå±€éƒ¨å˜é‡ä¸è®¾ç½®åˆå§‹å€¼çš„æ—¶å€™ï¼Œå…¶åˆå§‹å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œå±€éƒ¨å˜é‡ï¼ˆä¸å«é™æ€å±€éƒ¨å˜é‡ï¼‰çš„å­˜å‚¨ä½ç½®ä½äºæ ˆä¸Šï¼Œå…·ä½“ä½ç½®ä¸å›ºå®šã€‚å…¨å±€å˜é‡ï¼ˆå’Œé™æ€å±€éƒ¨å˜é‡ï¼‰æœ‰ä¸“é—¨æ•°æ®æ®µå­˜å‚¨ï¼Œåˆå§‹å€¼æ˜¯0ï¼Œå…·ä½“ä½ç½®æ˜¯å›ºå®šçš„ã€‚å…¶å®è¯´åˆ°åº•ï¼Œå°±ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½ç½®å›ºå®šï¼ˆæ•°æ®æ®µé‡Œï¼‰ï¼Œä¸€ç§æ˜¯ä½ç½®ä¸å›ºå®šçš„ï¼ˆæ ˆä¸Šï¼‰ã€‚ è¦çŸ¥é“ï¼Œæ—©æœŸçš„è®¡ç®—æœºå­˜å‚¨è®¾å¤‡æ˜¯å¾ˆè´µçš„ï¼Œè€Œå¾ˆå¤šæ—¶å€™ï¼Œæ•°æ®æ®µé‡Œçš„å…¨å±€å˜é‡éƒ½æ˜¯0ï¼ˆæˆ–è€…æ²¡æœ‰åˆå§‹å€¼ï¼‰ï¼Œé‚£ä¹ˆå­˜å‚¨è¿™ä¹ˆå¤šçš„0åˆ°ç›®æ ‡æ–‡ä»¶é‡Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚æ‰€ä»¥ä¸ºäº†èŠ‚çº¦ç©ºé—´ï¼Œåœ¨ç”Ÿæˆç›®æ ‡æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±æŠŠæ²¡æœ‰åˆå§‹å€¼ï¼ˆå®é™…å°±æ˜¯0ï¼‰çš„æ•°æ®æ®µé‡Œçš„å˜é‡éƒ½æ”¾åˆ°BSSæ®µé‡Œï¼Œè¿™æ ·ç›®æ ‡æ–‡ä»¶å°±ä¸éœ€è¦é‚£ä¹ˆå¤§çš„ä½“ç§¯é‡Œï¼ˆèŠ‚çº¦ç£ç›˜ç©ºé—´ï¼‰ã€‚åªæœ‰å½“ç›®æ ‡æ–‡ä»¶è¢«è½½å…¥çš„æ—¶å€™ï¼ŒåŠ è½½å™¨è´Ÿè´£æŠŠBSSæ®µæ¸…é›¶ï¼ˆä¸€ä¸ªå¾ªç¯å°±å¯ä»¥æå®šï¼‰ã€‚ ä¹‹åï¼Œè¿™ä¸ªè§„åˆ™æ…¢æ…¢çš„æˆä¸ºä¸€ä¸ªæ ‡å‡†é…ç½®ï¼Œå¤§å¤šæ•°ç¼–è¯‘å™¨ä¹Ÿå°±éƒ½æ”¯æŒäº†BSSæ®µã€‚\nQ:å¦‚æœBSSä¸æ¸…é›¶å¯ä¸å¯ä»¥ï¼Ÿ A:å¯ä»¥ï¼Œå¦‚æœç¼–è¯‘å™¨è§„å®šBSSæ®µä¸æ¸…é›¶ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†è¿™æ ·çš„è¯Cè¯­è¨€è¯­æ³•å°±è¦æ”¹äº†ï¼šæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å±€éƒ¨å˜é‡ï¼Œå…¶å€¼æ˜¯æœªçŸ¥çš„ã€‚ç”šè‡³å…¶å®ƒè¯­è¨€ä¹Ÿè¦è·Ÿç€æ”¹è¯­æ³•ã€‚ æ‰€ä»¥ï¼ŒBSSæ®µæ¸…é›¶çš„åŸå› æ˜¯å› ä¸ºè¿™ä¸ªæ®µæ˜¯BSS\næ’æ’­ldè¿‡ç¨‹ï¼š http://learn.lianglianglee.com/ä¸“æ /æ·±å…¥æµ…å‡ºè®¡ç®—æœºç»„æˆåŸç†/08 ELFå’Œé™æ€é“¾æ¥ï¼šä¸ºä»€ä¹ˆç¨‹åºæ— æ³•åŒæ—¶åœ¨Linuxå’ŒWindowsä¸‹è¿è¡Œï¼Ÿ.md\nè‡ªå·±çš„è¡¥å……ï¼šCè¯­è¨€çš„æ ‡å‡†å¯¹äºæœªåˆå§‹åŒ–çš„æ•°æ®æ˜¯UBè¿˜æ˜¯0 https://stackoverflow.com/questions/1597405/what-happens-to-a-declared-uninitialized-variable-in-c-does-it-have-a-value\nè‡ªå·±çš„è¡¥å……ï¼šWhy are global and static variables initialized to their default values https://stackoverflow.com/questions/2091499/why-are-global-and-static-variables-initialized-to-their-default-values/2091505#2091505\nSecurity: leaving memory alone would leak information from other processes or the kernel.\nEfficiency: the values are useless until initialized to something, and it\u0026rsquo;s more efficient to zero them in a block with unrolled loops. The OS can even zero freelist pages when the system is otherwise idle, rather than when some client or user is waiting for the program to start.\nReproducibility: leaving the values alone would make program behavior non-repeatable, making bugs really hard to find.\nElegance: it\u0026rsquo;s cleaner if programs can start from 0 without having to clutter the code with default initializers.\nOne might then wonder why the auto storage class does start as garbage. The answer is two-fold:\nIt doesn\u0026rsquo;t, in a sense. The very first stack frame page at each level (i.e., every new page added to the stack) does receive zero values. The \u0026ldquo;garbage\u0026rdquo;, or \u0026ldquo;uninitialized\u0026rdquo; values that subsequent function instances at the same stack level see are really the previous values left by other method instances of your own program and its library.\nThere might be a quadratic (or whatever) runtime performance penalty associated with initializing auto (function locals) to anything. A function might not use any or all of a large array, say, on any given call, and it could be invoked thousands or millions of times. The initialization of statics and globals, OTOH, only needs to happen once.\nå½“æ“ä½œç³»ç»Ÿå°†æ§åˆ¶æƒäº¤ç»™å®ƒçš„æ—¶å€™, è®¡ç®—æœºæŠŠå®ƒè§£é‡ŠæˆæŒ‡ä»¤å¹¶é€æ¡æ‰§è¡Œ. loaderè®©è®¡ç®—æœºçš„ç”Ÿå‘½å‘¨æœŸçªç ´ç¨‹åºçš„è¾¹ç•Œ: ä¸€ä¸ªç¨‹åºç»“æŸå¹¶ä¸æ„å‘³ç€è®¡ç®—æœºåœæ­¢å·¥ä½œ, è®¡ç®—æœºå°†ç»ˆå…¶ä¸€ç”Ÿå±¥è¡Œæ‰§è¡Œç¨‹åºçš„ä½¿å‘½.\nå®ç°loader ä½ éœ€è¦åœ¨Nanos-liteä¸­å®ç°loaderçš„åŠŸèƒ½, æ¥æŠŠç”¨æˆ·ç¨‹åºåŠ è½½åˆ°æ­£ç¡®çš„å†…å­˜ä½ç½®, ç„¶åæ‰§è¡Œç”¨æˆ·ç¨‹åº. loader()å‡½æ•°åœ¨nanos-lite/src/loader.cä¸­å®šä¹‰, å…¶ä¸­çš„pcbå‚æ•°ç›®å‰æš‚ä¸ä½¿ç”¨, å¯ä»¥å¿½ç•¥, è€Œå› ä¸ºramdiskä¸­ç›®å‰åªæœ‰ä¸€ä¸ªæ–‡ä»¶, filenameå‚æ•°ä¹Ÿå¯ä»¥å¿½ç•¥. åœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µå®ç°æ–‡ä»¶ç³»ç»Ÿä¹‹å, filenameå°±æ´¾ä¸Šç”¨åœºäº†.\nå®ç°å, åœ¨init_proc()ä¸­è°ƒç”¨naive_uload(NULL, NULL), å®ƒä¼šè°ƒç”¨ä½ å®ç°çš„loaderæ¥åŠ è½½ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åº, ç„¶åè·³è½¬åˆ°ç”¨æˆ·ç¨‹åºä¸­æ‰§è¡Œ. å¦‚æœä½ çš„å®ç°æ­£ç¡®, ä½ ä¼šçœ‹åˆ°æ‰§è¡Œdummyç¨‹åºæ—¶åœ¨Nanos-liteä¸­è§¦å‘äº†ä¸€ä¸ªæœªå¤„ç†çš„4å·äº‹ä»¶. è¿™è¯´æ˜loaderå·²ç»æˆåŠŸåŠ è½½dummy, å¹¶ä¸”æˆåŠŸåœ°è·³è½¬åˆ°dummyä¸­æ‰§è¡Œäº†. å…³äºæœªå¤„ç†çš„äº‹ä»¶, æˆ‘ä»¬ä¼šåœ¨ä¸‹æ–‡è¿›è¡Œè¯´æ˜.\nè¿™é‡Œæˆ‘çŠ¯å‚»äº†ä¸€ä¸‹ã€‚ã€‚ã€‚å®é™…ä¸Šè¯»å–çš„éƒ½æ˜¯æ•´æ•°ç±»å‹ï¼Œæˆ‘åœ¨é‚£ä¸€ç›´æ‰“å°å­—ç¬¦ä¸²æ•°æ®æ ¼å¼å°±è¯´ä¸€ç›´æ€ä¹ˆä¸å¯¹- -ã€‚ã€‚ã€‚ä¹ æƒ¯äº†char * arr[]ç›´æ¥æ‰“å°arrè€Œä¸ä¹ æƒ¯æ™®é€šint arr[]éœ€è¦å–æ•°å€¼äº†233333\u0026hellip;\nç›´æ¥è°ƒç”¨å‡½æ•°å¯ä»¥æ‰“å°å‡ºé­”æ•°\nå’Œæˆ‘ä»¬dumpå‡ºæ¥çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼š\næŠŠç”¨æˆ·ç¨‹åºåŠ è½½åˆ°æ­£ç¡®çš„å†…å­˜ä½ç½®,è¿™æ„å‘³ç€æˆ‘ä»¬è¦è·å–ç¨‹åºå¼€å§‹åœ°å€ä»¥åŠç¨‹åºå¤´è¡¨ï¼ˆæ®µå¤´è¡¨ï¼‰ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆéœ€è¦è‡ªå·±RTFMï¼Œçœ‹äº†è¢å¦ˆçš„è§†é¢‘å°±ä¼šè§‰å¾—è¿™å¹¶ä¸éš¾ã€‚\nè¿”å›å¼€å§‹åœ°å€å’Œè¯»å–elfå¤´å¾ˆç®€å•ï¼Œæ®µå¤´çš„å¤„ç†æœ‰ä¸€ç‚¹ç‚¹æ“ä½œï¼Œä¸»è¦æ˜¯æ³¨æ„æˆ‘ä»¬åªéœ€è¦è¯»å–LOADç›¸å…³æ®µï¼Œéœ€è¦åšä¸€ä¸ªæ‹¦æˆªï¼ˆæœ€å¥½æœ‰ä¸ªæ•°ç»„ï¼‰ï¼Œç„¶åæ ¹æ®è®²ä¹‰è¯´çš„ï¼š\nç„¶åæ³¨æ„ä¸€ä¸‹æˆ‘ä»¬è¦å†™å…¥åˆ°virtaddrçš„ä½ç½®è¦ç”¨æŒ‡é’ˆï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªåœ°å€æœ¬èº«æŒ‡é’ˆï¼‰\næ­¤æ—¶å‘ç°è¿›å…¥æ­»å¾ªç¯ï¼ˆåˆ«ç´§å¼ ï¼Œå…¶å®æ˜¯å¯¹çš„ã€‚ã€‚ã€‚ã€‚å¯ä»¥æ¥ä¸‹å»çœ‹è®²ä¹‰ï¼Œæˆ‘ä»¬å‘ç°è°ƒç”¨äº†ä¸¤æ¬¡ecallã€‚\nDIFFå¤§å‘çš„è§£è¯´ã€memcpyã€‘ (æœ¬é—®é¢˜æœ‰ä¸å°‘ç¾¤å‹éƒ½é‡åˆ°äº†ï¼Œæå‡ºè§£å†³æ–¹æ³•çš„æ˜¯ponyå“¥ï¼‰\nåœ¨loaderå®ç°é˜¶æ®µï¼Œä½ å¯èƒ½ä¼šç”¨diffé‡åˆ°pcæ¼‚ç§»diffå‡ºé”™å¾ˆç¦»è°±çš„ç¥å¥‡çŠ¶å†µï¼Œç”šè‡³åœ¨ä¹‹åä¹Ÿä¼šé‡åˆ°ï¼ˆä½†ä»ç„¶æœ‰ç»“æœä¸ä¼šé™·å…¥å¥‡æ€ªçš„å¾ªç¯ç­‰ç­‰ï¼‰ä¹Ÿè®¸ä½ éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼š\næ“ä½œç³»ç»Ÿçš„è¿è¡Œæ—¶ç¯å¢ƒ ç¨‹åºçš„è¿è¡Œéœ€è¦è¿è¡Œæ—¶ç¯å¢ƒçš„æ”¯æ’‘. è€Œæ“ä½œç³»ç»Ÿå¸Œæœ›åŠ è½½å¹¶è¿è¡Œç¨‹åº, è‡ªç„¶æœ‰è´£ä»»æ¥æä¾›è¿è¡Œæ—¶ç¯å¢ƒçš„åŠŸèƒ½.\néœ€è¦æœ‰ä¸€ä¸ªè§’è‰²æ¥å¯¹ç³»ç»Ÿä¸­çš„èµ„æºè¿›è¡Œç»Ÿä¸€çš„ç®¡ç†: ç¨‹åºä¸èƒ½æ“…è‡ªä½¿ç”¨èµ„æºäº†, ä½¿ç”¨çš„æ—¶å€™éœ€è¦å‘èµ„æºç®¡ç†è€…æå‡ºç”³è¯·. æ—¢ç„¶æ“ä½œç³»ç»Ÿä½äºé«˜ç‰¹æƒçº§, äº«å—ç€è‡³é«˜æ— ä¸Šçš„æƒåˆ©, è‡ªç„¶åœ°å®ƒä¹Ÿéœ€è¦å±¥è¡Œç›¸åº”çš„ä¹‰åŠ¡: ä½œä¸ºèµ„æºç®¡ç†è€…ç®¡ç†ç€ç³»ç»Ÿä¸­çš„æ‰€æœ‰èµ„æº, æ“ä½œç³»ç»Ÿè¿˜éœ€è¦ä¸ºç”¨æˆ·ç¨‹åºæä¾›ç›¸åº”çš„æœåŠ¡. è¿™äº›æœåŠ¡éœ€è¦ä»¥ä¸€ç§ç»Ÿä¸€çš„æ¥å£æ¥å‘ˆç°, ç”¨æˆ·ç¨‹åºä¹Ÿåªèƒ½é€šè¿‡è¿™ä¸€æ¥å£æ¥è¯·æ±‚æœåŠ¡.\nè¿™ä¸€æ¥å£å°±æ˜¯ç³»ç»Ÿè°ƒç”¨. è¿™æ˜¯æ“ä½œç³»ç»Ÿä»è¯ç”Ÿé‚£ä¸€åˆ»å°±è¢«èµ‹äºˆçš„ä½¿å‘½: æˆ‘ä»¬ä¹‹å‰æåˆ°GM-NAA I/Oçš„ä¸€ä¸ªä¸»è¦ä»»åŠ¡å°±æ˜¯åŠ è½½æ–°ç¨‹åº, è€Œå®ƒçš„å¦ä¸€ä¸ªä¸»è¦åŠŸèƒ½, å°±æ˜¯ä¸ºç¨‹åºæä¾›è¾“å…¥è¾“å‡ºçš„å…¬å…±æ¥å£. GM-NAA I/Oæ‰€æä¾›çš„å…¬å…±æ¥å£, å¯ä»¥è®¤ä¸ºæ˜¯ç³»ç»Ÿè°ƒç”¨çš„åˆåŸå½¢æ€.\né—®ï¼šç³»ç»Ÿè°ƒç”¨çš„å¿…è¦æ€§ å¯¹äºæ‰¹å¤„ç†ç³»ç»Ÿæ¥è¯´, ç³»ç»Ÿè°ƒç”¨æ˜¯å¿…é¡»çš„å—? å¦‚æœç›´æ¥æŠŠAMçš„APIæš´éœ²ç»™æ‰¹å¤„ç†ç³»ç»Ÿä¸­çš„ç¨‹åº, ä¼šä¸ä¼šæœ‰é—®é¢˜å‘¢?\nç­”ï¼šå¯èƒ½ä¼šæœ‰å„ç§å¥‡æ€ªçš„å¹¶å‘èµ„æºç«äº‰é—®é¢˜ï¼Œè€Œä¸”ä¼šè¢«æ¶æ„ç¨‹åºåˆ©ç”¨\nç³»ç»Ÿè°ƒç”¨æŠŠæ•´ä¸ªè¿è¡Œæ—¶ç¯å¢ƒåˆ†æˆä¸¤éƒ¨åˆ†, ä¸€éƒ¨åˆ†æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸åŒº, å¦ä¸€éƒ¨åˆ†æ˜¯ç”¨æˆ·åŒº. é‚£äº›ä¼šè®¿é—®ç³»ç»Ÿèµ„æºçš„åŠŸèƒ½ä¼šæ”¾åˆ°å†…æ ¸åŒºä¸­å®ç°, è€Œç”¨æˆ·åŒºåˆ™ä¿ç•™ä¸€äº›æ— éœ€ä½¿ç”¨ç³»ç»Ÿèµ„æºçš„åŠŸèƒ½(æ¯”å¦‚strcpy()), ä»¥åŠç”¨äºè¯·æ±‚ç³»ç»Ÿèµ„æºç›¸å…³æœåŠ¡çš„ç³»ç»Ÿè°ƒç”¨æ¥å£.\nåœ¨è¿™ä¸ªæ¨¡å‹ä¹‹ä¸‹, ç”¨æˆ·ç¨‹åºåªèƒ½åœ¨ç”¨æˆ·åŒºå®‰åˆ†å®ˆå·±åœ°\u0026quot;è®¡ç®—\u0026quot;, ä»»ä½•è¶…è¶Šçº¯ç²¹è®¡ç®—èƒ½åŠ›ä¹‹å¤–çš„ä»»åŠ¡, éƒ½éœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘æ“ä½œç³»ç»Ÿè¯·æ±‚æœåŠ¡. å¦‚æœç”¨æˆ·ç¨‹åºå°è¯•è¿›è¡Œä»»ä½•éæ³•æ“ä½œ, CPUå°±ä¼šå‘æ“ä½œç³»ç»ŸæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ä¿¡å·, è®©éæ³•æ“ä½œçš„æŒ‡ä»¤æ‰§è¡Œ\u0026quot;å¤±è´¥\u0026quot;, å¹¶äº¤ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œå¤„ç†. å¯¹, è¿™å°±æ˜¯ä¹‹å‰ä»‹ç»çš„ç¡¬ä»¶ä¿æŠ¤æœºåˆ¶, æ“ä½œç³»ç»Ÿéœ€è¦å€ŸåŠ©è¿™ä¸€å¤©ç„¶å±éšœæ¥é˜»æŒ¡ç¨‹åºçš„æ¶æ„è¡Œä¸º.\nè™½ç„¶æ“ä½œç³»ç»Ÿéœ€è¦ä¸ºç”¨æˆ·ç¨‹åºæœåŠ¡, ä½†è¿™å¹¶ä¸æ„å‘³ç€æ“ä½œç³»ç»Ÿéœ€è¦æŠŠæ‰€æœ‰ä¿¡æ¯éƒ½æš´éœ²ç»™ç”¨æˆ·ç¨‹åº. æœ‰äº›ä¿¡æ¯æ˜¯ç”¨æˆ·è¿›ç¨‹æ²¡æœ‰å¿…è¦çŸ¥é“çš„, ä¹Ÿæ°¸è¿œä¸åº”è¯¥çŸ¥é“, ä¾‹å¦‚ä¸€äº›ä¸å†…å­˜ç®¡ç†ç›¸å…³çš„æ•°æ®ç»“æ„. å¦‚æœä¸€ä¸ªæ¶æ„ç¨‹åºè·å¾—äº†è¿™äº›ä¿¡æ¯, å¯èƒ½ä¼šä¸ºæ¶æ„æ”»å‡»æä¾›äº†ä¿¡æ¯åŸºç¡€. å› æ­¤, é€šå¸¸ä¸å­˜åœ¨ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ¥è·å–è¿™äº›æ“ä½œç³»ç»Ÿçš„ç§æœ‰æ•°æ®.\nç³»ç»Ÿè°ƒç”¨ ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ï¼šç”¨æˆ·ç¨‹åºé€šè¿‡ä¸€ç§æ–¹æ³•æè¿°è‡ªå·±çš„éœ€æ±‚, ç„¶åå‘Šè¯‰æ“ä½œç³»ç»Ÿã€‚\n\u0026ldquo;å‘Šè¯‰æ“ä½œç³»ç»Ÿ\u0026rdquo;, è¿™æ˜¯é€šè¿‡è‡ªé™·æŒ‡ä»¤æ¥å®ç°çš„ã€‚\nåœ¨GNU/Linuxä¸­, ç”¨æˆ·ç¨‹åºé€šè¿‡è‡ªé™·æŒ‡ä»¤æ¥è§¦å‘ç³»ç»Ÿè°ƒç”¨, Nanos-liteä¹Ÿæ²¿ç”¨è¿™ä¸ªçº¦å®š. CTEä¸­çš„yield()ä¹Ÿæ˜¯é€šè¿‡è‡ªé™·æŒ‡ä»¤æ¥å®ç°,\nå¯¹ç”¨æˆ·ç¨‹åºæ¥è¯´, ç”¨æ¥å‘æ“ä½œç³»ç»Ÿæè¿°éœ€æ±‚çš„æœ€æ–¹ä¾¿æ‰‹æ®µå°±æ˜¯ä½¿ç”¨é€šç”¨å¯„å­˜å™¨äº†, å› ä¸ºæ‰§è¡Œè‡ªé™·æŒ‡ä»¤ä¹‹å, æ‰§è¡Œæµå°±ä¼šé©¬ä¸Šåˆ‡æ¢åˆ°äº‹å…ˆè®¾ç½®å¥½çš„å…¥å£, é€šç”¨å¯„å­˜å™¨ä¹Ÿä¼šä½œä¸ºä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†è¢«ä¿å­˜èµ·æ¥. ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°åªéœ€è¦ä»ä¸Šä¸‹æ–‡ä¸­è·å–å¿…è¦çš„ä¿¡æ¯, å°±èƒ½çŸ¥é“ç”¨æˆ·ç¨‹åºå‘å‡ºçš„æœåŠ¡è¯·æ±‚æ˜¯ä»€ä¹ˆäº†.\nç›®å‰dummyå·²ç»é€šè¿‡_syscall_()ç›´æ¥è§¦å‘ç³»ç»Ÿè°ƒç”¨, ä½ éœ€è¦è®©Nanos-liteè¯†åˆ«å‡ºç³»ç»Ÿè°ƒç”¨äº‹ä»¶EVENT_SYSCALL.\nåœ¨abstract-machine/am/include/arch/$ISA-nemu.hä¸­å®ç°æ­£ç¡®çš„GPR?å®, è®©å®ƒä»¬ä»ä¸Šä¸‹æ–‡cä¸­è·å¾—æ­£ç¡®çš„ç³»ç»Ÿè°ƒç”¨å‚æ•°å¯„å­˜å™¨.\næ·»åŠ SYS_yieldç³»ç»Ÿè°ƒç”¨.\nè®¾ç½®ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼.\nå¤„ç†ç³»ç»Ÿè°ƒç”¨çš„æœ€åä¸€ä»¶äº‹å°±æ˜¯è®¾ç½®ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼. å¯¹äºä¸åŒçš„ISA, ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼å­˜æ”¾åœ¨ä¸åŒçš„å¯„å­˜å™¨ä¸­, å®GPRxç”¨äºå®ç°è¿™ä¸€æŠ½è±¡, æ‰€ä»¥æˆ‘ä»¬é€šè¿‡GPRxæ¥è¿›è¡Œè®¾ç½®ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼å³å¯.\nç»è¿‡CTE, æ‰§è¡Œæµä¼šä»do_syscall()ä¸€è·¯è¿”å›åˆ°ç”¨æˆ·ç¨‹åºçš„_syscall_()å‡½æ•°ä¸­. ä»£ç æœ€åä¼šä»ç›¸åº”å¯„å­˜å™¨ä¸­å–å‡ºç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼, å¹¶è¿”å›ç»™_syscall_()çš„è°ƒç”¨è€…,\né‡æ–°è¿è¡Œdummyç¨‹åº, å¦‚æœä½ çš„å®ç°æ­£ç¡®, ä½ ä¼šçœ‹åˆ°dummyç¨‹åºåˆè§¦å‘äº†ä¸€ä¸ªå·ç ä¸º0çš„ç³»ç»Ÿè°ƒç”¨. æŸ¥çœ‹nanos-lite/src/syscall.h, ä½ ä¼šå‘ç°å®ƒæ˜¯ä¸€ä¸ªSYS_exitç³»ç»Ÿè°ƒç”¨. è¿™è¯´æ˜ä¹‹å‰çš„SYS_yieldå·²ç»æˆåŠŸè¿”å›, è§¦å‘SYS_exitæ˜¯å› ä¸ºdummyå·²ç»æ‰§è¡Œå®Œæ¯•, å‡†å¤‡é€€å‡ºäº†.\nä½ éœ€è¦å®ç°SYS_exitç³»ç»Ÿè°ƒç”¨, å®ƒä¼šæ¥æ”¶ä¸€ä¸ªé€€å‡ºçŠ¶æ€çš„å‚æ•°. ä¸ºäº†æ–¹ä¾¿æµ‹è¯•, æˆ‘ä»¬ç›®å‰å…ˆç›´æ¥ä½¿ç”¨è¿™ä¸ªå‚æ•°è°ƒç”¨halt(). å®ç°æˆåŠŸå, å†æ¬¡è¿è¡Œdummyç¨‹åº, ä½ ä¼šçœ‹åˆ°HIT GOOD TRAPçš„ä¿¡æ¯.\nã€ä½ éœ€è¦é˜…è¯»ä¸Šé¢æåˆ°çš„æ‰€æœ‰å‡½æ•°ï¼Œè¿™æ ·å°±èƒ½å®Œæˆæ‰€éœ€å†…å®¹ã€‚ã€‘\né—®ï¼šRISC-Vç³»ç»Ÿè°ƒç”¨å·çš„ä¼ é€’ å¦‚æœä½ é€‰æ‹©çš„æ˜¯RISC-V, ä½ ä¼šå‘ç°å®ƒå¹¶ä¸æ˜¯é€šè¿‡a0æ¥ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·. äº‹å®ä¸Š, æˆ‘ä»¬å‚è€ƒäº†RISC-V Linuxçš„ç³»ç»Ÿè°ƒç”¨å‚æ•°ä¼ é€’çš„çº¦å®š: å³åœ¨RISC-V Linuxä¸Šä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªå¯„å­˜å™¨æ¥ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·çš„. ä½ è§‰å¾—RISC-V Linuxä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨a0æ¥ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·å‘¢?\nç­”ï¼š\nç»è¿‡ä¸€é¡¿æ“ä½œçŒ›å¦‚è™è¡¥å……å¥½äº†å¯¹åº”å†…å®¹ã€‚ï¼ˆè®¤çœŸçœ‹è®²ä¹‰å³å¯ï¼‰\næ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„TRM æˆ‘ä»¬éœ€è¦æ„é€ osçš„è¿è¡Œæ—¶ç¯å¢ƒ\nç”¨æˆ·ç¨‹åºè¿˜å¯ä»¥åšä»€ä¹ˆå‘¢? æœ€åŸºæœ¬çš„, ä¸ºäº†æ»¡è¶³ç¨‹åºçš„åŸºæœ¬è®¡ç®—èƒ½åŠ›, éœ€è¦æœ‰è¿™äº›æ¡ä»¶:\næœºå™¨æä¾›åŸºæœ¬çš„è¿ç®—æŒ‡ä»¤ ï¼ˆæœºå™¨æä¾›äº†ï¼‰\nèƒ½è¾“å‡ºå­—ç¬¦ æœ‰å †åŒºå¯ä»¥åŠ¨æ€ç”³è¯·å†…å­˜\nå¯ä»¥ç»“æŸè¿è¡Œ ï¼ˆsys_exitï¼‰\nä¸ºäº†å‘ç”¨æˆ·ç¨‹åºæä¾›è¾“å‡ºå­—ç¬¦å’Œå†…å­˜åŠ¨æ€ç”³è¯·çš„åŠŸèƒ½, æˆ‘ä»¬éœ€è¦å®ç°æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨.\nwriteå®ç° ç®€å•å®ç°ä¸€ä¸‹writeï¼š å‘ç°æ‰“å°ä¸å…¨\nå…¶å®è¿™æ˜¯åé¢æåˆ°çš„ï¼š\nå †åŒºç®¡ç† è°ƒæ•´å †åŒºå¤§å°æ˜¯é€šè¿‡sbrk()åº“å‡½æ•°æ¥å®ç°çš„,ç”¨äºå°†ç”¨æˆ·ç¨‹åºçš„program breakå¢é•¿incrementå­—èŠ‚, å…¶ä¸­incrementå¯ä¸ºè´Ÿæ•°.\nmalloc()è¢«ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™, ä¼šé€šè¿‡sbrk(0)æ¥æŸ¥è¯¢ç”¨æˆ·ç¨‹åºå½“å‰program breakçš„ä½ç½®, ä¹‹åå°±å¯ä»¥é€šè¿‡åç»­çš„sbrk()è°ƒç”¨æ¥åŠ¨æ€è°ƒæ•´ç”¨æˆ·ç¨‹åºprogram breakçš„ä½ç½®äº†\nåœ¨Navyçš„Newlibä¸­, sbrk()æœ€ç»ˆä¼šè°ƒç”¨_sbrk(), å®ƒåœ¨navy-apps/libs/libos/src/syscall.cä¸­å®šä¹‰. æ¡†æ¶ä»£ç è®©_sbrk()æ€»æ˜¯è¿”å›-1, è¡¨ç¤ºå †åŒºè°ƒæ•´å¤±è´¥, äº‹å®ä¸Š,** ç”¨æˆ·ç¨‹åºåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨**printf()çš„æ—¶å€™ä¼šå°è¯•é€šè¿‡malloc()ç”³è¯·ä¸€ç‰‡ç¼“å†²åŒº, æ¥å­˜æ”¾æ ¼å¼åŒ–çš„å†…å®¹. è‹¥ç”³è¯·å¤±è´¥, å°±ä¼šé€ä¸ªå­—ç¬¦è¿›è¡Œè¾“å‡º.\næˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªç”¨äºè®¾ç½®å †åŒºå¤§å°çš„ç³»ç»Ÿè°ƒç”¨. åœ¨GNU/Linuxä¸­, è¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ˜¯SYS_brk, å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°addr, ç”¨äºæŒ‡ç¤ºæ–°çš„program breakçš„ä½ç½®. _sbrk()é€šè¿‡è®°å½•çš„æ–¹å¼æ¥å¯¹ç”¨æˆ·ç¨‹åºçš„program breakä½ç½®è¿›è¡Œç®¡ç†, å…¶å·¥ä½œæ–¹å¼å¦‚ä¸‹:\nprogram breakä¸€å¼€å§‹çš„ä½ç½®ä½äº_end\nè¢«è°ƒç”¨æ—¶, æ ¹æ®è®°å½•çš„program breakä½ç½®å’Œå‚æ•°increment, è®¡ç®—å‡ºæ–°program break\né€šè¿‡SYS_brkç³»ç»Ÿè°ƒç”¨æ¥è®©æ“ä½œç³»ç»Ÿè®¾ç½®æ–°program break\nè‹¥SYS_brkç³»ç»Ÿè°ƒç”¨æˆåŠŸ, è¯¥ç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›0, æ­¤æ—¶æ›´æ–°ä¹‹å‰è®°å½•çš„program breakçš„ä½ç½®, å¹¶å°†æ—§program breakçš„ä½ç½®ä½œä¸º_sbrk()çš„è¿”å›å€¼è¿”å›\nè‹¥è¯¥ç³»ç»Ÿè°ƒç”¨å¤±è´¥, _sbrk()ä¼šè¿”å›-1\nä¸Šè¿°ä»£ç æ˜¯åœ¨ç”¨æˆ·å±‚çš„åº“å‡½æ•°ä¸­å®ç°çš„, æˆ‘ä»¬è¿˜éœ€è¦åœ¨Nanos-liteä¸­å®ç°SYS_brkçš„åŠŸèƒ½. ç”±äºç›®å‰Nanos-liteè¿˜æ˜¯ä¸€ä¸ªå•ä»»åŠ¡æ“ä½œç³»ç»Ÿ, ç©ºé—²çš„å†…å­˜éƒ½å¯ä»¥è®©ç”¨æˆ·ç¨‹åºè‡ªç”±ä½¿ç”¨, å› æ­¤æˆ‘ä»¬åªéœ€è¦è®©SYS_brkç³»ç»Ÿè°ƒç”¨æ€»æ˜¯è¿”å›0å³å¯, è¡¨ç¤ºå †åŒºå¤§å°çš„è°ƒæ•´æ€»æ˜¯æˆåŠŸ. åœ¨PA4ä¸­, æˆ‘ä»¬ä¼šå¯¹è¿™ä¸€ç³»ç»Ÿè°ƒç”¨è¿›è¡Œä¿®æ”¹, å®ç°çœŸæ­£çš„å†…å­˜åˆ†é….\næ ¹æ®ä¸Šè¿°å†…å®¹åœ¨Nanos-liteä¸­å®ç°SYS_brkç³»ç»Ÿè°ƒç”¨, ç„¶ååœ¨ç”¨æˆ·å±‚å®ç°_sbrk(). ä½ å¯ä»¥é€šè¿‡man 2 sbrkæ¥æŸ¥é˜…libcä¸­brk()å’Œsbrk()çš„è¡Œä¸º, å¦å¤–é€šè¿‡man 3 endæ¥æŸ¥é˜…å¦‚ä½•ä½¿ç”¨_endç¬¦å·.\néœ€è¦æ³¨æ„çš„æ˜¯, è°ƒè¯•çš„æ—¶å€™ä¸è¦åœ¨_sbrk()ä¸­é€šè¿‡printf()è¿›è¡Œè¾“å‡º, è¿™æ˜¯å› ä¸ºprintf()è¿˜æ˜¯ä¼šå°è¯•é€šè¿‡malloc()æ¥ç”³è¯·ç¼“å†²åŒº, æœ€ç»ˆä¼šå†æ¬¡è°ƒç”¨_sbrk(), é€ æˆæ­»é€’å½’. ä½ å¯ä»¥é€šè¿‡sprintf()å…ˆæŠŠè°ƒè¯•ä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ç¼“å†²åŒºä¸­, ç„¶åé€šè¿‡_write()è¿›è¡Œè¾“å‡º.\nè¿™é‡ŒæŒ‰ç…§ä¸€æ­¥æ­¥æ“ä½œå°±å¥½ï¼Œå…¶å®å°±æ˜¯pa2çš„mallocçš„ç¨å¾®æ”¹å†™ã€‚è‡³äºendæ€ä¹ˆæ‹¿çœ‹manå°±æ‡‚äº†ã€‚\nï¼ˆè¿™é‡Œå…¶å®æœ‰ä¸ªå‘ï¼Œè¦æ³¨æ„å †åˆ†é…çš„ä½œç”¨åŸŸã€‚ä¸ç„¶å¤šæ¬¡å †åˆ†é…å°±æ²¡æœ‰æ„ä¹‰äº†ï¼‰\nè¿™é‡Œå…¶å®æˆ‘ä¸å¤ªç†è§£ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯â€œmallocçš„ç³»ç»Ÿè°ƒç”¨å¤±è´¥â€ï¼Œæ€ä¹ˆç®—å¤±è´¥å‘¢ï¼Ÿè®¿é—®åˆ°ä¸å¯è®¿é—®çš„å†…å­˜åº”è¯¥ä¼šç›´æ¥panicï¼Œæˆ–è€…å‡ºç•Œä¹Ÿä¼šç›´æ¥panicã€‚ä¹Ÿè®¸åº”è¯¥æœ‰æœºåˆ¶ä¼šåœ¨paè‡ªå·±panicçš„æƒ…å†µå‰æ‹¦æˆªï¼ˆæ¯”å¦‚å†æ¬¡æå‰æ£€æŸ¥åœ°å€æ˜¯å¦å‡ºç•Œï¼‰\nç„¶åæˆ‘å‘ç°äº†ä¸€ä¸ªä¹±ç é—®é¢˜ï¼ˆæ£€æŸ¥äº†å¾ˆå¤šæ¬¡åº”è¯¥ä¸æ˜¯å †çš„é—®é¢˜ï¼‰\nåé¢çªç„¶æƒ³åˆ°æ˜¯ä¸æ˜¯ç¼“å†²åŒºçš„é—®é¢˜ï¼ˆæ²¡æœ‰é‡åˆ°\\nå°±æš‚åœï¼‰ï¼Œä¿®æ”¹äº†writeé€»è¾‘åæ¢å¤æ­£å¸¸ï¼š\nå¦‚æœé€šè¿‡ç³»ç»Ÿè°ƒç”¨åƒè¾›ä¸‡è‹¦åœ°é™·å…¥æ“ä½œç³»ç»Ÿåªæ˜¯ä¸ºäº†è¾“å‡ºåŒºåŒºä¸€ä¸ªå­—ç¬¦, é‚£å°±å¤ªä¸åˆ’ç®—äº†. äºæ˜¯æœ‰äº†æ‰¹å¤„ç†(batching)çš„æŠ€æœ¯: å°†ä¸€äº›ç®€å•çš„ä»»åŠ¡ç´¯ç§¯èµ·æ¥, ç„¶åå†ä¸€æ¬¡æ€§è¿›è¡Œå¤„ç†. ç¼“å†²åŒºæ˜¯æ‰¹å¤„ç†æŠ€æœ¯çš„æ ¸å¿ƒ, libcä¸­çš„fread()å’Œfwrite()æ­£æ˜¯é€šè¿‡ç¼“å†²åŒºæ¥å°†æ•°æ®ç´¯ç§¯èµ·æ¥, ç„¶åå†é€šè¿‡ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨è¿›è¡Œå¤„ç†. ä¾‹å¦‚é€šè¿‡ä¸€ä¸ª1024å­—èŠ‚çš„ç¼“å†²åŒº, å°±å¯ä»¥é€šè¿‡ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ç›´æ¥è¾“å‡º1024ä¸ªå­—ç¬¦, è€Œä¸éœ€è¦é€šè¿‡1024æ¬¡ç³»ç»Ÿè°ƒç”¨æ¥é€ä¸ªå­—ç¬¦åœ°è¾“å‡º. æ˜¾ç„¶, åè€…çš„å¼€é”€æ¯”å‰è€…å¤§å¾—å¤š.\næœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åœ¨GNU/Linuxä¸Šç¼–å†™ç›¸åº”çš„ç¨‹åº, æ¥ç²—ç•¥æµ‹è¯•ä¸€ä¸‹ä¸€æ¬¡write()ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€, ç„¶åå’Œè¿™ç¯‡æ–‡ç« å¯¹æ¯”ä¸€ä¸‹\nprintf()æ‰“å°çš„å­—ç¬¦ä¸ä¸€å®šä¼šé©¬ä¸Šé€šè¿‡write()ç³»ç»Ÿè°ƒç”¨è¾“å‡º, ä½†é‡åˆ°\\næ—¶å¯ä»¥å¼ºè¡Œå°†ç¼“å†²åŒºä¸­çš„å†…å®¹è¿›è¡Œè¾“å‡º. æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥é˜…è¯»navy-apps/libs/libc/src/stdio/wbuf.c, è¿™ä¸ªæ–‡ä»¶å®ç°äº†ç¼“å†²åŒºçš„åŠŸèƒ½.\nå¿…ç­”é¢˜ - helloç¨‹åºæ˜¯ä»€ä¹ˆ, å®ƒä»è€Œä½•æ¥, è¦åˆ°å“ªé‡Œå» åˆ°æ­¤ä¸ºæ­¢, PAä¸­çš„æ‰€æœ‰ç»„ä»¶å·²ç»å…¨éƒ¨äº®ç›¸, æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿä¹Ÿå¼€å§‹è¶‹äºå®Œæ•´. ä½ ä¹Ÿå·²ç»åœ¨è¿™ä¸ªè‡ªå·±åˆ›é€ çš„è®¡ç®—æœºç³»ç»Ÿä¸Šè·‘èµ·äº†helloè¿™ä¸ªç¬¬ä¸€ä¸ªè¿˜è¯´å¾—è¿‡å»çš„ç”¨æˆ·ç¨‹åº (dummyæ˜¯ç»™å¤§å®¶çƒ­èº«ç”¨çš„, ä¸ç®—), å¥½æ¶ˆæ¯æ˜¯, æˆ‘ä»¬å·²ç»è·ç¦»è¿è¡Œä»™å‰‘å¥‡ä¾ ä¼ ä¸è¿œäº†(ä¸‹ä¸€ä¸ªé˜¶æ®µå°±æ˜¯å•¦).\nä¸è¿‡æŒ‰ç…§PAçš„ä¼ ç»Ÿ, å…‰æ˜¯è·‘èµ·æ¥è¿˜æ˜¯ä¸å¤Ÿçš„, ä½ è¿˜è¦æ˜ç™½å®ƒç©¶ç«Ÿæ€ä¹ˆè·‘èµ·æ¥æ‰è¡Œ. äºæ˜¯æ¥å›ç­”è¿™é“å¿…ç­”é¢˜å§:\næˆ‘ä»¬çŸ¥é“navy-apps/tests/hello/hello.cåªæ˜¯ä¸€ä¸ªCæºæ–‡ä»¶, å®ƒä¼šè¢«ç¼–è¯‘é“¾æ¥æˆä¸€ä¸ªELFæ–‡ä»¶. é‚£ä¹ˆ, helloç¨‹åºä¸€å¼€å§‹åœ¨å“ªé‡Œ?\nå®ƒæ˜¯æ€ä¹ˆå‡ºç°å†…å­˜ä¸­çš„? ä¸ºä»€ä¹ˆä¼šå‡ºç°åœ¨ç›®å‰çš„å†…å­˜ä½ç½®? å®ƒçš„ç¬¬ä¸€æ¡æŒ‡ä»¤åœ¨å“ªé‡Œ? ç©¶ç«Ÿæ˜¯æ€ä¹ˆæ‰§è¡Œåˆ°å®ƒçš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„?\nhelloç¨‹åºåœ¨ä¸æ–­åœ°æ‰“å°å­—ç¬¦ä¸², æ¯ä¸€ä¸ªå­—ç¬¦åˆæ˜¯ç»å†äº†ä»€ä¹ˆæ‰ä¼šæœ€ç»ˆå‡ºç°åœ¨ç»ˆç«¯ä¸Š?\n","date":"2022-08-26T08:50:40+08:00","permalink":"https://sanbuphy.github.io/p/nju%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%BE%E7%A8%8B%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C-pa3%E7%AC%94%E8%AE%B0%E4%B8%80/","title":"NJUè®¡ç®—æœºè¯¾ç¨‹åŸºç¡€å®éªŒ PA3ç¬”è®°ï¼ˆä¸€ï¼‰"},{"content":"ä¸€å¤©çœ‹åˆ°æœ‰ä¸ªç¾¤å‹é—®äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š\nä¸ºä»€ä¹ˆè¿™ä¸ªç±»æ²¡æœ‰çœ‹åˆ°ç»§æ‰¿äºè°ï¼Œä½†æ˜¯åœ¨é‡Œé¢å¯ä»¥ç›´æ¥superï¼Ÿ\nåœ¨è¿™ä¸ªæ ç›®ä¸­æˆ‘ä»¬å…ˆä¸è°ˆæœ‰å…³__setattr__é­”æœ¯æ–¹æ³•çš„å…·ä½“ä½œç”¨ï¼ˆå…¶å®å°±æ˜¯åå°„ï¼‰å’Œåº”ç”¨åœºæ™¯ï¼Œå°±å•çº¯è°ˆä¸ºä»€ä¹ˆåœ¨è¿™é‡Œå¯ä»¥å‡­ç©ºsuperã€‚\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š\nclass Person: def __setattr__(self,name,value): print(f\u0026#34;setting attribute [{name}] to {value}\u0026#34;) super().__setattr__(name,value) çœ‹ä¼¼æ²¡æœ‰é›†æˆä»»ä½•ç±»ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¯ä»¥superå‘¢ï¼Ÿå…¶å®ç›¸å½“äºé‡å†™äº†Personç±»çš„çˆ¶ç±»çš„__setattr__æ–¹æ³•ï¼Œpersonç±»çš„çˆ¶ç±»æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£å…ƒç±»çš„æ¦‚å¿µï¼šï¼ˆè½¬è½½è‡ªbç«™é˜¿å²³åŒå­¦ï¼‰\nå®é™…ä¸Šæˆ‘ä»¬åˆ›å»ºçš„ç±»personæœ¬èº«å°±æ˜¯objectçš„æ´¾ç”Ÿç±»ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨personé‡Œç›´æ¥superçš„æ—¶å€™ï¼Œäº‹å®ä¸Šä½¿ç”¨çš„æ˜¯objectçš„é­”æœ¯æ–¹æ³•ã€‚\næˆ‘ä»¬å¯ä»¥åšä¸ªå®éªŒï¼š\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨__base__æŸ¥çœ‹çˆ¶ç±»èƒ½å¤Ÿçœ‹åˆ°class\u0026rsquo;object\u0026rsquo;ï¼Œé‚£ä¹ˆåˆ°åº•ä»–æ˜¯ä¸ªä»€ä¹ˆå‘¢ï¼Ÿ\nåœ¨builtins.pyiä¸­æˆ‘ä»¬èƒ½ä¸€æ¢ç©¶ç«Ÿï¼š\næ‰€ä»¥ä¸€åˆ‡éƒ½å¾ˆæ˜¾ç„¶äº†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç›´æ¥superåŸå› æ˜¯æˆ‘ä»¬åˆ›é€ çš„classæœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æ´¾ç”Ÿã€‚\nâ€œä¸€ç”ŸäºŒï¼ŒäºŒç”Ÿä¸‰ï¼Œä¸‰ç”Ÿä¸‡ç‰©â€œ â€”â€” å¦‚æœè€å­æ˜¯ä¸ªç¨‹åºå‘˜ï¼Œåº”è¯¥å¾ˆå–œæ¬¢python\n","date":"2022-08-13T09:03:03+08:00","permalink":"https://sanbuphy.github.io/p/python%E8%BF%9B%E9%98%B6-%E6%9C%89%E5%85%B3%E5%85%83%E7%B1%BB%E7%9A%84%E6%B4%BE%E7%94%9F/","title":"pythonè¿›é˜¶ æœ‰å…³å…ƒç±»çš„æ´¾ç”Ÿ"},{"content":"åŸºç¡€è®¾æ–½(2)ï¼ˆè¿˜æœªå…¨å®Œæˆ traceç³»åˆ—æš‚æ—¶å¾…å¡«å‘ã€‚ã€‚ã€‚ã€‚\nNEMUæ˜¯ä¸€ä¸ªç”¨æ¥æ‰§è¡Œå…¶å®ƒç¨‹åºçš„ç¨‹åº. åœ¨å¯è®¡ç®—ç†è®ºä¸­, è¿™ç§ç¨‹åºæœ‰ä¸€ä¸ªä¸“é—¨çš„åè¯, å«é€šç”¨ç¨‹åº(Universal Program),\nNEMUå’Œå„ç§æ¨¡æ‹Ÿå™¨åªä¸è¿‡æ˜¯é€šç”¨ç¨‹åºçš„å®ä¾‹åŒ–, æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯«ä¸å¤¸å¼ åœ°è¯´, è®¡ç®—æœºå°±æ˜¯ä¸€ä¸ªé€šç”¨ç¨‹åºçš„å®ä½“åŒ–. é€šç”¨ç¨‹åºçš„å­˜åœ¨æ€§ä¸ºè®¡ç®—æœºçš„å‡ºç°å¥ å®šäº†ç†è®ºåŸºç¡€, æ˜¯å¯è®¡ç®—ç†è®ºä¸­ä¸€ä¸ªæå…¶é‡è¦çš„ç»“è®º,\nmemseté€šè¿‡æµ‹è¯•\næ¨èé˜…è¯» è®¡ç®—çš„æé™ï¼š https://zhuanlan.zhihu.com/p/270155475\né˜…è¯»ç›¸å…³Makefile, å°è¯•ç†è§£abstract-machineæ˜¯å¦‚ä½•ç”Ÿæˆnativeçš„å¯æ‰§è¡Œæ–‡ä»¶çš„. å¾…è¡¥å……\nå¥‡æ€ªçš„é”™è¯¯ç  ä¸ºä»€ä¹ˆé”™è¯¯ç æ˜¯1å‘¢? ä½ çŸ¥é“makeç¨‹åºæ˜¯å¦‚ä½•å¾—åˆ°è¿™ä¸ªé”™è¯¯ç çš„å—?\nåˆ«é«˜å…´å¤ªæ—©äº†, æ¡†æ¶ä»£ç ç¼–è¯‘åˆ°nativeçš„æ—¶å€™é»˜è®¤é“¾æ¥åˆ°glibc, æˆ‘ä»¬éœ€è¦æŠŠè¿™äº›åº“å‡½æ•°çš„è°ƒç”¨é“¾æ¥åˆ°æˆ‘ä»¬ç¼–å†™çš„klibæ¥è¿›è¡Œæµ‹è¯•. æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨abstract-machine/klib/include/klib.h ä¸­é€šè¿‡å®šä¹‰å®__NATIVE_USE_KLIB__æ¥æŠŠåº“å‡½æ•°é“¾æ¥åˆ°klib. å¦‚æœä¸å®šä¹‰è¿™ä¸ªå®, åº“å‡½æ•°å°†ä¼šé“¾æ¥åˆ°glibc, å¯ä»¥ä½œä¸ºæ­£ç¡®çš„å‚è€ƒå®ç°æ¥è¿›è¡Œå¯¹æ¯”.\nå¾…è¡¥å……\nè¿™æ˜¯å¦‚ä½•å®ç°çš„? ä¸ºä»€ä¹ˆå®šä¹‰å®__NATIVE_USE_KLIB__ä¹‹åå°±å¯ä»¥æŠŠnativeä¸Šçš„è¿™äº›åº“å‡½æ•°é“¾æ¥åˆ°klib? è¿™å…·ä½“æ˜¯å¦‚ä½•å‘ç”Ÿçš„? å°è¯•æ ¹æ®ä½ åœ¨è¯¾å ‚ä¸Šå­¦ä¹ çš„é“¾æ¥ç›¸å…³çš„çŸ¥è¯†è§£é‡Šè¿™ä¸€ç°è±¡.\nå¾…è¡¥å……\nè¾“å…¥è¾“å‡º è®¾å¤‡ä¸CPU è¦å‘è®¾å¤‡å‘é€ä¸€äº›æœ‰æ„ä¹‰çš„æ•°å­—ä¿¡å·, è®¾å¤‡å°±ä¼šæŒ‰ç…§è¿™äº›ä¿¡å·çš„å«ä¹‰æ¥å·¥ä½œ. è®©ä¸€äº›ä¿¡å·æ¥æŒ‡å¯¼è®¾å¤‡å¦‚ä½•å·¥ä½œ, è¿™ä¸å°±åƒ\u0026quot;ç¨‹åºçš„æŒ‡ä»¤æŒ‡å¯¼CPUå¦‚ä½•å·¥ä½œ\u0026quot;ä¸€æ ·å—? æ°æ°å°±æ˜¯è¿™æ ·! è®¾å¤‡ä¹Ÿæœ‰è‡ªå·±çš„çŠ¶æ€å¯„å­˜å™¨(ç›¸å½“äºCPUçš„å¯„å­˜å™¨), ä¹Ÿæœ‰è‡ªå·±çš„åŠŸèƒ½éƒ¨ä»¶(ç›¸å½“äºCPUçš„è¿ç®—å™¨). å½“ç„¶ä¸åŒçš„è®¾å¤‡æœ‰ä¸åŒçš„åŠŸèƒ½éƒ¨ä»¶, ä¾‹å¦‚é”®ç›˜æœ‰ä¸€ä¸ªæŠŠæŒ‰é”®çš„æ¨¡æ‹Ÿä¿¡å·è½¬æ¢æˆæ‰«æç çš„éƒ¨ä»¶, è€ŒVGAåˆ™æœ‰ä¸€ä¸ªæŠŠåƒç´ é¢œè‰²ä¿¡æ¯è½¬æ¢æˆæ˜¾ç¤ºå™¨æ¨¡æ‹Ÿä¿¡å·çš„éƒ¨ä»¶. æ§åˆ¶è®¾å¤‡å·¥ä½œçš„ä¿¡å·ç§°ä¸º\u0026quot;å‘½ä»¤å­—\u0026quot;, å¯ä»¥ç†è§£æˆã€è®¾å¤‡çš„æŒ‡ä»¤ã€‘, è®¾å¤‡çš„å·¥ä½œå°±æ˜¯è´Ÿè´£æ¥æ”¶å‘½ä»¤å­—, å¹¶è¿›è¡Œè¯‘ç å’Œæ‰§è¡Œ\u0026hellip; ä½ å·²ç»çŸ¥é“CPUçš„å·¥ä½œæ–¹å¼, è¿™ä¸€åˆ‡å¯¹ä½ æ¥è¯´éƒ½å¤ªç†Ÿæ‚‰äº†.\næ‰€è°“çš„è®¿é—®è®¾å¤‡, è¯´ç™½äº†å°±æ˜¯ä»è®¾å¤‡è·å–æ•°æ®(è¾“å…¥), æ¯”å¦‚ä»é”®ç›˜æ§åˆ¶å™¨è·å–æŒ‰é”®æ‰«æç , æˆ–è€…æ˜¯å‘è®¾å¤‡å‘é€æ•°æ®(è¾“å‡º), æ¯”å¦‚å‘æ˜¾å­˜å†™å…¥å›¾åƒçš„é¢œè‰²ä¿¡æ¯. ä½†æ˜¯, å¦‚æœä¸‡ä¸€ç”¨æˆ·æ²¡æœ‰æ•²é”®ç›˜, æˆ–è€…æ˜¯ç”¨æˆ·æƒ³è°ƒæ•´å±å¹•çš„åˆ†è¾¨ç‡, æ€ä¹ˆåŠå‘¢? è¿™è¯´æ˜, é™¤äº†çº¯ç²¹çš„æ•°æ®è¯»å†™ä¹‹å¤–, æˆ‘ä»¬è¿˜éœ€è¦å¯¹è®¾å¤‡è¿›è¡Œæ§åˆ¶: æ¯”å¦‚éœ€è¦è·å–é”®ç›˜æ§åˆ¶å™¨çš„çŠ¶æ€, æŸ¥çœ‹å½“å‰æ˜¯å¦æœ‰æŒ‰é”®è¢«æŒ‰ä¸‹; æˆ–è€…æ˜¯éœ€è¦æœ‰æ–¹å¼å¯ä»¥æŸ¥è¯¢æˆ–è®¾ç½®VGAæ§åˆ¶å™¨çš„åˆ†è¾¨ç‡. æ‰€ä»¥, åœ¨ç¨‹åºçœ‹æ¥,è®¿é—®è®¾å¤‡ = è¯»å‡ºæ•°æ® + å†™å…¥æ•°æ® + æ§åˆ¶çŠ¶æ€.\næ—¢ç„¶è®¾å¤‡ä¹Ÿæœ‰å¯„å­˜å™¨, ä¸€ç§æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æŠŠè®¾å¤‡çš„å¯„å­˜å™¨ä½œä¸ºæ¥å£, è®©CPUæ¥è®¿é—®è¿™äº›å¯„å­˜å™¨. CPUè¦å¦‚ä½•è®¿é—®è®¾å¤‡å¯„å­˜å™¨å‘¢? æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹CPUæ˜¯å¦‚ä½•è®¿é—®CPUè‡ªå·±çš„å¯„å­˜å™¨çš„: é¦–å…ˆç»™è¿™äº›å¯„å­˜å™¨ç¼–ä¸ªå·, æ¯”å¦‚eaxæ˜¯0, ecxæ˜¯1\u0026hellip; ç„¶ååœ¨æŒ‡ä»¤ä¸­å¼•ç”¨è¿™äº›ç¼–å·, ç”µè·¯ä¸Šä¼šæœ‰ç›¸åº”çš„é€‰æ‹©å™¨, æ¥é€‰æ‹©ç›¸åº”çš„å¯„å­˜å™¨å¹¶è¿›è¡Œè¯»å†™. å¯¹è®¾å¤‡å¯„å­˜å™¨çš„è®¿é—®ä¹Ÿæ˜¯ç±»ä¼¼çš„: æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™è®¾å¤‡ä¸­å…è®¸CPUè®¿é—®çš„å¯„å­˜å™¨é€ä¸€ç¼–å·, ç„¶åé€šè¿‡æŒ‡ä»¤æ¥å¼•ç”¨è¿™äº›ç¼–å·. è®¾å¤‡ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›ç§æœ‰å¯„å­˜å™¨, å®ƒä»¬æ˜¯ç”±è®¾å¤‡è‡ªå·±ç»´æŠ¤çš„, å®ƒä»¬æ²¡æœ‰è¿™æ ·çš„ç¼–å·, CPUä¸èƒ½ç›´æ¥è®¿é—®å®ƒä»¬.\nè¿™äº›ç¼–å·ä¹Ÿç§°ä¸ºè®¾å¤‡çš„åœ°å€. å¸¸ç”¨çš„ç¼–å€æ–¹å¼æœ‰ä¸¤ç§ï¼šç«¯å£I/Oã€å…§å­˜æ˜ å°„I/O\nç«¯å£I/O ç«¯å£æ˜ å°„I/O(port-mapped I/O), CPUä½¿ç”¨ä¸“é—¨çš„I/OæŒ‡ä»¤å¯¹è®¾å¤‡è¿›è¡Œè®¿é—®, å¹¶æŠŠè®¾å¤‡çš„åœ°å€ç§°ä½œç«¯å£å·. æœ‰äº†ç«¯å£å·ä»¥å, åœ¨I/OæŒ‡ä»¤ä¸­ç»™å‡ºç«¯å£å·, å°±çŸ¥é“è¦è®¿é—®å“ªä¸€ä¸ªè®¾å¤‡å¯„å­˜å™¨äº†. å¸‚åœºä¸Šçš„è®¡ç®—æœºç»å¤§å¤šæ•°éƒ½æ˜¯IBM PCå…¼å®¹æœº, IBM PCå…¼å®¹æœºå¯¹å¸¸è§è®¾å¤‡ç«¯å£å·çš„åˆ†é…æœ‰ä¸“é—¨çš„è§„å®š.\nx86æä¾›äº†inå’ŒoutæŒ‡ä»¤ç”¨äºè®¿é—®è®¾å¤‡, å…¶ä¸­inæŒ‡ä»¤ç”¨äºå°†è®¾å¤‡å¯„å­˜å™¨ä¸­çš„æ•°æ®ä¼ è¾“åˆ°CPUå¯„å­˜å™¨ä¸­, outæŒ‡ä»¤ç”¨äºå°†CPUå¯„å­˜å™¨ä¸­çš„æ•°æ®ä¼ é€åˆ°è®¾å¤‡å¯„å­˜å™¨ä¸­.\nmovl $0x41, %al\nmovl $0x3f8, %edx\noutb %al, (%dx)\nä¸Šè¿°ä»£ç æŠŠæ•°æ®0x41ä¼ é€åˆ°0x3f8å·ç«¯å£æ‰€å¯¹åº”çš„è®¾å¤‡å¯„å­˜å™¨ä¸­. CPUæ‰§è¡Œä¸Šè¿°ä»£ç å, ä¼šå°†0x41è¿™ä¸ªæ•°æ®ä¼ é€åˆ°ä¸²å£çš„ä¸€ä¸ªå¯„å­˜å™¨ä¸­, ä¸²å£æ¥æ”¶ä¹‹å, å‘ç°æ˜¯è¦è¾“å‡ºä¸€ä¸ªå­—ç¬¦A; ä½†å¯¹CPUæ¥è¯´, å®ƒå¹¶ä¸å…³å¿ƒè®¾å¤‡ä¼šæ€ä¹ˆå¤„ç†0x41è¿™ä¸ªæ•°æ®, åªä¼šè€è€å®å®åœ°æŠŠ0x41ä¼ é€åˆ°0x3f8å·ç«¯å£. äº‹å®ä¸Š, è®¾å¤‡çš„APIåŠå…¶è¡Œä¸ºéƒ½ä¼šåœ¨ç›¸åº”çš„æ–‡æ¡£é‡Œé¢æœ‰æ¸…æ™°çš„å®šä¹‰, åœ¨PAä¸­æˆ‘ä»¬æ— éœ€äº†è§£è¿™äº›ç»†èŠ‚, åªéœ€è¦çŸ¥é“, é©±åŠ¨å¼€å‘è€…å¯ä»¥é€šè¿‡RTFM, æ¥ç¼–å†™ç›¸åº”ç¨‹åºæ¥è®¿é—®è®¾å¤‡å³å¯.\nAPI, è¡Œä¸º, RTFM\u0026hellip; æ²¡é”™, æˆ‘ä»¬åˆå†æ¬¡çœ‹åˆ°äº†è®¡ç®—æœºç³»ç»Ÿè®¾è®¡çš„ä¸€ä¸ªä¾‹å­: è®¾å¤‡å‘CPUæš´éœ²è®¾å¤‡å¯„å­˜å™¨çš„æ¥å£, æŠŠè®¾å¤‡å†…éƒ¨çš„å¤æ‚è¡Œä¸º(ç”šè‡³ä¸€äº›æ¨¡æ‹Ÿç”µè·¯çš„ç‰¹æ€§)è¿›è¡ŒæŠ½è±¡, CPUåªéœ€è¦ä½¿ç”¨è¿™ä¸€æ¥å£è®¿é—®è®¾å¤‡, å°±å¯ä»¥å®ç°æœŸæœ›çš„åŠŸèƒ½. è®¡ç®—æœºç³»ç»Ÿå¤„å¤„è•´å«æŠ½è±¡çš„æ€æƒ³, åªè¦ç†è§£å…¶ä¸­çš„åŸç†, å†åŠ ä¸ŠRTFMçš„æŠ€èƒ½, ä½ å°±èƒ½æŒæ¡è®¡ç®—æœºç³»ç»Ÿçš„å…¨éƒ¨!\nå…§å­˜æ˜ å°„I/O ç«¯å£æ˜ å°„I/OæŠŠç«¯å£å·ä½œä¸ºI/OæŒ‡ä»¤çš„ä¸€éƒ¨åˆ†, è¿™ç§æ–¹æ³•å¾ˆç®€å•, ä½†åŒæ—¶ä¹Ÿæ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹. æŒ‡ä»¤é›†ä¸ºäº†å…¼å®¹å·²ç»å¼€å‘çš„ç¨‹åº, æ˜¯åªèƒ½æ·»åŠ ä½†ä¸èƒ½ä¿®æ”¹çš„.è¿™æ„å‘³ç€, ç«¯å£æ˜ å°„I/Oæ‰€èƒ½è®¿é—®çš„I/Oåœ°å€ç©ºé—´çš„å¤§å°, åœ¨è®¾è®¡I/OæŒ‡ä»¤çš„é‚£ä¸€åˆ»å°±å·²ç»å†³å®šä¸‹æ¥äº†. æ‰€è°“I/Oåœ°å€ç©ºé—´, å…¶å®å°±æ˜¯æ‰€æœ‰èƒ½è®¿é—®çš„è®¾å¤‡çš„åœ°å€çš„é›†åˆ. éšç€è®¾å¤‡è¶Šæ¥è¶Šå¤š, åŠŸèƒ½ä¹Ÿè¶Šæ¥è¶Šå¤æ‚, I/Oåœ°å€ç©ºé—´æœ‰é™çš„ç«¯å£æ˜ å°„I/Oå·²ç»é€æ¸ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†. æœ‰çš„è®¾å¤‡éœ€è¦è®©CPUè®¿é—®ä¸€æ®µè¾ƒå¤§çš„è¿ç»­å­˜å‚¨ç©ºé—´, å¦‚VGAçš„æ˜¾å­˜, 24è‰²åŠ ä¸ŠAlphaé€šé“çš„1024x768åˆ†è¾¨ç‡çš„æ˜¾å­˜å°±éœ€è¦3MBçš„ç¼–å€èŒƒå›´. äºæ˜¯å†…å­˜æ˜ å°„I/O(memory-mapped I/O, MMIO)åº”è¿è€Œç”Ÿ.\nç¼–å€æ–¹å¼å°†ä¸€éƒ¨åˆ†ç‰©ç†å†…å­˜çš„è®¿é—®\u0026quot;é‡å®šå‘\u0026quot;åˆ°I/Oåœ°å€ç©ºé—´ä¸­, CPUå°è¯•è®¿é—®è¿™éƒ¨åˆ†ç‰©ç†å†…å­˜çš„æ—¶å€™, å®é™…ä¸Šæœ€ç»ˆæ˜¯è®¿é—®äº†ç›¸åº”çš„I/Oè®¾å¤‡,\nç°ä»£è®¡ç®—æœºéƒ½å·²ç»æ˜¯64ä½è®¡ç®—æœº, ç‰©ç†åœ°å€çº¿éƒ½æœ‰48æ ¹,\nï¼ˆæ³¨æ„64ä½å¹¶ä¸éœ€è¦2çš„64æ¬¡æ–¹ï¼Œè€Œæ˜¯48å°±å¤Ÿäº†ï¼Œå› ä¸ºè¿‡å¤§ç©ºé—´å¯¼è‡´äº†èµ„æºæµªè´¹ã€‚32ä½çš„æ—¶å€™å¯»å€æ˜¯32æ¬¡æ–¹ã€‚æ¯ä¸ªåœ°å€æ€»çº¿å¯ä»¥å¯¹ä¸¤ä¸ªå­˜å‚¨å•å…ƒå¯»å€ï¼Œç¡®å®šä¸¤ç§çŠ¶æ€ï¼ˆ0æˆ–1ï¼‰1GBæ˜¯2çš„30æ¬¡æ–¹Byteï¼Œ1TBæ˜¯2çš„40æ¬¡æ–¹Bï¼Œå†ä¹˜ä¸Š256å³2çš„8æ¬¡æ–¹å³æ˜¯ï¼‰\nè¿™æ„å‘³ç€ç‰©ç†åœ°å€ç©ºé—´æœ‰256TBè¿™ä¹ˆå¤§, ä»é‡Œé¢åˆ’å‡º3MBçš„åœ°å€ç©ºé—´ç»™æ˜¾å­˜, æ ¹æœ¬å°±æ˜¯ä¸ç—›ä¸ç—’. æ­£å› ä¸ºå¦‚æ­¤, å†…å­˜æ˜ å°„I/Oæˆä¸ºäº†ç°ä»£è®¡ç®—æœºä¸»æµçš„I/Oç¼–å€æ–¹å¼: RISCæ¶æ„åªæä¾›å†…å­˜æ˜ å°„I/Oçš„ç¼–å€æ–¹å¼, è€ŒPCI-e, ç½‘å¡, x86çš„APICç­‰ä¸»æµè®¾å¤‡, éƒ½æ”¯æŒé€šè¿‡å†…å­˜æ˜ å°„I/Oæ¥è®¿é—®.\nä½œä¸ºRISCæ¶æ„, mips32å’Œriscv32éƒ½æ˜¯é‡‡ç”¨å†…å­˜æ˜ å°„I/Oçš„ç¼–å€æ–¹å¼. å¯¹x86æ¥è¯´, å†…å­˜æ˜ å°„I/Oçš„ä¸€ä¸ªä¾‹å­æ˜¯NEMUä¸­çš„ç‰©ç†åœ°å€åŒºé—´[0xa1000000, 0xa1800000). è¿™æ®µç‰©ç†åœ°å€åŒºé—´è¢«æ˜ å°„åˆ°VGAå†…éƒ¨çš„æ˜¾å­˜, è¯»å†™è¿™æ®µç‰©ç†åœ°å€åŒºé—´å°±ç›¸å½“äºå¯¹è¯»å†™VGAæ˜¾å­˜çš„æ•°æ®. ä¾‹å¦‚\nmemset((void *)0xa1000000, 0, SCR_SIZE); ä¼šå°†æ˜¾å­˜ä¸­ä¸€ä¸ªå±å¹•å¤§å°çš„æ•°æ®æ¸…é›¶, å³å¾€æ•´ä¸ªå±å¹•å†™å…¥é»‘è‰²åƒç´ , ä½œç”¨ç›¸å½“äºæ¸…å±. å¯ä»¥çœ‹åˆ°, å†…å­˜æ˜ å°„I/Oçš„ç¼–ç¨‹æ¨¡å‹å’Œæ™®é€šçš„ç¼–ç¨‹å®Œå…¨ä¸€æ ·: ç¨‹åºå‘˜å¯ä»¥ç›´æ¥æŠŠI/Oè®¾å¤‡å½“åšå†…å­˜æ¥è®¿é—®. è¿™ä¸€ç‰¹æ€§ä¹Ÿæ˜¯æ·±å—é©±åŠ¨å¼€å‘è€…çš„å–œçˆ±.\nçŠ¶æ€æœºè§†è§’ä¸‹çš„è¾“å…¥è¾“å‡º æˆ‘ä»¬å¯ä»¥æŠŠè®¾å¤‡åˆ†æˆä¸¤éƒ¨åˆ†, ä¸€éƒ¨åˆ†æ˜¯æ•°å­—ç”µè·¯. æˆ‘ä»¬åˆšæ‰ç²—ç•¥åœ°ä»‹ç»äº†ä¸€äº›è®¾å¤‡æ§åˆ¶å™¨çš„åŠŸèƒ½, ä¾‹å¦‚æˆ‘ä»¬CPUå¯ä»¥ä»é”®ç›˜æ§åˆ¶å™¨ä¸­è¯»å‡ºæŒ‰é”®ä¿¡æ¯. æ—¢ç„¶æ˜¯æ•°å­—ç”µè·¯, æˆ‘ä»¬å°±å¯ä»¥æŠŠå…¶ä¸­çš„æ—¶åºé€»è¾‘ç”µè·¯çœ‹æˆæ˜¯è®¾å¤‡æ•°å­—ç”µè·¯éƒ¨åˆ†çš„çŠ¶æ€D.\nä½†Dæ¯”è¾ƒç‰¹æ®Š, è®¡ç®—æœºåªèƒ½é€šè¿‡ç«¯å£I/OæŒ‡ä»¤æˆ–è€…å†…å­˜æ˜ å°„I/Oçš„è®¿å­˜æŒ‡ä»¤æ¥è®¿é—®å’Œä¿®æ”¹.â€‹\næœ‰æ„æ€çš„æ˜¯è®¾å¤‡çš„å¦ä¸€éƒ¨åˆ†: æ¨¡æ‹Ÿç”µè·¯, å®ƒä¹Ÿå¯ä»¥æ”¹å˜D. ä¾‹å¦‚é”®ç›˜é€šè¿‡æ£€æŸ¥æŒ‰é”®ä½ç½®çš„ç”µå®¹å˜åŒ–æ¥åˆ¤æ–­æ˜¯å¦æœ‰æŒ‰é”®è¢«æŒ‰ä¸‹, è‹¥æœ‰, åˆ™ä¼šå°†æŒ‰é”®ä¿¡æ¯å†™å…¥åˆ°é”®ç›˜æ§åˆ¶å™¨çš„å¯„å­˜å™¨ä¸­. è€ŒæŒ‰é”®ä½ç½®çš„ç”µå®¹æ˜¯å¦å‘ç”Ÿå˜åŒ–, åˆæ˜¯ç”±ç‰©ç†ä¸–ç•Œä¸­çš„ç”¨æˆ·æ˜¯å¦æŒ‰ä¸‹æŒ‰é”®å†³å®šçš„. æ‰€ä»¥æˆ‘ä»¬ä¼šè¯´, è®¾å¤‡æ˜¯è¿æ¥è®¡ç®—æœºå’Œç‰©ç†ä¸–ç•Œçš„æ¡¥æ¢.\nè¦å¯¹è®¾å¤‡çš„çŠ¶æ€å’Œè¡Œä¸ºè¿›è¡Œå»ºæ¨¡æ˜¯ä¸€ä»¶å¾ˆå›°éš¾çš„äº‹æƒ…, é™¤äº†è®¾å¤‡æœ¬èº«çš„è¡Œä¸ºäº”èŠ±å…«é—¨ä¹‹å¤–, è®¾å¤‡çš„çŠ¶æ€è¿˜æ—¶æ—¶åˆ»åˆ»å—åˆ°ç‰©ç†ä¸–ç•Œçš„å½±å“. äºæ˜¯, æˆ‘ä»¬åœ¨å¯¹çŠ¶æ€æœºæ¨¡å‹çš„è¡Œä¸ºè¿›è¡Œæ‰©å±•çš„æ—¶å€™, å¹¶ä¸è€ƒè™‘å°†DåŠ å…¥åˆ°Sä¸­, è€Œæ˜¯ä»…ä»…å¯¹è¾“å…¥è¾“å‡ºç›¸å…³æŒ‡ä»¤çš„è¡Œä¸ºè¿›è¡Œå»ºæ¨¡: â€‹\né€šè¿‡å†…å­˜è¿›è¡Œæ•°æ®äº¤äº’çš„è¾“å…¥è¾“å‡º æˆ‘ä»¬çŸ¥é“S = \u0026lt;R, M\u0026gt;, ä¸Šæ–‡ä»‹ç»çš„ç«¯å£I/Oå’Œå†…å­˜æ˜ å°„I/Oéƒ½æ˜¯é€šè¿‡å¯„å­˜å™¨Ræ¥è¿›è¡Œæ•°æ®äº¤äº’çš„. å¾ˆè‡ªç„¶åœ°, æˆ‘ä»¬å¯ä»¥è€ƒè™‘, æœ‰æ²¡æœ‰é€šè¿‡å†…å­˜â€‹æ¥è¿›è¡Œæ•°æ®äº¤äº’çš„è¾“å…¥è¾“å‡ºæ–¹å¼å‘¢?\nå…¶å®æ˜¯æœ‰çš„, è¿™ç§æ–¹å¼å«DMA. ä¸ºäº†æé«˜æ€§èƒ½, ä¸€äº›å¤æ‚çš„è®¾å¤‡ä¸€èˆ¬éƒ½ä¼šå¸¦æœ‰DMAçš„åŠŸèƒ½. ä¸è¿‡åœ¨NEMUä¸­çš„è®¾å¤‡éƒ½æ¯”è¾ƒç®€å•, å…³äºDMAçš„ç»†èŠ‚æˆ‘ä»¬å°±ä¸å±•å¼€ä»‹ç»äº†.\nNEMUä¸­çš„è¾“å…¥è¾“å‡º ç»ˆäºè¿›å…¥ç´§å¼ åˆºæ¿€çš„æ­£å¼è¯é¢˜ï¼\nNEMUçš„æ¡†æ¶ä»£ç å·²ç»åœ¨nemu/src/device/ç›®å½•ä¸‹æä¾›äº†è®¾å¤‡ç›¸å…³çš„ä»£ç ,\næ˜ å°„å’ŒI/Oæ–¹å¼ è¿™éƒ¨åˆ†è›®é‡è¦çš„ï¼Œå¤šè¯»è¯»åŸæ–‡æŠŠï¼Œå¯ä»¥åœ¨ä¹‹åå›å¤´è¯»ã€‚\nè®¾å¤‡ NEMUä½¿ç”¨SDLåº“æ¥å®ç°è®¾å¤‡çš„æ¨¡æ‹Ÿ, nemu/src/device/device.cå«æœ‰å’ŒSDLåº“ç›¸å…³çš„ä»£ç . init_device()å‡½æ•°ä¸»è¦è¿›è¡Œä»¥ä¸‹å·¥ä½œ:\nè°ƒç”¨init_map()è¿›è¡Œåˆå§‹åŒ–. cpu_exec()åœ¨æ‰§è¡Œæ¯æ¡æŒ‡ä»¤ä¹‹åå°±ä¼šè°ƒç”¨device_update()å‡½æ•°, è¿™ä¸ªå‡½æ•°é¦–å…ˆä¼šæ£€æŸ¥è·ç¦»ä¸Šæ¬¡è®¾å¤‡æ›´æ–°æ˜¯å¦å·²ç»è¶…è¿‡ä¸€å®šæ—¶é—´, è‹¥æ˜¯, åˆ™ä¼šå°è¯•åˆ·æ–°å±å¹•, å¹¶è¿›ä¸€æ­¥æ£€æŸ¥æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹/é‡Šæ”¾, ä»¥åŠæ˜¯å¦ç‚¹å‡»äº†çª—å£çš„â€‹æŒ‰é’®; å¦åˆ™åˆ™ç›´æ¥è¿”å›, é¿å…æ£€æŸ¥è¿‡äºé¢‘ç¹, å› ä¸ºä¸Šè¿°äº‹ä»¶å‘ç”Ÿçš„é¢‘ç‡æ˜¯å¾ˆä½çš„.\nå°†è¾“å…¥è¾“å‡ºæŠ½è±¡æˆIOE è®¾å¤‡è®¿é—®çš„å…·ä½“å®ç°æ˜¯æ¶æ„ç›¸å…³çš„, æ¯”å¦‚NEMUçš„VGAæ˜¾å­˜ä½äºç‰©ç†åœ°å€åŒºé—´[0xa1000000, 0xa1080000), ä½†å¯¹nativeçš„ç¨‹åºæ¥è¯´, è¿™æ˜¯ä¸€ä¸ªä¸å¯è®¿é—®çš„éæ³•åŒºé—´, å› æ­¤nativeç¨‹åºéœ€è¦é€šè¿‡åˆ«çš„æ–¹å¼æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½. è‡ªç„¶åœ°, è®¾å¤‡è®¿é—®è¿™ä¸€æ¶æ„ç›¸å…³çš„åŠŸèƒ½, åº”è¯¥å½’å…¥AMä¸­. ä¸TRMä¸åŒ, è®¾å¤‡è®¿é—®æ˜¯ä¸ºè®¡ç®—æœºæä¾›è¾“å…¥è¾“å‡ºçš„åŠŸèƒ½, å› æ­¤æˆ‘ä»¬æŠŠå®ƒä»¬åˆ’å…¥ä¸€ç±»æ–°çš„API, åå­—å«IOE(I/O Extension).\nè®¿é—®è®¾å¤‡å…¶å®æƒ³åšä»€ä¹ˆ: è®¿é—®è®¾å¤‡ = è¯»å‡ºæ•°æ® + å†™å…¥æ•°æ® + æ§åˆ¶çŠ¶æ€. è¿›ä¸€æ­¥çš„, æ§åˆ¶çŠ¶æ€æœ¬è´¨ä¸Šä¹Ÿæ˜¯è¯»/å†™è®¾å¤‡å¯„å­˜å™¨çš„æ“ä½œ, æ‰€ä»¥è®¿é—®è®¾å¤‡ = è¯»/å†™æ“ä½œ.\nbool ioe_init();\nvoid ioe_read(int reg, void *buf);\nvoid ioe_write(int reg, void *buf);\nç¬¬ä¸€ä¸ªAPIç”¨äºè¿›è¡ŒIOEç›¸å…³çš„åˆå§‹åŒ–æ“ä½œ. åä¸¤ä¸ªAPIåˆ†åˆ«ç”¨äºä»ç¼–å·ä¸ºregçš„å¯„å­˜å™¨ä¸­è¯»å‡ºå†…å®¹åˆ°ç¼“å†²åŒºbufä¸­, ä»¥åŠå¾€ç¼–å·ä¸ºregå¯„å­˜å™¨ä¸­å†™å…¥ç¼“å†²åŒºbufä¸­çš„å†…å®¹.\nã€è¿™é‡Œçš„regå¯„å­˜å™¨å¹¶ä¸æ˜¯ä¸Šæ–‡è®¨è®ºçš„è®¾å¤‡å¯„å­˜å™¨, å› ä¸ºè®¾å¤‡å¯„å­˜å™¨çš„ç¼–å·æ˜¯æ¶æ„ç›¸å…³çš„.ã€‘\nabstract-machine/am/include/amdev.hä¸­å®šä¹‰äº†å¸¸è§è®¾å¤‡çš„\u0026quot;æŠ½è±¡å¯„å­˜å™¨\u0026quot;ç¼–å·å’Œç›¸åº”çš„ç»“æ„. è¿™äº›å®šä¹‰æ˜¯æ¶æ„æ— å…³çš„, æ¯ä¸ªæ¶æ„åœ¨å®ç°å„è‡ªçš„IOE APIæ—¶, éƒ½éœ€è¦éµå¾ªè¿™äº›å®šä¹‰(çº¦å®š). NEMUä½œä¸ºä¸€ä¸ªå¹³å°, è®¾å¤‡çš„è¡Œä¸ºæ˜¯ä¸ISAæ— å…³çš„, åªéœ€è¦åœ¨abstract-machine/am/src/platform/nemu/ioe/ç›®å½•ä¸‹å®ç°ä¸€ä»½IOE, æ¥ä¾›NEMUå¹³å°çš„æ¶æ„å…±äº«. å…¶ä¸­, abstract-machine/am/src/platform/nemu/ioe/ioe.cä¸­å®ç°äº†ä¸Šè¿°çš„ä¸‰ä¸ªIOE API, ioe_read()å’Œioe_write()éƒ½æ˜¯é€šè¿‡æŠ½è±¡å¯„å­˜å™¨çš„ç¼–å·ç´¢å¼•åˆ°ä¸€ä¸ªå¤„ç†å‡½æ•°, ç„¶åè°ƒç”¨å®ƒ. å¤„ç†å‡½æ•°çš„å…·ä½“åŠŸèƒ½å’Œå¯„å­˜å™¨ç¼–å·ç›¸å…³, ä¸‹é¢æˆ‘ä»¬æ¥é€ä¸€ä»‹ç»NEMUä¸­æ¯ä¸ªè®¾å¤‡çš„åŠŸèƒ½.\nä¸€äº›é‡è¦çš„æ–‡ä»¶ã€å‡½æ•°è®°å½• ä»£ç æ¡†æ¶å¯å‚è€ƒï¼šhttps://ysyx.oscc.cc/forum/topic/16/pa2-3-nemu-am-am-kernelså…±åŒæ„å»ºçš„è™šæ‹Ÿä¸–ç•Œæ¦‚å¿µå›¾\néšç€ä»£ç å¤æ‚åº¦è¶Šæ¥è¶Šé«˜ï¼Œå¯¹æ¡†æ¶çš„ç†Ÿæ‚‰åº¦è¦æ±‚æŒ‡æ•°ä¸Šæ¶¨ï¼Œå¿…é¡»å¼€å§‹è®°å½•æ¯ä¸ªæ¡†æ¶çš„åŠŸèƒ½åŠå…¶ä½¿ç”¨æ–¹å¼ï¼š\nåŸºç¡€æ–‡ä»¶ æŒ‡ä»¤é›†ç›¸å…³æ–‡ä»¶ï¼š\nå„ç±»æŒ‡ä»¤RTLè°ƒç”¨å‡½æ•°å®ç°éƒ¨åˆ†ï¼š/home/physico/ics2021/nemu/src/isa/riscv32/instr/ *.h\nè¯‘ç å‡½æ•°éƒ¨åˆ†ï¼š/home/physico/ics2021/nemu/src/isa/riscv32/instr/decode.c\nå‡½æ•°å-å®å±•å¼€éœ€è¦éƒ¨åˆ†ï¼š/home/physico/ics2021/nemu/src/isa/riscv32/include/isa-all-instr.hï¼ˆæ—è¾¹çš„isa-execå¯ä»¥åŒ…æ‹¬1æåˆ°çš„ï¼‰\nISADecodeInfoï¼š/home/physico/ics2021/nemu/src/isa/riscv32/include/isa-def.h\nRTLå®ç°ç›¸å…³ï¼š\n/home/physico/ics2021/nemu/src/engine/interpreter/rtl-basic.h ï¼ˆdef_rtl_compute_reg_immï¼‰\n/home/physico/ics2021/nemu/src/engine/interpreter/c_op.hï¼ˆc_add(a, b) ((a) + (b)) ä»¥åŠ interpret_relopç±»ä¼¼RELOP_NEï¼‰\nè°ƒè¯•æµ‹è¯•ç”¨æŒ‡ä»¤ä¸æ–‡ä»¶ï¼ˆæˆ‘ä»¥è‡ªå·±çš„è·¯å¾„ä¸ºå‡†ï¼‰ IOEï¼ˆåŒ…æ‹¬æ—¶é—´ç­‰ï¼‰ï¼š\nåœ°å€ï¼š/home/physico/ics2021/am-kernels/tests/am-tests\næµ‹è¯•æ–¹å¼ï¼šmake ARCH=riscv32-nemu run mainargs=t ï¼ˆå…¶ä»–æµ‹è¯•æ–¹å¼è‡ªè¡Œè¯»ä»£ç ï¼‰\nbenchmarkæµ‹è¯•ï¼š\nåœ°å€ï¼š/home/physico/ics2021/am-kernels/benchmarks/microbench\næµ‹è¯•æ–¹å¼ï¼šmake ARCH=riscv32-nemu run ï¼ˆå…¶ä»–benchmarkåŒæ ·æ–¹æ³•å¯æµ‹ï¼‰\né©¬é‡Œå¥¥æµ‹è¯•ï¼š\nåœ°å€ï¼šhome/physico/ics2021/fceux-am\næµ‹è¯•æ–¹å¼ï¼š make ARCH=riscv32-nemu run mainargs=mario\nè®¾å¤‡ç›¸å…³æ–‡ä»¶ï¼š æ—¶é’Ÿï¼š\nAMçš„ç›¸å…³å®ç°ï¼š\n/home/physico/ics2021/abstract-machine/am/src/platform/nemu/ioe/timer.c ï¼ˆéœ€è¦å®ç°ï¼‰ nativeçš„ç›¸å…³å®ç°\n/home/physico/ics2021/abstract-machine/am/src/native/ioe/timer.c nemuçš„ç›¸å…³å®ç°ï¼š\n/home/physico/ics2021/nemu/src/device/timer.c\n/home/physico/ics2021/nemu/src/utils/timer.c\nä¸²å£ nemu/src/device/serial.cæ¨¡æ‹Ÿäº†ä¸²å£çš„åŠŸèƒ½. å…¶å¤§éƒ¨åˆ†åŠŸèƒ½ä¹Ÿè¢«ç®€åŒ–, åªä¿ç•™äº†æ•°æ®å¯„å­˜å™¨. ä¸²å£åˆå§‹åŒ–æ—¶ä¼šåˆ†åˆ«æ³¨å†Œ0x3F8å¤„é•¿åº¦ä¸º8ä¸ªå­—èŠ‚çš„ç«¯å£, ä»¥åŠ0xa00003F8å¤„é•¿åº¦ä¸º8å­—èŠ‚çš„MMIOç©ºé—´, å®ƒä»¬éƒ½ä¼šæ˜ å°„åˆ°ä¸²å£çš„æ•°æ®å¯„å­˜å™¨. ç”±äºNEMUä¸²è¡Œæ¨¡æ‹Ÿè®¡ç®—æœºç³»ç»Ÿçš„å·¥ä½œ, ä¸²å£çš„çŠ¶æ€å¯„å­˜å™¨å¯ä»¥ä¸€ç›´å¤„äºç©ºé—²çŠ¶æ€; æ¯å½“CPUå¾€æ•°æ®å¯„å­˜å™¨ä¸­å†™å…¥æ•°æ®æ—¶, ä¸²å£ä¼šå°†æ•°æ®ä¼ é€åˆ°ä¸»æœºçš„æ ‡å‡†é”™è¯¯æµè¿›è¡Œè¾“å‡º.\nabstract-machine/am/src/platform/nemu/trm.cä¸­çš„putch()ä¼šå°†å­—ç¬¦è¾“å‡ºåˆ°ä¸²å£.\nå¯ä»¥é…åˆvsprintfåšæˆPrintfã€‚\nç†è§£mainargs è¯·ä½ é€šè¿‡RTFSCç†è§£è¿™ä¸ªå‚æ•°æ˜¯å¦‚ä½•ä»makeå‘½ä»¤ä¸­ä¼ é€’åˆ°helloç¨‹åºä¸­çš„, $ISA-nemuå’Œnativeé‡‡ç”¨äº†ä¸åŒçš„ä¼ é€’æ–¹æ³•, éƒ½å€¼å¾—ä½ å»äº†è§£ä¸€ä¸‹.\nç­”ï¼š\nISA-NEMUé€šè¿‡ics2021/abstract-machine/scripts/platform/nemu.mkä¸­çš„å®å®šä¹‰ï¼š-D\nCFLAGS += -DMAINARGS=\\\u0026quot;$(mainargs)\\\u0026ldquo;ç„¶åå°±åœ¨mainï¼ˆmainargsï¼‰\næ—¶é’Ÿã€åŸ‹äº†å¤§å‘ã€‘ æœ‰äº†æ—¶é’Ÿ, ç¨‹åºæ‰å¯ä»¥æä¾›æ—¶é—´ç›¸å…³çš„ä½“éªŒ, ä¾‹å¦‚æ¸¸æˆçš„å¸§ç‡, ç¨‹åºçš„å¿«æ…¢ç­‰. nemu/src/device/timer.cæ¨¡æ‹Ÿäº†i8253è®¡æ—¶å™¨çš„åŠŸèƒ½. è®¡æ—¶å™¨çš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½è¢«ç®€åŒ–, åªä¿ç•™äº†\u0026quot;å‘èµ·æ—¶é’Ÿä¸­æ–­\u0026quot;çš„åŠŸèƒ½(ç›®å‰æˆ‘ä»¬ä¸ä¼šç”¨åˆ°). åŒæ—¶æ·»åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„æ—¶é’Ÿ. i8253è®¡æ—¶å™¨åˆå§‹åŒ–æ—¶ä¼šåˆ†åˆ«æ³¨å†Œ0x48å¤„é•¿åº¦ä¸º8ä¸ªå­—èŠ‚çš„ç«¯å£, ä»¥åŠ0xa0000048å¤„é•¿åº¦ä¸º8å­—èŠ‚çš„MMIOç©ºé—´, å®ƒä»¬éƒ½ä¼šæ˜ å°„åˆ°RTCå¯„å­˜å™¨. CPUå¯ä»¥è®¿é—®è¿™ä¸¤ä¸ªå¯„å­˜å™¨æ¥è·å¾—å½“å‰æ—¶é—´.\nabstract-machine/am/include/amdev.hä¸­ä¸ºæ—¶é’Ÿçš„åŠŸèƒ½å®šä¹‰äº†ä¸¤ä¸ªæŠ½è±¡å¯„å­˜å™¨:\nAM_TIMER_RTC, AMå®æ—¶æ—¶é’Ÿ(RTC, Real Time Clock), å¯è¯»å‡ºå½“å‰çš„å¹´æœˆæ—¥æ—¶åˆ†ç§’. PAä¸­æš‚ä¸ä½¿ç”¨.\nAM_TIMER_UPTIME, AMç³»ç»Ÿå¯åŠ¨æ—¶é—´, å¯è¯»å‡ºç³»ç»Ÿå¯åŠ¨åçš„å¾®ç§’æ•°.\nå®ç°IOE\nåœ¨abstract-machine/am/src/platform/nemu/ioe/timer.cä¸­å®ç°AM_TIMER_UPTIMEçš„åŠŸèƒ½. åœ¨abstract-machine/am/src/platform/nemu/include/nemu.hå’Œ abstract-machine/am/src/$ISA/$ISA.hä¸­æœ‰ä¸€äº›è¾“å…¥è¾“å‡ºç›¸å…³çš„ä»£ç ä¾›ä½ ä½¿ç”¨.\nå®ç°å, åœ¨$ISA-nemuä¸­è¿è¡Œam-kernel/tests/am-testsä¸­çš„real-time clock testæµ‹è¯•. å¦‚æœä½ çš„å®ç°æ­£ç¡®, ä½ å°†ä¼šçœ‹åˆ°ç¨‹åºæ¯éš”1ç§’å¾€ç»ˆç«¯è¾“å‡ºä¸€è¡Œä¿¡æ¯. ç”±äºæˆ‘ä»¬æ²¡æœ‰å®ç°AM_TIMER_RTC, æµ‹è¯•æ€»æ˜¯è¾“å‡º1900å¹´0æœˆ0æ—¥0æ—¶0åˆ†0ç§’, è¿™å±äºæ­£å¸¸è¡Œä¸º, å¯ä»¥å¿½ç•¥.\nnativeçš„IOEæ˜¯åŸºäºSDLåº“å®ç°çš„, å®ƒä»¬å‡è®¾å¸¸ç”¨åº“å‡½æ•°çš„è¡Œä¸ºä¼šç¬¦åˆglibcæ ‡å‡†, ä½†æˆ‘ä»¬è‡ªå·±å®ç°çš„klibé€šå¸¸ä¸èƒ½æ»¡è¶³è¿™ä¸€è¦æ±‚. å› æ­¤__NATIVE_USE_KLIB__ä»…ä¾›æµ‹è¯•klibå®ç°çš„æ—¶å€™ä½¿ç”¨, æˆ‘ä»¬ä¸è¦æ±‚åœ¨å®šä¹‰__NATIVE_USE_KLIB__çš„æƒ…å†µä¸‹æ­£ç¡®è¿è¡Œæ‰€æœ‰ç¨‹åº.\nè¿™é‡Œæˆ‘å¡äº†ä¸€æ®µæ—¶é—´ï¼ˆä¸»è¦æ˜¯è·‘åˆ†è¿‡é«˜ç”šè‡³æœ‰äº›è·‘ä¸äº†ã€‚ï¼‰ï¼Œæˆ‘å‚è€ƒäº†ä¸€ç”Ÿä¸€èŠ¯è®ºå›æŸä¸ªå¤§ä½¬çš„æ€è·¯ï¼š\nhttps://ysyx.oscc.cc/forum/topic/56/pa2-3å®ç°æ—¶é’Ÿä¸ºä¾‹çš„ä¸€äº›rtscæ€è·¯\nè§£å†³æ—¶é’Ÿé—®é¢˜çš„é’¥åŒ™â€”â€”ç†è§£æ›´æ–°è¿‡ç¨‹ æˆ‘ä»¬éœ€è¦æ€è€ƒï¼Œå†…å­˜æ˜ å°„çš„é€»è¾‘æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬é€šè¿‡å­¦ä¹ ç±»ä¼¼abstract-machine/am/src/platform/nemu/ioe/timer.c çš„æ–¹æ³•èƒ½å¤Ÿè¯»å‡ºæ•°æ®ï¼Ÿæˆ–è€…ä½¿ç”¨æ–‡æ¡£é‡Œè®©æˆ‘ä»¬çœ‹æ–‡ä»¶ä¸­çš„è¯»å†™æ–¹å¼èƒ½å¤Ÿè¯»å‡ºæ—¶é—´æ•°æ®ï¼Ÿï¼ˆå…·ä½“å¯ä»¥çœ‹ä¸Šé¢é‚£ä¸ªå¤§ä½¬çš„æ€è·¯ï¼‰å…³é”®åœ¨äºâ€”â€”æ—¶é—´æ˜¯è¢«æ›´æ–°åˆ°åœ°å€ä¸Šçš„ï¼Œé‚£ä¹ˆä»€ä¹ˆé€ æˆäº†åœ°å€å¯¹åº”æ•°æ®çš„æ›´æ–°ï¼Ÿè®²ä¹‰ç»™å‡ºäº†ç­”æ¡ˆï¼Œè®©æˆ‘ä»¬åå¤é˜…è¯»æ˜ å°„å’ŒIOæ–¹å¼ï¼š æ¡†æ¶ä»£ç ä¸ºæ˜ å°„å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ç±»å‹IOMap(åœ¨nemu/include/device/map.hä¸­å®šä¹‰), åŒ…æ‹¬åå­—, æ˜ å°„çš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€, æ˜ å°„çš„ç›®æ ‡ç©ºé—´, ä»¥åŠä¸€ä¸ªå›è°ƒå‡½æ•°.\nnemu/src/device/io/map.cå®ç°äº†æ˜ å°„çš„ç®¡ç†, åŒ…æ‹¬I/Oç©ºé—´çš„åˆ†é…åŠå…¶æ˜ å°„, è¿˜æœ‰æ˜ å°„çš„è®¿é—®æ¥å£.\nå…¶ä¸­map_read()å’Œmap_write()ç”¨äºå°†åœ°å€addræ˜ å°„åˆ°â€‹æ‰€æŒ‡ç¤ºçš„ç›®æ ‡ç©ºé—´, å¹¶è¿›è¡Œè®¿é—®. è®¿é—®æ—¶, å¯èƒ½ä¼šè§¦å‘ç›¸åº”çš„å›è°ƒå‡½æ•°, å¯¹è®¾å¤‡å’Œç›®æ ‡ç©ºé—´çš„çŠ¶æ€è¿›è¡Œæ›´æ–°.\nnemu/src/device/io/port-io.cæ˜¯å¯¹ç«¯å£æ˜ å°„I/Oçš„æ¨¡æ‹Ÿ. add_pio_map()å‡½æ•°ç”¨äºä¸ºè®¾å¤‡çš„åˆå§‹åŒ–æ³¨å†Œä¸€ä¸ªç«¯å£æ˜ å°„I/Oçš„æ˜ å°„å…³ç³». pio_read()å’Œpio_write()æ˜¯é¢å‘CPUçš„ç«¯å£I/Oè¯»å†™æ¥å£, å®ƒä»¬æœ€ç»ˆä¼šè°ƒç”¨map_read()å’Œmap_write(), å¯¹é€šè¿‡â€‹æ³¨å†Œçš„I/Oç©ºé—´è¿›è¡Œè®¿é—®.\nè¿™æ—¶å€™æˆ‘ä»¬å°±ä¼šæƒ³åˆ°ï¼Œè¿™ä¸ªå¯¹è®¾å¤‡å’Œç›®æ ‡ç©ºé—´çŠ¶æ€æ›´æ–°çš„å‡½æ•°ï¼Œå¯¹æ—¶é’Ÿæ¥è¯´ï¼Œæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\næ³¨æ„åˆ°â€”â€”â€”â€” nemu/src/device/timer.cæ¨¡æ‹Ÿäº†i8253è®¡æ—¶å™¨çš„åŠŸèƒ½\næ­¤æ—¶è¿›å…¥åä¼šå‘ç°ç†Ÿæ‚‰çš„add_pio_mapï¼Œè¿˜æœ‰ä¸€ä¸ªrtc_io_handlerè¿™é‡Œå‡ºç°äº†gettime! æ„Ÿè§‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆï¼Œä½†æ­¤æ—¶ä¼šå‘ç°ä¸€ä¸ªoffsetï¼Œé‚£ä¹ˆè¿™ä¸ªoffsetåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Œè®©æˆ‘ä»¬ç»§ç»­æ‰“å¼€add_pio_mapï¼Œç»§ç»­ä¸€è·¯å¯»æ‰¾ç”¨åˆ°callbackçš„åœ°æ–¹ä¼šå‘ç°å›åˆ°äº†mapï¼Œå…¶ä¸­çš„map_readçš„writeå‘Šè¯‰äº†æˆ‘ä»¬åŸæ¥åœ¨è¿™é‡Œä¼ å…¥callback,å…¶ä¸­offsetä¹Ÿå°±ä¸è¨€è€Œå–»äº†ã€‚\nå¾—çŸ¥offset = addr - map-\u0026gt;lowåï¼Œæˆ‘ä»¬å†å€’å›å»çœ‹æŸä¸ªå‡½æ•°å°±æ˜¾å¾—å¯ç–‘äº†ï¼Œ addr å¯ä»¥å°±æ˜¯ map-\u0026gt;lowï¼Œä¹Ÿå¯ä»¥æ˜¯low+4ã€‚é‚£ä¹ˆå“ªä¸ªæ‰æ˜¯å¯¹çš„å‘¢ï¼Ÿè®©æˆ‘ä»¬å†å¤ä¹ è¿™å¥è¯ï¼š\nå…¶ä¸­map_read()å’Œmap_write()ç”¨äºå°†åœ°å€addræ˜ å°„åˆ°â€‹æ‰€æŒ‡ç¤ºçš„ç›®æ ‡ç©ºé—´, å¹¶è¿›è¡Œè®¿é—®. è®¿é—®æ—¶, å¯èƒ½ä¼šè§¦å‘ç›¸åº”çš„å›è°ƒå‡½æ•°, å¯¹è®¾å¤‡å’Œç›®æ ‡ç©ºé—´çš„çŠ¶æ€è¿›è¡Œæ›´æ–°.\nè¿™æ—¶å€™é—®é¢˜å°±å˜æˆaddråˆ°åº•æ˜¯ç­‰äºä»€ä¹ˆçš„æ—¶å€™æ›´æ–°æ‰æ˜¯å¯¹çš„å‘¢ï¼Ÿæˆ‘ä»¬æ€ä¹ˆè®¿é—®åœ°å€æ›´æ–°æ•°æ®æ‰æ˜¯æ­£ç¡®çš„ï¼Ÿ\nè¿™ä¸ªè®¿é—®ä¼šå¯¹æˆ‘ä»¬è¯»å–æ—¶é’Ÿæ•°æ®æœ‰ä»€ä¹ˆå½±å“ï¼Ÿæˆ‘ä»¬è¯»å–åœ°å€ä¸Šçš„æ—¶é’Ÿæ•°æ®çš„æ—¶å€™æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ\nåœ¨åå¤é˜…è¯»ä¸€ä¸‹å‰é¢å¤§ä½¬åˆ†äº«çš„RTFCçš„è¿‡ç¨‹ï¼Œç›¸ä¿¡ä½ èƒ½å¾—åˆ°ç­”æ¡ˆã€‚\né”®ç›˜ è¿™éƒ¨åˆ†åªè¦å¼„æ‡‚äº†æ—¶é’Ÿï¼Œéå¸¸ç®€å•ã€‚\nVGA ç°ä»£çš„æ˜¾ç¤ºå™¨ä¸€èˆ¬éƒ½æ”¯æŒ24ä½çš„é¢œè‰²(R, G, Bå„å 8ä¸ªbit, å…±æœ‰2^8*2^8*2^8çº¦1600ä¸‡ç§é¢œè‰²)\nä¸ºäº†è®©å±å¹•æ˜¾ç¤ºä¸åŒçš„é¢œè‰²æˆä¸ºå¯èƒ½, åœ¨8ä½é¢œè‰²æ·±åº¦æ—¶ä¼šä½¿ç”¨è°ƒè‰²æ¿çš„æ¦‚å¿µ. è°ƒè‰²æ¿æ˜¯ä¸€ä¸ªé¢œè‰²ä¿¡æ¯çš„æ•°ç»„, æ¯ä¸€ä¸ªå…ƒç´ å 4ä¸ªå­—èŠ‚, åˆ†åˆ«ä»£è¡¨R(red), G(green), B(blue), A(alpha)çš„å€¼\nä¸€ä¸ªåƒç´ å­˜å‚¨çš„å°±ä¸å†æ˜¯é¢œè‰²çš„ä¿¡æ¯, è€Œæ˜¯ä¸€ä¸ªè°ƒè‰²æ¿çš„ç´¢å¼•\nè¦å¾—åˆ°ä¸€ä¸ªåƒç´ çš„é¢œè‰²ä¿¡æ¯, å°±è¦æŠŠå®ƒçš„å€¼å½“ä½œä¸‹æ ‡, åœ¨è°ƒè‰²æ¿è¿™ä¸ªæ•°ç»„ä¸­åšä¸‹æ ‡è¿ç®—, å–å‡ºç›¸åº”çš„é¢œè‰²ä¿¡æ¯. å› æ­¤, åªè¦ä½¿ç”¨ä¸åŒçš„è°ƒè‰²æ¿, å°±å¯ä»¥åœ¨ä¸åŒçš„æ—¶åˆ»ä½¿ç”¨ä¸åŒçš„256ç§é¢œè‰²äº†.\nQï¼šåœ¨ä¸€äº›90å¹´ä»£çš„æ¸¸æˆä¸­(æ¯”å¦‚ä»™å‰‘å¥‡ä¾ ä¼ ), å¾ˆå¤šæ¸å‡ºæ¸å…¥æ•ˆæœéƒ½æ˜¯é€šè¿‡è°ƒè‰²æ¿å®ç°çš„, èªæ˜çš„ä½ çŸ¥é“å…¶ä¸­çš„ç„æœºå—?\nA:é€šè¿‡çº¿æ€§æ”¹å˜ç´¢å¼•ï¼Ÿ\nåœ¨NEMUä¸­, GPUä»…ä»…ä¿ç•™ç»˜åˆ¶åƒç´ çš„åŸºæœ¬åŠŸèƒ½.\nabstract-machine/am/include/amdev.hä¸­ä¸ºGPUå®šä¹‰äº†äº”ä¸ªæŠ½è±¡å¯„å­˜å™¨, åœ¨NEMUä¸­åªä¼šç”¨åˆ°å…¶ä¸­çš„ä¸¤ä¸ª:\nAM_GPU_CONFIG, AMæ˜¾ç¤ºæ§åˆ¶å™¨ä¿¡æ¯, å¯è¯»å‡ºå±å¹•å¤§å°ä¿¡æ¯widthå’Œheight. å¦å¤–AMå‡è®¾ç³»ç»Ÿåœ¨è¿è¡Œè¿‡ç¨‹ä¸­, å±å¹•å¤§å°ä¸ä¼šå‘ç”Ÿå˜åŒ–.\nAM_GPU_FBDRAW, AMå¸§ç¼“å†²æ§åˆ¶å™¨, å¯å†™å…¥ç»˜å›¾ä¿¡æ¯, å‘å±å¹•(x, y)åæ ‡å¤„ç»˜åˆ¶w*hçš„çŸ©å½¢å›¾åƒ. å›¾åƒåƒç´ æŒ‰è¡Œä¼˜å…ˆæ–¹å¼å­˜å‚¨åœ¨pixelsä¸­, æ¯ä¸ªåƒç´ ç”¨32ä½æ•´æ•°ä»¥00RRGGBBçš„æ–¹å¼æè¿°é¢œè‰². è‹¥syncä¸ºtrue, åˆ™é©¬ä¸Šå°†å¸§ç¼“å†²ä¸­çš„å†…å®¹åŒæ­¥åˆ°å±å¹•ä¸Š.\nVGAè®¾å¤‡è¿˜æœ‰ä¸¤ä¸ªå¯„å­˜å™¨: å±å¹•å¤§å°å¯„å­˜å™¨å’ŒåŒæ­¥å¯„å­˜å™¨.\nå±å¹•å¤§å°å¯„å­˜å™¨çš„ç¡¬ä»¶(NEMU)åŠŸèƒ½å·²ç»å®ç°, ä½†è½¯ä»¶(AM)è¿˜æ²¡æœ‰å»ä½¿ç”¨å®ƒ;\nåŒæ­¥å¯„å­˜å™¨è½¯ä»¶(AM)å·²ç»å®ç°äº†åŒæ­¥å±å¹•çš„åŠŸèƒ½, ä½†ç¡¬ä»¶(NEMU)å°šæœªæ·»åŠ ç›¸åº”çš„æ”¯æŒ.\nè¿™é‡Œæˆ‘å¡çš„æœ€ä¹…çš„æ˜¯1ã€å¦‚ä½•ç†è§£éšè—çš„åŒæ­¥ä¿¡æ¯ 2ã€å¦‚ä½•ç»˜åˆ¶åƒç´ ã€‚\né’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ å…¶å®å…³é”®æ˜¯ä¸ç†è§£æŠ½è±¡å¯„å­˜å™¨æ˜¯å¦‚ä½•ä¸å®é™…ç¡¬ä»¶å¯„å­˜å™¨è”ç³»èµ·æ¥çš„ã€‚ç»è¿‡RTFSCæˆ‘ä»¬èƒ½çŸ¥é“å½¢å¦‚â€œ_port_baseâ€ï¼ˆåœ¨å†…å­˜è¯»å–ä¸­å‚æ•°ä¸ºspaceï¼‰æ‰æ˜¯çœŸæ­£çš„å¯„å­˜å™¨ä½ç½®ï¼Œè€Œä¸”ä¹Ÿåœ¨åœ°å€ç©ºé—´ä¸­å¼€è¾Ÿäº†å¯¹åº”çš„å†…å­˜ã€‚(å½“ç„¶ä½ ä¸ä»…å¯ä»¥é€šè¿‡å¼€è¾Ÿçš„ç©ºé—´å»çŒœæµ‹åªæœ‰ä¸¤ä¸ªå¯„å­˜å™¨ï¼Œå› ä¸ºä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªnewplaceï¼ˆ8ï¼‰ï¼›åŒæ—¶ä¹Ÿå¯ä»¥æ‰¾åˆ°SYNC_ADDRçš„åœ°å€ï¼Œé‚£é‡Œæ˜¯åŒæ­¥çš„åœ°å€ï¼Œå†é…åˆVGAæœ¬ä½“æ˜ å°„çš„åœ°å€çŒœçŒœçœ‹å³å¯ï¼›æˆ–è€…ä½ ä¹Ÿå¯ä»¥å‚è€ƒæœ‰ä¸€ä¸ªå«åšpixel *renderçš„åœ°æ–¹ï¼Œé‚£é‡Œä¹Ÿå¯ä»¥å‚è€ƒï¼‰\nï¼ˆåŒæ—¶è¿™é‡Œæˆ‘ä¹Ÿè¿˜ä¸çŸ¥é“æŒ‡é’ˆä¹Ÿå¯ä»¥ç›´æ¥å–ä¸‹æ ‡è¿ç®—ï¼Œæˆ‘ä¸€ç›´è®°ç€æŒ‡é’ˆä¸ç­‰åŒæ•°ç»„ï¼Œç›´åˆ°æŸ¥é˜…çŸ¥é“äº†å…¶å®ç¼–è¯‘å™¨ä¸­è¿™æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼š\né™¤äº†ä¼˜å…ˆçº§ä¸åŒä¹‹å¤–ï¼Œä¸‹æ ‡è¡¨è¾¾å¼ array[ value ] å’Œé—´æ¥è®¿é—®è¡¨è¾¾å¼ *ï¼ˆarray + ( value )ï¼‰ æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œä¸‹æ ‡ä¸ä»…å¯ä»¥ç”¨ä½œæ•°ç»„åï¼Œä¹Ÿå¯ä»¥ç”¨äºæŒ‡é’ˆè¡¨è¾¾å¼ä¸­ã€‚ä¸è¿‡è¿™æ ·ä¸€æ¥ï¼Œç¼–è¯‘å™¨å°±å¾ˆéš¾æ£€æŸ¥ä¸‹æ ‡çš„æœ‰æ•ˆæ€§ã€‚ï¼ˆæ–Ÿé…Œï¼‰ï¼ˆæ„æ€æ˜¯å¦‚æœç”¨æŒ‡é’ˆåŠ ä¸‹æ ‡çš„æ–¹å¼æ¥è¡¨è¾¾æ•°ç»„çš„å…ƒç´ ï¼Œç¼–è¯‘å™¨æ— æ³•æ£€æµ‹åˆ°æ˜¯å¦è¶Šç•Œï¼ï¼‰\nhttps://blog.51cto.com/u_15338162/5206658\nhttps://zhuanlan.zhihu.com/p/399327901\nè®©æˆ‘ä»¬å›æ¥ç»§ç»­æ€è€ƒé—®é¢˜ï¼ŒæŠ½è±¡å¯„å­˜å™¨çš„ç¼–å·åˆæ˜¯å¦‚ä½•ä¸å®é™…å¯„å­˜å™¨çš„ç¼–å·ï¼ˆæ¯”å¦‚5ã€6ã€7å’Œå…·ä½“çš„[0] [1]ï¼‰è”ç³»èµ·æ¥çš„å‘¢ï¼Ÿ\næ‰€ä»¥ï¼Œå¦‚æœå®ç°äº†AMçš„åŒæ­¥å¯„å­˜å™¨ä½†æ²¡æœ‰ç¡¬ä»¶æ”¯æŒï¼Œè¯´æ˜ç¡¬ä»¶éƒ¨åˆ†å®é™…ä¸Šç¼ºå°‘äº†ä¸€ä¸ªå¯¹åŒæ­¥å¯„å­˜å™¨çš„è¯»å–ï¼Œé‚£ä¹ˆå“ªä¸€ä¸ªæ‰æ˜¯ç¡¬ä»¶åŒæ­¥å¯„å­˜å™¨å‘¢ï¼Ÿä»–åœ¨å“ªå‘¢ï¼Ÿè¿™å°±éœ€è¦RTFSCäº†ã€‚\né’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œ å®é™…ä¸Špa2021çš„æ¡†æ¶æ¯”2020çš„éš¾ï¼Œå› ä¸º2021çš„nativeæ²¡æœ‰åŠæ³•å‚è€ƒï¼Œè€Œ2020çš„nativeä»£ç ç»™å‡ºäº†ç»˜åˆ¶å®ç°ã€‚è¿™é‡Œæˆ‘æ˜¯å‚è€ƒäº†2020çš„nativeæ‰åšå‡ºæ¥çš„ã€‚å®é™…ä¸Šè¦ç†è§£è¿™ä¸€å¥è¯ï¼š\nå‘å±å¹•(x, y)åæ ‡å¤„ç»˜åˆ¶w*hçš„çŸ©å½¢å›¾åƒ. å›¾åƒåƒç´ æŒ‰è¡Œä¼˜å…ˆæ–¹å¼å­˜å‚¨åœ¨pixelsä¸­\nè¿™ä¸ªx y w hçš„å«ä¹‰ï¼Œå®é™…ä¸Šæ˜¯ä»ç»˜åˆ¶ç†è§£çš„ã€‚æˆ‘ä»¬å›¾åƒçš„ç»˜åˆ¶ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯å¤šç»´æ•°ç»„å±•å¹³æˆä¸€ç»´æ•°æ®ä¸€ç›´ç”»ä¸‹å»ï¼ˆä½ å¯ä»¥æ›´æ”¹fb(i)=[i]çš„å€¼å’ŒforèŒƒå›´æŸ¥çœ‹ï¼‰ï¼Œè€Œä¸€ä¸ªå¥½çš„ç†è§£æ–¹å¼æ˜¯æŠŠx,yå½“åšå¼€å§‹ç»˜åˆ¶çš„ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ è¦ç»˜åˆ¶ä¸€ä¸ªå°çŸ©å½¢æ¡†ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªç‚¹â€œæ‹–å‡ºæ¥çš„â€ï¼Œå› ä¸ºæœ¬è´¨æ˜¯ä»ä¸€ç»´æ•°ç»„ä»å·¦åˆ°å³ç”»ã€‚é‚£ä¹ˆæˆ‘ä»¬çŸ¥é“äº†æ­¤æ—¶çš„x,yæ˜¯åŸºç¡€åç§»åæ ‡ï¼ˆä¹Ÿå°±æ˜¯ç»˜åˆ¶å°çŸ©å½¢æ¡†çš„åŸºç¡€åæ ‡ï¼‰ï¼Œè€Œæˆ‘ä»¬ç»˜åˆ¶éœ€è¦forå¾ªç¯è¡¨è¾¾çš„æ˜¯iå’Œjåæ ‡ä¹Ÿå°±æ˜¯å°çŸ©å½¢æ¡†çš„åæ ‡ï¼Œå…¶ä¸­pixelsæ˜¯æˆ‘ä»¬å°†è¦ç”»çš„å°çŸ©å½¢çš„åƒç´ ä¿¡æ¯ã€‚\næˆ‘ä»¬çš„ç›®çš„æ˜¯æŠŠå°çŸ©å½¢çš„åƒç´ ä¿¡æ¯ä»è¡Œå¼€å§‹éå†ä¸€ä¸ªä¸ªiå’Œj,å†é€šè¿‡fbç»˜åˆ¶åˆ°å¤§çŸ©å½¢æ¡†ï¼ˆgpuå†…å­˜æ˜ å°„åœ°å€ï¼‰ä¸Šï¼Œæ‰€ä»¥ä½ åº”è¯¥æ€è€ƒè¿™ä¸ªæ˜ å°„æ˜¯æ€ä¹ˆåšçš„ï¼Œå¦‚ä½•è¡¨è¾¾â€œä»æŸä¸€è¡Œå¼€å§‹ï¼Œä¸€åˆ—åˆ—çš„ç”»è¿‡å»ï¼Ÿâ€ï¼Œå…·ä½“çš„åæ ‡ä¿¡æ¯è¯¥å¦‚ä½•è½¬æ¢ï¼Ÿè¿™å°±æ˜¯ä½ åº”è¯¥æ€è€ƒçš„äº†ã€‚å®åœ¨ä¸è¡Œï¼Œä½ å¯ä»¥å‚è€ƒ2020naitiveæœ‰å…³gpuçš„ç›¸å…³å®ç°ã€‚\nå®ç°å®Œåä½ å°±å¯ä»¥è·‘é©¬é‡Œå¥¥ç­‰ç¨‹åºäº†ï¼Œæˆ‘çš„fpså¤§æ¦‚æ˜¯25å·¦å³ï¼Œå¥½å¥½äº«å—è‡ªå·±çš„ä½œå“ï¼\nå£°å¡éƒ¨åˆ† æš‚æ—¶å‘äº†\nã€åšå®ŒPA2åº”è¯¥ç†Ÿæ‚‰çš„ä»£ç ã€‘ï¼ˆå¾…å®Œæˆ NEMUä¸­é™¤äº†fixdep, kconfig, ä»¥åŠæ²¡æœ‰é€‰æ‹©çš„ISAä¹‹å¤–çš„å…¨éƒ¨å·²æœ‰ä»£ç (åŒ…æ‹¬Makefile)\nabstract-machine/am/ä¸‹ä¸$ISA-nemuç›¸å…³çš„, é™¤å»CTEå’ŒVMEä¹‹å¤–çš„ä»£ç \nabstract-machine/klib/ä¸­çš„æ‰€æœ‰ä»£ç \nabstract-machine/Makefileå’Œabstract-machine/scripts/ä¸­çš„æ‰€æœ‰ä»£ç \nam-kernels/tests/cpu-tests/ä¸­çš„æ‰€æœ‰ä»£ç \nam-kernels/tests/am-tests/ä¸­è¿è¡Œè¿‡çš„æµ‹è¯•ä»£ç \nam-kernels/benchmarks/microbench/bench.c\nam-kernels/kernels/ä¸­çš„hello, sliderå’Œtyping-gameçš„æ‰€æœ‰ä»£ç \nå¦‚æœä½ å‘ç°è‡ªå·±ä¸èƒ½ç†è§£è¿™äº›ä»£ç çš„è¡Œä¸º, å°±èµ¶ç´§çœ‹çœ‹å§. å¤šçœ‹ä¸€ä¸ªæ–‡ä»¶, bugå°‘è°ƒå‡ å¤©, åˆ°äº†PA3ä½ å°±ä¼šé¢†æ•™åˆ°äº†. ï¼ˆè¿™å¥è¯æˆ‘è¿˜æ˜¯éå¸¸ç›¸ä¿¡çš„ï¼Œæ‰€ä»¥å®æ„¿æ…¢ä¸€ç‚¹ä¸€ä¸ªä¸ªå»çœ‹ï¼Œæ…¢å°±æ˜¯å¿«ã€‚ï¼‰\nã€ä½ åº”è¯¥çŸ¥é“å¹¶ç†è§£çš„çŸ¥è¯†ã€‘ï¼ˆå¾…å®Œæˆ ç¨‹åºæ˜¯ä¸ªçŠ¶æ€æœº ç†è§£YEMUçš„æ‰§è¡Œè¿‡ç¨‹, å…·ä½“è¯·å‚è€ƒè¿™é‡Œ.\nRTFSC è¯·æ•´ç†ä¸€æ¡æŒ‡ä»¤åœ¨NEMUä¸­çš„æ‰§è¡Œè¿‡ç¨‹, å…·ä½“è¯·å‚è€ƒè¿™é‡Œ.\nç¨‹åºå¦‚ä½•è¿è¡Œ ç†è§£æ‰“å­—å°æ¸¸æˆå¦‚ä½•è¿è¡Œ, å…·ä½“è¯·å‚è€ƒè¿™é‡Œ.\nç¼–è¯‘ä¸é“¾æ¥ åœ¨nemu/src/engine/interpreter/rtl-basic.hä¸­, ä½ ä¼šçœ‹åˆ°ç”±static inlineå¼€å¤´å®šä¹‰çš„å„ç§RTLæŒ‡ä»¤å‡½æ•°. é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå‡½æ•°, åˆ†åˆ«å°è¯•å»æ‰static, å»æ‰inlineæˆ–å»æ‰ä¸¤è€…, ç„¶åé‡æ–°è¿›è¡Œç¼–è¯‘, ä½ å¯èƒ½ä¼šçœ‹åˆ°å‘ç”Ÿé”™è¯¯. è¯·åˆ†åˆ«è§£é‡Šä¸ºä»€ä¹ˆè¿™äº›é”™è¯¯ä¼šå‘ç”Ÿ/ä¸å‘ç”Ÿ? ä½ æœ‰åŠæ³•è¯æ˜ä½ çš„æƒ³æ³•å—?\nç¼–è¯‘ä¸é“¾æ¥\nåœ¨nemu/include/common.hä¸­æ·»åŠ ä¸€è¡Œvolatile static int dummy; ç„¶åé‡æ–°ç¼–è¯‘NEMU. è¯·é—®é‡æ–°ç¼–è¯‘åçš„NEMUå«æœ‰å¤šå°‘ä¸ªdummyå˜é‡çš„å®ä½“? ä½ æ˜¯å¦‚ä½•å¾—åˆ°è¿™ä¸ªç»“æœçš„?\næ·»åŠ ä¸Šé¢˜ä¸­çš„ä»£ç å, å†åœ¨nemu/include/debug.hä¸­æ·»åŠ ä¸€è¡Œvolatile static int dummy; ç„¶åé‡æ–°ç¼–è¯‘NEMU. è¯·é—®æ­¤æ—¶çš„NEMUå«æœ‰å¤šå°‘ä¸ªdummyå˜é‡çš„å®ä½“? ä¸ä¸Šé¢˜ä¸­dummyå˜é‡å®ä½“æ•°ç›®è¿›è¡Œæ¯”è¾ƒ, å¹¶è§£é‡Šæœ¬é¢˜çš„ç»“æœ.\nä¿®æ”¹æ·»åŠ çš„ä»£ç , ä¸ºä¸¤å¤„dummyå˜é‡è¿›è¡Œåˆå§‹åŒ–:volatile static int dummy = 0; ç„¶åé‡æ–°ç¼–è¯‘NEMU. ä½ å‘ç°äº†ä»€ä¹ˆé—®é¢˜? ä¸ºä»€ä¹ˆä¹‹å‰æ²¡æœ‰å‡ºç°è¿™æ ·çš„é—®é¢˜? (å›ç­”å®Œæœ¬é¢˜åå¯ä»¥åˆ é™¤æ·»åŠ çš„ä»£ç .)\näº†è§£Makefile è¯·æè¿°ä½ åœ¨am-kernels/kernels/hello/ç›®å½•ä¸‹æ•²å…¥make ARCH=$ISA-nemu å, makeç¨‹åºå¦‚ä½•ç»„ç»‡.cå’Œ.hæ–‡ä»¶, æœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶am-kernels/kernels/hello/build/hello-$ISA-nemu.elf. (è¿™ä¸ªé—®é¢˜åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢:Makefileçš„å·¥ä½œæ–¹å¼å’Œç¼–è¯‘é“¾æ¥çš„è¿‡ç¨‹.) å…³äºMakefileå·¥ä½œæ–¹å¼çš„æç¤º:\nMakefileä¸­ä½¿ç”¨äº†å˜é‡, åŒ…å«æ–‡ä»¶ç­‰ç‰¹æ€§\nMakefileè¿ç”¨å¹¶é‡å†™äº†ä¸€äº›implicit rules\nåœ¨man makeä¸­æœç´¢-né€‰é¡¹, ä¹Ÿè®¸ä¼šå¯¹ä½ æœ‰å¸®åŠ©\nReference https://nju-projectn.github.io/ics-pa-gitbook/ics2021\nç½‘ç»œä¸Šæœåˆ°çš„ä¸€äº›ç»†èŠ‚ï¼Œä½†ç”±äºå­¦æœ¯è¯šä¿¡ä¸äºˆæ”¾å‡ºã€‚\n","date":"2022-08-13T08:50:40+08:00","permalink":"https://sanbuphy.github.io/p/nju%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%BE%E7%A8%8B%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C-pa2%E7%AC%94%E8%AE%B0%E4%BA%8C/","title":"NJUè®¡ç®—æœºè¯¾ç¨‹åŸºç¡€å®éªŒ PA2ç¬”è®°ï¼ˆäºŒï¼‰"},{"content":"PA2.1 å†¯è¯ºä¾æ›¼è®¡ç®—æœº å†™åœ¨å‰é¢ï¼š\né¦–å…ˆè¦æ„Ÿè°¢jyyç¾¤ä¸€ç›´å¸®åŠ©æˆ‘çš„ponyå°å“¥ã€17å·å°å“¥ã€YSYXè®ºå›ï¼ˆè¿˜æœ‰å¾ˆå¤šå¸®åŠ©æˆ‘çš„äººï¼Œæ²¡å†™å‡ºæ¥ä½†æˆ‘éƒ½å¾ˆæ„Ÿè°¢ï¼ï¼‰\næ²¡æœ‰ä½ ä»¬æˆ‘æ˜¯ä¸å¯èƒ½èƒ½è¿™ä¹ˆå¿«ç†è§£ï¼ˆç”šè‡³å®Œå…¨åšä¸å‡ºï¼‰è¿™ä¸€éƒ¨åˆ†çš„ã€‚\næˆ‘çš„åŸºç¡€å¾ˆè–„å¼±ï¼Œå¯¹äºISAçœŸçš„ä¸€æ— æ‰€çŸ¥ï¼Œæ„Ÿè°¢æ— ç§çš„å¸®åŠ©\næ³¨æ„ï¼ŒåŒ…è€å¸ˆçš„ä¸­æ–‡ç‰ˆæ‰‹å†Œæœ‰äº›åœ°æ–¹æ˜¯æœ‰é”™çš„ï¼Œå»ºè®®åªçœ‹æ¦‚å¿µï¼Œå…·ä½“çš„ç¼–ç å‚è€ƒè‹±æ–‡çš„èµ„æ–™ï¼Œæ¯”å¦‚ï¼šhttps://msyksphinz-self.github.io/riscv-isadoc/html/rvi.html#fence-i\nå…·ä½“è¿˜æ˜¯è¦ä»¥è‹±æ–‡æ‰‹å†Œçš„è¯‘ç ä¸ºå‡†ã€‚\nã€å‰åŠéƒ¨åˆ†éƒ½æ˜¯çº¯ç²¹çš„æŠ„è®²ä¹‰é˜¶æ®µã€‚ã€‚ä½†æ˜¯æŠ„äº†åçœŸçš„èƒ½æ¯”è¾ƒå¥½ç†è§£ã€‘\nPA2ä¸€å¼€å§‹çš„ä»»åŠ¡æ˜¯å®ç°è¯‘ç çš„æµç¨‹ï¼Œè¡¥å……è¾…åŠ©è¯‘ç å‡½æ•°ï¼ˆæ³¨æ„ä¸€ä¸‹ä¼ªæŒ‡ä»¤ä¸ç”¨å®ç°ï¼Œå‡½æ•°ä½“å¯ä»¥ç•™ç©ºï¼‰\nRTFSC(2) fetch_decode_exec_updatepc()ï¼š å–æŒ‡, è¯‘ç , æ‰§è¡Œ, æ›´æ–°PC åœ¨cpu_execâ€”â€”fetch_decode_exec_updatepcâ€”â€”fetch_decode\nfetch_decode_exec_updatepc()æ¥å—ä¸€ä¸ªDecodeç±»å‹çš„ç»“æ„ä½“æŒ‡é’ˆs, è¿™ä¸ªç»“æ„ä½“ç”¨äºå­˜æ”¾åœ¨æ‰§è¡Œä¸€æ¡æŒ‡ä»¤è¿‡ç¨‹ä¸­çš„è¯‘ç å’Œæ‰§è¡Œä¿¡æ¯, åŒ…æ‹¬æŒ‡ä»¤çš„PC, æ‰§è¡Œæ–¹å¼, ä»¥åŠæ“ä½œæ•°çš„ä¿¡æ¯. è¿˜æœ‰ä¸€äº›ä¿¡æ¯æ˜¯ISAç›¸å…³çš„, NEMUç”¨ä¸€ä¸ªç»“æ„ç±»å‹ISADecodeInfoæ¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡ŒæŠ½è±¡, å…·ä½“çš„å®šä¹‰åœ¨nemu/src/isa/$ISA/include/isa-def.hä¸­. fetch_decode_exec_updatepc()é¦–å…ˆä¼šè°ƒç”¨fetch_decode()è¿›è¡Œå–æŒ‡å’Œè¯‘ç , fetch_decode()ä¼šå…ˆæŠŠå½“å‰çš„PCä¿å­˜åˆ°sçš„æˆå‘˜pcå’Œsnpcä¸­, å…¶ä¸­s-\u0026gt;pcå°±æ˜¯å½“å‰æŒ‡ä»¤çš„PC, è€Œs-\u0026gt;snpcåˆ™æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„PC, è¿™é‡Œçš„snpcæ˜¯ \u0026ldquo;static next PC\u0026quot;çš„æ„æ€.\nç„¶åä»£ç ä¼šè°ƒç”¨isa_fetch_decode()å‡½æ•°(åœ¨nemu/src/isa/$ISA/instr/decode.cä¸­å®šä¹‰), å®ƒä¼šéšç€å–æŒ‡çš„è¿‡ç¨‹ä¿®æ”¹s-\u0026gt;snpcçš„å€¼, ä½¿å¾—ä»isa_fetch_decode()è¿”å›ås-\u0026gt;snpcæ­£å¥½ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„PC. è¿™é‡Œçš„dnpc**æ˜¯\u0026quot;dynamic next PC\u0026quot;çš„æ„æ€. **\næ­¤å¤–, isa_fetch_decode()è¿˜ä¼šè¿”å›ä¸€ä¸ªç¼–å·idx, ç”¨äºå¯¹g_exec_tableè¿™ä¸€æ•°ç»„è¿›è¡Œç´¢å¼•. g_exec_tableæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆçš„æ•°ç»„, æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªç”¨äºæ¨¡æ‹ŸæŒ‡ä»¤æ‰§è¡Œçš„å‡½æ•°, æˆ‘ä»¬æŠŠè¿™æ ·çš„å‡½æ•°ç§°ä¸º\u0026quot;æ‰§è¡Œè¾…åŠ©å‡½æ•°\u0026rdquo;(execution helper function). é€šè¿‡idxç´¢å¼•è¿™ä¸ªæ•°ç»„, å¯ä»¥æ‰¾åˆ°ä¸ä¸€æ¡æŒ‡ä»¤ç›¸åŒ¹é…çš„æ‰§è¡Œè¾…åŠ©å‡½æ•°, å¹¶æŠŠå®ƒè®°å½•åˆ°s-\u0026gt;EHelperä¸­.\nå¿½ç•¥fetch_decode()ä¸­å‰©ä¸‹ä¸traceç›¸å…³çš„ä»£ç , æˆ‘ä»¬å°±è¿”å›åˆ°fetch_decode_exec_updatepc()ä¸­. å°†ä¼šè°ƒç”¨åˆšæ‰è®°å½•åˆ°çš„æ‰§è¡Œè¾…åŠ©å‡½æ•°, æ¥æ¨¡æ‹ŸæŒ‡ä»¤æ‰§è¡Œçš„çœŸæ­£æ“ä½œ. æœ€åä¼šæ›´æ–°PC, è®©PCæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤.\næ˜¾ç„¶, fetch_decode_exec_updatepc()å‡½æ•°è¦†ç›–äº†æŒ‡ä»¤å‘¨æœŸçš„æ‰€æœ‰é˜¶æ®µ: å–æŒ‡, è¯‘ç , æ‰§è¡Œ, æ›´æ–°PC. åœ¨è¿™äº›é˜¶æ®µä¸­, ä»£ç éƒ½å¯ä»¥å¯¹sè¿›è¡Œè®°å½•å’Œè®¿é—®. å–æŒ‡(instruction fetch, IF) isa_fetch_decode()åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å–æŒ‡ä»¤. åœ¨NEMUä¸­, æœ‰ä¸€ä¸ªå‡½æ•°instr_fetch()(åœ¨nemu/include/cpu/ifetch.hä¸­å®šä¹‰)ä¸“é—¨è´Ÿè´£å–æŒ‡ä»¤çš„å·¥ä½œ. instr_fetch()æœ€ç»ˆä¼šæ ¹æ®å‚æ•°lenæ¥è°ƒç”¨vaddr_ifetch()(åœ¨nemu/src/memory/vaddr.cä¸­å®šä¹‰), è€Œç›®å‰vaddr_ifetch()åˆä¼šé€šè¿‡paddr_read()æ¥è®¿é—®ç‰©ç†å†…å­˜ä¸­çš„å†…å®¹. å› æ­¤, å–æŒ‡æ“ä½œçš„æœ¬è´¨åªä¸è¿‡å°±æ˜¯ä¸€æ¬¡å†…å­˜çš„è®¿é—®è€Œå·².\nisa_fetch_decode()åœ¨è°ƒç”¨instr_fetch()çš„æ—¶å€™ä¼ å…¥äº†s-\u0026gt;snpcçš„åœ°å€, å› æ­¤instr_fetch()æœ€åè¿˜ä¼šæ ¹æ®lenæ¥æ›´æ–°s-\u0026gt;snpc, ä»è€Œè®©s-\u0026gt;snpcæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤.\nMotorola 68kç³»åˆ—çš„å¤„ç†å™¨éƒ½æ˜¯å¤§ç«¯æ¶æ„çš„. ç°åœ¨é—®é¢˜æ¥äº†, è€ƒè™‘ä»¥ä¸‹ä¸¤ç§æƒ…å†µ:\nå‡è®¾æˆ‘ä»¬éœ€è¦å°†NEMUè¿è¡Œåœ¨Motorola 68kçš„æœºå™¨ä¸Š(æŠŠNEMUçš„æºä»£ç ç¼–è¯‘æˆMotorola 68kçš„æœºå™¨ç )\nå‡è®¾æˆ‘ä»¬éœ€è¦æŠŠMotorola 68kä½œä¸ºä¸€ä¸ªæ–°çš„ISAåŠ å…¥åˆ°NEMUä¸­ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹, ä½ éœ€è¦æ³¨æ„äº›ä»€ä¹ˆé—®é¢˜? ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™äº›é—®é¢˜? æ€ä¹ˆè§£å†³å®ƒä»¬?\nç­”ï¼šæˆ‘çŒœæƒ³å¯ä»¥åœ¨memoryçš„host.hå¤„ä»¥åŠmap.cçš„åœ°æ–¹é€šè¿‡ä½ç½®è°ƒæ•´ï¼ˆæ”¹å˜addræŒ‡é’ˆçš„åç§»ï¼‰è§£å†³é—®é¢˜ã€‚æœ‰æœ‹å‹æå‡ºå¯ä»¥å›ºå®šlenç„¶åå†æ‹¼èµ·æ¥ï¼Œä¹Ÿæœ‰æœ‹å‹å»ºè®®å¯ä»¥äº†è§£ä¸€ä¸‹ntohlå’Œntohsçš„ç°æœ‰è½¬æ¢åº“\nè¯‘ç (instruction decode, ID) è¯‘ç çš„ç›®çš„æ˜¯å¾—åˆ°æŒ‡ä»¤çš„æ“ä½œå’Œæ“ä½œå¯¹è±¡, è¿™ä¸»è¦æ˜¯é€šè¿‡æŸ¥çœ‹æŒ‡ä»¤çš„opcodeæ¥å†³å®šçš„. ä¸åŒISAçš„opcodeä¼šå‡ºç°åœ¨æŒ‡ä»¤çš„ä¸åŒä½ç½®, æˆ‘ä»¬åªéœ€è¦æ ¹æ®æŒ‡ä»¤çš„ç¼–ç æ ¼å¼, ä»å–å‡ºçš„æŒ‡ä»¤ä¸­è¯†åˆ«å‡ºç›¸åº”çš„opcodeå³å¯.\nå’ŒYEMUç›¸æ¯”, NEMUä½¿ç”¨ä¸€ç§æŠ½è±¡å±‚æ¬¡æ›´é«˜çš„è¯‘ç æ–¹å¼: æ¨¡å¼åŒ¹é…, NEMUå¯ä»¥é€šè¿‡ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸²æ¥æŒ‡å®šæŒ‡ä»¤ä¸­opcode:(def_INSTR_IDTAB åœ¨ decode.c)\nnemu/include/cpu/decode.h å®šä¹‰äº†è¿™äº›å„ç§å„æ ·çš„å®ï¼ŒåŒ…æ‹¬æ¨¡å¼åŒ¹é…è§„åˆ™ã€‚\nå®å±•å¼€defçš„å®šä¹‰å®åæ˜¯è¿™æ ·çš„ï¼šï¼ˆæ ¹æ®def_INSTR_rawï¼‰\ndo { uint32_t key, mask, shift; pattern_decode(\u0026#34;??????? ????? ????? ??? ????? 01101 11\u0026#34;, 37, \u0026amp;key, \u0026amp;mask, \u0026amp;shift); if (((s-\u0026gt;isa.instr.val \u0026gt;\u0026gt; shift) \u0026amp; mask) == key) { decode_U(s, 0); return table_lui(s); } } while (0); æ“ä½œå¯¹è±¡(æ¯”å¦‚ç«‹å³æ•°æ˜¯å¤šå°‘, è¯»å…¥åˆ°å“ªä¸ªå¯„å­˜å™¨). ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, ä»£ç éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„è¯‘ç å·¥ä½œ, è¿™æ˜¯é€šè¿‡è°ƒç”¨ç›¸åº”çš„è¯‘ç è¾…åŠ©å‡½æ•°(decode helper function)æ¥å®Œæˆçš„. è¯‘ç è¾…åŠ©å‡½æ•°ç»Ÿä¸€é€šè¿‡å®def_DHelper(åœ¨nemu/include/cpu/decode.hä¸­å®šä¹‰)æ¥å®šä¹‰\næ¯ä¸ªè¯‘ç è¾…åŠ©å‡½æ•°è´Ÿè´£è¿›è¡Œä¸€ç§ç±»å‹çš„æ“ä½œæ•°è¯‘ç , æŠŠæŒ‡ä»¤ä¸­çš„æ“ä½œæ•°ä¿¡æ¯åˆ†åˆ«è®°å½•åœ¨è¯‘ç ä¿¡æ¯sçš„destæˆå‘˜, src1æˆå‘˜å’Œsrc2æˆå‘˜ä¸­, å®ƒä»¬åˆ†åˆ«ä»£è¡¨ç›®çš„æ“ä½œæ•°å’Œä¸¤ä¸ªæºæ“ä½œæ•°. nemu/include/cpu/decode.hä¸­è¿˜å®šä¹‰äº†ä¸‰ä¸ªå®id_dest, id_src1å’Œid_src2, ç”¨äºæ–¹ä¾¿åœ°è®¿é—®å®ƒä»¬.ã€æ³¨æ„ï¼Œè¿™é‡Œçš„å…³é”®æ˜¯åŸæ“ä½œæ•°å’Œç›®çš„æ“ä½œæ•°çš„æ˜¯å¦å¯å†™å…¥æƒé™ã€‘\nå¯„å­˜å™¨å’Œç«‹å³æ•°è¿™äº›æ“ä½œæ•°, å…¶å®æ˜¯éå¸¸å¸¸è§çš„æ“ä½œæ•°ç±»å‹. ä¸ºäº†è¿›ä¸€æ­¥å®ç°æ“ä½œæ•°è¯‘ç å’ŒæŒ‡ä»¤è¯‘ç çš„è§£è€¦, æ¡†æ¶ä»£ç å¯¹è¿™äº›æ“ä½œæ•°çš„è¯‘ç è¿›è¡Œäº†æŠ½è±¡å°è£…, æŒ‡ä»¤è¯‘ç è¿‡ç¨‹ç”±è‹¥å¹²è¯‘ç æ“ä½œæ•°è¾…åŠ©å‡½æ•°(decode operand helper function)ç»„æˆ. è¯‘ç æ“ä½œæ•°è¾…åŠ©å‡½æ•°ç»Ÿä¸€é€šè¿‡å®def_DopHelperæ¥å®šä¹‰\nDopHelperå¸¦æœ‰ä¸€ä¸ªflagå‚æ•°, ä¸åŒçš„DopHelperå¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œä¸åŒçš„å¤„ç†. ä¾‹å¦‚å¯„å­˜å™¨çš„DopHelperå¯ä»¥é€šè¿‡flagæ¥æŒ‡ç¤ºæ˜¯å¦å†™å…¥ï¼ˆå¯ä»¥å‚è€ƒdef_DopHelper(r)å®ç°ä¸­çš„ï¼‰\nvoid concat(decode_op_, name) (Decode *s, Operand *op, word_t val, bool flag)å¯ä»¥åŒ¹é…decode_op_rå’Œdecode_op_i(def_DopHelper(r), def_DopHelper(i) )\nDopHelperå¸¦æœ‰ä¸€ä¸ªflagå‚æ•°, ä¸åŒçš„DopHelperå¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œä¸åŒçš„å¤„ç†. ä¾‹å¦‚å¯„å­˜å™¨çš„DopHelperå¯ä»¥é€šè¿‡flagæ¥æŒ‡ç¤ºæ˜¯å¦å†™å…¥ï¼ˆå¯å‚è€ƒdef_DopHelper(r)ä¸­çš„å®ç°ï¼‰\næœ‰äº†è¿™äº›è¯‘ç æ“ä½œæ•°è¾…åŠ©å‡½æ•°, æˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒä»¬æ¥ç¼–å†™è¯‘ç è¾…åŠ©å‡½æ•°:def_DHelper(I)ã€\ndef_DHelper(U)ã€ def_DHelper(S)\nç”±äºCISCæŒ‡ä»¤å˜é•¿çš„ç‰¹æ€§, x86æŒ‡ä»¤é•¿åº¦å’ŒæŒ‡ä»¤å½¢å¼éœ€è¦ä¸€è¾¹å–æŒ‡ä¸€è¾¹è¯‘ç æ¥ç¡®å®š, è€Œä¸åƒRISCæŒ‡ä»¤é›†é‚£æ ·å¯ä»¥æ³¾æ¸­åˆ†æ˜åœ°å¤„ç†å–æŒ‡å’Œè¯‘ç é˜¶æ®µ, å› æ­¤ä½ ä¼šåœ¨x86çš„è¯‘ç æ“ä½œæ•°è¾…åŠ©å‡½æ•°ä¸­çœ‹åˆ°â€‹çš„æ“ä½œ.\nQï¼šmips32å’Œriscv32çš„æŒ‡ä»¤é•¿åº¦åªæœ‰32ä½, å› æ­¤å®ƒä»¬ä¸èƒ½åƒx86é‚£æ ·, æŠŠCä»£ç ä¸­çš„32ä½å¸¸æ•°ç›´æ¥ç¼–ç åˆ°ä¸€æ¡æŒ‡ä»¤ä¸­. æ€è€ƒä¸€ä¸‹, mips32å’Œriscv32åº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜?\nAï¼šæŒ‡ä»¤å’Œå‚¨å­˜åˆ†å¼€ï¼Œè€Œä¸”å¯ä»¥ç”¨ä¸¤ä¸ªæ‹¼æˆä¸€ä¸ªï¼ŒæŠŠæ•°æ®å­˜åœ¨32ä½å¯„å­˜å™¨ï¼Œæˆ–è€…å˜æˆå‡ ä¸ªå¯„å­˜å™¨åŠ å‡ç»“æœã€‚æˆ–è€…æœ‰æœ‹å‹è¯´çš„å¯ä»¥é«˜ä½ä½ä½åˆ†å¼€å‚¨å­˜(å®é™…ä¸Šä½ åœ¨æ‰‹å†Œä¸­èƒ½çœ‹åˆ°éƒ¨æŒ‡ä»¤è¿™æ ·çš„å®ç°ä¹‹ç±»çš„ï¼‰ã€‚\nå›åˆ°def_INSTR_IDTABçš„å®å±•å¼€ç»“æœ,ï¼š\ndo { uint32_t key, mask, shift; pattern_decode(\u0026#34;??????? ????? ????? ??? ????? 01101 11\u0026#34;, 37, \u0026amp;key, \u0026amp;mask, \u0026amp;shift); if (((s-\u0026gt;isa.instr.val \u0026gt;\u0026gt; shift) \u0026amp; mask) == key) { decode_U(s, 0); return table_lui(s); } } while (0); å¯¹äºluiæŒ‡ä»¤, åœ¨è¯‘ç è¾…åŠ©å‡½æ•°decode_U()æ‰§è¡Œç»“æŸå, ä»£ç å°†ä¼šæ‰§è¡Œtable_lui(). table_lui()çš„å®šä¹‰æ–¹å¼æ¯”è¾ƒç‰¹æ®Š, éƒ¨åˆ†å®å±•å¼€åçš„å®šä¹‰:\ndef_THelper(lui) { return EXEC_ID_lui; } å…¶ä¸­å®def_THelper(åœ¨nemu/include/cpu/decode.hä¸­å®šä¹‰) ç”¨äº**ç»Ÿä¸€å®šä¹‰\u0026quot;è¡¨æ ¼è¾…åŠ©å‡½æ•°\u0026quot;(table helper function). **table_lui()åšçš„äº‹æƒ…å¾ˆç®€å•, å®ƒç›´æ¥è¿”å›ä¸€ä¸ªæ ‡è¯†luiæŒ‡ä»¤çš„å”¯ä¸€ID. è¿™ä¸ªIDä¼šä½œä¸ºè¯‘ç ç»“æœçš„è¿”å›å€¼, åœ¨fetch_decode()ä¸­ç´¢å¼•g_exec_tableæ•°ç»„.\näº‹å®ä¸Š, è¯‘ç çš„è¿‡ç¨‹å¯ä»¥çœ‹æˆæ˜¯è‹¥å¹²æŸ¥è¡¨çš„æ“ä½œ, æ¯ä¸€æ¡æ¨¡å¼åŒ¹é…çš„è§„åˆ™éƒ½å¯ä»¥çœ‹æˆæ˜¯è¡¨æ ¼ä¸­çš„ä¸€ä¸ªè¡¨é¡¹, å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¡¨æ ¼è¾…åŠ©å‡½æ•°æ¥æè¿°è¿™äº›è¯‘ç çš„è§„åˆ™. ä»¥riscvä¸ºä¾‹:\nè¿™ä¸€æ¨¡å¼å­—ç¬¦ä¸²åªèƒ½é€šè¿‡opcodeåŒ¹é…åˆ°loadç±»å‹çš„æŒ‡ä»¤, ä¸ºäº†è¿›ä¸€æ­¥ç¡®å®šæ˜¯å“ªä¸€æ¡loadæŒ‡ä»¤, æˆ‘ä»¬è¿˜éœ€è¦åŒ¹é…funct3å­—æ®µï¼ˆå…·ä½“æŸ¥çœ‹riscvæ‰‹å†Œå°±ç›´åˆ°ä¸ºä»€ä¹ˆè¦åŒ¹é…é‚£ä¸‰ä¸ªäº†ã€‚ï¼‰, å› æ­¤æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„è¡¨æ ¼è¾…åŠ©å‡½æ•°table_load(), åŒ¹é…åˆ°loadç±»å‹æŒ‡ä»¤çš„æ—¶å€™, ä¼šè¿›ä¸€æ­¥è°ƒç”¨table_load(), ç„¶ååœ¨å…¶ä¸­é€šè¿‡é¢å¤–çš„æ¨¡å¼å­—ç¬¦ä¸²æ¥åŒ¹é…funct3å­—æ®µ, ä¾‹å¦‚: ä»¥riscvä¸ºä¾‹:\ndef_THelper(load) { def_INSTR_TAB(\u0026#34;??????? ????? ????? 010 ????? ????? ??\u0026#34;, lw); return EXEC_ID_inv; } def_INSTR_TABä¹Ÿæ˜¯ä¸€æ¡å­—ç¬¦ä¸²åŒ¹é…è§„åˆ™, ä½†å®ƒå¹¶ä¸éœ€è¦è°ƒç”¨è¯‘ç è¾…åŠ©å‡½æ•°. è¿™æ¡è§„åˆ™æè¿°äº†\u0026quot;åœ¨loadç±»å‹æŒ‡ä»¤ä¸­, å¦‚æœfunct3ä¸º010, åˆ™ä¸ºlwæŒ‡ä»¤\u0026quot;.\n** NEMUæŠŠè¯‘ç æ—¶çš„å¦‚ä¸‹æƒ…å†µéƒ½çœ‹ä½œæ˜¯æŸ¥è¡¨è¿‡ç¨‹:** â€‹\nåœ¨isa_fetch_decode()ä¸­æŸ¥ä¸»è¡¨(main decode table)\nåœ¨è¯‘ç è¿‡ç¨‹ä¸­åˆ†åˆ«åŒ¹é…æŒ‡ä»¤ä¸­çš„æ¯ä¸€ä¸ªåŸŸ(å¦‚ä¸Šæ–‡ä»‹ç»çš„table_load()\nè¯‘ç å‡ºæœ€ç»ˆçš„æŒ‡ä»¤æ—¶è®¤ä¸ºæ˜¯ä¸€ç§ç‰¹æ®Šçš„æŸ¥è¡¨æ“ä½œ, ç›´æ¥è¿”å›æ ‡è¯†è¯¥æŒ‡ä»¤çš„å”¯ä¸€ID\nå¦‚æœæ‰€æœ‰æ¨¡å¼åŒ¹é…è§„åˆ™éƒ½æ— æ³•æˆåŠŸåŒ¹é…, ä»£ç å°†ä¼šè¿”å›ä¸€ä¸ªæ ‡è¯†éæ³•æŒ‡ä»¤çš„ID.\næ‰§è¡Œ(execute, EX) ä¹‹å‰çš„å…³é”®æ˜¯è¯‘ç è¾…åŠ©å‡½æ•°ï¼ˆdecode_Uï¼‰â€”â€”è¯‘ç è¾…åŠ©å‡½æ•°ç»Ÿä¸€é€šè¿‡å®def_DHelper(åœ¨nemu/include/cpu/decode.h)æ¥å®šä¹‰ï¼›ä»¥åŠ\u0026quot;è¡¨æ ¼è¾…åŠ©å‡½æ•°\u0026quot;def_THelper(ä¹Ÿåœ¨nemu/include/cpu/decode.h)ï¼Œä»–è¿”å›ä¸€ä¸ªæ ‡è¯†luiæŒ‡ä»¤çš„å”¯ä¸€ID. è¿™ä¸ªIDä¼šä½œä¸ºè¯‘ç ç»“æœçš„è¿”å›å€¼, åœ¨fetch_decode()ä¸­ç´¢å¼•g_exec_tableæ•°ç»„ã€‚\nä¸€ç§å¥½çš„åšæ³•æ˜¯æŠŠè¯‘ç , æ‰§è¡Œå’Œæ“ä½œæ•°å®½åº¦çš„ç›¸å…³ä»£ç åˆ†ç¦»æ¥, å®ç°è§£è€¦. åœ¨æ¡†æ¶ä»£ç ä¸­, å®ç°è¯‘ç å’Œæ‰§è¡Œä¹‹é—´çš„è§£è€¦çš„æ˜¯isa_fetch_decode()è¿”å›çš„ç¼–å·, è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ†åˆ«ç¼–å†™è¯‘ç å’Œæ‰§è¡Œçš„è¾…åŠ©å‡½æ•°, ç„¶åè¿›è¡Œç»„åˆ:è¿™å¾ˆå®¹æ˜“å®ç°æ‰§è¡Œè¡Œä¸ºç›¸åŒä½†è¯‘ç æ–¹å¼ä¸åŒçš„å¤šæ¡æŒ‡ä»¤.\nç°åœ¨æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯æ‰§è¡Œè¾…åŠ©å‡½æ•°def_EHelperï¼ˆåœ¨g_exec_tableï¼‰ã€‚\nè¯‘ç è¿‡ç¨‹ç»“æŸä¹‹å, æ¥ä¸‹æ¥ä¼šè¿”å›åˆ°fetch_decode()ä¸­, å¹¶é€šè¿‡è¿”å›çš„IDæ¥ä»g_exec_tableæ•°ç»„ä¸­é€‰æ‹©ç›¸åº”çš„æ‰§è¡Œè¾…åŠ©å‡½æ•°(execution helper function), ç„¶åè®°å½•åˆ°s-\u0026gt;EHelperä¸­. è¿”å›åˆ°fetch_decode_exec_updatepc()å, ä»£ç å°†ä¼šè°ƒç”¨åˆšæ‰è®°å½•çš„æ‰§è¡Œè¾…åŠ©å‡½æ•°. æ‰§è¡Œè¾…åŠ©å‡½æ•°ç»Ÿä¸€é€šè¿‡å®def_EHelper(åœ¨nemu/include/cpu/exec.hä¸­å®šä¹‰)æ¥å®šä¹‰\nï¼ˆå¯¹x86æ¥è¯´, å¤§éƒ¨åˆ†è®¡ç®—æŒ‡ä»¤éƒ½å¯ä»¥è®¿é—®å†…å­˜, æ¥æ ¹æ®ç›®çš„æ“ä½œæ•°ç±»å‹çš„ä¸åŒ, å†³å®šæ˜¯å†™å…¥å¯„å­˜å™¨è¿˜æ˜¯å†™å…¥å†…å­˜; å¯¹äºmips32å’Œriscv32, è®¿é—®å†…å­˜åªèƒ½é€šè¿‡ç‰¹å®šçš„è®¿å­˜æŒ‡ä»¤è¿›è¡Œ, å› æ­¤æ¯æ¡æŒ‡ä»¤çš„ç›®çš„æ“ä½œæ•°ç±»å‹éƒ½æ˜¯å”¯ä¸€çš„.ï¼‰\næ¯ä¸ªæ‰§è¡Œè¾…åŠ©å‡½æ•°éƒ½éœ€è¦æœ‰ä¸€ä¸ªæ ‡è¯†è¯¥æŒ‡ä»¤çš„IDä»¥åŠä¸€ä¸ªè¡¨æ ¼è¾…åŠ©å‡½æ•°ä¸ä¹‹ç›¸å¯¹åº”, é€šè¿‡ä¸€ç³»åˆ—å®å®šä¹‰å®ç°çš„. åœ¨nemu/src/isa/$ISA/include/isa-all-instr.hä¸­å®šä¹‰ç”¨äºè¡¨ç¤ºæŒ‡ä»¤åˆ—è¡¨çš„å®INSTR_LIST, å®ƒå®šä¹‰äº†NEMUæ”¯æŒçš„æ‰€æœ‰æŒ‡ä»¤. ç„¶åä»£ç é€šè¿‡ä¸€ç§ç±»ä¼¼å‡½æ•°å¼ç¼–ç¨‹çš„æ–¹å¼æ¥å®šä¹‰å¦‚ä¸‹ç›¸å…³çš„å†…å®¹:\nåœ¨nemu/include/cpu/decode.hä¸­ä¸ºæ‰€æœ‰çš„æ‰§è¡Œè¾…åŠ©å‡½æ•°å®šä¹‰ç›¸åº”çš„ID. ä»¥riscv32ä¸ºä¾‹, å¯¹def_all_EXEC_ID()è¿›è¡Œå®å±•å¼€å, ç»“æœå¦‚ä¸‹: #define def_all_EXEC_ID() enum { MAP(INSTR_LIST, def_EXEC_ID) TOTAL_INSTR }\nå˜ä¸ºenum { EXEC_ID_lui, EXEC_ID_lw, EXEC_ID_sw, EXEC_ID_inv, EXEC_ID_nemu_trap, TOTAL_INSTR }\nå…¶ä¸­TOTAL_INSTRçš„å€¼æ­£å¥½ä¸ºç›®å‰æ‰€æœ‰æŒ‡ä»¤çš„æ€»æ•°\nåªéœ€è¦ç»´æŠ¤â€‹ä¸­çš„æŒ‡ä»¤åˆ—è¡¨, å°±å¯ä»¥æ­£ç¡®ç»´æŠ¤æ‰§è¡Œè¾…åŠ©å‡½æ•°å’Œè¯‘ç ä¹‹é—´çš„å…³ç³»äº†.\næ›´æ–°PC æ›´æ–°PCçš„æ“ä½œéå¸¸ç®€å•, åœ¨fetch_decode_exec_updatepcæŠŠs-\u0026gt;dnpcèµ‹å€¼ç»™cpu.pcå³å¯. ä¹‹å‰æåˆ°äº†snpcå’Œdnpc, å®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š\nåœ¨ç¨‹åºåˆ†æé¢†åŸŸä¸­, é™æ€æŒ‡ä»¤æ˜¯æŒ‡ç¨‹åºä»£ç ä¸­çš„æŒ‡ä»¤, åŠ¨æ€æŒ‡ä»¤æ˜¯æŒ‡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„æŒ‡ä»¤\nsnpcæ˜¯æŒ‡ä»£ç ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤, è€Œdnpcæ˜¯æŒ‡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤. dnpcåº”è¯¥æŒ‡å‘è·³è½¬ç›®æ ‡çš„æŒ‡ä»¤. æ˜¾ç„¶, æˆ‘ä»¬åº”è¯¥ä½¿ç”¨s-\u0026gt;dnpcæ¥æ›´æ–°PC, å¹¶ä¸”åœ¨æ‰§è¡Œè¾…åŠ©å‡½æ•°ä¸­æ­£ç¡®ç»´æŠ¤s-\u0026gt;dnpc.\nç”¨RTLè¡¨ç¤ºæŒ‡ä»¤è¡Œä¸º è¿™ä¸ªå¾ˆé‡è¦ï¼å¤§éƒ¨åˆ†è¯‘ç å‡½æ•°éƒ½é€šè¿‡è¿™ä¸ªå®ç°ï¼ˆå…·ä½“æœ‰äº›è¡Œä¸ºåœ¨op_cä¸­å¯ä»¥æ‰¾åˆ°ï¼‰\néœ€è¦è¯¦ç»†æŸ¥çœ‹\nåœ¨NEMUä¸­,ä½¿ç”¨RTL(å¯„å­˜å™¨ä¼ è¾“è¯­è¨€)æ¥æè¿°ï¼ˆå…ˆå®ç°è¿™äº›ç®€å•æ“ä½œ, ç„¶åå†ç”¨å®ƒä»¬æ¥å®ç°æŒ‡ä»¤ï¼‰. RTLå¯„å­˜å™¨çš„å®šä¹‰. åœ¨NEMUä¸­, RTLå¯„å­˜å™¨ç»Ÿä¸€ä½¿ç”¨rtlreg_tæ¥å®šä¹‰, è€Œrtlreg_t(åœ¨nemu/include/common.hä¸­å®šä¹‰)å…¶å®åªæ˜¯ä¸€ä¸ªword_tç±»å‹:\ntypedef word_t rtlreg_t; åœ¨NEMUä¸­çš„RTLå¯„å­˜å™¨ï¼š\nä¸åŒISAçš„é€šç”¨å¯„å­˜å™¨(åœ¨nemu/src/isa/$ISA/include/isa-def.hä¸­å®šä¹‰)\nä¸´æ—¶å¯„å­˜å™¨s0, s1, s2å’Œt0(åœ¨nemu/include/rtl/rtl.hä¸­å®šä¹‰)\né›¶å¯„å­˜å™¨rz(åœ¨nemu/include/rtl/rtl.hä¸­å®šä¹‰), å®ƒçš„å€¼æ€»æ˜¯0\nï¼ˆå…¶å®ä¸éœ€è¦ä½¿ç”¨ ä¸´æ—¶å¯„å­˜å™¨å°±å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†æŒ‡ä»¤\nå®ç°æ–°æŒ‡ä»¤ å¯¹è¯‘ç , æ‰§è¡Œå’Œæ“ä½œæ•°å®½åº¦çš„è§£è€¦å®ç°ä»¥åŠRTLçš„å¼•å…¥, å¯¹åœ¨NEMUä¸­å®ç°å®¢æˆ·æŒ‡ä»¤æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©, ä¸ºäº†å®ç°ä¸€æ¡æ–°æŒ‡ä»¤, åªéœ€è¦\nåœ¨nemu/src/isa/$ISA/instr/decode.cä¸­æ·»åŠ æ­£ç¡®çš„æ¨¡å¼åŒ¹é…è§„åˆ™\nç”¨RTLå®ç°æ­£ç¡®çš„æ‰§è¡Œè¾…åŠ©å‡½æ•°, éœ€è¦æ³¨æ„ä½¿ç”¨RTLä¼ªæŒ‡ä»¤æ—¶è¦éµå®ˆä¸Šæ–‡æåˆ°çš„å°å‹è°ƒç”¨çº¦å®š\nåœ¨nemu/src/isa/$ISA/include/isa-all-instr.hä¸­æŠŠæŒ‡ä»¤æ·»åŠ åˆ°INSTR_LISTä¸­\nå¿…è¦æ—¶åœ¨nemu/src/isa/$ISA/include/isa-exec.hä¸­æ·»åŠ ç›¸åº”çš„å¤´æ–‡ä»¶\nè¯·æ•´ç†ä¸€æ¡æŒ‡ä»¤åœ¨NEMUä¸­çš„æ‰§è¡Œè¿‡ç¨‹. æŒ‡ä»¤é›†ç›¸å…³æ–‡ä»¶ï¼š\nå„ç±»æŒ‡ä»¤RTLè°ƒç”¨å‡½æ•°å®ç°éƒ¨åˆ†ï¼š/home/physico/ics2021/nemu/src/isa/riscv32/instr/ *.h\nè¯‘ç å‡½æ•°éƒ¨åˆ†ï¼š/home/physico/ics2021/nemu/src/isa/riscv32/instr/decode.c\nå‡½æ•°å-å®å±•å¼€éœ€è¦éƒ¨åˆ†ï¼š/home/physico/ics2021/nemu/src/isa/riscv32/include/isa-all-instr.hï¼ˆæ—è¾¹çš„isa-execå¯ä»¥åŒ…æ‹¬1æåˆ°çš„ï¼‰\nISADecodeInfoï¼š/home/physico/ics2021/nemu/src/isa/riscv32/include/isa-def.h\nRTLå®ç°ç›¸å…³ï¼š\n/home/physico/ics2021/nemu/src/engine/interpreter/rtl-basic.h ï¼ˆdef_rtl_compute_reg_immï¼‰\n/home/physico/ics2021/nemu/src/engine/interpreter/c_op.hï¼ˆc_add(a, b) ((a) + (b)) ä»¥åŠ interpret_relopç±»ä¼¼RELOP_NEï¼‰\nè¸©å‘å¿ƒå¾— å…³é”®ï¼šç†è§£ç«‹å³æ•°çš„ç¬¦å·ä½æ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Œä»€ä¹ˆæ—¶å€™ç”¨æ— ç¬¦å·æ•°æœ‰ç¬¦å·æ•°ï¼Œæ€ä¹ˆæ ·æ­£ç¡®ç§»ä½ç½®ï¼Œæ€ä¹ˆæ ·è®¾ç½®å¥½srcä¸destçš„æ˜¯å¦å¯è¯»å†™æƒé™ã€‚å‹æƒ…å»ºè®®å…ˆå®ç°diffï¼ˆå…·ä½“åœ¨å“ªè¯·çœ‹è®²ä¹‰ï¼‰ã€‚\n(æ³¨æ„ï¼Œæ¥ä¸‹æ¥çš„å™è¿°æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¹‹åä¼šè¯´é—®é¢˜åœ¨å“ª)\nä¸€å¼€å§‹å®ç°liï¼Œæœ€åæ‰çŸ¥é“liåŸæ¥æ˜¯ä¼ªæŒ‡ä»¤ï¼Œæ‰€ä»¥å…³é”®æ˜¯å…ˆå®ç°Rã€Sã€Uçš„åŸºç¡€æŒ‡ä»¤ï¼ˆRTSMæœ‰å…³ä¸­æ–‡éƒ¨åˆ†ï¼‰ã€‚ä¸€å¼€å§‹æ€ä¹ˆæ ·éƒ½æ— æ³•ç¼–è¯‘ï¼ŒåŸæ¥æ˜¯å¿˜è®°äº†computerç›¸å…³å¤´æ–‡ä»¶çš„å‡½æ•°å®ç°ï¼Œé¡ºå¸¦ä¿®æ”¹äº†ä¸€ä¸‹isa-defå½“ä¸­çš„ç»“æ„ä½“ï¼Œç»ˆäºç¼–è¯‘é€šè¿‡ï¼ˆåæ¥æ”¹æˆäº†å…ˆå®ç°addiä¹Ÿå°±æ˜¯Rå‹æŒ‡ä»¤ï¼‰\nç¼–è¯‘é€šè¿‡åï¼Œsiè¿˜æ˜¯ä¼šæŠ¥é”™ï¼Œåœ¨ç¡®å®šdef_DHelper(R)åˆå§‹åŒ–ååå¤æ£€æŸ¥å‘ç°æ˜¯def_THelper(main)æ¨¡å¼åŒ¹é…å°±æ²¡åŒ¹é…åˆ°ï¼ˆè¿˜å¥½Logå¤§æ³•å¥½ä¸€ä¸ªä¸ªæ£€æŸ¥ã€‚ã€‚ï¼‰ç›´æ¥çœ‹å‰é¢çš„æŒ‡ä»¤æ˜¯ä¸æ­£ç¡®çš„ï¼ˆä¸å¤ªæ¸…æ¥šåŸå› ï¼Œå°±æ˜¯æ‰‹å†Œå¼€å¤´æœ‰æ•´ç†å¥½åŸºç¡€ç±»å‹ï¼Œæˆ‘å¯¹ç…§ç»“å°¾å¡«å†™ï¼‰ï¼Œé€šè¿‡ç›´æ¥æœaddiï¼ˆå†³å®šçœ‹è‹±æ–‡çš„æ‰‹å†Œï¼‰æ”¹æ­£åèƒ½æœåˆ°äº†ä¸ä¼šæŠ¥é”™ã€‚\nè§£å†³äº†ç¼–è¯‘å’ŒæŠ¥é”™é—®é¢˜ï¼Œå†™äº†ä¸€æ®µa0ç›¸å…³çš„ç›¸åŠ ä»£ç ï¼Œå‘ç°è¿˜æ˜¯æœ‰é—®é¢˜ï¼›æœ€åæ’æŸ¥æ˜¯è‡ªå·±ä¸å¤Ÿç†è§£RTLçš„å®ç°ï¼Œè¦æ·±å…¥pseudo.hç†è§£ç›¸å…³å‡½æ•°ä½œç”¨ï¼Œç„¶åå†ç†è§£åŠŸèƒ½çš„å®ç°å¥—ç”¨å³å¯å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼ˆä¸€å¼€å§‹è¿˜æŠŠsrc2çš„ç«‹å³æ•°å†™æˆäº†src1.immé—¹äº†ç¬‘è¯ï¼‰\nè¿™æ—¶å€™å‘ç°å‰é¢å†™çš„åŸºç¡€è®¾æ–½è¿˜æ˜¯æ´¾ä¸Šç”¨åœºäº†\nä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œä¸€æ ·åœ¨åšpaçš„æœ‹å‹å‘Šè¯‰æˆ‘addiå’Œlwä¸€æ ·éƒ½æ˜¯Iå‹ï¼Œæˆ‘ä¸€å¼€å§‹è¿˜ä¸ä¿¡ï¼ˆæˆ‘ä»¥ä¸ºç›¸åŒä½ä½è¡¨ç¤ºä¸€ä¸ªç±»å‹ï¼‰ç„¶åå‘ç°ä»–ä»¬çš„ä½ä½ä¸åŒä¹Ÿæ˜¯Iå‹ï¼ˆæ‰€ä»¥ç›´æ¥æ–°å¢ä¸€ä¸ªIç±»å‹çš„ä¸»è¡¨å†åŒæ ·çš„åˆå§‹åŒ–åæ‰§è¡Œå¯¹åº”å‡½æ•°å³å¯ï¼‰\u0026hellip;..åªèƒ½é‡æ–°é˜…è¯»æ‰‹å†Œç†è§£ç±»å‹æ˜¯æ€ä¹ˆåŒºåˆ«çš„ï¼š\nå½“ç„¶å‰é¢è™½ç„¶ä¸å°å¿ƒâ€œé€ äº†è½®å­â€ï¼Œä½†ä¹Ÿä¸æ˜¯åäº‹ï¼Œè¿˜æ˜¯èƒ½æ´¾ä¸Šç”¨åœºçš„ã€‚\næœ€å›°éš¾çš„éƒ¨åˆ†â€”â€”æ€ä¹ˆäº†è§£ç«‹å³æ•°ï¼Ÿ\nhttps://blog.csdn.net/qq_39507748/article/details/120150936\nhttps://www.cnblogs.com/mikewolf2002/p/11196680.html\næœ‰æœ‹å‹å»ºè®®æˆ‘çœ‹cs61bï¼Œäºæ˜¯æˆ‘å»ç¿»äº†ä¸€ä¸‹\nhttps://inst.eecs.berkeley.edu/~cs61c/su20/pdfs/lectures/lec08.pdf\nç†è§£è¿™å¼ å›¾çš„å«ä¹‰ï¼ˆçœ‹ä¸æ‡‚å°±å¤šè¯»å‡ éï¼Œ2.4æ˜¯ä¸‹é¢ä¸€å¼ å›¾ï¼‰ã€å…³é”®æ˜¯æŒ‡ä»¤ç»™äº†ç»„æˆimmçš„éƒ¨åˆ†ï¼Œimmå›¾å±•ç¤ºäº†è¦ä»æŒ‡ä»¤çš„å“ªå„¿æ‹¿ã€‘\nçŒœæµ‹ï¼šæ‹¿inst[31]æ˜¯ä¸æ˜¯å°±æ˜¯00000000000æˆ–è€…1111111111111ï¼Œä¹Ÿæ˜¯ä¸€ç§æ‹“å±•\nQ:ä¸ºä»€ä¹ˆè¦å·¦ç§»ï¼Ÿ\nA:æˆ‘çš„çœ‹æ³•æ˜¯ï¼Œæˆ‘ä»¬çš„ç«‹å³æ•°ä¸€å¼€å§‹éƒ½è¦ç§»ä½æ‰èƒ½ç»„è£…æˆçœŸæ­£çš„ç¼–ç å¥½çš„ç«‹å³æ•°ï¼ˆéƒ½æ˜¯ä»0å¼€å§‹ï¼Œä¸ºäº†è®©ä»–åˆ°æ‹¼æ¥çš„åœ°æ–¹ æˆ‘ä»¬å¿…é¡»ç§»ä½ï¼‰ç„¶åæ‹¼å¥½åçš„ç«‹å³æ•°éƒ½è¦æ˜¯è¿™æ ·çš„ï¼ˆ2.4ä¸­éƒ½æ˜¯ç»„è£…å¥½çš„ç«‹å³æ•°ï¼‰ä¹Ÿå°±æ˜¯ç¬¦å·ä½æ‰©å±•çš„ã€‚ä¸ºä»€ä¹ˆè¯´ç¬¦å·ä½æ‰©å±•äº†ï¼Ÿæ¯”å¦‚æœ‰inst31 çš„å°±æ˜¯éƒ½000000 æˆ–è€…111111\næ³¨æ„ï¼šä¼ªå‡½æ•°æ˜¯ä¸éœ€è¦å®ç°çš„ï¼Œç¼–è¯‘å™¨ä¼šå¸®ä½ é€‰æ‹©å®ç°å®ƒçœŸæ­£çš„æ‰§è¡Œçš„å‡½æ•°ï¼Œç”šè‡³éƒ½ä¸ç”¨å†™ã€‚\nå®Œæˆæœ€ç®€å•çš„å¼€å§‹å~æ¥ä¸‹æ¥å°±éœ€è¦è¿è¡Œé™¤äº†dummyå„ç§å„æ ·çš„Cæ–‡ä»¶äº†ï¼Œç¡®ä¿æŒ‡ä»¤éƒ½å®ç°ï¼ˆæ¯”å¦‚åŸºç¡€çš„addå’Œifelseï¼‰\nQï¼šå¦‚æœä¸çŸ¥é“å“ªä¸ªæŒ‡ä»¤æ²¡å®ç°æ€ä¹ˆåŠï¼Ÿ\nAï¼šæƒ³æƒ³æœ‰äº†å†…å­˜åœ°å€ååœ¨ä»€ä¹ˆæƒ…å†µä¸‹èƒ½è®©ä»–æ˜¾ç¤ºæŒ‡ä»¤\nå½“ç„¶ï¼Œæ›´ä¼˜é›…çš„ä½ å¯ä»¥åœ¨ä¿®æ”¹nemu.mk ä¸­å–æ¶ˆ-båç¼€å³å¯è®©ä»–å®Œç¾åœä¸‹æ¥å¯ä»¥ä¸€æ­¥æ­¥çœ‹ï¼ˆåœ¨testä¸­makeçš„é˜¶æ®µï¼‰ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ç”¨è¿™æ ·çš„æ“ä½œï¼šï¼ˆæµ‹è¯•è¿™ä¸ªå‘½ä»¤å‡½å‚æ•°æ‰¾çš„æˆ‘æœ‰ç‚¹æŠ‘éƒï¼Œæ³¨æ„-dåé¢çš„-ï¼Œä½ ä¹Ÿå¯ä»¥å†™-1ï¼‰\n./riscv32-nemu-interpreter -d - --diff=/xxxxxx/ics2021/nemu/tools/spike-diff/build/riscv32-spike-so /xxxxxxx/ics2021/am-kernels/tests/cpu-tests/build/add-riscv32-nemu.bin æå‰åŠ äº†diffåï¼Œå‘ç°ä¸€ç›´å¡åœ¨add.cæ— æ³•å®ç°çš„ç—›è‹¦ï¼ˆbneä¸€ç›´æœ‰é—®é¢˜ï¼‰æŸ¥äº†éå¸¸ä¹…çš„computeå’Œdecodeè¯‘ç éƒ½æ— æ³•æ‰¾åˆ°é”™è¯¯ï¼Œæœ€åå‘ç°æ˜¯isa-defç«‹å³æ•°ç¯èŠ‚å‡ºé”™ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚åªæœ‰æœ€é«˜ä½intå…¶ä»–uintæˆ‘å´æŠŠBæŒ‡ä»¤çš„å…¶ä»–ç«‹å³æ•°ä¹Ÿå†™æˆäº†int\u0026hellip;\u0026hellip;æ‰€ä»¥æ—§æŠ¥é”™äº†ï¼Œæ”¹å®ŒåæˆåŠŸé€šè¿‡addæµ‹è¯•ï¼Œæ„Ÿè§‰äººç”Ÿåˆ°äº†ä¸€ç§å¤§å’Œè°~~~~\nè¿™é‡Œå¼•å‘äº†ä¸€ä¸ªæ€è€ƒï¼šä¸ºä»€ä¹ˆä¸­é—´ä¸èƒ½ç”¨intï¼Ÿæœ‰ä¸ªè€å“¥è¯´è¿™æ˜¯å› ä¸ºæœ‰ç¬¦å·æ•°å­—åœ¨bitfieldä¸­ä¼šè‡ªåŠ¨è¡¥1ï¼Œè¿™æ˜¯ä¸è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥åšå®éªŒæ¥éªŒè¯æ˜¯ä¸æ˜¯ä½åŸŸéƒ½ä¼šæœ‰è¿™ä¸ªæ€§è´¨ï¼ˆå…¶å®å°±æ˜¯æœ‰ç¬¦å·æ•°çš„æ‰©å±•æ€§è´¨ï¼Œå¦‚æœæ— ç¬¦å·æ•°ç›´æ¥é›¶æ‹“å±•ï¼‰ã€‚\nåé¢åœ¨å®ç°Rå‹æŒ‡ä»¤çš„æ—¶å€™åˆé‡åˆ°äº†bugï¼Œä¹Ÿæ˜¯åŒæ ·çš„å¯„å­˜å™¨é—®é¢˜ï¼Œåé¢æ’æŸ¥å‘ç°æ˜¯è¯‘ç é˜¶æ®µå¯„å­˜å™¨å†™å…¥å¼€å…³æˆ‘å†™æˆäº†trueï¼Œä½†å¾—æ˜¯false\u0026hellip;.åŸå› æ˜¯ï¼š\nå¦å¤–ï¼Œå¯¹äºRTLä½ éœ€è¦æœ‰æ›´æ·±å…¥çš„ç†è§£ï¼ŒRå’ŒIå…¶å®éƒ½åœ¨32ä½å¯„å­˜å™¨-å¯„å­˜å™¨ç±»å‹å’Œå¯„å­˜å™¨-ç«‹å³æ•°ç±»å‹çš„åŸºæœ¬ç®—æœ¯/é€»è¾‘è¿ç®—é‡Œäº†ã€‚åŒ…æ‹¬rtl_(add|sub|and|or|xor|sll|srl|sra|setrelop)i?, å®ƒä»¬çš„å®šä¹‰ç”¨åˆ°äº†nemu/src/engine/interpreter/c_op.hä¸­çš„Cè¯­è¨€è¿ç®—ã€‚å½“æƒ³ä¸å‡ºæ¥çš„æ—¶å€™æ€è€ƒä¸€ä¸‹addå’Œaddiçš„åŒºåˆ«ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆå¾—åˆ°çš„ã€‚æœ‰å…³å¯„å­˜å™¨å’Œimmçš„æ“ä½œéƒ½æœ‰äº†ï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚\nè¿™é‡Œè¿˜æ¶‰åŠåˆ°mulï¼Œå½“æˆ‘ä»¬çœ‹åˆ°op_cä¼šå‘ç°éƒ½æ˜¯64ä½ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º32ä¹˜æ³•çš„è¯æ˜¯é”™è¯¯çš„ï¼ˆä¸æ˜¯æº¢å‡ºè€Œæ˜¯å°±æ˜¯é”™ï¼Œæ¶‰åŠåˆ°ç¬¦å·ä½çš„é—®é¢˜ï¼‰ï¼Œå…·ä½“åŸå› å¯ä»¥çœ‹ï¼š\nhttps://pages.cs.wisc.edu/~markhill/cs354/Fall2008/beyond354/int.mult.html\nç¨‹åº, è¿è¡Œæ—¶ç¯å¢ƒä¸AM åº”ç”¨ç¨‹åºçš„è¿è¡Œéœ€è¦è¿è¡Œæ—¶ç¯å¢ƒçš„æ”¯æŒ, åŒ…æ‹¬åŠ è½½, é”€æ¯ç¨‹åº, ä»¥åŠæä¾›ç¨‹åºè¿è¡Œæ—¶çš„å„ç§åŠ¨æ€é“¾æ¥åº“(ä½ ç»å¸¸ä½¿ç”¨çš„åº“å‡½æ•°å°±æ˜¯è¿è¡Œæ—¶ç¯å¢ƒæä¾›çš„)ç­‰. ä¸ºäº†è®©å®¢æˆ·ç¨‹åºåœ¨NEMUä¸­è¿è¡Œ, ç°åœ¨éœ€è¦ç›¸åº”çš„è¿è¡Œæ—¶ç¯å¢ƒçš„æ”¯æŒäº†.\nè®¡ç®—æœºå¯ä»¥æ°¸ä¸åœæ­¢åœ°æ‰§è¡ŒæŒ‡ä»¤, ä½†ä¸€èˆ¬çš„ç¨‹åºéƒ½æ˜¯ä¼šç»“æŸçš„, æ‰€ä»¥è¿è¡Œæ—¶ç¯å¢ƒéœ€è¦å‘ç¨‹åºæä¾›ä¸€ç§ç»“æŸè¿è¡Œçš„æ–¹æ³•. PA1ä¸­æåˆ°çš„é‚£æ¡äººå·¥æ·»åŠ çš„nemu_trapæŒ‡ä»¤, å°±æ˜¯è®©ç¨‹åºæ¥ç»“æŸè¿è¡Œçš„.\nåªè¦æœ‰å†…å­˜, æœ‰ç»“æŸè¿è¡Œçš„æ–¹å¼, åŠ ä¸Šå®ç°æ­£ç¡®çš„æŒ‡ä»¤, å°±å¯ä»¥æ”¯æ’‘æœ€ç®€å•ç¨‹åºçš„è¿è¡Œäº†. è€Œè¿™, ä¹Ÿå¯ä»¥ç®—æ˜¯æœ€ç®€å•çš„è¿è¡Œæ—¶ç¯å¢ƒäº†.\nå°†è¿è¡Œæ—¶ç¯å¢ƒå°è£…æˆåº“å‡½æ•° é€šè¿‡åº“, è¿è¡Œç¨‹åºæ‰€éœ€è¦çš„å…¬å…±è¦ç´ è¢«æŠ½è±¡æˆAPI, ä¸åŒçš„æ¶æ„åªéœ€è¦å®ç°è¿™äº›API, ä¹Ÿå°±ç›¸å½“äºå®ç°äº†æ”¯æ’‘ç¨‹åºè¿è¡Œçš„è¿è¡Œæ—¶ç¯å¢ƒ, è¿™æå‡äº†ç¨‹åºå¼€å‘çš„æ•ˆç‡: éœ€è¦çš„æ—¶å€™åªè¦è°ƒç”¨è¿™äº›API, å°±èƒ½ä½¿ç”¨è¿è¡Œæ—¶ç¯å¢ƒæä¾›çš„ç›¸åº”åŠŸèƒ½.\nAM - è£¸æœº(bare-metal)è¿è¡Œæ—¶ç¯å¢ƒ åº”ç”¨ç¨‹åºçš„è¿è¡Œéƒ½éœ€è¦è¿è¡Œæ—¶ç¯å¢ƒçš„æ”¯æŒ; åªè¿›è¡Œçº¯ç²¹è®¡ç®—ä»»åŠ¡çš„ç¨‹åºåœ¨TRMä¸Šå°±å¯ä»¥è¿è¡Œ\næ›´é«˜çº§çš„æ¸¸æˆéœ€è¦è¿è¡Œæ—¶ç¯å¢ƒæä¾›è¾“å…¥è¾“å‡ºç­‰çš„æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†è¿™äº›éœ€æ±‚ï¼Œç»Ÿä¸€æˆä¸€ä¸ªAPIç»™ç¨‹åºï¼Œè¿™æ ·å°±å¯ä»¥æ”¯æ’‘ä¸åŒç¨‹åºåœ¨å„ç§æ¶æ„ä¸Šè¿è¡Œçš„åº“ã€‚\næ¯ä¸ªæ¶æ„éƒ½æŒ‰ç…§å®ƒä»¬çš„ç‰¹æ€§å®ç°è¿™ç»„API; åº”ç”¨ç¨‹åºåªéœ€è¦ç›´æ¥è°ƒç”¨è¿™ç»„APIå³å¯, æ— éœ€å…³å¿ƒè‡ªå·±å°†æ¥è¿è¡Œåœ¨å“ªä¸ªæ¶æ„ä¸Š. ç”±äºè¿™ç»„ç»Ÿä¸€æŠ½è±¡çš„APIä»£è¡¨äº†ç¨‹åºè¿è¡Œå¯¹è®¡ç®—æœºçš„éœ€æ±‚, æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ç»„APIç§°ä¸ºæŠ½è±¡è®¡ç®—æœº\nAM(Abstract machine)é¡¹ç›®å°±æ˜¯è¿™æ ·è¯ç”Ÿçš„. ä½œä¸ºä¸€ä¸ªå‘ç¨‹åºæä¾›è¿è¡Œæ—¶ç¯å¢ƒçš„åº“, AMæ ¹æ®ç¨‹åºçš„éœ€æ±‚æŠŠåº“åˆ’åˆ†æˆä»¥ä¸‹æ¨¡å—\nAM = TRM + IOE + CTE + VME + MPE\nTRM(Turing Machine) - å›¾çµæœº, æœ€ç®€å•çš„è¿è¡Œæ—¶ç¯å¢ƒ, ä¸ºç¨‹åºæä¾›åŸºæœ¬çš„è®¡ç®—èƒ½åŠ›\nIOE(I/O Extension) - è¾“å…¥è¾“å‡ºæ‰©å±•, ä¸ºç¨‹åºæä¾›è¾“å‡ºè¾“å…¥çš„èƒ½åŠ›\nCTE(Context Extension) - ä¸Šä¸‹æ–‡æ‰©å±•, ä¸ºç¨‹åºæä¾›ä¸Šä¸‹æ–‡ç®¡ç†çš„èƒ½åŠ›\nVME(Virtual Memory Extension) - è™šå­˜æ‰©å±•, ä¸ºç¨‹åºæä¾›è™šå­˜ç®¡ç†çš„èƒ½åŠ›\nMPE(Multi-Processor Extension) - å¤šå¤„ç†å™¨æ‰©å±•, ä¸ºç¨‹åºæä¾›å¤šå¤„ç†å™¨é€šä¿¡çš„èƒ½åŠ› (MPEè¶…å‡ºäº†ICSè¯¾ç¨‹çš„èŒƒå›´, åœ¨PAä¸­ä¸ä¼šæ¶‰åŠ)\nè§£è€¦å’Œåˆ†å±‚çš„è‰ºæœ¯ï¼\n(åœ¨NEMUä¸­)å®ç°ç¡¬ä»¶åŠŸèƒ½ -\u0026gt; (åœ¨AMä¸­)æä¾›è¿è¡Œæ—¶ç¯å¢ƒ -\u0026gt; (åœ¨APPå±‚)è¿è¡Œç¨‹åº\n(åœ¨NEMUä¸­)å®ç°æ›´å¼ºå¤§çš„ç¡¬ä»¶åŠŸèƒ½ -\u0026gt; (åœ¨AMä¸­)æä¾›æ›´ä¸°å¯Œçš„è¿è¡Œæ—¶ç¯å¢ƒ -\u0026gt; (åœ¨APPå±‚)è¿è¡Œæ›´å¤æ‚çš„ç¨‹åº\næ•´ä¸ªAMé¡¹ç›®åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†:\nabstract-machine/am/ - ä¸åŒæ¶æ„çš„AM APIå®ç°, ç›®å‰æˆ‘ä»¬åªéœ€è¦å…³æ³¨NEMUç›¸å…³çš„å†…å®¹å³å¯. æ­¤å¤–, abstract-machine/am/include/am.håˆ—å‡ºäº†AMä¸­çš„æ‰€æœ‰API, æˆ‘ä»¬ä¼šåœ¨åç»­é€ä¸€ä»‹ç»å®ƒä»¬.\nabstract-machine/klib/ - ä¸€äº›æ¶æ„æ— å…³çš„åº“å‡½æ•°, æ–¹ä¾¿åº”ç”¨ç¨‹åºçš„å¼€å‘\né˜…è¯»abstract-machine/am/src/platform/nemu/trm.cä¸­çš„ä»£ç , ä½ ä¼šå‘ç°åªéœ€è¦å®ç°å¾ˆå°‘çš„APIå°±å¯ä»¥æ”¯æ’‘èµ·ç¨‹åºåœ¨TRMä¸Šè¿è¡Œäº†:\nArea heapç»“æ„ç”¨äºæŒ‡ç¤ºå †åŒºçš„èµ·å§‹å’Œæœ«å°¾\nvoid putch(char ch)ç”¨äºè¾“å‡ºä¸€ä¸ªå­—ç¬¦\nvoid halt(int code)ç”¨äºç»“æŸç¨‹åºçš„è¿è¡Œ\nvoid _trm_init()ç”¨äºè¿›è¡ŒTRMç›¸å…³çš„åˆå§‹åŒ–å·¥ä½œ\n#include \u0026lt;am.h\u0026gt; #include \u0026lt;nemu.h\u0026gt; extern char _heap_start; int main(const char *args); Area heap = RANGE(\u0026amp;_heap_start, PMEM_END); #ifndef MAINARGS #define MAINARGS \u0026#34;\u0026#34; #endif static const char mainargs[] = MAINARGS; void putch(char ch) { outb(SERIAL_PORT, ch); } void halt(int code) { nemu_trap(code); // should not reach here while (1); } void _trm_init() { int ret = main(mainargs); halt(ret); } æœ€åæ¥çœ‹çœ‹halt(). halt()é‡Œé¢è°ƒç”¨äº†nemu_trap()å® (åœ¨abstract-machine/am/src/platform/nemu/include/nemu.hä¸­å®šä¹‰), è¿™ä¸ªå®å±•å¼€ä¹‹åæ˜¯ä¸€æ¡å†…è”æ±‡ç¼–è¯­å¥, å†…è”æ±‡ç¼–è¯­å¥å…è®¸æˆ‘ä»¬åœ¨Cä»£ç ä¸­åµŒå…¥æ±‡ç¼–è¯­å¥, æ˜¾ç„¶, è¿™ä¸ªå®çš„å®šä¹‰æ˜¯å’ŒISAç›¸å…³çš„.\nè¿™æ¡ç‰¹æ®Šçš„æŒ‡ä»¤æ˜¯äººä¸ºæ·»åŠ çš„, æ ‡å‡†çš„æ±‡ç¼–å™¨å¹¶ä¸èƒ½è¯†åˆ«å®ƒ, objdumpçš„åæ±‡ç¼–ç»“æœä¹Ÿæ— æ³•æŒ‰ç…§æˆ‘ä»¬çš„æƒ³æ³•å°†å…¶åæ±‡ç¼–ä¸ºnemu_trap. nemu_trap()å®è¿˜ä¼šæŠŠä¸€ä¸ªæ ‡è¯†ç»“æŸçš„ç»“æŸç ç§»åŠ¨åˆ°é€šç”¨å¯„å­˜å™¨ä¸­, è¿™æ ·, è¿™æ®µæ±‡ç¼–ä»£ç çš„åŠŸèƒ½å°±å’Œnemu/src/isa/$ISA/instr/special.h ä¸­çš„æ‰§è¡Œè¾…åŠ©å‡½æ•°def_EHelper(nemu_trap)å¯¹åº”èµ·æ¥äº†: é€šç”¨å¯„å­˜å™¨ä¸­çš„å€¼å°†ä¼šä½œä¸ºå‚æ•°ä¼ ç»™rtl_hostcall, rtl_hostcallå°†ä¼šæ ¹æ®ä¼ å…¥çš„id(æ­¤å¤„ä¸ºHOSTCALL_EXIT)æ¥è°ƒç”¨set_nemu_state(), å°†halt()ä¸­çš„ç»“æŸç è®¾ç½®åˆ°NEMUçš„monitorä¸­, monitorå°†ä¼šæ ¹æ®ç»“æŸç æ¥æŠ¥å‘Šç¨‹åºç»“æŸçš„åŸå› .\nï¼ˆåœ¨å“ªç»“æŸï¼Œä¸ºä»€ä¹ˆç»“æŸï¼‰\nç¼–è¯‘ç”Ÿæˆä¸€ä¸ªå¯ä»¥åœ¨NEMUçš„è¿è¡Œæ—¶ç¯å¢ƒä¸Šè¿è¡Œçš„ç¨‹åºçš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹:\nï¼ˆè¿™éƒ¨åˆ†çœ‹å¾—æˆ‘å¤´ç—›ï¼‰\ngccå°†$ISA-nemuçš„AMå®ç°æºæ–‡ä»¶ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶, ç„¶åé€šè¿‡arå°†è¿™äº›ç›®æ ‡æ–‡ä»¶ä½œä¸ºä¸€ä¸ªåº“, æ‰“åŒ…æˆä¸€ä¸ªå½’æ¡£æ–‡ä»¶abstract-machine/am/build/am-$ISA-nemu.a\ngccæŠŠåº”ç”¨ç¨‹åºæºæ–‡ä»¶(å¦‚am-kernels/tests/cpu-tests/tests/dummy.c)ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶\né€šè¿‡gccå’ŒaræŠŠç¨‹åºä¾èµ–çš„è¿è¡Œåº“(å¦‚abstract-machine/klib/)ä¹Ÿç¼–è¯‘å¹¶æ‰“åŒ…æˆå½’æ¡£æ–‡ä»¶\næ ¹æ®Makefileæ–‡ä»¶abstract-machine/scripts/$ISA-nemu.mkä¸­çš„æŒ‡ç¤º, è®©ldæ ¹æ®é“¾æ¥è„šæœ¬abstract-machine/scripts/linker.ld, å°†ä¸Šè¿°ç›®æ ‡æ–‡ä»¶å’Œå½’æ¡£æ–‡ä»¶é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶\næ ¹æ®ä¸Šè¿°é“¾æ¥è„šæœ¬çš„æŒ‡ç¤º, å¯æ‰§è¡Œç¨‹åºé‡å®šä½åçš„èŠ‚ä»0x100000æˆ–0x80000000å¼€å§‹ (å–å†³äº_pmem_startå’Œ_entry_offsetçš„å€¼), é¦–å…ˆæ˜¯.textèŠ‚, å…¶ä¸­åˆä»¥abstract-machine/am/src/$ISA/nemu/start.Sä¸­è‡ªå®šä¹‰çš„entryèŠ‚å¼€å§‹, ç„¶åæ¥ä¸‹æ¥æ˜¯å…¶å®ƒç›®æ ‡æ–‡ä»¶çš„.textèŠ‚. è¿™æ ·, å¯æ‰§è¡Œç¨‹åºèµ·å§‹å¤„æ€»æ˜¯æ”¾ç½®start.Sçš„ä»£ç , è€Œä¸æ˜¯å…¶å®ƒä»£ç , ä¿è¯å®¢æˆ·ç¨‹åºæ€»èƒ½ä»start.Så¼€å§‹æ­£ç¡®æ‰§è¡Œ. é“¾æ¥è„šæœ¬ä¹Ÿå®šä¹‰äº†å…¶å®ƒèŠ‚(åŒ…æ‹¬.rodata, .data, .bss)çš„é“¾æ¥é¡ºåº, è¿˜å®šä¹‰äº†ä¸€äº›å…³äºä½ç½®ä¿¡æ¯çš„ç¬¦å·, åŒ…æ‹¬æ¯ä¸ªèŠ‚çš„æœ«å°¾, æ ˆé¡¶ä½ç½®, å †åŒºçš„èµ·å§‹å’Œæœ«å°¾.\næˆ‘ä»¬å¯¹ç¼–è¯‘å¾—åˆ°çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è¡Œä¸ºè¿›è¡Œç®€å•çš„æ¢³ç†:\nç¬¬ä¸€æ¡æŒ‡ä»¤ä»abstract-machine/am/src/$ISA/nemu/start.Så¼€å§‹, è®¾ç½®å¥½æ ˆé¡¶ä¹‹åå°±è·³è½¬åˆ°abstract-machine/am/src/platform/nemu/trm.cçš„_trm_init()å‡½æ•°å¤„æ‰§è¡Œ.\nåœ¨_trm_init()ä¸­è°ƒç”¨main()å‡½æ•°æ‰§è¡Œç¨‹åºçš„ä¸»ä½“åŠŸèƒ½, main()å‡½æ•°è¿˜å¸¦ä¸€ä¸ªå‚æ•°, ç›®å‰æˆ‘ä»¬æš‚æ—¶ä¸ä¼šç”¨åˆ°, åé¢æˆ‘ä»¬å†ä»‹ç»å®ƒ.\nä»main()å‡½æ•°è¿”å›å, è°ƒç”¨halt()ç»“æŸè¿è¡Œ.\næœ‰äº†TRMè¿™ä¸ªç®€å•çš„è¿è¡Œæ—¶ç¯å¢ƒ, æˆ‘ä»¬å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ä¸Šé¢è¿è¡Œå„ç§\u0026quot;ç®€å•\u0026quot;çš„ç¨‹åºäº†. å½“ç„¶, æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿è¡Œ\u0026quot;ä¸ç®€å•\u0026quot;çš„ç¨‹åº: æˆ‘ä»¬å¯ä»¥å®ç°ä»»æ„å¤æ‚çš„ç®—æ³•, ç”šè‡³æ˜¯å„ç§ç†è®ºä¸Šå¯è®¡ç®—çš„é—®é¢˜, éƒ½å¯ä»¥åœ¨TRMä¸Šè§£å†³.\nå®ç°æ›´å¤šåº“å‡½æ•° ç»è¿‡å“­å¤©å–Šåœ°çš„å®ç°ç»ˆäºã€‚ã€‚ã€‚ã€‚ã€‚ï¼ˆsprintfå®åœ¨æ˜¯éš¾åº¦å¤ªå¤§ï¼Œæˆ‘ä»ç½‘ä¸Šæ‰¾äº†å¥½ä¹…æ‰¾åˆ°ä¸€ä¸ªæœ€å°å®ç°printfé­”æ”¹äº†ä¸€ä¸‹ï¼Œç­‰æ›´å¼ºäº†å†æ¥ç†è§£ï¼Œå®é™…ä¸Šæ˜¯è¦ç†è§£å¯å˜å‚æ•°ç®¡ç†ä¹‹ç±»çš„æ‰èƒ½è§£ç­”ã€‚ï¼‰\næ‰¹é‡æµ‹è¯•é€šè¿‡ åšä¸ªçºªå¿µ:) ï¼ˆåšISAçš„æ—¶å€™çœŸçš„æ„Ÿè§‰äººè¦æ²¡äº†ï¼Œä½†æ˜¯å°±è¿™æ ·æ…¢æ…¢å‰è¿›è¿˜æ˜¯çœ‹åˆ°äº†æ›™å…‰ï¼‰ ï¼š\né‡æ–°è®¤è¯†è®¡ç®—æœº: è®¡ç®—æœºæ˜¯ä¸ªæŠ½è±¡å±‚ å¾®è§‚è§†è§’: ç¨‹åºæ˜¯ä¸ªçŠ¶æ€æœº å®è§‚è§†è§’: è®¡ç®—æœºæ˜¯ä¸ªæŠ½è±¡å±‚\nå¤§å®¶åœ¨åšå®éªŒçš„æ—¶å€™ä¹Ÿå¯ä»¥å¤šå¤šæ€è€ƒ: æˆ‘ç°åœ¨å†™çš„ä»£ç ç©¶ç«Ÿä½äºå“ªä¸€ä¸ªæŠ½è±¡å±‚? ä»£ç çš„å…·ä½“è¡Œä¸ºç©¶ç«Ÿæ˜¯ä»€ä¹ˆ?\nçŠ¶æ€æœºè§†è§’å¯ä»¥ä»æŒ‡ä»¤å±‚æ¬¡ç²¾ç¡®åœ°æè¿°ç¨‹åºè¿è¡Œçš„æ¯ä¸€å¤„ç»†èŠ‚, ä½†ä¸¢å¤±äº†ç¨‹åºçš„è¯­ä¹‰. ä¸ºäº†æ›´å¥½åœ°ç†è§£å¤æ‚ç¨‹åº, æˆ‘ä»¬éœ€è¦ä»ä¸€ä¸ªæ–°çš„è§†è§’æ¥åˆ‡å…¥.\nå…ˆæ¥è®¨è®ºåœ¨TRMä¸Šè¿è¡Œçš„ç¨‹åº, çœ‹è®¡ç®—æœºç³»ç»Ÿæ˜¯å¦‚ä½•æ”¯æ’‘è¿™äº›éœ€æ±‚çš„.\nTRM è®¡ç®— å†…å­˜ç”³è¯· ç»“æŸè¿è¡Œ æ‰“å°ä¿¡æ¯ è¿è¡Œç¯å¢ƒ - malloc()/free() - printf() AM API - heap halt() putch() ISAæ¥å£ æŒ‡ä»¤ ç‰©ç†å†…å­˜åœ°å€ç©ºé—´ nemu_trapæŒ‡ä»¤ I/Oæ–¹å¼ ç¡¬ä»¶æ¨¡å— å¤„ç†å™¨ ç‰©ç†å†…å­˜ Monitor ä¸²å£ ç”µè·¯å®ç° cpu_exec() pmem[] nemu_state serial_io_handler() è®¡ç®—. è¿™æ˜¯ç¨‹åºæœ€åŸºæœ¬çš„éœ€æ±‚, ä»¥è‡³äºå®ƒç”šè‡³ä¸å±äºè¿è¡Œæ—¶ç¯å¢ƒå’ŒAMçš„èŒƒç•´. æ‰€æœ‰è®¡ç®—ç›¸å…³çš„ä»£ç (é¡ºåºè¯­å¥, åˆ†æ”¯, å¾ªç¯, å‡½æ•°è°ƒç”¨ç­‰), éƒ½ä¼šè¢«ç¼–è¯‘å™¨ç¼–è¯‘æˆåŠŸèƒ½ç­‰ä»·çš„æŒ‡ä»¤åºåˆ—, æœ€ç»ˆåœ¨CPUä¸Šæ‰§è¡Œ. åœ¨NEMUä¸­, æˆ‘ä»¬é€šè¿‡cpu_exec()å‡½æ•°æ¥å®ç°\u0026quot;CPUæ‰§è¡ŒæŒ‡ä»¤\u0026quot;çš„åŠŸèƒ½.\nå†…å­˜ç”³è¯·. æœ‰çš„ç¨‹åºéœ€è¦åœ¨è¿è¡Œæ—¶åˆ»åŠ¨æ€åœ°ç”³è¯·å†…å­˜æ¥ä½¿ç”¨. å’Œlibcç±»ä¼¼, klibæä¾›äº†malloc()å’Œfree()æ¥å®ç°å†…å­˜çš„åŠ¨æ€ç®¡ç†(ä½ å°†æ¥ä¼šå®ç°å®ƒä»¬), å®ƒä»¬åˆä¼šä½¿ç”¨TRMä¸­æä¾›çš„API heapæ¥è·å¾—å †åŒºçš„èµ·å§‹å’Œæœ«å°¾. è€Œheapçš„åŒºé—´åˆæ˜¯ç”±ISA-å¹³å°è¿™ä¸ªäºŒå…ƒç»„å¯¹åº”çš„ç‰©ç†å†…å­˜åœ°å€ç©ºé—´æ¥å†³å®šçš„. è¿™ä¸€åœ°å€ç©ºé—´å¯¹åº”ç€ç‰©ç†å†…å­˜çš„å¤§å°, åœ¨NEMUä¸­, å®ƒå°±æ˜¯å¤§æ•°ç»„pmem[]çš„å¤§å°.\nç»“æŸè¿è¡Œ. ä¸€èˆ¬ç¨‹åºéƒ½ä¼šæœ‰ç»“æŸè¿è¡Œçš„æ—¶å€™, TRMæä¾›äº†ä¸€ä¸ªhalt()çš„APIæ¥å®ç°è¿™ä¸€åŠŸèƒ½. ç”±äºè¿™ä¸ªéœ€æ±‚è¿‡äºç®€å•, å› æ­¤æ— éœ€è¿è¡Œæ—¶ç¯å¢ƒæä¾›æ›´å¤æ‚çš„æ¥å£. halt()çš„å…·ä½“å®ç°å’ŒISAæœ‰å…³, æˆ‘ä»¬ä½¿ç”¨äº†äººä¸ºæ·»åŠ çš„nemu_trapæŒ‡ä»¤æ¥å®ç°è¿™ä¸€ç‚¹. æ‰§è¡Œnemu_trapæŒ‡ä»¤ä¼šè®©NEMUä»CPUæ‰§è¡ŒæŒ‡ä»¤çš„å¾ªç¯ä¸­è·³å‡º, è¿”å›åˆ°Monitorä¸­, è¿™æ˜¯é€šè¿‡è®¾ç½®Monitorä¸­çš„ä¸€ä¸ªçŠ¶æ€å˜é‡nemu_stateæ¥å®ç°çš„.\næ‰“å°ä¿¡æ¯. è¾“å‡ºæ˜¯ç¨‹åºçš„å¦ä¸€ä¸ªåŸºæœ¬éœ€æ±‚. ç¨‹åºå¯ä»¥è°ƒç”¨klibä¸­çš„printf()æ¥è¾“å‡º, å®ƒä¼šé€šè¿‡TRMçš„API putch()æ¥è¾“å‡ºå­—ç¬¦. ä¸åŒçš„ISA-å¹³å°æœ‰ä¸åŒçš„å­—ç¬¦è¾“å‡ºæ–¹å¼, åœ¨$ISA-nemuä¸­, putch()é€šè¿‡I/Oç›¸å…³çš„æŒ‡ä»¤æŠŠå­—ç¬¦å†™å…¥åˆ°ä¸²å£, æœ€ç»ˆåœ¨NEMUä¸­é€šè¿‡serial_io_handler()å°†å­—ç¬¦æ‰“å°åˆ°ç»ˆç«¯. å…³äºè¾“å…¥è¾“å‡ºçš„æ›´å¤šç»†èŠ‚ä¼šåœ¨PA2çš„æœ€åéƒ¨åˆ†è¿›è¡Œä»‹ç».\næ¯ä¸€å±‚æŠ½è±¡éƒ½æœ‰å®ƒå­˜åœ¨çš„ç†ç”±:\næ¦‚å¿µç›¸åŒçš„ä¸€ä¸ªç¡¬ä»¶æ¨¡å—æœ‰ç€ä¸åŒçš„å®ç°æ–¹å¼, æ¯”å¦‚å¤„ç†å™¨æ—¢å¯ä»¥é€šè¿‡NEMUä¸­ç®€å•çš„è§£é‡Šæ–¹å¼æ¥å®ç°, ä¹Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼QEMUä¸­é«˜æ€§èƒ½çš„äºŒè¿›åˆ¶ç¿»è¯‘æ–¹å¼æ¥å®ç°, ç”šè‡³å¯ä»¥é€šè¿‡verilogç­‰ç¡¬ä»¶æè¿°è¯­è¨€æ¥å®ç°ä¸€ä¸ªçœŸå®çš„å¤„ç†å™¨.\nISAæ˜¯ç¡¬ä»¶å‘è½¯ä»¶æä¾›çš„å¯ä»¥æ“ä½œç¡¬ä»¶çš„æ¥å£\nAMçš„APIå¯¹ä¸åŒISA(å¦‚x86/mips32/riscv32)çš„æ¥å£è¿›è¡Œäº†æŠ½è±¡, ä¸ºä¸Šå±‚çš„ç¨‹åºå±è”½ISAç›¸å…³çš„ç»†èŠ‚\nè¿è¡Œæ—¶ç¯å¢ƒå¯ä»¥é€šè¿‡å¯¹AMçš„APIè¿›è¡Œè¿›ä¸€æ­¥çš„å°è£…, å‘ç¨‹åºæä¾›æ›´æ–¹ä¾¿çš„åŠŸèƒ½\nå¯¹AMçš„è¿›ä¸€æ­¥ç†è§£ï¼ˆå¾…å®Œæˆ æš‚æ—¶å¾…å¡«å‘ã€‚ã€‚ã€‚\n","date":"2022-08-12T21:50:40+08:00","permalink":"https://sanbuphy.github.io/p/nju%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%BE%E7%A8%8B%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C-pa2%E7%AC%94%E8%AE%B0%E4%B8%80/","title":"NJUè®¡ç®—æœºè¯¾ç¨‹åŸºç¡€å®éªŒ PA2ç¬”è®°ï¼ˆä¸€ï¼‰"},{"content":"ä¸€äº›å°å·¥å…· è®©ä½ èƒ½åšå‡ºå’Œjyyä¸€æ ·çš„ä¼˜é›…pptï¼šhttps://sli.dev/\nä»£æ›¿grepçš„è¶…çº§å‘½ä»¤è¡Œå·¥å…·â€”â€”ripgrepï¼šhttps://github.com/BurntSushi/ripgrep\nripgrep is a line-oriented search tool that recursively searches the current directory for a regex pattern. By default, ripgrep will respect gitignore rules and automatically skip hidden files/directories and binary files. ripgrep has first class support on Windows, macOS and Linux, with binary downloads available for every release. ripgrep is similar to other popular search tools like The Silver Searcher, ack and grep.\nç½‘ç»œåŒ…åˆ†æâ€”â€”Wiresharkï¼šhttps://www.cnblogs.com/linyfeng/p/9496126.html #########å¾…æ›´æ–°\n","date":"2022-07-31T11:48:46+08:00","permalink":"https://sanbuphy.github.io/p/%E6%8E%A8%E8%8D%90%E5%B0%9D%E8%AF%95%E7%9A%84%E5%B0%8F%E5%B7%A5%E5%85%B7/","title":"æ¨èå°è¯•çš„å°å·¥å…·"},{"content":"è¯¦ç»†çš„ç¼“å†²åŒºä»‹ç»è¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼Œéå¸¸è¯¦ç»† https://www.cnblogs.com/lanhaicode/p/10575049.html\nå…¨ç¼“å†²ï¼šå½“ç¼“å†²åŒºè¢«å¡«æ»¡ä»¥åæ‰è¿›è¡ŒçœŸæ­£çš„è¾“å…¥è¾“å‡ºæ“ä½œ\nè¡Œç¼“å†²ï¼šå½“åœ¨è¾“å…¥æˆ–è€…è¾“å‡ºçš„è¿‡ç¨‹ä¸­é‡åˆ°æ¢è¡Œç¬¦æ—¶ï¼Œæ‰æ‰§è¡ŒçœŸæ­£çš„è¾“å…¥è¾“å‡ºæ“ä½œ\næ— ç¼“å†²ï¼šæ²¡æœ‰ç¼“å†²åŒºï¼Œç«‹å³è¿›è¡Œè¾“å…¥è¾“å‡º\nå®é™…ä¸Šprintfæ˜¯è¡Œç¼“å†²ï¼Œå¦‚æœprintf(\u0026quot;hello\u0026quot;)è€Œä¸åŠ ä¸Š\\næ˜¯ä¸ä¼šå‡ºç°ç»“æœçš„(ä¹‹å‰åœ¨fork()çš„æ—¶å€™é‡åˆ°è¿™ä¸ªé—®é¢˜)\nä½†ä¸ºä»€ä¹ˆæˆ‘ä»¬ç›´æ¥çœ‹ç»“æœæ˜¯ä¼šå‡ºç°çš„å‘¢ï¼Ÿ\nåŸå› æ˜¯æ ‡å‡†è¾“å‡ºåœ¨ç¨‹åºæ­£å¸¸é€€å‡ºçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ fclose(stdout)ï¼Œè€Œ fclose å‡½æ•°ä¼šè°ƒç”¨ fflushã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„ç¨‹åºæå‰å´©æºƒäº†ï¼Œé‚£æ˜¯çœ‹ä¸åˆ°ç¼“å†²åŒºä¸­çš„å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ä¸Šçš„ã€‚ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œexitï¼ˆæ­£å¸¸é€€å‡ºï¼‰çš„è¯ä¼šè¾“å‡ºï¼Œexitåœ¨è°ƒç”¨ç³»ç»Ÿ_exit ä¹‹å‰ï¼Œé¦–å…ˆè°ƒç”¨é€€å‡ºå¤„ç†å‡½æ•°ï¼Œåˆ·æ–°I/Oç¼“å†²ï¼Œå…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œæœ€åè°ƒç”¨_exit é€€å‡ºè¿›ç¨‹ï¼›_exitï¼ˆç«‹å³ç»ˆæ­¢è¿›ç¨‹ï¼‰ä¸ä¼šè¾“å‡ºç¼“å†²åŒºã€‚\nå¾…è¡¥å……å†…å®¹ï¼šforkè¯•éªŒä¸‹printfå¤±æ•ˆçš„åŸç†ï¼ˆjyyæŸä¸€è¯¾ https://blog.csdn.net/takashi77/article/details/108077328\nå¾…è¡¥å……å†…å®¹ï¼šå¸¸è§IOçš„ç¼“å†²åˆ†ç±» ","date":"2022-07-31T11:33:06+08:00","permalink":"https://sanbuphy.github.io/p/c%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86io%E7%9A%84%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BB%8B%E7%BB%8D/","title":"Cè¯­è¨€æ ‡å‡†IOçš„ç¼“å†²åŒºä»‹ç»"},{"content":"åœ¨åšPAçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°è¿™æ ·çš„ä¸€æ®µä»£ç ï¼ˆæ¨¡æ‹Ÿcpuçš„è¿‡ç¨‹ï¼‰ï¼š\né‚£ä¹ˆé—®é¢˜å°±æ¥äº†â€”â€”ä¸ºä»€ä¹ˆè¿™é‡Œopä½æ®µä¼šè‡ªåŠ¨åŒ¹é…å‰é¢çš„éƒ¨åˆ†ï¼Ÿï¼ˆä¸ºä»€ä¹ˆä¸åŒ¹é…åé¢ï¼‰ å’Œå¤§ç«¯æ³•æœ‰å…³ç³»å—ï¼Ÿ\næˆ‘æ€€ç–‘å°±æ˜¯å°ç«¯å®šä¹‰ï¼Œä½†ä¸æ˜ç™½åŸå› ï¼Œäºæ˜¯å¼€å§‹äº†æ¼«é•¿çš„æœç´¢\u0026hellip;..\nï¼ˆç›´æ¥çœ‹ç»“æœã€ä¸ä¸€å®šå¯¹ï¼Œå¦‚æœæœ‰ç–‘é—®æ¬¢è¿æå‡ºä¸€èµ·è®¨è®ºï¼Œè°¢è°¢ï¼Œæˆ‘å¯¹ç¼–è¯‘å™¨ä¹Ÿä¸ç†Ÿæ‚‰ã€‘ï¼‰ï¼š\næˆ‘è®¤ä¸ºbit fieldçš„åå‘è¯»å–æœ¬è´¨ä¸Šä¹Ÿæ˜¯ç”±äºè®¡ç®—æœºç»“æ„å¤§å°ç«¯å®ç°çš„ï¼Œç¼–è¯‘å™¨ä¼šå…ˆçœ‹æœºå™¨æ˜¯å¦æœ‰å®šä¹‰å½“ç„¶ä¹Ÿå¯ä»¥æ”¹å˜å®šä¹‰ï¼ŒCè¯­è¨€æ ‡å‡†ä¸­æœ¬èº«æ²¡æœ‰å®šä¹‰ã€‚ï¼‰\næŸ¥åˆ°äº†ä¹Ÿæœ‰äººé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼š åœ¨ä¸€ä¸ªç¼–è¯‘å™¨çš„ç½‘ç«™ä¸‹ï¼Œæˆ‘å‘ç°äº†è¿™æ ·ä¸€æ®µè¯ï¼š\nFor big-endian mode, bit fields are packed into registers from most significant bit (MSB) to least significant bit (LSB) in the order in which they are defined. Bit fields are packed in memory from most significant byte (MSbyte) to least significant byte (LSbyte). For little-endian mode, bit fields are packed into registers from the LSB to the MSB in the order in which they are defined, and packed in memory from LSbyte to MSbyte.\né‚£æ­¤æ—¶æˆ‘ä»¬çŸ¥é“ç¡®å®å¯èƒ½å’Œå¤§å°ç«¯æ³•æ˜¯æœ‰å…³çš„,è‡³å°‘åœ¨Cè¯­è¨€ä¸Šæ˜¯è¿™æ ·çš„ã€‚è€ŒC++ä¸Šåªç»™äº†è¯´æ˜ï¼Œæ²¡æœ‰ä¸ºä»€ä¹ˆï¼Œåªç»™å‡ºäº†å®šä¹‰ã€‚\nä½†é—®é¢˜åˆæ¥äº†ï¼Œä¸€èˆ¬æœºå™¨ä¸­å¤§å°ç«¯çœ‹çš„æ˜¯å­—èŠ‚æ’åºï¼Œä½†æ˜¯æˆ‘å‘çš„ä½åŸŸæ˜¯å¯¹ä¸€ä¸ªå­—èŠ‚è¿›è¡Œåˆ’åˆ†ï¼Œä¸€ä¸ªå­—èŠ‚å†…çš„bitä¹Ÿè¦éµå¾ªå¤§å°ç«¯æ’åºå—ï¼Ÿ\nåœ¨æŸ¥é˜…Cæ ‡å‡†ä¸­æˆ‘å‘ç°åŸæ¥è¿™ä¸ªä½åŸŸæ’å¸ƒæ˜¯implementation-dependentçš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸ç®¡æ€ä¹ˆæ ·ï¼Œé¦–å…ˆä½åŸŸæ’å¸ƒæ˜¯Cæ ‡å‡†æ²¡æœ‰æ˜ç¡®å®šä¹‰çš„ï¼Œå–å†³äºç¼–è¯‘å™¨ï¼‰ Implementation dependent means that the standard says nothing about some occurance in C/C++ and leaves the choice up to the people who create compilers and operating systems. It means that what you use on one system/compiler may not work the same way on another, but the behavior is well defined for that particular implementation. For example, whether the result of a right bitwise shift on a signed variable results in a logical or arithmetic shift is implementation defined.\né‚£ä¹ˆæˆ‘ä»¬çš„æ£€ç´¢èŒƒå›´å°±å¯ä»¥ç¼©å°äº†ï¼Œåªè¦çŸ¥é“è¿™ä¸ªè¡Œä¸ºæ˜¯ä¸æ˜¯ç¼–è¯‘å™¨è§„å®šçš„å³å¯ã€‚\nç»§ç»­æŸ¥çœ‹GCCçš„æ‰‹å†Œ\nThis represents a reference to a sign-extended bit-field contained or starting in loc (a memory or register reference). The bit-field is size bits wide and starts at bit pos. The compilation option BITS_BIG_ENDIAN says which end of the memory unit pos counts from.\nç­”æ¡ˆå¾ˆæ¥è¿‘äº†ï¼Œæˆ‘çŒœæƒ³åªè¦çŸ¥é“BITS_BIG_ENDIANæ˜¯åšä»€ä¹ˆçš„å³å¯\nåŒæ ·ç»§ç»­æŸ¥çœ‹GCCçš„æ‰‹å†ŒStorageLayout\nBITS_BIG_ENDIAN Define this macro to have the value 1 if the most significant bit in a byte has the lowest number; otherwise define it to have the value zero. This means that bit-field instructions count from the most significant bit. If the machine has no bit-field instructions, then this must still be defined, but it doesn\u0026rsquo;t matter which value it is defined to. This macro need not be a constant. This macro does not affect the way structure fields are packed into bytes or words; that is controlled by BYTES_BIG_ENDIAN.\né‡Œé¢å‡ºç°äº†â€œIf the machine has no bit-field instructionsâ€ï¼Œæ‰€ä»¥å€¾å‘äºè¿˜æ˜¯æœºå™¨ä¸ºå‡†çš„ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘è®¤ä¸ºbit fieldçš„åå‘è¯»å–æœ¬è´¨ä¸Šä¹Ÿæ˜¯ç”±äºè®¡ç®—æœºç»“æ„å¤§å°ç«¯å®ç°çš„ï¼Œç¼–è¯‘å™¨ä¼šå…ˆçœ‹æœºå™¨æ˜¯å¦æœ‰å®šä¹‰å½“ç„¶ä¹Ÿå¯ä»¥æ”¹å˜å®šä¹‰ï¼ŒCè¯­è¨€æ ‡å‡†ä¸­æœ¬èº«æ²¡æœ‰å®šä¹‰ã€‚\n","date":"2022-07-31T09:18:16+08:00","permalink":"https://sanbuphy.github.io/p/c%E4%BD%8D%E6%AE%B5/%E4%BD%8D%E5%9F%9Fbit-field%E7%9A%84%E6%8E%92%E5%BA%8F%E5%8E%9F%E7%90%86/","title":"Cä½æ®µ/ä½åŸŸ(bit field)çš„æ’åºåŸç†"},{"content":"å¼€å§‹æµ‹è¯•å¤šçº¿ç¨‹çš„æ£€æµ‹ä¸è‹±ä¼Ÿè¾¾æ¿å¡æ‹‰æµå‹åŠ›æµ‹è¯•ï¼Œæ‘„åƒå¤´ä¸å¤Ÿå°±ç”¨ç¬”è®°æœ¬ä¸Šã€‚æœ¬æ–‡å®ç°åŠŸèƒ½ï¼š\nå°†æœ¬åœ°æ‘„åƒå¤´ä½œä¸ºè®¾å¤‡è·å–å›¾åƒï¼Œç”¨ç”µè„‘å»ºç«‹æœåŠ¡å™¨æ¨é€rtspæµå¹¶åœ¨å…¶ä»–åŒç½‘æ®µç”µè„‘ä¸‹æ‹‰æµã€‚\nä½¿ç”¨è½¯ä»¶:\nFFmpeg(éŸ³è§†é¢‘ç¼–è§£ç ) EasyDarwin(æµåª’ä½“æœåŠ¡å™¨) å®Œæ•´å‚è€ƒä»¥ä¸‹æ–‡ç« å³å¯ï¼šï¼ˆè®°å¾—æ¨é€IPè¦æ”¹æˆæŒ‡å®šçš„ä¸€ä¸ªIPï¼Œè€Œä¸æ˜¯127é‚£æŒ‡çš„æ˜¯æœ¬åœ°IPï¼‰\nå¦‚æœä¸èƒ½è¿æ¥ï¼Œé™¤äº†pingä¹‹å¤–è¿˜è¦ç”¨curl ip:portæˆ–è€…telnetç­‰æ£€æµ‹ï¼Œå¦‚æœä¸è¡Œå°±æŠŠæ¨æµæœºçš„å…¬å…±é˜²ç«å¢™å…³é—­ã€‚ï¼ˆä¹‹å‰æˆ‘æ²¡æœ‰å…³é—­é˜²ç«å¢™æ˜¯ä¸èƒ½æ‹‰æµçš„ï¼‰\nå¦‚æœç”¨çš„æ˜¯ubuntuæ‹‰æµï¼Œè¿˜è¦çœ‹çœ‹æ˜¯ä¸æ˜¯è™šæ‹Ÿç½‘å¡æœ‰æ‰€å½±å“ï¼ˆè™šæ‹Ÿç½‘å¡çš„ipä¸åŒå¯èƒ½è®¿é—®ç­–ç•¥ä¼˜å…ˆï¼‰\nReference æµåª’ä½“æœåŠ¡å™¨é…ç½®ä¸ç®¡ç†â€”â€”ä½¿ç”¨FFmpegæ¨æµåˆ°EasyDarwinä¸­å†é€šè¿‡VLCè§‚çœ‹\nEasyDarwin+ffmpegè¿›è¡ŒPC(æ‘„åƒå¤´+éº¦å…‹é£)æµåª’ä½“ç›´æ’­æœåŠ¡\nffmpeg\u0026ndash;ä½¿ç”¨å‘½ä»¤+EasyDarwinæ¨æµç¬”è®°æœ¬æ‘„åƒå¤´\nEasyDarwinå¼€æºæµåª’ä½“æœåŠ¡å™¨\n","date":"2022-07-31T08:32:51+08:00","permalink":"https://sanbuphy.github.io/p/%E5%88%A9%E7%94%A8%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E6%8E%A8%E6%B5%81/","title":"åˆ©ç”¨ç¬”è®°æœ¬ç”µè„‘è¿›è¡Œæ¨æµ"},{"content":"æé—®ï¼š\næˆ‘ä»¬æœ‰ä»€ä¹ˆæ£€æµ‹æ‰‹æ®µï¼ˆç¼–è¯‘å™¨æˆ–è€…æ“ä½œç³»ç»Ÿè‡ªå¸¦æ£€æµ‹ï¼‰èƒ½é˜²æ­¢stack overflowå˜›ï¼Ÿæˆ–è€…è¯´é˜²æ­¢å‡ºæ ˆè¶…ç•Œ\nç¨‹åºä¸­çš„å†…å­˜åœ°å€è§„å®šå¥½rä½†ä¸ç»™wèƒ½é˜²æ­¢æ ˆæº¢å‡ºè¦†ç›–å—ï¼Ÿæˆ–è€…å‡ºæ ˆè¶…ç•Œ\nå†…æ ¸ä¹Ÿæ˜¯ç¨‹åºï¼Œå¦‚æœå‘ç”Ÿäº†æº¢å‡ºä¼šç›´æ¥panicï¼Œæ˜¯ä¸æ˜¯å´©æºƒæœ¬èº«å°±ä½œä¸ºäº†ä¸€ç§ä¿æŠ¤æœºåˆ¶ï¼Ÿ\nç­”ï¼šï¼ˆè¯¦ç»†å‚è€ƒè’‹ç‚å²©çš„è¿™ä¸€è¯¾ï¼šå¹¶å‘ Bug å’Œåº”å¯¹ï¼‰\n1ã€è¯·çœ‹å¦‚ä¸‹è§£é‡Š\n2ã€å€¼å¾—åšå®éªŒå°è¯•ï¼Œå› ä¸ºç†è®ºä¸Šæˆ‘ä»¬æ˜¯èƒ½å¤Ÿè®¿ä¿®æ”¹å†…å­˜åœ°å€æƒé™çš„ï¼ˆè¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ï¼Œä¸ºä»€ä¹ˆæ ˆçš„å†…å­˜åœ°å€ä¸ä»…å¯è¯»å¯å†™è¿˜å¯ã€æ‰§è¡Œã€‘å‘¢ï¼Ÿå› ä¸ºè¿™ä»£è¡¨ç€CPUèƒ½è¯»å–è¯‘ç å¹¶æ‰§è¡Œï¼‰\n3ã€æ˜¯çš„ï¼Œè¯¦è§panic()\nBuffer Overrun æ£€æŸ¥ Canary (é‡‘ä¸é›€) å¯¹ä¸€æ°§åŒ–ç¢³éå¸¸æ•æ„Ÿ ç”¨ç”Ÿå‘½é¢„è­¦çŸ¿äº•ä¸‹çš„ç“¦æ–¯æ³„éœ² (since 1911)\nè®¡ç®—æœºç³»ç»Ÿä¸­çš„ canary â€œç‰ºç‰²â€ ä¸€äº›å†…å­˜å•å…ƒï¼Œæ¥é¢„è­¦ memory error çš„å‘ç”Ÿ (ç¨‹åºè¿è¡Œæ—¶æ²¡æœ‰åŠ¨ç‰©å—åˆ°å®è´¨çš„ä¼¤å®³)\næ¯”å¦‚æŠŠä¸€äº›å†…å­˜å—â€œæ¶‚è‰²â€ï¼Œå¦‚æœå‘ç°å®ƒçš„â€œé¢œè‰²è¢«è¦†ç›–äº†â€åˆ™è¯´æ˜æœ‰äº›ä¿æŠ¤çš„åŒºåŸŸè¢«è®¿é—®äº†ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚ï¼ˆæˆ–è€…åƒPAé‚£æ ·çš„è¶Šç•ŒæŠ¥é”™\næ²¡ç”¨è¿‡ lint/sanitizersï¼Ÿ å…·ä½“è¯·ç‚¹å‡»ï¼šå¹¶å‘ Bug å’Œåº”å¯¹\nAddressSanitizer (asan); (paper): éæ³•å†…å­˜è®¿é—® Buffer (heap/stack/global) overflow, use-after-free, use-after-return, double-free, \u0026hellip; Demo: uaf.c; kasan\nThreadSanitizer (tsan): æ•°æ®ç«äº‰ Demo: fish.c, sum.c, peterson-barrier.c; ktsan\nMemorySanitizer (msan): æœªåˆå§‹åŒ–çš„è¯»å–\nUBSanitizer (ubsan): undefined behavior Misaligned pointer, signed integer overflow, \u0026hellip; Kernel ä¼šå¸¦ç€ -fwrapv ç¼–è¯‘\n","date":"2022-07-30T16:08:27+08:00","permalink":"https://sanbuphy.github.io/p/%E9%98%B2%E6%AD%A2stack-overflow%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%E6%9D%80%E6%AF%92/","title":"é˜²æ­¢stack overflowâ€”â€”å†…å­˜åœ°å€æ€æ¯’"},{"content":"Qï¼šä¼—æ‰€å‘¨çŸ¥ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¯»å–æœ¬åœ°çš„è§†é¢‘ä¿¡æ¯ï¼Œä»–æœ‰å¯èƒ½ä¸å…¨ï¼ˆæ¯”å¦‚ç›´æ’­å½•åƒï¼ŒæŸäº›æ–‡ä»¶å†…å®¹è¢«ç ´åæˆ–è€…å¹²è„†æ²¡æœ‰æ¯”å¦‚ï¼‰è¿™æ˜¯ä¸€ä¸ªå…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜â€”â€”ä½ æ€ä¹ˆç¡®å®šfpsæ˜¯å¯¹çš„ï¼šæ˜¯opencvç®—çš„ï¼ˆå…ˆæœ‰äº†æ—¶é•¿ï¼‰è¿˜æ˜¯è¯´æœ¬èº«fpså°±æ˜¯å†…åµŒè§†é¢‘è¾“å‡ºçš„ä¿¡æ¯è€Œä¸”ä¿è¯ä¸å˜ç„¶åopencvç”¨è¿™ä¸ªå»è®¡ç®—æ€»æ—¶é•¿ï¼ˆå› ä¸ºfpséƒ½æ˜¯åŸºæœ¬å¯ä»¥æ•´é™¤çš„æ‰€ä»¥åŸºæœ¬åªèƒ½çœ‹åˆ°opencvç»™å‡º0.01ç²¾ç¡®åº¦çš„æ—¶é•¿ï¼‰\nAï¼šæ±‚æ€»å¸§æ•°æ˜¯æœ€å‡†çš„ï¼Œæ ¹æ®æ€»æ—¶é•¿å¯ä»¥è®¡ç®—å‡ºFPSï¼Œè¿™æ‰æ˜¯æœ€å‡†ç¡®çš„ã€‚\nå…¶ä»–é—®é¢˜ï¼šå¦‚ä½•çœ‹ä¸€ä¸ªè§†é¢‘æ–‡ä»¶çš„å®¹å™¨/å°è£…æ ¼å¼ï¼Ÿ ç­”ï¼šä½¿ç”¨xxdæˆ–å…¶ä»–å¯ä»¥çœ‹åå…­è¿›åˆ¶å†…å®¹çš„ç¨‹åºç›´æ¥æ‰“å¼€è§†é¢‘æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤´é‡Œé¢æœ‰ç›¸å…³ä¿¡æ¯ç›´æ¥æœç´¢ç›¸å…³å†…å®¹ï¼ˆæ¯”å¦‚åœ¨æœªå®‰è£…è§£ç å™¨çš„æƒ…å†µä¸‹ï¼Œæµ·åº·æ‘„åƒå¤´ç›´æ’­ä¿å­˜åçš„æ–‡ä»¶å°±æ˜¯mpeg psæ ¼å¼ï¼Œæœ‰IMKH headerï¼‰\n","date":"2022-07-30T15:00:59+08:00","permalink":"https://sanbuphy.github.io/p/%E6%9C%89%E5%85%B3fps%E8%AE%A1%E7%AE%97%E5%85%88%E6%9C%89%E9%B8%A1%E8%BF%98%E6%98%AF%E5%85%88%E6%9C%89%E8%9B%8B/","title":"æœ‰å…³fpsè®¡ç®—â€”â€”å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹"},{"content":"æœ‰ä¸€å¤©é‡åˆ°éœ€è¦å®ç°shellè„šæœ¬ä¸­å˜é‡è¿ç€æ‹¬å·ä¸€èµ·è¯»å–ï¼Œå®ç°æ–¹æ³•å¦‚ä¸‹ï¼š\nå¦‚æœä¸åŠ åŒå¼•å·ä¼šç¿»è½¦ï¼ˆä½ å¯ä»¥å°è¯•å»é™¤ä¸åŒçš„åŒå¼•å·çœ‹çœ‹æ•ˆæœï¼‰\n#!/bin/bash OLDIFS=IFS #IFS=`echo -e \u0026#34;\\n\u0026#34;` f1=\u0026#34;DAFS DFFS\u0026#34; f2=2 f3=3 f4=4 array=(\u0026#34;f1\u0026#34; $f2 $f3 f4) for element in \u0026#34;{array[@]}\u0026#34; do echo $element Referenceï¼š\nshellè„šæœ¬ä¸­oldIFS=$IFS linuxè·å¾—åŒ…å«ç©ºç™½å­—ç¬¦çš„è¡Œ,Shellå¦‚ä½•éå†åŒ…å«ç©ºæ ¼çš„æ–‡æœ¬è¯¦è§£ ","date":"2022-07-30T09:29:20+08:00","permalink":"https://sanbuphy.github.io/p/shell%E8%84%9A%E6%9C%AC%E4%B8%AD%E5%8F%98%E9%87%8F%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96%E7%A9%BA%E6%A0%BC%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/","title":"shellè„šæœ¬ä¸­å˜é‡æ— æ³•è¯»å–ç©ºæ ¼çš„è§£å†³æ–¹æ³•"},{"content":"å¾ˆå¤šäººæ ¹æ®æ•°æ®ç»“æ„çš„å®šä¹‰ï¼š\u0026ldquo;Data structure is a storage that is used to store and organize data. It is a way of arranging data on a computer so that it can be accessed and updated efficiently. Depending on your requirement and project, it is important to choose the right data structure for your project. \u0026ldquo;è§‰å¾—ç±»å½“ç„¶ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå› ä¸ºç¬¦åˆå®šä¹‰ä¸­æåˆ°çš„è¡Œä¸ºã€‚ç„¶è€Œï¼Œç»è¿‡ä¸€ç•ªæŸ¥èµ„æ–™å¤–åŠ çœ‹äº†ä¸‹ç»å…¸clean coder blogçš„æè¿°ï¼Œå‘ç°äº‹æƒ…æ²¡è¿™ä¹ˆç®€å•ã€‚\nå…³é”®è¿˜æ˜¯è¦çœ‹â€œ çœ‹ä½ æŠ½è±¡äº†å¤šå°‘ã€æŠ½è±¡å±‚çº§ã€æƒ³è¦å¯¹å¤–æš´éœ²ä»€ä¹ˆâ€ï¼Œå¹¶ä¸”åˆ†æçš„è§’åº¦ä¹Ÿä¸åŒã€‚\næ½œåœ¨çš„æ ‡å‡†ç­”æ¡ˆ\nClasses vs. Data Structures\n","date":"2022-06-25T15:07:48+08:00","permalink":"https://sanbuphy.github.io/p/classes-vs.-data-structures/","title":"Classes vs. Data Structures"},{"content":"ä½œä¸ºå‡ ä¸ªæœˆå†…é‡è£…è¿‡ä¸ä¸‹åæ¬¡ç”µè„‘çš„ç‚¸æœºçŒ›ç”·ï¼Œå¼ºçƒˆå»ºè®®å¤§å®¶åº”è¯¥å»ºç«‹ä¸€ä¸ªè‡ªå·±çš„â€œæ¯ç›˜â€,å‚¨å¤‡å¥½å¸¸è§éœ€è¦å®‰è£…çš„è½¯ä»¶ï¼ˆAnacondaã€vscodeç­‰ç­‰ï¼‰\né¦–å…ˆè¦ä¿å­˜ä¸€äº›å¸¸è§çš„æ–¹æ³•ï¼ˆå½“ç„¶å¯ä»¥ç±»ä¼¼é±¼é¦™ROSé‚£æ ·å°è£…æˆä¸ºä¸€ä¸ªshellæ–‡ä»¶ï¼Œè‡ªåŠ¨æ¢æºå¹¶å®‰è£…å„ç§åº“ï¼‰\nã€ç¯å¢ƒé…ç½®ã€‘Ubuntu20.04å¦‚ä½•æ›´æ¢å›½å†…æº\ngit cloneé€Ÿåº¦å¤ªæ…¢çš„è§£å†³åŠæ³•æŠ€å·§åˆ†äº« æ³¨ï¼šè¿™é‡Œæœ‰ä¸ªå‘éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå½“é‡ç½®DNSçš„æ—¶å€™ä¸è¦ç”¨æ–‡ä¸­æ–¹æ³•ï¼ˆæˆ‘æ˜¯æ²¡æœ‰æ•ˆç”¨ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼šsudo service network-manager restart\nå¦‚æœä½ å–œæ¬¢ä½¿ç”¨vimï¼Œå»ºè®®ä½ å®‰è£…ä¸€é”®é…ç½®ï¼švimplus ä¸è¿‡å®ƒçš„å®‰è£…éœ€è¦git cloneï¼Œå»ºè®®ç§‘å­¦ä¸Šç½‘å¦åˆ™ä¼šå‡ºç°å¤§é¢ç§¯å¤±è´¥ï¼ˆå¸¸è§åŠŸèƒ½è¿˜æ˜¯èƒ½åŒæ­¥ä¸Šçš„ï¼Œå°±æ˜¯éå¸¸éå¸¸æ…¢ã€‚ã€‚ã€‚ã€‚ï¼‰\nTODO:æœ‰æ—¶é—´äº†æ ¹æ®é±¼é¦™ROSçš„ä¸€é”®shellåšä¸€ä¸ªå±äºè‡ªå·±çš„ä¸€é”®shell\n","date":"2022-06-25T14:50:08+08:00","permalink":"https://sanbuphy.github.io/p/%E7%B3%BB%E7%BB%9F%E9%80%83%E7%94%9F%E8%88%B1%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7/","title":"ç³»ç»Ÿé€ƒç”Ÿèˆ±çš„å¿…è¦æ€§"},{"content":"su çš„ä½œç”¨æ˜¯åˆ‡æ¢å½“å‰ç”¨æˆ·ï¼Œéœ€è¦çš„æ˜¯åˆ‡æ¢åè´¦æˆ·çš„åå­—ï¼Œå³â€œsu è´¦æˆ·åç§°â€ï¼Œå¦‚æœåé¢ä¸åŠ è´¦æˆ·æ—¶ç³»ç»Ÿé»˜è®¤ä¸ºrootè´¦æˆ·\nsuæœ‰ä¸¤ç§ç”¨æ³•ï¼š su Username/ su - Usernameï¼Œä¾‹å­å¦‚ä¸‹ï¼š\nsu root è¾“å…¥rootå¯†ç ååˆ‡æ¢ä¹‹rootç”¨æˆ·ä½†æ˜¯pwdç›®å½•ä¸å˜ su - root è¾“å…¥rootå¯†ç ååˆ‡æ¢ä¹‹rootç”¨æˆ·ä½†æ˜¯pwdç›®å½•/root sudo æš‚æ—¶åˆ‡æ¢åˆ°è¶…çº§ç”¨æˆ·æ¨¡å¼ä»¥æ‰§è¡Œè¶…çº§ç”¨æˆ·æƒé™ï¼Œæç¤ºè¾“å…¥å¯†ç æ—¶è¯¥å¯†ç ä¸ºå½“å‰ç”¨æˆ·çš„å¯†ç ï¼Œè€Œä¸æ˜¯è¶…çº§è´¦æˆ·çš„å¯†ç \nsudo should be read as \u0026quot;su do\u0026quot;, that is, \u0026quot;switch user and do this command\u0026quot;.\nsudo -i rootä¸sudo - rootã€sudo -i ,sudo - ï¼Œsudo rootæ•ˆæœç›¸åŒï¼Œæç¤ºè¾“å…¥å¯†ç æ—¶è¯¥å¯†ç ä¸ºå½“å‰è´¦æˆ·çš„å¯†ç  è¦æ±‚æ‰§è¡Œè¯¥å‘½ä»¤çš„ç”¨æˆ·å¿…é¡»åœ¨sudoersä¸­æ‰å¯ä»¥\nsudo su è¿è¡Œsudoå‘½ä»¤ç»™suå‘½ä»¤ææƒï¼Œè¿è¡Œsuå‘½ä»¤\n","date":"2022-06-25T14:18:55+08:00","permalink":"https://sanbuphy.github.io/p/linux%E4%B8%ADsudosusu-%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/","title":"Linuxä¸­sudoã€suã€su-çš„é‚£äº›äº‹"},{"content":"Vision GNN: An Image is Worth Graph of Nodes è®ºæ–‡é“¾æ¥ï¼š https://arxiv.org/abs/2206.00272\nä»£ç å¼€æºé“¾æ¥ï¼ˆæš‚æ— ï¼‰ï¼šhttps://github.com/sanbuphy/CV-Backbones\næœ€è¿‘éƒ½åœ¨å…³æ³¨GNNåœ¨å›¾åƒè¯†åˆ«ä¸Šçš„åº”ç”¨ï¼Œå‘ç°å·²ç»è¢«Huawei Noahâ€™s Ark Labåšå®Œäº†ã€‚ã€‚ã€‚\nä½†æˆ‘å¾ˆå¥½å¥‡ä»–ä»¬æ˜¯æ€ä¹ˆå¤„ç†è®­ç»ƒé›†æœ¬èº«ï¼ˆlossæ˜¯ä»€ä¹ˆï¼‰ï¼Œå¯¹æ‹†åˆ†åå›¾ç»“æ„çš„æ ‡æ³¨åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹å¤§çš„å·¥ç¨‹ï¼Œè¿™ç‚¹éœ€è¦ç­‰å¼€æºåä»”ç»†ç ”ç©¶ï¼ˆä¹Ÿè®¸è¿˜éœ€è¦å¤šè¯»å‡ éGraph Representation of Imageä»¥åŠVIG BLockï¼‰\nè¯¥æ–‡åŸºäºå›¾åƒçš„å›¾è¡¨ç¤ºï¼ˆgraph representationï¼‰æå‡ºäº† vision graph neural network (ViG)ã€‚è¯¥æ–‡åº”è¯¥æ˜¯é¦–æ¬¡å°†å›¾ç¥ç»ç½‘ç»œç”¨äºè§†è§‰ä»»åŠ¡ï¼ŒåŒæ—¶å–å¾—å¾ˆå¥½çš„æ•ˆæœï¼Œåœ¨ ImageNet åˆ†ç±»ä»»åŠ¡ä¸Šè¶…è¿‡äº† CNN (ResNet), MLP (CycleMLP) å’Œ transformer (Swin-T)\nThese parts linked by joints naturally form a graph structure. By analyzing the graph.\né€šè¿‡å›¾ç»“æ„åˆ†è§£ï¼Œå„éƒ¨åˆ†é—´çš„è¿æ¥æ˜¾å¾—æ›´åŠ ç´§å¯†ï¼šï¼ˆç›¸ä¼¼çš„è¯­ä¹‰èƒ½å¤Ÿäº’ç›¸è·¨åŒºåŸŸå…³è”ï¼‰\nâ€œwe are able to recognize the human. Moreover, graph is a generalized data structure that grid and sequence can be viewed as a special case of graph. Viewing an image as a graph is more flexible and effective for visual perceptionâ€\nVIG Block Huawei Noahâ€™s Ark Labæå‡ºäº†ä¸€ä¸ªç‰¹æ®Šçš„VIGå—ç»“æ„ï¼Œç›¸æ¯”GCNså¯ä»¥æé«˜ç‰¹å¾çš„å¤šæ ·æ€§ï¼Œå‡å°‘å› ç½‘ç»œæ·±åº¦åŠ å¼ºå¯¼è‡´çš„ç‰¹å¾å‡å°‘ç°è±¡ã€‚ViG å—æ˜¯æ„æˆ ViG ç½‘ç»œçš„åŸºæœ¬æ„å»ºå•å…ƒï¼Œå…¶ç”±Grapher æ¨¡å—å’Œ FFN æ¨¡å—å åŠ è€Œæˆçš„ã€‚\nå¦‚ä½•é¿å…Feature diversity of nodes as layer changes é™ä½ï¼Œå³ï¼š\nâ€œThe over-smoothing phenomenon in deep GCNs will decrease the distinctiveness of node features and lead to performance degradation for visual recognition,â€\nä»–ä»¬è¿˜æä¾›äº†ä¸¤ç§ç»“æ„ç”¨äºæ„å»ºVIGï¼Œåˆ†åˆ«ä¸ºå„å‘åŒæ€§ä¸é‡‘å­—å¡”å‹ï¼š\nâ€we build two kinds of network architectures for ViG, i.e., isotropic architecture and pyramid architectureâ€œ\néªŒè¯æ•°æ®é›†ï¼š\nè·‘æ•°æ®é›†çš„è®¾ç½®ï¼š\næœ€åç»“æœå±•ç¤ºï¼š\nIsotropic ViGï¼š\nPyramid ViG\nåœ¨ç›®æ ‡æ£€æµ‹çš„æ•ˆæœï¼š\nAblation Studyæµ‹è¯•çš„ç»“æœï¼ˆå…³é—­ä¸€äº›é…ä»¶ï¼‰\nè¿‡ç¨‹çš„å¯è§†åŒ–ï¼š\né€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæµ…å±‚ç½‘ç»œçš„è·¨åŒºåŸŸå›¾åªæ˜¯ç»“åˆäº†é¢œè‰²æˆ–å½¢çŠ¶ç­‰ä¸€äº›è¡¨è±¡è¯­ä¹‰ï¼›\nè€Œæ·±å±‚ç½‘ç»œçš„å›¾ç»“æ„åˆ™æ›´åŠ ä¸“æ³¨äºç»†åŒ–ç‰¹å¾æœ¬èº«â€œæ¯”å¦‚é±¼å°±æ˜¯é±¼ï¼Œäººå°±æ˜¯äººâ€\nThe pentagram is the center node, and the nodes with the same color are its neighbors\nTwo center nodes are visualized as drawing all the edges will be messy.\nWe can observe that our model can select the content-related nodes as the first order neighbors,\nIn the shallow layer, the neighbor nodes tend to be selected based on low-level and local features( such as color and texture)\nIn the deep layer, the neighbors of the center nodes are more semantic and belong to the same categor.\nä»¥ä¸‹æ˜¯ä¼ªä»£ç ï¼š\n","date":"2022-06-18T11:56:50+08:00","image":"https://sanbuphy.github.io/p/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBvision-gnn-an-image-is-worth-graph-of-nodes/image/image_AfAe9Ctp8A_hue88e56843ed6b1870c9b31fdca73cbf5_282168_120x120_fill_box_smart1_3.png","permalink":"https://sanbuphy.github.io/p/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBvision-gnn-an-image-is-worth-graph-of-nodes/","title":"è®ºæ–‡é˜…è¯»ï¼šVision GNN: An Image is Worth Graph of Nodes"},{"content":"PA0æ¯”è¾ƒç®€å•ï¼Œå°±ä¸å†é‡å¤è¯´æ˜ã€‚\nPA1çš„ä»»åŠ¡ ä»å›¾ä¸Šå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬çš„å…³é”®æ˜¯è¦ä»Monè¯»å–Memå’ŒRegçš„ä¿¡æ¯\nPA1.RTFSC apt-get install ccache which gcc å¯ä»¥æŠŠgccç¼–è¯‘ç»“æœç¼“å­˜ï¼Œå¯è·³è¿‡é‡å¤çš„ç¼–è¯‘è¿‡ç¨‹\nmake -nB, å®ƒä¼šè®© makeç¨‹åºä»¥\u0026quot;åªè¾“å‡ºå‘½ä»¤ä½†ä¸æ‰§è¡Œ\u0026quot;çš„æ–¹å¼å¼ºåˆ¶æ„å»ºç›®æ ‡\nllvmæ¨èç”¨PAé‡Œé¢è¯´åˆ°çš„11å…ˆè¯•è¯•çœ‹ï¼Œå®åœ¨ä¸è¡Œæƒ³è¦å‡çº§å¯å‚è€ƒï¼šhttps://blog.csdn.net/weixin_44200757/article/details/122725577\næœ€ç®€å•çš„è®¡ç®—æœºç§°ä¸º\u0026quot;å›¾çµæœº\u0026quot;(Turing Machine, TRM)\nç»“æ„ä¸Š, TRMæœ‰å­˜å‚¨å™¨, æœ‰PC, æœ‰å¯„å­˜å™¨, æœ‰åŠ æ³•å™¨ å·¥ä½œæ–¹å¼ä¸Š, TRMä¸æ–­åœ°é‡å¤ä»¥ä¸‹è¿‡ç¨‹: ä»PCæŒ‡ç¤ºçš„å­˜å‚¨å™¨ä½ç½®å–å‡ºæŒ‡ä»¤, æ‰§è¡ŒæŒ‡ä»¤, ç„¶åæ›´æ–°PC BIOSæ˜¯å›ºåŒ–åœ¨ROM/Flashä¸­çš„, å®ƒä»¬éƒ½æ˜¯éæ˜“å¤±æ€§çš„å­˜å‚¨ä»‹è´¨, BIOSä¸­çš„å†…å®¹ä¸ä¼šå› ä¸ºæ–­ç”µè€Œä¸¢å¤±.\nå› æ­¤åœ¨çœŸå®çš„è®¡ç®—æœºç³»ç»Ÿä¸­, è®¡ç®—æœºå¯åŠ¨åé¦–å…ˆä¼šæŠŠæ§åˆ¶æƒäº¤ç»™BIOS, BIOSç»è¿‡ä¸€ç³»åˆ—åˆå§‹åŒ–å·¥ä½œä¹‹å, å†ä»ç£ç›˜ä¸­å°†æœ‰æ„ä¹‰çš„ç¨‹åºè¯»å…¥å†…å­˜ä¸­æ‰§è¡Œ. å¯¹è¿™ä¸ªè¿‡ç¨‹çš„æ¨¡æ‹Ÿéœ€è¦äº†è§£å¾ˆå¤šè¶…å‡ºæœ¬è¯¾ç¨‹èŒƒå›´çš„ç»†èŠ‚, æˆ‘ä»¬åœ¨PAä¸­åšäº†ç®€åŒ–: é‡‡å–çº¦å®šçš„æ–¹å¼è®©CPUç›´æ¥ä»çº¦å®šçš„å†…å­˜ä½ç½®å¼€å§‹æ‰§è¡Œ.\nåœ¨GNU/Linuxä¸­, ä½ å¯ä»¥å¾ˆå®¹æ˜“å¾—çŸ¥æ“ä½œç³»ç»Ÿåœ¨èƒŒååšäº†äº›ä»€ä¹ˆ. é”®å…¥ sudo dmesg, å°±å¯ä»¥è¾“å‡ºæ“ä½œç³»ç»Ÿçš„å¯åŠ¨æ—¥å¿—, æ“ä½œç³»ç»Ÿçš„è¡Œä¸ºä¸€è§ˆæ— ä½™.\nä½ éœ€è¦ç»“åˆPA1 RTFSCå†…å®¹æ¥NEMUçš„æ¡†æ¶ä»£ç .\nå¦‚æœä½ ä¸çŸ¥é“\u0026quot;æ€ä¹ˆæ‰ç®—æ˜¯çœ‹æ‡‚äº†æ¡†æ¶ä»£ç \u0026quot;, ä½ å¯ä»¥å…ˆå°è¯•è¿›è¡Œåé¢çš„ä»»åŠ¡. å¦‚æœå‘ç°ä¸çŸ¥é“å¦‚ä½•ä¸‹æ‰‹, å†å›æ¥ä»”ç»†é˜…è¯»è¿™ä¸€èŠ‚\ncpu å…ˆé©±ä¸ºCPUåˆ›é€ äº†ä¸€ä¸ªç‰¹æ®Šçš„è®¡æ•°å™¨, å«\u0026quot;ç¨‹åºè®¡æ•°å™¨\u0026quot;(Program Counter, PC). åœ¨x86ä¸­, å®ƒæœ‰ä¸€ä¸ªç‰¹æ®Šçš„åå­—, å« EIP(Extended Instruction Pointer).\nwhile (1) { ä»PCæŒ‡ç¤ºçš„å­˜å‚¨å™¨ä½ç½®å–å‡ºæŒ‡ä»¤; æ‰§è¡ŒæŒ‡ä»¤; æ›´æ–°PC; } ç¬¬ä¸€é¡¹å·¥ä½œå°±æ˜¯å°†ä¸€ä¸ªå†…ç½®çš„å®¢æˆ·ç¨‹åºè¯»å…¥åˆ°å†…å­˜ä¸­ å…ˆæ‰“å¼€ï¼šnemu/src/isa/$ISA/init.c\nmonitorä¼šè°ƒç”¨ init_isa()å‡½æ•°(åœ¨ nemu/src/isa/$ISA/init.cä¸­å®šä¹‰), æ¥è¿›è¡Œä¸€äº›ISAç›¸å…³çš„åˆå§‹åŒ–å·¥ä½œ.\nç¬¬ä¸€é¡¹å·¥ä½œå°±æ˜¯å°†ä¸€ä¸ªå†…ç½®çš„å®¢æˆ·ç¨‹åºè¯»å…¥åˆ°å†…å­˜ä¸­.\nå†…å­˜æ˜¯ä»€ä¹ˆï¼ŸCè¯­è¨€ä¸­æˆ‘ä»¬å°±å¾ˆè‡ªç„¶åœ°ä½¿ç”¨ä¸€ä¸ª uint8_tç±»å‹çš„æ•°ç»„æ¥å¯¹å†…å­˜è¿›è¡Œæ¨¡æ‹Ÿ. NEMUé»˜è®¤ä¸ºå®¢æˆ·è®¡ç®—æœºæä¾›128MBçš„ç‰©ç†å†…å­˜(è§ nemu/src/memory/paddr.cä¸­å®šä¹‰çš„ pmem(å¦‚æœæ‰¾ä¸åˆ°çœ‹çœ‹.hå†…æœ‰128*1024*1024) éœ€è¦å°†å®¢æˆ·ç¨‹åºè¯»å…¥åˆ°å†…å­˜çš„ä»€ä¹ˆä½ç½®ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼è®©å®¢æˆ·è®¡ç®—æœºçš„CPUçŸ¥é“å®¢æˆ·ç¨‹åºçš„ä½ç½®. æˆ‘ä»¬é‡‡å–ä¸€ç§æœ€ç®€å•çš„æ–¹å¼: çº¦å®š. å…·ä½“åœ°, æˆ‘ä»¬è®©monitorç›´æ¥æŠŠå®¢æˆ·ç¨‹åºè¯»å…¥åˆ°ä¸€ä¸ªå›ºå®šçš„å†…å­˜ä½ç½® init_isa()çš„ç¬¬äºŒé¡¹ä»»åŠ¡æ˜¯åˆå§‹åŒ–å¯„å­˜å™¨ CPUä¸­, å¯„å­˜å™¨æ˜¯ä¸€ä¸ªç»“æ„åŒ–ç‰¹å¾è¾ƒå¼ºçš„å­˜å‚¨éƒ¨ä»¶, åœ¨Cè¯­è¨€ä¸­æˆ‘ä»¬å°±å¾ˆè‡ªç„¶åœ°ä½¿ç”¨ç›¸åº”çš„ç»“æ„ä½“æ¥æè¿°CPUçš„å¯„å­˜å™¨ç»“æ„. ä¸åŒISAçš„å¯„å­˜å™¨ç»“æ„ä¹Ÿå„ä¸ç›¸åŒ, ä¸ºæ­¤æˆ‘ä»¬æŠŠå¯„å­˜å™¨ç»“æ„ä½“ CPU_stateçš„å®šä¹‰æ”¾åœ¨ nemu/src/isa/$ISA/include/isa-def.h\nåˆå§‹åŒ–å¯„å­˜å™¨çš„ä¸€ä¸ªé‡è¦å·¥ä½œå°±æ˜¯è®¾ç½® cpu.pcçš„åˆå€¼, æˆ‘ä»¬éœ€è¦å°†å®ƒè®¾ç½®æˆåˆšæ‰åŠ è½½å®¢æˆ·ç¨‹åºçš„å†…å­˜ä½ç½®, è¿™æ ·å°±å¯ä»¥è®©CPUä»æˆ‘ä»¬çº¦å®šçš„å†…å­˜ä½ç½®å¼€å§‹æ‰§è¡Œå®¢æˆ·ç¨‹åºäº†. å¯¹äºmips32å’Œriscv32, å®ƒä»¬çš„0å·å¯„å­˜å™¨æ€»æ˜¯å­˜æ”¾ 0, å› æ­¤æˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–.\nCONFIG_MBASEï¼šç‰©ç†å†…å­˜èµ·å§‹åœ°å€ RESET_VECTORï¼šå®¢æˆ·ç¨‹åºè¯»å…¥çš„å›ºå®šä½ç½®\nç‰©ç†å†…å­˜çš„èµ·å§‹åœ°å€ x86çš„ç‰©ç†å†…å­˜æ˜¯ä»0å¼€å§‹ç¼–å€çš„, ä½†å¯¹äºä¸€äº›ISAæ¥è¯´å´ä¸æ˜¯è¿™æ ·, ä¾‹å¦‚mips32å’Œriscv32çš„ç‰©ç†åœ°å€å‡ä» 0x80000000å¼€å§‹. å› æ­¤å¯¹äºmips32å’Œriscv32, å…¶ CONFIG_MBASEå°†ä¼šè¢«å®šä¹‰æˆ 0x80000000. å°†æ¥CPUè®¿é—®å†…å­˜æ—¶, æˆ‘ä»¬ä¼šå°†CPUå°†è¦è®¿é—®çš„å†…å­˜åœ°å€æ˜ å°„åˆ° pmemä¸­çš„ç›¸åº”åç§»ä½ç½®, è¿™æ˜¯é€šè¿‡ nemu/src/memory/paddr.cä¸­çš„ guest_to_host()å‡½æ•°å®ç°çš„. ä¾‹å¦‚å¦‚æœmips32çš„CPUæ‰“ç®—è®¿é—®å†…å­˜åœ°å€ 0x80000000, æˆ‘ä»¬ä¼šè®©å®ƒæœ€ç»ˆè®¿é—® pmem[0], ä»è€Œå¯ä»¥æ­£ç¡®è®¿é—®å®¢æˆ·ç¨‹åºçš„ç¬¬ä¸€æ¡æŒ‡ä»¤. è¿™ç§æœºåˆ¶æœ‰ä¸€ä¸ªä¸“é—¨çš„åå­—, å«åœ°å€æ˜ å°„, åœ¨åç»­çš„PAä¸­æˆ‘ä»¬è¿˜ä¼šå†é‡åˆ°å®ƒ.x86çš„ç‰©ç†å†…å­˜æ˜¯ä»0å¼€å§‹ç¼–å€çš„, ä½†å¯¹äºä¸€äº›ISAæ¥è¯´å´ä¸æ˜¯è¿™æ ·, ä¾‹å¦‚mips32å’Œriscv32çš„ç‰©ç†åœ°å€å‡ä»0x80000000å¼€å§‹. å› æ­¤å¯¹äºmips32å’Œriscv32, å…¶CONFIG_MBASEå°†ä¼šè¢«å®šä¹‰æˆ0x8000000\nMonitorè¯»å…¥å®¢æˆ·ç¨‹åºå¹¶å¯¹å¯„å­˜å™¨è¿›è¡Œåˆå§‹åŒ–å, è¿™æ—¶å†…å­˜çš„å¸ƒå±€å¦‚ä¸‹:\npmem: CONFIG_MBASE RESET_VECTOR | | v v ----------------------------------------------- | | | | | guest prog | | | | ----------------------------------------------- ^ | pc NEMUè¿”å›åˆ° init_monitor()å‡½æ•°ä¸­, ç»§ç»­è°ƒç”¨ load_img()å‡½æ•° (åœ¨ nemu/src/monitor/monitor.cä¸­å®šä¹‰). è¿™ä¸ªå‡½æ•°ä¼šå°†ä¸€ä¸ªæœ‰æ„ä¹‰çš„å®¢æˆ·ç¨‹åºä»é•œåƒæ–‡ä»¶è¯»å…¥åˆ°å†…å­˜, è¦†ç›–åˆšæ‰çš„å†…ç½®å®¢æˆ·ç¨‹åº.\nå¦‚æœè¿è¡ŒNEMUçš„æ—¶å€™æ²¡æœ‰ç»™å‡ºè¿™ä¸ªå‚æ•°, NEMUå°†ä¼šè¿è¡Œå†…ç½®å®¢æˆ·ç¨‹åº.\næ€è€ƒé¢˜1ï¼š-1å‚æ•° åœ¨ cmd_c()å‡½æ•°ä¸­, è°ƒç”¨ cpu_exec()çš„æ—¶å€™ä¼ å…¥äº†å‚æ•° -1, ä½ çŸ¥é“è¿™æ˜¯ä»€ä¹ˆæ„æ€å—?\nç­”:å‚æ•°ä¸ºuint64,æ— ç¬¦å·64ä½æ•´å‹ï¼Œ-1è¡¨ç¤ºå–æœ€å¤§å€¼ï¼ˆæ•´æ•°ç”¨è¡¥ç è¡¨ç¤ºï¼Œè´Ÿæ•°çš„è¡¥ç ä¸º=åç +1ï¼Œæ­£æ•°çš„è¡¥ç å°±æ˜¯å…¶åŸç ï¼›è´Ÿæ•°çš„åç ä¸ºç¬¦å·ä½ä¸å˜ï¼Œæ•°å€¼ä½æŒ‰ä½å–åã€‚-1çš„åŸç ï¼š1,000\u0026hellip;0001ï¼Œå› æ­¤ï¼Œ-1çš„è¡¥ç ä¸º1,111\u0026hellip;111ã€‚ï¼‰\næ€è€ƒé¢˜2ï¼šè°æ¥æŒ‡ç¤ºç¨‹åºçš„ç»“æŸ? åœ¨ç¨‹åºè®¾è®¡è¯¾ä¸Šè€å¸ˆå‘Šè¯‰ä½ , å½“ç¨‹åºæ‰§è¡Œåˆ° main()å‡½æ•°è¿”å›å¤„çš„æ—¶å€™, ç¨‹åºå°±é€€å‡ºäº†, ä½ å¯¹æ­¤æ·±ä¿¡ä¸ç–‘. ä½†ä½ æ˜¯å¦æ€€ç–‘è¿‡, å‡­ä»€ä¹ˆç¨‹åºæ‰§è¡Œåˆ° main()å‡½æ•°çš„è¿”å›å¤„å°±ç»“æŸäº†?\nmain()å‡½æ•°ç»“æŸï¼Œå¦‚ä½•å†æ‰§è¡Œä»£ç ï¼Ÿ\nä½¿ç”¨ atexit() å‡½æ•°ï¼Œæ¥æ‰§è¡Œç›¸å…³çš„â€œ æ¸…ç† â€å·¥ä½œThe function pointed by func is automatically called without arguments when the program terminates normally.A zero value is returned if the function was successfully registered. If it failed, a non-zero value is returned. å‡ ç§é€€å‡ºå‡½æ•°ï¼šhttps://blog.csdn.net/jinchaoh/article/details/50340743\nexit()å‡½æ•°ç”¨äºåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­éšæ—¶ç»“æŸç¨‹åºï¼Œå…¶åŸå‹ä¸ºï¼š void exit(int state); exitçš„å‚æ•°stateæ˜¯è¿”å›ç»™æ“ä½œç³»ç»Ÿæˆ–å½“å‰ç¨‹åºçš„è°ƒç”¨ç¨‹åºï¼Œè¿”å›0è¡¨ç¤ºç¨‹åºæ­£å¸¸ç»“æŸï¼Œé0è¡¨ç¤ºç¨‹åºéæ­£å¸¸ç»“æŸã€‚mainå‡½æ•°ç»“æŸæ—¶ä¹Ÿä¼šéšå¼åœ°è°ƒç”¨exit()å‡½æ•°ã€‚exit()å‡½æ•°è¿è¡Œæ—¶é¦–å…ˆä¼šæ‰§è¡Œç”±atexit()å‡½æ•°ç™»è®°çš„å‡½æ•°ï¼Œç„¶åä¼šåšä¸€äº›è‡ªèº«çš„æ¸…ç†å·¥ä½œï¼ŒåŒæ—¶åˆ·æ–°æ‰€æœ‰è¾“å‡ºæµã€å…³é—­æ‰€æœ‰æ‰“å¼€çš„æµå¹¶ä¸”å…³é—­é€šè¿‡æ ‡å‡†I/Oå‡½æ•°tmpfile()åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶ã€‚\natexit() ç”¨äºæ³¨å†Œç»ˆæ­¢å‡½æ•°(å³mainæ‰§è¡Œç»“æŸåè°ƒç”¨çš„å‡½æ•°)ï¼Œå…¶åŸå‹ä¸ºï¼š int atexit(void (*function)(void)); å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºé€€å‡ºçš„æ—¶å€™åšä¸€äº›è¯¸å¦‚é‡Šæ”¾èµ„æºçš„æ“ä½œï¼Œä½†ç¨‹åºé€€å‡ºçš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚main()å‡½æ•°è¿è¡Œç»“æŸã€åœ¨ç¨‹åºçš„æŸä¸ªåœ°æ–¹ç”¨exit()ç»“æŸç¨‹åºã€ç”¨æˆ·é€šè¿‡Ctrl+Cæˆ–Ctrl+breakæ“ä½œæ¥ç»ˆæ­¢ç¨‹åºç­‰ç­‰ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€ç§ä¸ç¨‹åºé€€å‡ºæ–¹å¼æ— å…³çš„æ–¹æ³•æ¥è¿›è¡Œç¨‹åºé€€å‡ºæ—¶çš„å¿…è¦å¤„ç†ã€‚æ–¹æ³•å°±æ˜¯ç”¨atexit()å‡½æ•°æ¥æ³¨å†Œç¨‹åºæ­£å¸¸ç»ˆæ­¢æ—¶è¦è¢«è°ƒç”¨çš„å‡½æ•°ã€‚\né¢å¤–æ€è€ƒï¼šmainæ˜¯æ€ä¹ˆå¼€å§‹çš„? http://wen00072.github.io/blog/2015/02/14/main-linux-whos-going-to-call-in-c-language/\nä¸‰ä¸ªå¯¹è°ƒè¯•æœ‰ç”¨çš„å®(åœ¨ nemu/include/debug.hä¸­å®šä¹‰) Log()æ˜¯ printf()çš„å‡çº§ç‰ˆ, ä¸“é—¨ç”¨æ¥è¾“å‡ºè°ƒè¯•ä¿¡æ¯, åŒæ—¶è¿˜ä¼šè¾“å‡ºä½¿ç”¨ Log()æ‰€åœ¨çš„æºæ–‡ä»¶, è¡Œå·å’Œå‡½æ•°. å½“è¾“å‡ºçš„è°ƒè¯•ä¿¡æ¯è¿‡å¤šçš„æ—¶å€™, å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®šä½åˆ°ä»£ç ä¸­çš„ç›¸å…³ä½ç½®ï¼ˆéå¸¸å¥½ç”¨ï¼ï¼ï¼ï¼éå¸¸æ¨èï¼‰ Assert()æ˜¯ assert()çš„å‡çº§ç‰ˆ, å½“æµ‹è¯•æ¡ä»¶ä¸ºå‡æ—¶, åœ¨assertion failä¹‹å‰å¯ä»¥è¾“å‡ºä¸€äº›ä¿¡æ¯ panic()ç”¨äºè¾“å‡ºä¿¡æ¯å¹¶ç»“æŸç¨‹åº, ç›¸å½“äºæ— æ¡ä»¶çš„assertion fail å†…å­˜é€šè¿‡åœ¨ nemu/src/memory/paddr.cä¸­å®šä¹‰çš„å¤§æ•°ç»„ pmemæ¥æ¨¡æ‹Ÿ.\nåœ¨å®¢æˆ·ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­, æ€»æ˜¯ä½¿ç”¨ vaddr_read()å’Œ vaddr_write() (åœ¨ nemu/src/memory/vaddr.cä¸­å®šä¹‰)æ¥è®¿é—®æ¨¡æ‹Ÿçš„å†…å­˜.ï¼ˆè¿™é‡Œå·²ç»å‘Šè¯‰äº†ä½ ä¸‹é¢æ¶‰åŠé—®é¢˜çš„ç­”æ¡ˆï¼ï¼‰\nvaddr, paddråˆ†åˆ«ä»£è¡¨è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€.\nPA1.ç®€æ˜“è°ƒè¯•å™¨ ç®€æ˜“è°ƒè¯•å™¨(Simple Debugger, sdb)æ˜¯NEMUä¸­ä¸€é¡¹éå¸¸é‡è¦çš„åŸºç¡€è®¾æ–½.\næˆ‘ä»¬çŸ¥é“NEMUæ˜¯ä¸€ä¸ªç”¨æ¥æ‰§è¡Œå…¶å®ƒå®¢æˆ·ç¨‹åºçš„ç¨‹åº, è¿™æ„å‘³ç€, NEMUå¯ä»¥éšæ—¶äº†è§£å®¢æˆ·ç¨‹åºæ‰§è¡Œçš„æ‰€æœ‰ä¿¡æ¯. ç„¶è€Œè¿™äº›ä¿¡æ¯å¯¹å¤–é¢çš„è°ƒè¯•å™¨(ä¾‹å¦‚GDB)æ¥è¯´, æ˜¯ä¸å®¹æ˜“è·å–çš„. ä¾‹å¦‚åœ¨é€šè¿‡GDBè°ƒè¯•NEMUçš„æ—¶å€™, ä½ å°†å¾ˆéš¾åœ¨NEMUä¸­è¿è¡Œçš„å®¢æˆ·ç¨‹åºä¸­è®¾ç½®æ–­ç‚¹, ä½†å¯¹äºNEMUæ¥è¯´, è¿™æ˜¯ä¸€ä»¶ä¸å¤ªå›°éš¾çš„äº‹æƒ….\nä¸ºäº†æé«˜è°ƒè¯•çš„æ•ˆç‡, åŒæ—¶ä¹Ÿä½œä¸ºç†Ÿæ‚‰æ¡†æ¶ä»£ç çš„ç»ƒä¹ , æˆ‘ä»¬éœ€è¦åœ¨monitorä¸­å®ç°ä¸€ä¸ªå…·æœ‰å¦‚ä¸‹åŠŸèƒ½çš„ç®€æ˜“è°ƒè¯•å™¨:\n(1) å‘½ä»¤å·²å®ç° (2) ä¸GDBç›¸æ¯”, æˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ç®€åŒ–, æ›´æ”¹äº†å‘½ä»¤çš„æ ¼å¼ å‘½ä»¤ æ ¼å¼ ä½¿ç”¨ä¸¾ä¾‹ è¯´æ˜ å¸®åŠ©(1) help help æ‰“å°å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ ç»§ç»­è¿è¡Œ(1) c c ç»§ç»­è¿è¡Œè¢«æš‚åœçš„ç¨‹åº é€€å‡º(1) q q é€€å‡ºNEMU å•æ­¥æ‰§è¡Œ si [N] si 10 è®©ç¨‹åºå•æ­¥æ‰§è¡ŒNæ¡æŒ‡ä»¤åæš‚åœæ‰§è¡Œ,``å½“ Næ²¡æœ‰ç»™å‡ºæ—¶, ç¼ºçœä¸º 1 æ‰“å°ç¨‹åºçŠ¶æ€ info SUBCMD info rinfo w æ‰“å°å¯„å­˜å™¨çŠ¶æ€``æ‰“å°ç›‘è§†ç‚¹ä¿¡æ¯ æ‰«æå†…å­˜(2) x N EXPR x 10 $esp æ±‚å‡ºè¡¨è¾¾å¼EXPRçš„å€¼, å°†ç»“æœä½œä¸ºèµ·å§‹å†…å­˜``åœ°å€, ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºè¿ç»­çš„ Nä¸ª4å­—èŠ‚ è¡¨è¾¾å¼æ±‚å€¼ p EXPR p $eax + 1 æ±‚å‡ºè¡¨è¾¾å¼EXPRçš„å€¼, EXPRæ”¯æŒçš„``è¿ç®—è¯·è§è°ƒè¯•ä¸­çš„è¡¨è¾¾å¼æ±‚å€¼å°èŠ‚ è®¾ç½®ç›‘è§†ç‚¹ w EXPR w *0x2000 å½“è¡¨è¾¾å¼EXPRçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶, æš‚åœç¨‹åºæ‰§è¡Œ åˆ é™¤ç›‘è§†ç‚¹ d N d 2 åˆ é™¤åºå·ä¸ºNçš„ç›‘è§†ç‚¹ ä½ éœ€è¦åœ¨å®ç°ä¸€ä¸ªåŠŸèƒ½ä¹‹åå¯¹å®ƒè¿›è¡Œå……åˆ†çš„æµ‹è¯•. éšç€æ—¶é—´çš„æ¨ç§», å‘ç°åŒä¸€ä¸ªbugæ‰€éœ€è¦çš„ä»£ä»·ä¼šè¶Šæ¥è¶Šå¤§.\nå®ç°æ­¥éª¤ï¼š\nä»é”®ç›˜ä¸Šè¯»å…¥å‘½ä»¤å, NEMUéœ€è¦è§£æè¯¥å‘½ä»¤â€”â€”åˆ©ç”¨æ¡†æ¶ä»£ç è°ƒç”¨å•æ­¥æ‰§è¡Œâ€”â€”æ‰“å°å¯„å­˜å™¨â€”â€”æ‰«æå†…å­˜\nï¼ˆNEMUé»˜è®¤ä¼šæŠŠå•æ­¥æ‰§è¡Œçš„æŒ‡ä»¤æ‰“å°å‡ºæ¥(è¿™é‡Œé¢åŸ‹äº†ä¸€äº›å‘, ä½ éœ€è¦RTFSCçœ‹çœ‹æŒ‡ä»¤æ˜¯åœ¨å“ªé‡Œè¢«æ‰“å°çš„), è¿™æ ·ä½ å°±å¯ä»¥éªŒè¯å•æ­¥æ‰§è¡Œçš„æ•ˆæœäº†.ï¼‰\nè¯»å…¥å¹¶è§£æ NEMUé€šè¿‡ readlineåº“ä¸ç”¨æˆ·äº¤äº’\nè§£æå‘½ä»¤çš„å·¥ä½œæ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°æ¥å®Œæˆçš„, ä¾‹å¦‚æ¡†æ¶ä»£ç ä¸­çš„ strtok()ã€strlen(), strcpy()ã€sscanf()ç­‰\nreadlineï¼šï¼ˆä½¿ç”¨äº†ç³»ç»Ÿåº“è¦è®°å¾—-lreadlineé“¾æ¥ï¼‰\nstrtok:è¦æ³¨æ„ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼šè¢«ä»–æ›¿æ¢æˆ\\0ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²è¯»å‡ºåæ¥ä¸‹æ¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±è¦ç”¨NULLæ›¿æ¢\nstrtokä¸èƒ½ä¿è¯å­—ç¬¦ä¸²çš„å®Œæ•´ï¼Œè¦ä¿æŒå­—ç¬¦ä¸²çš„å®Œæ•´å¯ä»¥ç”¨strchrå’Œsscanfçš„ç»„åˆã€‚\nè¡¨è¾¾å¼çš„å®ç° å…³é”®ï¼š\nå¸¸è§çš„operatoréœ€è¦åŒ¹é… ç•™ä¸‹ä¸¤ä¸ªå†—ä½™ç»™æŒ‡é’ˆè§£å¼•ç”¨ è¿™é‡Œæˆ‘èŠ±äº†å‡ å¤©é‡æ„äº†ï¼ˆç›¸å½“äºé‡å†™ï¼‰äº†ä¸€éæ±‚è§£è¡¨è¾¾å¼çš„é€»è¾‘ã€‚å¤§æ¦‚æ¶ˆè€—äº†ä¸€å‘¨ã€‚\nç¬¬ä¸€ä¸ªéš¾ç‚¹åœ¨äºå¦‚ä½•ä¼˜é›…çš„æŠŠå­—ç¬¦ä¸²ä¿ç•™åˆ°token[].strä¸­ï¼Œä½ éœ€è¦ææ˜ç™½ä»€ä¹ˆæ˜¯ç»“æ„ä½“æ•°ç»„ä¸æŒ‡é’ˆï¼ˆä¹‹åçš„é™æ€é“¾è¡¨ä¹Ÿä¼šç”¨åˆ°ï¼\nç¬¬äºŒä¸ªéš¾ç‚¹åœ¨äºopåŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¦‚ä½•ç»™å‡ºopï¼ˆä¼˜å…ˆçº§æ’åˆ—ï¼‰ï¼Œè¿™é‡Œå‚è€ƒäº†ä¸€ä¸‹åˆ«äººçš„ç®—æ³•ï¼ˆæˆ‘è‡ªå·±çš„bugå¾ˆå¤šï¼‰é‡‡ç”¨äº†ä¸€ä¸ªè®¾è®¡å¤§åˆ°å°è¦†ç›–çš„æ–¹æ³•ï¼Œèƒ½ä¿è¯ä¿ç•™â€œæœ€å¤§â€æ ‡è¯†çš„ç¬¦å·ä½œä¸ºopï¼Œï¼ˆä½ ä»å°¾éƒ¨å¼€å§‹æ‰«æä¹Ÿè¡Œï¼Œæ¢ä¸ªæ–¹å‘è¦†ç›–ç¬¦å·ç½¢äº†ï¼‰ã€‚\nç¬¬ä¸‰ä¸ªéš¾ç‚¹åœ¨äºå¦‚ä½•ä¼˜é›…çš„æ£€æŸ¥æ‹¬å·ï¼Œå¦‚æœä½ åªåœ¨på’Œqè¾¹ç•Œæ£€æŸ¥ï¼Œå®¹æ˜“å‡ºç°(1+1)+(1+1)çš„é”™è¯¯ï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šå¾ˆå¤šåŠæ³•ï¼Œæœ€åç”¨äº†ä¸€ä¸ªi+-å¹¶ä¸”åˆ¤æ–­ä¼šä¸ä¼šâ€œè¿˜æ²¡è¯»å®Œiå°±å˜0äº†â€æ¥é¿å…è¿™ä¸ªé”™è¯¯ã€‚\nç¬¬å››ä¸ªéš¾ç‚¹åœ¨äºè´Ÿæ•°å’ŒæŒ‡é’ˆçš„æ‹¦æˆªï¼Œä½ éœ€è¦åœ¨åˆ«çš„åœ°æ–¹è¿›è¡Œæ‹¦æˆªï¼Œæ£€æŸ¥ä¹‹å‰çš„ç¬¦å·ã€‚\nç›‘è§†ç‚¹çš„å®ç° ç›‘è§†ç‚¹ï¼šå®é™…ä¸Šè¿™ä¸ªæ˜¯ä¸€ä¸ªâ€œèƒ½æ”¹å¤§å°â€çš„é™æ€é“¾è¡¨ï¼Œä¸éœ€è¦mallocï¼Œç†Ÿæ‚‰äº†é“¾è¡¨æ“ä½œå®é™…ä¸Šä¸éš¾ï¼ˆæˆ‘èŠ±æ—¶é—´æ‰‹å†™äº†ä¸€ä¸‹åŠ¨æ€é“¾è¡¨å†çœ‹è¿™å„¿ç»“æ„ä½“æ•°ç»„ä¸€å¼€å§‹è¿˜æœ‰ç‚¹è¯§å¼‚ï¼‰\nå¦ä¸€ä¸ªå…³é”®æ˜¯è¦ç†è§£staticçš„å¥¥ä¹‰æ‰€åœ¨ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸ºäº†å°†è¿™ä¸ªé“¾è¡¨éš”ç¦»åœ¨è¯¥ä½œç”¨èŒƒå›´å†…ä¸è¦è¢«å…¶ä»–æ–‡ä»¶è®¿é—®ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ“ä½œéƒ½è¦åœ¨sdbå’Œwatchpointé‡Œè¿›è¡Œï¼Œä¸è¦å¯¹å¤–æš´éœ²å˜é‡ï¼Œåªéœ€è¦æš´éœ²å‡½æ•°èƒ½å¤Ÿä½¿å¾—ä»–è¢«è°ƒç”¨å³å¯ã€‚è¿™ä¹Ÿæ˜¯ç¨‹åºéš”ç¦»çš„é‡è¦æ€§æ‰€åœ¨ï¼ˆä¸€å¼€å§‹æˆ‘è§‰å¾—éº»çƒ¦ï¼Œä½†å‡å°è€¦åˆçš„è§’åº¦æ¥è¯´è¿™éå¸¸é‡è¦ï¼Œè¦åšåˆ°èŒè´£åˆ†ç¦»ï¼‰ï¼Œæ‰€æœ‰çš„æ•°æ®ç»“æ„è®¿é—®å’Œæ“ä½œéƒ½åœ¨é“¾è¡¨çš„Cæ–‡ä»¶ä¸­æ‰§è¡Œï¼Œä¹Ÿä¸è¦å¯¹å¤–æš´éœ²ï¼›è€ŒCPUæ¯æ¬¡æ‰§è¡Œå®Œåçš„æ£€æŸ¥ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨é“¾è¡¨Cçš„å¤´æ–‡ä»¶è¿›è¡Œå‡½æ•°æ‰§è¡Œï¼ˆç›´æ¥æ‰§è¡Œï¼‰ï¼Œåšåˆ°èŒè´£åˆ†ç¦»å’Œéš”ç¦»ã€‚è‡³äºåŒ…ä¸€ä¸ªå®ï¼Œè¿™ä¸ªé€šè¿‡RTFCå¤šå¤šå°è¯•å³å¯å¾—åˆ°ç»“æœã€‚\nReference ã€é‡ç‚¹ã€‘ ps:æœ€å¥½å¯ä»¥æŒæ¡ä¸€äº›å¸¸ç”¨çš„Cå­—ç¬¦ä¸²æ ‡å‡†åº“ï¼Œå¦‚strcpy strnpy\ngdb layoutçª—å£ (å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥gdb xxx -tui)\nlayoutï¼šç”¨äºåˆ†å‰²çª—å£ï¼Œå¯ä»¥ä¸€è¾¹æŸ¥çœ‹ä»£ç ï¼Œä¸€è¾¹æµ‹è¯•ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ç”¨æ³•ï¼š layout srcï¼šæ˜¾ç¤ºæºä»£ç çª—å£ layout asmï¼šæ˜¾ç¤ºæ±‡ç¼–çª—å£ layout regsï¼šæ˜¾ç¤ºæºä»£ç /æ±‡ç¼–å’Œå¯„å­˜å™¨çª—å£ layout splitï¼šæ˜¾ç¤ºæºä»£ç å’Œæ±‡ç¼–çª—å£ layout nextï¼šæ˜¾ç¤ºä¸‹ä¸€ä¸ªlayout layout prevï¼šæ˜¾ç¤ºä¸Šä¸€ä¸ªlayout Ctrl + Lï¼šåˆ·æ–°çª—å£ Ctrl + xï¼Œå†æŒ‰1ï¼šå•çª—å£æ¨¡å¼ï¼Œæ˜¾ç¤ºä¸€ä¸ªçª—å£ Ctrl + xï¼Œå†æŒ‰2ï¼šåŒçª—å£æ¨¡å¼ï¼Œæ˜¾ç¤ºä¸¤ä¸ªçª—å£ Ctrl + xï¼Œå†æŒ‰aï¼šå›åˆ°ä¼ ç»Ÿæ¨¡å¼ï¼Œå³é€€å‡ºlayoutï¼Œå›åˆ°æ‰§è¡Œlayoutä¹‹å‰çš„è°ƒè¯•çª—å£ã€‚\nGDBå¿«æ·é”® 100ä¸ªgdb\nå¸¸è§çš„å‘½ä»¤ï¼š\nè®°ä½runå’Œstartçš„åŒºåˆ«ï¼\nå¦‚ä½•æ‰“å°å˜é‡çš„å€¼ï¼Ÿ(print var)\nå¦‚ä½•æ‰“å°å˜é‡çš„åœ°å€ï¼Ÿ(print \u0026amp;var) å¦‚ä½•æ‰“å°åœ°å€çš„æ•°æ®å€¼ï¼Ÿ(print *address) å¦‚ä½•æŸ¥çœ‹å½“å‰è¿è¡Œçš„æ–‡ä»¶å’Œè¡Œï¼Ÿ(backtrace) å¦‚ä½•æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çš„ä»£ç ï¼Ÿ(list file:N) å¦‚æœç¨‹åºæ˜¯å¤šæ–‡ä»¶çš„ï¼Œæ€æ ·å®šä½åˆ°æŒ‡å®šæ–‡ä»¶çš„æŒ‡å®šè¡Œæˆ–è€…å‡½æ•°ï¼Ÿ(list file:N) å¦‚æœå¾ªç¯æ¬¡æ•°å¾ˆå¤šï¼Œå¦‚ä½•æ‰§è¡Œå®Œå½“å‰çš„å¾ªç¯ï¼Ÿ(until)\nå¦‚ä½•è·³è¿‡ä¸æ„Ÿå…´è¶£çš„å‡½æ•°ï¼ˆnï¼‰\ngdbä¸­è·³å…¥å‡½æ•°çš„å‘½ä»¤æ˜¯stepï¼Œç›¸å½“äºVisual Studioä¸­çš„å¿«æ·é”®F11ï¼Œ gdbä¸­è·³å‡ºå‡½æ•°çš„å‘½ä»¤æ˜¯finishï¼Œç›¸å½“äºVisual Studioä¸­çš„å¿«æ·é”®Shift+F11ï¼Œå‡½æ•°å®Œæ•´æ‰§è¡Œåè¿”å›\ngdbä¸­è¿˜æœ‰ä¸€ä¸ªç›´æ¥è¿”å›çš„å‘½ä»¤æ˜¯returnï¼Œå®ƒä¼šè·³è¿‡å½“å‰å‡½æ•°åé¢çš„è¯­å¥ç›´æ¥è¿”å›ï¼Œè¿”å›å€¼å¯ä»¥è‡ªå®šä¹‰ï¼Œç´§è·Ÿåœ¨returnå‘½ä»¤åé¢å³å¯\nè¿›é˜¶å‘½ä»¤ï¼š\nå¦‚ä½•æ‰“å°å†…å­˜ï¼Ÿ gdbä¸­ä½¿ç”¨â€œxâ€å‘½ä»¤æ¥æ‰“å°å†…å­˜çš„å€¼ï¼Œæ ¼å¼ä¸ºâ€œx/nfu addrâ€ã€‚å«ä¹‰ä¸ºä»¥ fæ ¼å¼æ‰“å°ä» addrå¼€å§‹çš„ nä¸ªé•¿åº¦å•å…ƒä¸º uçš„å†…å­˜å€¼ã€‚å‚æ•°å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š aï¼‰nï¼šè¾“å‡ºå•å…ƒçš„ä¸ªæ•°ã€‚ bï¼‰fï¼šæ˜¯è¾“å‡ºæ ¼å¼ã€‚æ¯”å¦‚ xæ˜¯ä»¥16è¿›åˆ¶å½¢å¼è¾“å‡ºï¼Œoæ˜¯ä»¥8è¿›åˆ¶å½¢å¼è¾“å‡º,ç­‰ç­‰ã€‚ cï¼‰uï¼šæ ‡æ˜ä¸€ä¸ªå•å…ƒçš„é•¿åº¦ã€‚bæ˜¯ä¸€ä¸ª byteï¼Œhæ˜¯ä¸¤ä¸ª byteï¼ˆhalfwordï¼‰ï¼Œwæ˜¯å››ä¸ª byteï¼ˆwordï¼‰ï¼Œgæ˜¯å…«ä¸ª byteï¼ˆgiant wordï¼‰\næ¯”å¦‚ï¼šä»¥16è¿›åˆ¶æ ¼å¼æ‰“å°æ•°ç»„å‰ a16ä¸ªbyteçš„å€¼ï¼š x/16xb a\nå¦‚ä½•æ‰“å°å †æ ˆä¿¡æ¯ï¼Ÿ ä½¿ç”¨gdbè°ƒè¯•ç¨‹åºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€œi frameâ€å‘½ä»¤ï¼ˆiæ˜¯ infoå‘½ä»¤ç¼©å†™ï¼‰æ˜¾ç¤ºå‡½æ•°å †æ ˆå¸§ä¿¡æ¯ã€‚\nå‚è€ƒæ–‡æ¡£ ä½™å­æ¿  ä»movæŒ‡ä»¤åˆ°ä»™å‰‘ï¼šé€šè¿‡NEMUæ„å»ºç®€å•å®Œæ•´çš„è®¡ç®—æœºç³»ç»Ÿ ","date":"2022-06-11T22:50:40+08:00","permalink":"https://sanbuphy.github.io/p/nju%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%BE%E7%A8%8B%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C-pa1%E7%AC%94%E8%AE%B0/","title":"NJUè®¡ç®—æœºè¯¾ç¨‹åŸºç¡€å®éªŒ PA1ç¬”è®°"},{"content":"å¦‚æœæƒ³è¦äº†è§£æ›´ä»”ç»†åœ°è¿‡ç¨‹ï¼Œå»ºè®®çœ‹csappæˆ–è€…ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹\næœ€ç›´æ¥çš„ç¼–è¯‘è¿‡ç¨‹ åˆå§‹.cæ–‡ä»¶é€šè¿‡é¢„å¤„ç†å™¨ã€ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨ã€é“¾æ¥å™¨å¾—åˆ°æœ€åçš„å¯æ‰§è¡Œç¨‹åºï¼ˆæ¯”å¦‚linuxç³»ç»Ÿä¸‹çš„a.outï¼‰\nhello.iï¼šhello.cç»é¢„å¤„ç†ç”Ÿæˆçš„æ–‡æœ¬æ–‡ä»¶ã€‚\nhello.sï¼šhello.iç»ç¼–è¯‘ç”Ÿæˆçš„æ±‡ç¼–è¯­è¨€æ–‡ä»¶ã€‚\nhello.oï¼šhello.sç»æ±‡ç¼–ç”Ÿæˆçš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ã€‚\nhelloï¼šhello.oç»é“¾æ¥ç”Ÿæˆçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚\nåœ¨ç»è¿‡ä¸åŒå¤„ç†é˜¶æ®µçš„ç¨‹åºåˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿè®©æˆ‘ä»¬ç”¨gccåˆ†æ­¥è°ƒè¯•å³å¯ï¼š\nä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è·å¾—æ‰€æœ‰è¾“å‡ºï¼šgcc -save-temps main.c â€“o main\nä¸€ã€é¢„å¤„ç†è¿‡ç¨‹ åœ¨é¢„å¤„ç†é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¸»è¦å®Œæˆäº†è¿™å‡ ä»¶äº‹ï¼š\nå»æ‰æ‰€æœ‰çš„æ³¨é‡Š\nå±•å¼€æ‰€æœ‰çš„å®å®šä¹‰ï¼ˆä¹Ÿå°±æ˜¯åšå­—ç¬¦æ›¿æ¢ï¼‰\næ’å…¥#includeæ–‡ä»¶çš„å†…å®¹\nå¤„ç†æ‰€æœ‰çš„æ¡ä»¶ç¼–è¯‘ï¼ˆå½¢å¦‚#ifndefçš„è¯­å¥ï¼Œè¯¦è§ æ¡ä»¶ç¼–è¯‘\nå¦‚æœæƒ³è¦è·å¾—.içš„é¢„å¤„ç†æ–‡ä»¶ï¼Œéœ€è¦è¾“å…¥ gcc -E main.c -o main.i ï¼Œ-Eé€‰é¡¹ä¿ç•™é¢„å¤„ç†å™¨çš„è¾“å‡ºæ–‡ä»¶ï¼Œä½†é»˜è®¤è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµï¼Œä½ éœ€è¦-oæŒ‡å®šä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ã€‚\nå› ä¸ºå¤´æ–‡ä»¶å¯èƒ½ç›¸å½“å¤§ï¼Œå¦‚æœæºæ–‡ä»¶åŒ…æ‹¬äº†å¤šä¸ªå¤´æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒçš„é¢„å¤„ç†å™¨è¾“å‡ºå¯èƒ½ä¼šåºæ‚éš¾è¯»ã€‚ä½¿ç”¨-Cé€‰é¡¹ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥é˜»æ­¢é¢„å¤„ç†å™¨åˆ é™¤æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶ä¸­çš„æ³¨é‡Šï¼šgcc -E -C main.c -o main.c\næµ‹è¯•æ•ˆæœå¦‚ä¸‹ï¼Œæˆ‘ä»¬èƒ½ç¡®å®çœ‹åˆ°ä¸Šè¿°å‡ ä»¶äº‹æƒ…çš„å‘ç”Ÿï¼šï¼ˆå¯ä»¥ä½¿ç”¨cat main.iæˆ–è€…vim main.iæŸ¥çœ‹ç»“æœï¼‰\næœ‰å…³é¢„ç¼–è¯‘ï¼Œå¦‚æœæƒ³çŸ¥é“æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ é¢„ç¼–è¯‘å™¨\næ ‡å‡†è¾“å‡ºæµé»˜è®¤æ˜¯æ˜¾ç¤ºå™¨ï¼Œä½†ç†è®ºä¸Šé€šè¿‡æ§åˆ¶stdoutçš„å®ç°æ¥æºdupå¯ä»¥ä¿®æ”¹æˆæ–‡ä»¶æˆ–è€…å…¶ä»–å¯å†™ç©ºé—´\näºŒã€ç¼–è¯‘è¿‡ç¨‹ ç¼–è¯‘èƒ½å¤Ÿå°†hello.i æ–‡ä»¶ç¼–è¯‘ç”Ÿæˆæ±‡ç¼–è¯­è¨€ç¨‹åº hello.sï¼Œä¸ºä¹‹åçš„æ±‡ç¼–è¿‡ç¨‹åšé“ºå«ã€‚æ±‡ç¼–è¯­è¨€ç¨‹åºä¸­çš„æ¯æ¡è¯­å¥éƒ½ä»¥ä¸€ç§æ ‡å‡†çš„æ–‡æœ¬æ ¼å¼ç¡®åˆ‡åœ°æè¿°äº†ä¸€æ¡ä½çº§æœºå™¨è¯­è¨€æŒ‡ä»¤ï¼Œæ±‡ç¼–è¯­è¨€ä¸ºä¸åŒé«˜çº§è¯­è¨€çš„ä¸åŒç¼–è¯‘å™¨æä¾›äº†é€šç”¨çš„è¾“å‡ºè¯­è¨€ã€‚å¦‚æœæƒ³çœ‹æ‡‚ä»–ä»¬ï¼Œå¯ä»¥å»çœ‹çœ‹csappçš„ç¬¬ä¸‰ç« ã€‚\nä½¿ç”¨gcc -S main.i -o main.s æˆ–è€… gcc -S main.cç”Ÿæˆæ±‡ç¼–ç¨‹åºï¼Œå³å¯çœ‹åˆ°æ•ˆæœï¼š\nå¦‚æœä½ å°è¯•ä¸åŒä»£ç ï¼Œä½ ä¼šå‘ç°æ±‡ç¼–ä»£ç é€»è¾‘æ¯”èµ·æºä»£ç é€»è¾‘å‘ç”Ÿäº†ç®€åŒ–ç”šè‡³æ›´æ¢ä½ç½®ï¼Œè¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¯¹ç¨‹åºçš„æ±‡ç¼–å®ç°è¿›è¡Œä¼˜åŒ–ï¼Œç¼–è¯‘å™¨æ˜¯å¾ˆèªæ˜çš„ã€‚ä½†å¦‚æœä½ æƒ³è·å¾—åŸæ±åŸå‘³ç»“æ„çš„æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨gcc -0g -E main.cè·å¾—ç¬¦åˆç»“æ„çš„ä¼˜åŒ–ç­‰çº§ï¼ˆå¦‚æœè¦è·å¾—è¾ƒå¥½çš„ä¼˜åŒ–ä¸€èˆ¬éœ€è¦æŠŠ-0gæ”¹ä¸º-01æˆ–è€…-01ï¼‰ ä¸‰ã€æ±‡ç¼–è¿‡ç¨‹ æ¥ä¸‹æ¥ï¼Œæ±‡ç¼–å™¨å°†hello.sç¿»è¯‘æˆæœºå™¨è¯­è¨€æŒ‡ä»¤ï¼ŒæŠŠè¿™äº›æŒ‡ä»¤æ‰“åŒ…æˆä¸€ç§å«åšå¯é‡å®šä½ç›®æ ‡ç¨‹åºçš„æ ¼å¼ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ç›®æ ‡æ–‡ä»¶main.oä¸­ã€‚\nä½¿ç”¨gcc -c main.s -o main.oæˆ–è€…gcc -c main.cå¾—åˆ°main.oç›®æ ‡æ–‡ä»¶ã€‚main.oæ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒçš„å­—èŠ‚ç¼–ç æ˜¯æœºå™¨è¯­è¨€æŒ‡ä»¤è€Œä¸æ˜¯å­—ç¬¦ï¼Œå¦‚æœvimå¼ºåˆ¶æ‰“å¼€main.oæ–‡ä»¶ï¼Œçœ‹åˆ°çš„å°†æ˜¯ä¸€å †ä¹±ç ï¼š\nå¦‚æœæƒ³çœ‹ä»–çš„æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥ç”¨åæ±‡ç¼–å™¨æ¥æŸ¥çœ‹å®ƒçš„ç¼–ç ï¼šobjdump â€“d main.o\nå®é™…ä¸Šï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¹Ÿèƒ½ç›´æ¥æ”¹ï¼Œåœ¨jyyæ“ä½œç³»ç»Ÿè¯¾ç¨‹ä¸­ä½ èƒ½å­¦åˆ°è¿™ç§æœ‰è¶£çš„æ“ä½œ å››ã€é“¾æ¥è¿‡ç¨‹ é“¾æ¥å™¨ï¼ˆldï¼‰è´Ÿè´£å°†å¤šä¸ªå¯é‡å®šä½çš„ç›®æ ‡æ–‡ä»¶ï¼ˆ.oæ–‡ä»¶ï¼‰åˆå¹¶ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè™½ç„¶å‰é¢å·²ç»å¾—åˆ°äº†æœºå™¨è¯­è¨€æ–‡ä»¶ï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦æŠŠç›®æ ‡æ–‡ä»¶ã€æ“ä½œç³»ç»Ÿçš„å¯åŠ¨ä»£ç å’Œç”¨åˆ°çš„åº“æ–‡ä»¶è¿›è¡Œç»„ç»‡å¾—åˆ°æœ€åçš„æ‰§è¡Œæ–‡ä»¶ï¼ˆæ¯”å¦‚printfå°±æ˜¯ä»åˆ«çš„åº“æ–‡ä»¶æ¥çš„ï¼‰ã€‚\né€šè¿‡é“¾æ¥è¿‡ç¨‹å°†main.oå˜ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨gcc main.c -o mainæˆ–è€…gcc main.c\nç”±äºè¿™é‡Œç”¨åˆ°äº†å…¶ä»–æ–‡ä»¶çš„å‡½æ•°ï¼ˆå®é™…ä¸Šå°è¯•å®ç°äº†ä¸€ä¸ªé™æ€åº“ï¼Œå¦‚æœæ˜¯å•æ–‡ä»¶å°±æŒ‰ç…§å‰é¢çš„æ–¹æ³•å³å¯ï¼‰éœ€è¦ä½¿ç”¨gcc main.c get_minus.c -o run ï¼Œå¯ä»¥çœ‹åˆ°æœ€åç”Ÿæˆäº†runï¼Œä½¿ç”¨./runå³å¯çœ‹åˆ°ç»“æœï¼š\nå¦‚æœç›´æ¥è¿›è¡Œgcc main.cçš„æ“ä½œï¼Œå¾—åˆ°çš„å°†æ˜¯a.outæ–‡ä»¶ï¼Œç”¨åŒæ ·çš„æ–¹æ³•å¯ä»¥è¿è¡Œå¾—åˆ°ç»“æœã€‚\né€šè¿‡ls -læˆ‘ä»¬å¯ä»¥å°†.oæ–‡ä»¶ä¸æœ€åå¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œå¤§å°æ¯”è¾ƒï¼Œå¯ä»¥å‘ç°æœ€åçš„æ‰§è¡Œæ–‡ä»¶å¤§å°è¿˜æ˜¯å¤§å¾ˆå¤šçš„ã€‚\nå¦‚æœæƒ³ç”¨gdbè¿›è¡Œè°ƒè¯•ï¼Œä½ éœ€è¦è¿™æ ·å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼šgcc main.c -o main -g\nå¦‚æœæƒ³è¿›ä¸€æ­¥å­¦ä¹ æ€ä¹ˆç”Ÿæˆè‡ªå·±çš„é™æ€é“¾æ¥åº“ä¸åŠ¨æ€é“¾æ¥åº“ï¼Œå¯ä»¥å‚è€ƒï¼šé™æ€é“¾æ¥åº“ä¸åŠ¨æ€é“¾æ¥åº“\nReference https://blog.csdn.net/Shrimp_millet/article/details/94574406\nhttps://zhuanlan.zhihu.com/p/307730265\nhttps://blog.csdn.net/u012184539/article/details/81348529\nhttps://www.runoob.com/cprogramming/c-examples.html\nhttps://wangjunstf.github.io/2021/09/30/jing-tai-ku-he-dong-tai-ku-zhi-zuo/\nhttps://www.runoob.com/cprogramming/c-functions.html\nhttp://c.biancheng.net/view/2375.html\n","date":"2022-05-18T13:24:37+08:00","permalink":"https://sanbuphy.github.io/p/c%E8%AF%AD%E8%A8%80%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B%E7%AE%80%E4%BB%8B/","title":"cè¯­è¨€ç¼–è¯‘è¿‡ç¨‹ç®€ä»‹"},{"content":"é•¿è¯çŸ­è¯´ï¼Œç›´æ¥è´´å›¾ï¼ [éƒ¨åˆ†æ”¶é›†è‡ªbç«™] ä»¥ä¸‹æ˜¯å›¾ç‰‡åŠå…¶å¯¹åº”ç”Ÿæˆè¾“å…¥ï¼ˆå› ä¸ºå›¾ç‰‡å‘½åæ›´æ”¹äº†æ ¼å¼ï¼Œå«æœ‰\u0026rsquo;_\u0026lsquo;å­—æ ·ï¼Œè¯·è‡ªè¡Œå¤„ç†ä¸€ä¸‹æˆ–è€…å†™ä¸€ä¸ª str.replace()æ–¹æ³•æ›¿æ¢æˆç©ºæ ¼,ä¸”å§æœ«å°¾çš„200å»é™¤ï¼‰\nA_beautiful_painting_of_a_romantic_and_elegant_wedding_at_sunset_A_bride_white_wedding_dress_A_church_by_the_sea_rose_beach_light_effect_Dream_Caspar_David_Friedrich_artstation_200 Light_effect_Dream_Galaxy_StarsGreg_Rutkowski_Unreal_engine_Artstation_Towering_waves_200 Splendid_colorful_fireworks_in_the_sky_desert_Dream_Karlsimon_Greg_Rutkowski_Unreal_Engine_James_Gurney_Artstation_200 The_mountains_follow_the_plains_and_the_river_flows_into_the_great_wildernessTrending_on_artstation_200 A_beautiful_painting_of_a_building_full_of_sakura_bridge_clouds_sunset_fairy_tale_Distant_town_light_effect_dream_Josan_Gonzalez_artstation_200 a_beautiful_painting_of_mysterious_hard_sci-fi_city_at_sunset_clouds_neon_light_Cyberpunk_Magnificent_Greg_Rutkowski_artstation_200 A_Moonlit_Night_On_The_Spring_River_Greg_Rutkowski_James_Gurney_Artstation_200 ps:ä½ å¯èƒ½éš¾ä»¥æƒ³è±¡ï¼Œä»–çš„è‹±æ–‡å‡ºè‡ªã€Šæ˜¥æ±ŸèŠ±æœˆå¤œã€‹â†‘\nThe_peach_blossom_lover_plants_peach_trees_in_days_fine_Greg_Rutkowski_James_Gurney_Artstation_200 ps:ä½ å¯èƒ½éš¾ä»¥æƒ³è±¡ï¼Œä»–çš„è‹±æ–‡å‡ºè‡ªå”å¯…çš„ã€Šæ¡ƒèŠ±åºµæ­Œã€‹â€œæ¡ƒèŠ±ä»™äººç§æ¡ƒæ ‘â€ â†‘\nA_Moonlit_Night_On_The_Spring_Riverromantic_In_the_morning_Greg_Rutkowski_James_Gurney_Artstation_160 ps:ä½ å¯èƒ½éš¾ä»¥æƒ³è±¡ï¼Œä»–çš„è‹±æ–‡å‡ºè‡ªã€Šæ˜¥æ±ŸèŠ±æœˆå¤œã€‹â†‘ Change_is_the_WayGreat_seas_have_turned_into_fieldsTrending_on_artstation_200 ps:ä½ å¯èƒ½éš¾ä»¥æƒ³è±¡ï¼Œä»–çš„è‹±æ–‡å‡ºè‡ªã€äººé—´æ­£é“æ˜¯æ²§æ¡‘ã€‘â†‘\nCherry_blossoms_grand_palaces_above_clouds_rivers_sunshine_dream_Greg_Rutkowski_James_Gurney_Artstation_200 Cherry_blossoms_village_river_sunshine_dream_Greg_Rutkowski_James_Gurney_Artstation_200 In_the_morning_light_some_ancient_Chinese_buildings_on_the_mountains_sakura_mysterious_and_serene_landscape_clouds_river_Ivan_Aivazovsky_artstation_200 ","date":"2022-05-12T22:25:38+08:00","image":"https://sanbuphy.github.io/p/disco-diffusion%E5%85%B3%E9%94%AE%E5%AD%97%E5%A4%A7%E8%B5%8F/cherry2_hud0ddbd73ac71be0ebba682dec347f5c6_597770_120x120_fill_box_smart1_3.png","permalink":"https://sanbuphy.github.io/p/disco-diffusion%E5%85%B3%E9%94%AE%E5%AD%97%E5%A4%A7%E8%B5%8F/","title":"Disco Diffusionå…³é”®å­—å¤§èµ"},{"content":"// TODO: //åŠ å…¥åç¨‹ç›¸å…³å†…å®¹ // èµ„æºå®‰å…¨æ€§\n// è¿›ç¨‹ã€çº¿ç¨‹é—´é€šä¿¡æ–¹å¼ // å¦‚ä½•æ•è·å­çº¿ç¨‹å¼‚å¸¸\nç®€å•ç†è§£è¿›ç¨‹å’Œçº¿ç¨‹ ä»€ä¹ˆæ˜¯è¿›ç¨‹ ä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚\nä¾‹å¦‚æ‰“å¼€æµè§ˆå™¨ï¼Œæ‰“å¼€wordï¼Œæ‰“å¼€æ¸¸æˆã€QQç­‰ç­‰ï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œå®ƒä»¬å„è‡ªä¸ºä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹ã€‚\nè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼ŒåŒä¸€ç§ä»»åŠ¡æ‰“å¼€å¤šä¸ªï¼Œåˆ†åˆ«å±äºä¸åŒè¿›ç¨‹ï¼Œä¾‹å¦‚chromeæ‰“å¼€å¤šä¸ªæ ‡ç­¾ï¼Œå®é™…ä¸Šå®ƒåˆ›å»ºäº†å¤šä¸ªè¿›ç¨‹ã€‚ â€œè¿è¡Œâ€çš„ç¨‹åºæ‰å¯ä»¥ç§°ä¸ºè¿›ç¨‹ã€‚æœªè¿è¡Œçš„ç¨‹åºä»…ä»…æ˜¯ä¸€äº›æŒ‡ä»¤å’Œæ•°æ®çš„é›†åˆï¼Œå¹¶éè¿›ç¨‹ã€‚\nä»€ä¹ˆæ˜¯çº¿ç¨‹ çº¿ç¨‹å¯ä»¥çœ‹ä½œä¸€ä¸ªä»»åŠ¡çš„å„é¡¹å­ä»»åŠ¡ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç›´æ¥çš„æ‰§è¡Œå•å…ƒã€‚\nä¾‹å¦‚æ’­æ”¾å™¨ï¼Œæ—¢è¦è§£ç è§†é¢‘ã€ä¹Ÿè¦è§£ç éŸ³é¢‘ï¼Œæ‰€ä»¥åœ¨è¿›ç¨‹ä¸‹å­˜åœ¨å¤šçº¿ç¨‹ã€‚åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸‹ä¸€å®šå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥ç§°å®ƒä¸ºä¸»çº¿ç¨‹ã€‚\nå°ç»“ æ“ä½œç³»ç»Ÿåˆ›å»ºè¿›ç¨‹æ—¶ï¼Œä¼šå•ç‹¬ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹åˆ†é…å„è‡ªçš„èµ„æºï¼Œè¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»ã€‚è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å•å…ƒï¼Œè€Œå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ã€‚ å¯è§ï¼Œæ“ä½œç³»ç»Ÿæ‰§è¡Œçš„ç²’åº¦æ˜¯çº¿ç¨‹ï¼Œåˆ†é…èµ„æºçš„ç²’åº¦æ˜¯è¿›ç¨‹ï¼Œæˆ‘ä»¬çš„å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œåœ¨å•æ ¸CPUä¸Šæ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¸Šä¸æ–­åˆ‡æ¢è€Œè¾¾åˆ°ç›®çš„ï¼Œè€Œåœ¨å¤šæ ¸CPUä¸Šåˆ™å¤šä¸ªä»»åŠ¡å¯ä»¥åˆ›å»ºå¤šä¸ªè¿›ç¨‹æ¥å®Œæˆï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹æ¥å®Œæˆï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿç›´æ¥çš„æ‰§è¡Œå•å…ƒã€‚èƒ½åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ä»»åŠ¡ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨pythonä¸­ï¼Œç”±äºå…¨å±€è§£é‡Šå™¨é”çš„å­˜åœ¨ï¼Œçº¿ç¨‹å¹¶æ²¡æœ‰å‘æŒ¥å¹¶è¡Œè®¡ç®—çš„ä½œç”¨ï¼Œè€Œæ˜¯æä¾›äº†å¹¶å‘çš„èƒ½åŠ›ã€‚ï¼ˆåªèƒ½åœ¨ä¸€ä¸ªcpuæ ¸ä¸Šè¿è¡Œï¼‰\nè¿›ç¨‹ä¸çº¿ç¨‹çš„æ¯”è¾ƒ è¿›ç¨‹çš„ä¼˜ç¼ºç‚¹ å¤šè¿›ç¨‹çš„ä¼˜ç‚¹æ˜¯ç¨³å®šæ€§å¥½ï¼Œä¸€ä¸ªå­è¿›ç¨‹å´©æºƒäº†ï¼Œä¸ä¼šå½±å“ä¸»è¿›ç¨‹ä»¥åŠå…¶ä½™è¿›ç¨‹ã€‚ ä½†æ˜¯ç¼ºç‚¹æ˜¯åˆ›å»ºè¿›ç¨‹çš„ä»£ä»·éå¸¸å¤§ ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè¦ç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…å›ºå®šçš„èµ„æºï¼Œå¹¶ä¸”ï¼Œæ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹çš„æ€»æ•°ä¼šæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œè‹¥è¿›ç¨‹è¿‡å¤šï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦éƒ½ä¼šå­˜åœ¨é—®é¢˜ï¼Œä¼šé€ æˆå‡æ­»çŠ¶æ€ã€‚ã€‚ä¸è¿‡ï¼Œè¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œè¿›ç¨‹Aå´©æºƒäº†å®Œå…¨ä¸ä¼šå½±å“åˆ°è¿›ç¨‹Bã€‚\nçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹ å¤šçº¿ç¨‹ä¼˜ç‚¹æ˜¯æ•ˆç‡è¾ƒé«˜ä¸€äº›ï¼Œä½†æ˜¯è‡´å‘½çš„ç¼ºç‚¹æ˜¯ä»»ä½•ä¸€ä¸ªçº¿ç¨‹å´©æºƒéƒ½å¯èƒ½é€ æˆæ•´ä¸ªè¿›ç¨‹çš„å´©æºƒï¼Œå› ä¸ºå®ƒä»¬å…±äº«äº†è¿›ç¨‹çš„å†…å­˜èµ„æºæ± ï¼Œæ²¡æœ‰è‡ªå·±å•ç‹¬çš„å†…å­˜åœ°å€ç©ºé—´ï¼ŒæŒ‡é’ˆæ•°æ®çš„é”™è¯¯å¯ä»¥å¯¼è‡´ä»»ä½•åŒåœ°å€ç©ºé—´å†…å…¶ä»–çº¿ç¨‹çš„å´©æºƒï¼ŒåŒ…æ‹¬è¿›ç¨‹ã€‚\nè¿›ä¸€æ­¥ç†è§£è¿›ç¨‹å’Œçº¿ç¨‹ï¼ˆå¯é€‰ï¼‰ è¿›ç¨‹ è¿›ç¨‹çš„ç»„æˆ å½“ä¸€ä¸ªç¨‹åºè¢«è½½å…¥å†…å­˜å¹¶æˆä¸ºä¸€ä¸ªè¿›ç¨‹åï¼Œå®ƒä¼šå ç”¨ä¸€éƒ¨åˆ†å­˜å‚¨ç©ºé—´ï¼Œæ­¤ç©ºé—´ä¼šåˆ†ä¸º 4 ä¸ªåŒºåŸŸï¼š è¿™ 4 ä¸ªåŒºåŸŸçš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š æ ˆï¼ˆStackï¼‰ï¼šå­˜å‚¨å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ç­‰ä¸´æ—¶æ•°æ®ã€‚ å †ï¼ˆHeapï¼‰ï¼šè¿›ç¨‹åœ¨æ‰§è¡ŒæœŸé—´å¯ä»¥åŠ¨æ€ç”³è¯·è¿™éƒ¨åˆ†ç©ºé—´ã€‚ æ•°æ®åŒºï¼ˆDataï¼‰ï¼šå­˜å‚¨å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚ æ–‡æœ¬åŒºï¼ˆTextï¼‰ï¼šå­˜å‚¨è¿›ç¨‹è¦æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤ä»£ç ã€‚\nè¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ pythonä¸­çš„GILå…¨å±€è§£é‡Šå™¨é” TODO:\næ£€æŸ¥ä¸ªäººç”µè„‘çš„æœ€å¤§è¿›ç¨‹ã€çº¿ç¨‹æ•° ä¸åŒç”µè„‘çš„é…ç½®çŠ¶å†µå†³å®šäº†ä¸€ä¸ªç³»ç»Ÿèƒ½å¤Ÿè¿è¡Œå¤šå°‘è¿›ç¨‹ä»¥åŠå¯¹åº”çš„çº¿ç¨‹æ•°ï¼Œç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯ç”¨å®ä¾‹ä»£ç æ¥æ£€æµ‹åˆ°åº•èƒ½è¿è¡Œå¤šå°‘è¿›ç¨‹å’Œçº¿ç¨‹ï¼šï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦è¿‡äºç¦»è°±å³å¯ï¼‰ ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒä»»åŠ¡å¤„ç†æ‰€éœ€è¦å ç”¨çš„å†…å­˜å’Œcpuä½¿ç”¨ç‡æ˜¯ä¸åŒçš„ï¼Œéœ€è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œä½†é€šå¸¸æƒ…å†µä¸‹çš„ä½¿ç”¨ä¸ä¼šå‡ºç°å¤§é—®é¢˜ï¼ˆé™¤éä½ è€ƒè™‘åˆ°æ•°æ®å…±äº«å®‰å…¨æ€§ï¼Œæƒ³è®©ä¸€ç»„çº¿ç¨‹æ‰§è¡Œå®Œåå†å¯åŠ¨ä¸‹ä¸€è½®ï¼Œé‚£å°±è¦æ ¹æ®å®é™…æƒ…å†µè®¾è®¡æœ€å¤§çº¿ç¨‹å¹¶åŠ ä¸Šçº¿ç¨‹é”ï¼›ç­‰åˆ°è·å–åˆ°çš„è¿™äº›æ•°æ®å¤„ç†åæ‰èƒ½ç»§ç»­å¤„ç†ä¸‹ä¸€è½®æ•°æ®ï¼›æˆ–è€…ä½¿ç”¨å¤§å°é™å®šé˜Ÿåˆ—ä¸çº¿ç¨‹æ± ï¼‰\tå¤šè¿›ç¨‹æµ‹è¯•ä»£ç  é¦–å…ˆï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªè¯­å¥ï¼ˆlinuxä¸macï¼‰è¿›è¡Œç›´æ¥æŸ¥çœ‹:ubuntu\u0026gt; ps aux | wc -l,å¦‚æœæŸ¥è¯¢å¤±è´¥æˆ–è€…æƒ³è¦çœ‹åˆ°æ›´ç›´è§‚çš„ç»“æœå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š\n#!/usr/bin/python import os import sys import re import threading import signal import time g_exit = 0 num = 0 def sig_process(sig, frame): global g_exit g_exit = 1 def sub_process(data): while not g_exit: time.sleep(1) print data def process(): num = int(sys.argv[1]) all_process = [] for i in range(num): try: pid = os.fork() except: pid = -1 if pid \u0026lt; 0: print \u0026#39;error in fork\u0026#39; all_process.append(-1) elif 0 == pid: sub_process(i) os._exit(0) else: all_process.append(pid) while not g_exit: time.sleep(100) for i in range(num): if -1 == all_process[i]: continue os.waitpid(all_process[i], 0) def main(): if len(sys.argv) != 2: print \u0026#39;wrong number parameter\u0026#39; return 0 signal.signal(signal.SIGINT, sig_process) process() if __name__ == \u0026#39;__main__\u0026#39;: main() å¤šçº¿ç¨‹æµ‹è¯•ä»£ç \n#!/usr/bin/python import os import sys import re import threading import signal import time g_exit = 0 num = 0 def sig_process(sig, frame): global g_exit g_exit = 1 def sub_process(data): while not g_exit: time.sleep(1) print data def process(): num = int(sys.argv[1]) all_thread = [] for i in range(num): try: td = threading.Thread(target = sub_process, args=(i,)) td.start() except: all_thread.append(-1) continue all_thread.append(td) while not g_exit: time.sleep(100) for i in range(num): if isinstance(all_thread[i], int): continue all_thread[i].join() def main(): if len(sys.argv) != 2: print \u0026#39;wrong number parameter\u0026#39; return 0 signal.signal(signal.SIGINT, sig_process) process() if __name__ == \u0026#39;__main__\u0026#39;: main() Reference Pythonå¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹å­¦ä¹ \u0026mdash;-æ¦‚å¿µ æ“ä½œç³»ç»Ÿï¼Œè¿›ç¨‹ï¼Œçº¿ç¨‹ çº¿ç¨‹å´©æºƒæ˜¯å¦ä¼šé€ æˆè¿›ç¨‹å´©æºƒ pythonç¼–ç¨‹ï¼ˆä½ çš„ç”µè„‘èƒ½å¤Ÿæ‰§è¡Œå¤šå°‘çº¿ç¨‹å’Œè¿›ç¨‹ï¼‰ pythonä¸»çº¿ç¨‹æ•è·å­çº¿ç¨‹å¼‚å¸¸ æ“ä½œç³»ç»Ÿ ","date":"2022-04-24T19:23:03+08:00","permalink":"https://sanbuphy.github.io/p/python%E4%B8%AD%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A6%82%E5%BF%B5%E7%9A%84%E8%BF%9B%E9%98%B6%E6%8E%A2%E8%AE%A8/","title":"pythonä¸­å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹æ¦‚å¿µçš„è¿›é˜¶æ¢è®¨"},{"content":"å¾…è¿›ä¸€æ­¥å®Œå–„\u0026hellip;é¾Ÿé€Ÿå¡«å‘ä¸­\nè¯„ä»·æŒ‡æ ‡çš„åŸºçŸ³ æ‰€æœ‰å¤æ‚é—®é¢˜éƒ½æ˜¯ç®€å•é—®é¢˜çš„é‡å¤ï¼Œ ä¸ºäº†ç†è§£æ‰€æœ‰æŒ‡æ ‡ï¼Œé¦–å…ˆéœ€äº†è§£â€œå››å¤§å¤©ç‹â€ä¸â€œä¸‰å¤§æŠ¤æ³•â€\nå››å¤§å¤©ç‹â€”â€”TP|FP TN|FN æˆ‘ä»¬è®¤ä¸ºpositiveä»£è¡¨äº†é˜³æ€§ï¼ˆæˆ–è€…è¯´æ­£æ ·æœ¬ï¼‰ï¼Œ è€ŒNegativeä»£è¡¨äº†é˜´æ€§ï¼ˆè´Ÿæ ·æœ¬)ï¼Œé‚£ä¹ˆåœ¨äºŒåˆ†ç±»ä¸­æˆ‘ä»¬æ ¹æ®çŒœæµ‹çš„å¯¹é”™å¾ˆå®¹æ˜“æ’åˆ—å‡º2x2ç§æƒ…å†µï¼š\nTrue False Positive TP(çŒœå¯¹äº†é˜³) FP(çŒœé”™äº†é˜³) Negative TN(çŒœå¯¹äº†é˜´) FN(çŒœé”™äº†é˜´) å…¶ä¸­å·¦åŠè¾¹è¡¨ç¤ºçœŸå€¼å’Œæˆ‘çš„çŒœæµ‹ä¸€è‡´ï¼ˆçŒœå¯¹äº†ï¼‰ï¼Œå³åŠè¾¹è¡¨ç¤ºçœŸå€¼å’Œæˆ‘çš„çŒœæµ‹ä¸ä¸€è‡´ï¼ˆçŒœé”™äº†ï¼‰ï¼›\nä¸ŠåŠè¾¹è¡¨ç¤ºçŒœæµ‹é˜³æ€§çš„å…¨ä½“ $P$ï¼Œä¸‹åŠè¾¹è¡¨ç¤ºçŒœæµ‹é˜´æ€§çš„å…¨ä½“$N$ã€‚\nTP+FNè¡¨ç¤ºçœŸå€¼é˜³æ€§çš„å…¨ä½“ï¼ŒTN+FPè¡¨ç¤ºçœŸå€¼é˜´æ€§çš„å…¨ä½“ã€‚\nä¸‰å¤§æŠ¤æ³•â€”â€”Preã€ACCã€Recall æ ¹æ®å››å¤§é‡‘åˆšï¼Œæˆ‘ä»¬å®¹æ˜“å¾—å‡ºå¸¸è§æ¨¡å‹ä¸­çš„ä¸‰ä¸ªè¯„ä»·æŒ‡æ ‡ï¼Œ (ä¸ºä»€ä¹ˆä¸èƒ½åªçœ‹ä¸€ä¸ªå‘¢ï¼Ÿå› ä¸ºå®¹æ˜“è¢«â€œæµ®äº‘é®æœ›çœ¼â€)\nPre(Precision ç²¾ç¡®ç‡åˆç§°æŸ¥å‡†ç‡) ç²¾ç¡®å’Œå‡†ç¡®åœ¨ä¸­æ–‡ä¸Šçœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæ„æ€ï¼Œä½†å®é™…ä¸Šæœ‰å¾®å°çš„åŒºåˆ«ï¼› æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠ•æ ‡çš„ä¾‹å­æ¥ç†è§£ä»€ä¹ˆæ˜¯ç²¾ç¡®ï¼Œä»€ä¹ˆæ˜¯å‡†ç¡®ã€‚ ç²¾ç¡®ç‡æ˜¯åº¦é‡ä¿¡å™ªçš„ä¸€ç§æ–¹å¼ï¼Œæ˜¯å¯¹åå·®ç¨‹åº¦çš„ååº”ï¼ˆæ ‡å‡†å·®å¤§å°±ä¸ç²¾ç¡®ï¼‰ ä»ä¸Šå›¾å¯çŸ¥ï¼Œç²¾ç¡®ç‡é«˜çš„æ•°æ®å…¶æ ‡å‡†å·®è¾ƒå°ï¼Œä¹Ÿå°±æ˜¯â€œæˆ‘æŠ•ä¸­äº†ï¼ŒæŠ•ä¸­çš„å·®åˆ«ä¸å¤§â€;åœ¨äºŒåˆ†ç±»ä¸­æˆ–è€…è¯´åˆ¤æ–­æ˜¯å¦é˜³æ€§ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹æ˜¯åœ¨æˆ‘å¯¹é˜³æ€§çš„åˆ¤æ–­ä¸­ï¼Œæ˜¯å¦åˆ¤æ–­å¯¹äº†(å­˜ä¸å­˜åœ¨é”™åˆ¤é˜³æ€§çš„åå·®ï¼‰ï¼›å¦‚æœç²¾ç¡®ç‡é«˜ï¼Œå°±è¯´æ˜æˆ‘é¢„æµ‹é˜³æ€§åå·®å°ï¼Œé˜³æ€§å°±æ˜¯çœŸçš„é˜³æ€§ï¼Œè¾ƒå°‘å‡ºå·®é”™ã€‚ æ€»ç»“æ¥è¯´ï¼Œç²¾ç¡®ç‡é«˜æŒ‡çš„æ˜¯â€œæˆ‘å¯¹æ­£ä¾‹åˆ¤æ–­å‡ºå·®é”™ï¼ˆåå·®ï¼‰çš„æƒ…å†µæ€ä¹ˆæ ·ï¼Ÿâ€ï¼Œä¹Ÿå°±æ˜¯ï¼š $$ Precision = \\frac{TP}{P} = \\frac{TP}{TP+FP} $$ ç²¾ç¡®ç‡è¶Šé«˜ï¼Œè¯´æ˜æˆ‘å¯¹æ­£ä¾‹/é˜³æ€§åˆ¤æ–­çš„åå·®è¶Šå°ï¼Œä¹Ÿå°±æ˜¯TPå æ€»åˆ¤æ–­é˜³æ€§ä¸­çš„æ¯”ä¾‹è¶Šå¤§ã€‚ è¿™æ—¶å€™å¯èƒ½ä¼šæœ‰èªæ˜çš„åŒå­¦é—®äº†ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸è€ƒè™‘å¯¹è´Ÿä¾‹åˆ¤æ–­çš„åå·®å‘¢ï¼Œæ¯”å¦‚æ„å»ºä¸€ä¸ªTN/TN+FNçš„æŒ‡æ ‡ï¼Ÿ å…¶å®æ˜¯æœ‰çš„ï¼Œä¸€èˆ¬çš„ï¼ŒPreè¿˜æœ‰æ›´æ·±å…¥çš„åå­—å«â€œpositive predictive value (PPV)â€ï¼Œæ˜¾ç„¶ä¹Ÿæœ‰å¯¹åº”çš„â€œNegative predictive value (NPV) â€ åªæ˜¯å› ä¸ºè´Ÿæ ·æœ¬é€šå¸¸è¾ƒå°‘ï¼Œæ­£æ ·æœ¬è¾ƒå¤šï¼›æ‰€ä»¥æŠŠPPVä½œä¸ºä¸€ä¸ªæ›´å¸¸ç”¨çš„æŒ‡æ ‡ï¼Œå½’ä¸ºç²¾ç¡®ç‡ã€‚\nACC(Accuracy å‡†ç¡®ç‡) ä¸ºä»€ä¹ˆè¯´ç²¾å‡†ä½†â€œç²¾ç¡®ä¸ä¸€å®šå‡†ç¡®å‘¢â€ï¼Ÿ\nä½ å¯ä»¥è¿™ä¹ˆæƒ³ï¼Œç²¾å¯†ä»ªå™¨æ˜¾ç„¶æ˜¯ä¸ºäº†è¯¯å·®å°ï¼Œé‚£ç²¾å¯†ä»ªå™¨ä¸€å®šèƒ½å¾—åˆ°å‡†ç¡®ç»“æœå—ï¼Ÿâ€”â€”â€”â€”ç­”æ¡ˆæ˜¯ä¸ä¸€å®šï¼Œæ¯”å¦‚ä½ æ²¡æœ‰è°ƒé›¶!(åšè¿‡å¤§ç‰©å®éªŒçš„æœ‹å‹éƒ½çŸ¥é“~) æ²¡æœ‰è°ƒé›¶å°±å¥½åƒy=kx+bä¸­å¤šäº†ä¸€ä¸ªbï¼Œä¹Ÿå°±æ˜¯æŠ•æ ‡å›¾åƒä¸­çš„â€œæ•´ä½“åç§»çœŸå€¼â€ ï¼ˆä¸‹å›¾çš„ä¸ŠåŠéƒ¨åˆ†ï¼‰ è™½ç„¶å¾ˆç²¾ç¡®ï¼Œä½†å¾ˆä¸å‡†ç¡®ï¼ï¼ å·¦åŠä¾§æ›´ä¸å‡†ç¡®ï¼Œå³åŠä¾§æ›´å‡†ç¡® å‡†ç¡®ç‡æ›´å®¹æ˜“ç†è§£ï¼Œå‡†ç¡®ç‡è€ƒè™‘çš„æ˜¯æ›´â€œå…¨å±€â€çš„ç»“æœæ˜¯å¦æ­£ç¡®ï¼Œ ä¹Ÿå°±æ˜¯åœ¨æˆ‘æ‰€æœ‰é¢„æµ‹çš„ç»“æœä¸­ï¼Œæˆ‘åˆ°åº•é¢„æµ‹çš„â€œå¥½ä¸å¥½â€ï¼Œ å³ï¼š $$ Accuracy = \\frac{TP+TN}{æ‰€æœ‰é¢„æµ‹} = \\frac{TP+TN}{TP+FP+TN+FN} $$\nRecall(å¬å›ç‡åˆç§°æŸ¥å…¨ç‡) é¡¾åæ€ä¹‰ï¼ŒæŸ¥å…¨çš„æ„æ€å°±æ˜¯â€œæˆ‘æŸ¥çš„å…¨ä¸å…¨â€ï¼Œæˆ‘æ˜¯å¦æŠŠæ‰€æœ‰çš„é˜³æ€§è¦†ç›–åˆ°äº†ï¼ˆé˜³æ€§å…¨ä½“ä¸ºPï¼‰ï¼Œ\n$$ Recall = \\frac{TP}{é˜³æ€§å…¨ä½“}= \\frac{TP}{TP+FN} $$ æœ‰æ—¶å€™æŸ¥å…¨ç‡å¾ˆé«˜ï¼Œä½†ç²¾ç¡®ç‡å¾ˆä½ã€‚ æ¯”å¦‚æˆ‘æœ‰3ä¸ªé˜³æ€§ï¼Œ97ä¸ªé˜´æ€§ã€‚æˆ‘é¢„æµ‹100ä¸ªå…¨ä¸ºé˜³æ€§ï¼ˆæ­¤æ—¶P=100ä¸”TP=3ï¼ŒFP=97ï¼‰ï¼Œ0ä¸ªé˜´æ€§ï¼›æ­¤æ—¶æŸ¥å…¨ç‡ä¸ºï¼š3/3=100% ï¼\nä½†æ­¤æ—¶ç²¾ç¡®ç‡ä¸ºï¼š3%ã€‚ã€‚ã€‚ã€‚ã€‚è¿™æ˜¾ç„¶æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ æœ‰æ—¶å€™ç²¾ç¡®ç‡å¾ˆé«˜ï¼Œä½†æŸ¥å…¨ç‡å¾ˆä½ã€‚ æ¯”å¦‚æˆ‘è¿˜æ˜¯æœ‰3ä¸ªé˜³æ€§ï¼Œ97ä¸ªé˜´æ€§ã€‚æˆ‘åˆšå¥½é¢„æµ‹å¯¹æŸ1ä¸ªä¸ºé˜³æ€§ï¼ˆæ­¤æ—¶P=1ä¸”TP=1ï¼ŒFP=0ï¼‰ï¼Œ99ä¸ªé˜´æ€§ï¼›æ­¤æ—¶ç²¾ç¡®ç‡ä¸ºï¼š100% ï¼ ä½†æ­¤æ—¶æŸ¥å…¨ç‡ä¸ºï¼š33.333%ã€‚ã€‚ã€‚ã€‚ã€‚è¿™æ˜¾ç„¶ä¹Ÿæ˜¯æ„ä¹‰ä¸å¤§çš„ã€‚ æŸ¥å…¨ç‡ä¸ç²¾ç¡®ç‡å­˜åœ¨äº’é€†å…³ç³»\næˆ‘ä»¬èƒ½å¤Ÿéšçº¦å‘ç°æŸ¥å…¨ç‡å’Œç²¾ç¡®ç‡çš„äº’é€†å…³ç³»ï¼Œä½†ç©¶ç«Ÿæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ï¼ŒRecallå’ŒPreåªåœ¨åˆ†æ¯æœ‰å·®åˆ«ï¼Œå…¶ä¸­Recallçš„åˆ†æ¯æ˜¯TP+FNã€ä¸å˜é‡ã€‘ï¼Œè€ŒPreçš„åˆ†æ¯æ˜¯TP+FPã€å¯å˜é‡ã€‘ã€‚\nä¸ºäº†æé«˜Recallï¼Œæˆ‘ä»¬éœ€è¦å¢å¤§TPï¼Œè€Œåˆ†æ¯ä¸å˜ï¼› ä½†Preä¸­å¦‚æœTPå¢åŠ äº†FPä¹Ÿä¼šè·Ÿç€å¢åŠ ï¼ˆæˆ‘éœ€è¦åˆ¤æ–­çš„ä¸œè¥¿å˜å¤šäº†ï¼Œç²¾ç¡®ç‡ä¼šä¸‹é™ï¼Œé”™è¯¯çš„æ¦‚ç‡ä¼šå˜å¤§ï¼‰ï¼Œåˆ†å­çš„TPå¢åŠ å°äºåˆ†æ¯çš„TP+FPæ€»ä½“çš„å¢åŠ ã€‚æ‰€ä»¥æŸ¥å…¨ç‡å’Œç²¾ç¡®ç‡æ˜¯äº’é€†çš„ã€‚\nF1ã€RPCã€Rocã€AUC åœ¨å……åˆ†äº†è§£äº†å››å¤§é‡‘åˆšä¸ä¸‰å¤§æŠ¤æ³•åï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æ¥ç ”ç©¶ä»–ä»¬çš„è¡ç”Ÿå˜ä½“ï¼š\nReference æœºå™¨å­¦ä¹ åŸºç¡€\u0026mdash;åˆ†ç±»ä¸æ£€æµ‹çš„è¯„ä»·æŒ‡æ ‡\u0026mdash;APï¼ŒmAPï¼ŒPRCæ›²çº¿ åˆ†ç±»é—®é¢˜ä¸­çš„ä¸€äº›æŒ‡æ ‡æ¦‚å¿µ-Roc|AUC|Pre|Recall|ACC|AP|mAP|F1æ€»ç»“ åˆ†ç±»å™¨çš„ROCæ›²çº¿åŠç›¸å…³æŒ‡æ ‡ï¼ˆROCã€AUCã€ACCï¼‰è¯¦è§£ MCC â€” æœºå™¨å­¦ä¹ ä¸­ä¼˜äºF1-scoreå’Œaccuracyçš„ä¸€ä¸ªæ€§èƒ½è¯„ä»·æŒ‡æ ‡ Data Science in Medicine â€” Precision \u0026amp; Recall or Specificity \u0026amp; Sensitivity? ","date":"2022-04-12T20:53:41+08:00","permalink":"https://sanbuphy.github.io/p/%E8%AF%A6%E8%A7%A3%E6%9C%BA%E5%99%A8/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E5%B8%B8%E8%A7%81%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87/","title":"è¯¦è§£æœºå™¨/æ·±åº¦å­¦ä¹ ä¸­å¸¸è§è¯„ä»·æŒ‡æ ‡"},{"content":"ç¬”è€…å› ä¸ºè¦ä½¿ç”¨opencv c++ç‰ˆçš„éœ€æ±‚ï¼Œéœ€è¦ç»™å®¶é‡Œçš„ç”µè„‘é…c/cppçš„è¿è¡Œç¯å¢ƒï¼Œ å¦‚æœæ˜¯Linuxæ— è„‘Clionå³å¯ï¼Œwindowsä¸Šç¨å¾®æœ‰ä¸€äº›éº»çƒ¦ï¼Œé™„ä¸Šå…¨æµç¨‹ï¼š\nã€6æœˆä»½å›æ¥çœ‹æ„Ÿåˆ°å¾ˆæç¬‘ï¼Œæ³¨ï¼šè¿™æ˜¯ç¬”è€…åˆšå¼€å§‹ç©c/cppçš„çº¯ç²¹é’æ¶©æ–‡ç« \u0026hellip;..ã€‘\né¦–å…ˆè¯·æŒ‰ç…§è¿™ä¸ªåšä¸»çš„å®‰è£…æ•™ç¨‹èµ°ä¸€éæµç¨‹c++ cè¯­è¨€å®‰è£…æµç¨‹\nå¦‚æœé¡ºåˆ©çš„å®‰è£…å¥½ç¯å¢ƒï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿è¡Œç¯èŠ‚ï¼Œé¦–å…ˆéšä¾¿æ–°å»ºä¸€ä¸ªCæˆ–è€…cppæ–‡ä»¶ï¼Œå¯å‚è€ƒï¼› Cè¯­è¨€çš„ç‰ˆæœ¬ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;windows.h\u0026gt; int main() { printf(\u0026#34;Hello World\\n\u0026#34;); system(\u0026#34;pause\u0026#34;); return 0; } C++çš„ç‰ˆæœ¬ï¼š\n#include \u0026lt;iostream\u0026gt; using namespace std; int main() { cout \u0026lt;\u0026lt; \u0026#34;Hello Vscode\u0026#34; \u0026lt;\u0026lt; endl; return 0; } æ¥ä¸‹æ¥å°±æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§åŠæ³•ç¼–è¯‘å¥½æ–‡ä»¶è¿è¡Œï¼Œ ç¬¬ä¸€ç§åŠæ³•ï¼ˆç›´æ¥ç¼–è¯‘ï¼‰ï¼š åœ¨ç»ˆç«¯ä¸­è¿›å…¥å¯¹åº”æ–‡ä»¶å¤¹ï¼Œè¾“å…¥gcc xxx.c æˆ–è€…g++ xxxx.cpp å³å¯å°†æ–‡ä»¶ç¼–è¯‘æˆexeï¼Œç„¶åç›´æ¥ç»ˆç«¯ä¸­è¾“å…¥exeæ–‡ä»¶åå­—å³å¯æŸ¥çœ‹æ•ˆæœï¼ å¦‚æœä½ æƒ³è¿è¡Œåç›´æ¥çœ‹è·³å‡ºçš„ç»“æœï¼Œå¯ä»¥æŒ‰ç…§å¼€å¤´çŸ¥ä¹é“¾æ¥çš„ç­”ä¸»æ–¹æ³•æ“ä½œã€‚\nç¬¬äºŒç§æ–¹æ³•ï¼ˆé—´æ¥ç¼–è¯‘ï¼‰ï¼šæˆ‘ä»¬è¦åšä¸¤ä»¶äº‹ï¼š\né¦–å…ˆåœ¨ä¸Šé¢èœå•æ æ‰¾åˆ°ç»ˆç«¯ï¼Œé€‰æ‹©é…ç½®ç”Ÿæˆä»»åŠ¡ï¼Œé€‰æ‹©å¯¹åº”çš„æ–‡ä»¶ï¼ˆgccæˆ–è€…g++ æœ‰å¯èƒ½åªæ˜¾ç¤ºc++ ä½†ç‚¹è¿›å»åä¼šå‡ºç°gcc) å·¦ä¾§æ‰¾åˆ°è¿è¡Œä¸è°ƒè¯•åœ¨ä¸Šé¢æ¡†æ¡†ä¸­ç‚¹å¼€ï¼Œç„¶åé€‰æ‹©å·¥ä½œåŒºå¯¹åº”çš„æ–‡ä»¶å¤¹æ·»åŠ é…ç½®ï¼ˆä¼šç”Ÿæˆ.vscodeæ–‡ä»¶å¤¹ï¼Œå†…éƒ¨å°±æ˜¯é…ç½®æ–‡ä»¶ï¼ï¼‰ï¼Œæˆ–è€…ç›´æ¥è¿è¡Œä¸­æ‰¾åˆ°æ·»åŠ é…ç½®ï¼Œç„¶ååŒæ ·æ‰¾åˆ°å¯¹åº”gcc g++å³å¯ï¼ˆgccæˆ–è€…g++ æœ‰å¯èƒ½åªæ˜¾ç¤ºc++ ä½†ç‚¹è¿›å»åä¼šå‡ºç°gcc) å¦‚æœç¬¬äºŒç§æ–¹æ³•é…ç½®å‡ºç°é—®é¢˜äº†ï¼ˆlaunchæˆ–è€…taskï¼‰ï¼Œä½ å¯ä»¥æŠŠ.vscodeæ–‡ä»¶å¤¹åˆ é™¤ï¼Œé‡æ–°é…ç½®å³å¯ã€‚\n","date":"2022-03-20T16:28:01+08:00","permalink":"https://sanbuphy.github.io/p/c/c-%E5%9C%A8windows%E4%B8%8B%E7%9A%84%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E5%92%8C%E8%BF%90%E8%A1%8C%E6%96%B9%E6%B3%95/","title":"C/C++åœ¨Windowsä¸‹çš„ç¯å¢ƒé…ç½®æµç¨‹å’Œè¿è¡Œæ–¹æ³•"},{"content":"æœ¬æ–‡æºäºå’Œå¤§å­¦æ—¶æœŸèˆå‹åˆ†äº«æ¯’æ‰“ç»éªŒ(è¢«æ¯’æ‰“)\næ‰¾å·¥ä½œçš„æ€ªè±¡ä¸å½¢æˆçš„æœ¬æºã€æœ€é‡è¦çš„ã€‘ äº§ä¸šåˆ†å¸ƒâ€”â€”æˆ‘è¯¥å»å“ªï¼Ÿ ä¸€çº¿ï¼šäº’è”ç½‘ä¼ä¸šã€é«˜æ–°æŠ€æœ¯ä¼ä¸š â€”â€”â€”â€” æˆ¿ä»·å¾ˆé«˜ å®¹ä¸ä¸‹è‚‰èº« äºŒä¸‰çº¿ï¼šäº‹ä¸šå•ä½ã€å›½ä¼ã€å„ç§ä½ æ‡‚ç¼–åˆ¶ï¼ˆç ”ç©¶æ‰€ã€è€å¸ˆã€‚ã€‚ã€‚ã€‚ã€‚ï¼‰ â€”â€”â€”â€”â€”â€” æˆ¿ä»·ä¸ç®—ç‰¹åˆ«é«˜ å¯èƒ½å®¹ä¸ä¸‹çµé­‚ å»ºè®®å¯¹è‡ªå·±æƒ³å»çš„åœ°æ–¹æœ‰ä¸ªç›®çš„æ€§ï¼Œè¶æ—©è€ƒè™‘ã€‚\nå­¦æ ¡å’Œç¤¾ä¼šç”Ÿæ´»çš„å·®è· æ€æƒ³ä¸Šçš„å‡†å¤‡è½å 1. è€ƒå…¬åŠ¡å‘˜ 2. å½“è€å¸ˆ 3. äº‹ä¸šå•ä½ ã€‚ã€‚ã€‚ã€‚ã€‚ å…¶å®æ˜¯å¯¹æ‰¾å·¥ä½œæ²¡æœ‰æ¦‚å¿µ ã€å­¦æ ¡å’Œç¤¾ä¼šç”Ÿæ´»çš„å·®è·å¯¼è‡´å›´åŸã€‘ ç¤¾ä¼šä¸Šæ¸©æƒ…ç¡®å®æ›´å°‘ä¸€äº› 1.æŠ±å¤§è…¿ï¼Ÿå¤§è…¿ä½ é‡ä¸åˆ°ï¼Œå°è…¿ä¸æƒ³ç†ä½  2.è·¨éƒ¨é—¨çš„äº‹æƒ…ï¼ŒåŸºæœ¬æ˜¯è¸¢çš®çƒ 3. *åœ¨å¤–é¢å¾ˆéš¾æ‰¾ç”·/å¥³æœ‹å‹* 1. è€ƒè™‘ç°å® 2.è€ƒè™‘è¿œè¿‘ ä¸­å¿ƒæ€æƒ³ï¼šä½ è¦çœŸæ­£æ–­å¥¶ï¼Œä¸ºè‡ªå·±è´Ÿè´£ï¼Œä¸ºè‡ªå·±é€‰æ‹©ï¼ˆæ¥è‡ªå®¶é‡Œäººçš„å»ºè®®ï¼Œæ¥è‡ªè€å¸ˆçš„å»ºè®®ï¼Œæ¥è‡ªåŒå­¦çš„å»ºè®®ï¼‰ã€‚\nä¸€ä¸ªæ¯›ç—…â€”â€”â€”â€”è¿½æ±‚ç”Ÿæ´»çš„æœ€ä¼˜è§£ â€”â€”â€”â€”â€”â€”ä¸å¯èƒ½ï¼ ç”Ÿæ´»å…¶å®æ²¡æœ‰æœ€ä¼˜è§£ï¼Œåªæœ‰ä¸åŒé˜¶æ®µçš„å±€éƒ¨æœ€ä¼˜ â€”â€”â€”â€”â€”â€”è¿½éšå¿ƒçš„å£°éŸ³\né—®é¢˜ï¼šæˆ‘ä»¬åº”è¯¥ç”¨ç°åœ¨çš„å›æŠ¥å»ä¼°è®¡å°†æ¥çš„æ”¶å…¥æ›²çº¿å—ï¼Ÿ é¢„æµ‹åŸºæœ¬ä¸å¯èƒ½â€”â€”â€”â€”â€”â€”è¿½éšå¿ƒçš„å£°éŸ³\næ€ä¹ˆæ›´å¥½çš„è·å¾—å›æŠ¥/è·å¾—èµ„æ–™(å·¥ä½œå²—ä½çš„éœ€æ±‚) å‡è®¾ï¼šç°åœ¨æˆ‘è¦å»è¿½æ±‚äºŒçº¿çš„æŸæŸå·¥ä½œï¼š 1ã€æˆ‘è¦è½¬è¡Œå—ï¼Ÿåšä»€ä¹ˆï¼Ÿæ€ä¹ˆåšï¼Ÿ æˆ‘æ˜¯ç”µå­ä¿¡æ¯ç¡•å£«ç”Ÿï¼Œä¸è½¬è¡Œ\n2ã€æˆ‘è¦åšæœ¬è¡Œå—ï¼Ÿåšä»€ä¹ˆï¼Ÿæ€ä¹ˆåšï¼Ÿ\nç¬¬ä¸€æ­¥ï¼šä¿¡æ¯è·å– ã€è·å¾—ä¿¡æ¯æ˜¯ç¬¬ä¸€æ­¥çš„å…³é”®ï¼ã€‘\næˆ‘å¯¼å¸ˆç ”ç©¶çš„æ˜¯ä»€ä¹ˆï¼Œæˆ‘çš„è€å¸ˆæœ‰ä»€ä¹ˆèµ„æºâ€”â€”ï¼ˆå­¦æœ¯çš„èµ„æºã€äººè„‰çš„èµ„æºï¼ˆå…¬å¸çš„è”ç³»ï¼‰ï¼‰ ã€æˆ‘èƒ½è·å¾—ä»€ä¹ˆï¼Ÿã€‘ è·å¾—å¯¹åº”çš„å­¦è¯† è·å¾—å¯¹åº”å…¬å¸çš„å†…æ¨æœºä¼š è·å¾—å­¦é•¿å­¦å§çš„ä¿¡æ¯ äº†è§£å…¬å¸çš„å†…éƒ¨å¥½åå’Œç¦åˆ©ï¼ˆæ¯”å¦‚å®å¾·æ—¶ä»£çš„ä¸€äº›é»‘å†å²ï¼‰ å­¦é•¿å­¦å§å’Œå†å¹´å°±ä¸šå»å‘è¡¨â€”â€”â€”â€”æ‰¾å‡ºæœ€ä¼˜ç§€çš„å­¦é•¿å­¦å§ é—®ä»–ä»¬æ˜¯æ€ä¹ˆè¿‡çš„ï¼Œæ€ä¹ˆåŠªåŠ›çš„ï¼Œæ€ä¹ˆå»è·å–èµ„æºçš„ï¼ˆå¯ä»¥è¯·å’–å•¡æˆ–è€…çº¦é¢è°ˆæˆ–è€…é‚®ä»¶æˆ–è€…å¾®ä¿¡ï¼Œç›¸ä¿¡åŒæ ¡çš„å­¦é•¿å­¦å§ï¼ï¼‰ ç¬¬äºŒæ­¥ï¼šé€‰æ‹©æ–¹å‘ï¼ˆé¿å…æœ€åçš„æƒ…å†µï¼Œè¿½æ±‚å¥½ä¸€äº›çš„æƒ…å†µï¼Œä½†ä¸å­˜åœ¨æœ€å¥½çš„æƒ…å†µï¼‰ ç”µæ°”å·¥ç¨‹å¸ˆï¼Ÿåšç®—æ³•å·¥ç¨‹å¸ˆï¼Ÿå»å›½å®¶ç”µç½‘ï¼Ÿè¿˜æ˜¯å»å½“å°å­¦è€å¸ˆï¼Ÿ\nç»™å‡ºå¯èƒ½çš„å‡ ä¸ªæ–¹å‘ æ±‚äº¤é›† å„ç§æ‰¾å·¥ä½œçš„ç½‘ç«™ æŒ‰ç…§ 1ã€å…³é”®è¯ 2ã€åŸå¸‚ éå†æ¯ä¸€å®¶å…¬å¸çš„æ‹›å·¥éœ€æ±‚â€”â€”â€”â€”â€”è·å¾—å¾…é‡æƒ…å†µï¼Œæˆ–è€…æ˜¯å»æœç´¢å¾…é‡æ›²çº¿ä»¥åŠå’Œå­¦é•¿å­¦å§ä¿¡æ¯å¯¹æ¯”ã€‚ ç¬¬ä¸‰æ­¥ï¼šæ ¹æ®æ–¹å‘ åŠªåŠ›ï¼è·å–ä¿¡æ¯ååŠªåŠ›ï¼ ã€æ ¹æ®ç¤¾æ‹›çš„è¦æ±‚ï¼Œå»åšæ ¡æ‹›ï¼Œåƒä¸‡ä¸è¦æ²¦è½åˆ°ç¤¾æ‹›ï¼ã€‘ ã€ç°åœ¨çš„å›½æƒ…å°±æ˜¯æ ¡æ‹›yydsï¼Œåº”å±Šç”Ÿyydsï¼Œè¯·ææ¸…æ¥šåº”å±Šç”Ÿæœ‰ä»€ä¹ˆç¦åˆ©ï¼ˆè½æˆ·æ”¿ç­–ï¼Œäººæ‰å¼•è¿›)!!!!!!!!!!!!!!!!!!!!ã€‘ ã€å¿…é¡»åˆ©ç”¨å¥½åº”å±Šç”Ÿçš„èº«ä»½ï¼Œå¦åˆ™ä¼šåæ‚”ä¸€è¾ˆå­ã€‘\nè‡ªå·±åšä¸ªæ–‡æ¡£ï¼ˆå·¥ä½œæ–¹éœ€è¦ä»€ä¹ˆç»å†ï¼Œçœ‹é‡å­¦ç”Ÿçš„ä»€ä¹ˆç´ è´¨ï¼Œæ‹›å·¥éœ€è¦ä»€ä¹ˆæŠ€æœ¯æ ˆ(ASIC\\ä¼šéªŒè¯ä¼šæµ‹è¯•\\ä¼šFPGA\\ä¼špythonä½¿ç”¨EDAéªŒè¯ç­‰ï¼‰ ä¸¾ä¸ªä¾‹å­ï¼š å²—ä½èŒè´£ï¼š 1ã€æ·±å…¥äº†è§£ASICè®¾è®¡åŠéªŒè¯æµç¨‹ï¼Œå¯æ ¹æ®èŠ¯ç‰‡è®¾è®¡è§„æ ¼ä¹¦ï¼Œç¼–å†™éªŒè¯éœ€æ±‚ï¼Œå¯æ­å»ºéªŒè¯å¹³å°å¹¶å®ŒæˆéªŒè¯ç”¨ä¾‹å’Œå›å½’; 2ã€æ‰§è¡ŒéªŒè¯è®¡åˆ’ï¼Œç¼–å†™éªŒè¯ç”¨ä¾‹ï¼Œå¼€å±•é€’å½’æµ‹è¯•ï¼Œå®Œæˆé—®é¢˜çš„è°ƒè¯•å’Œä¿®å¤ï¼› 3ã€è´Ÿè´£èŠ¯ç‰‡IPé›†æˆéªŒè¯ä»¥åŠIPæ¨¡å—éªŒè¯ï¼Œæœ‰é«˜é€Ÿæ¥å£éªŒè¯ç»éªŒè€…ä¼˜å…ˆ; 4ã€è´Ÿè´£SOCç³»ç»Ÿçº§éªŒè¯ï¼Œå¹¶æ”¶é›†ã€åˆ†æå’Œæé«˜éªŒè¯è¦†ç›–ç‡; 5ã€ç†Ÿæ‚‰FPGAèŠ¯ç‰‡æ¶æ„ï¼Œå¯ååŠ©æµ‹è¯•å·¥ç¨‹å¸ˆå®ŒæˆèŠ¯ç‰‡æµ‹è¯•å·¥ä½œã€‚ ä»»èŒè¦æ±‚ï¼š 1ã€å¾®ç”µå­ç”µå­å·¥ç¨‹é€šä¿¡è®¡ç®—æœºç­‰ç›¸å…³ä¸“ä¸šç¡•å£«åŠä»¥ä¸Šå­¦å†ï¼› 2ã€ç†Ÿæ‚‰system *** ã€OVMUVMç­‰èƒ½ç‹¬ç«‹æ­å»ºå¯é‡ç”¨çš„ç³»ç»ŸéªŒè¯å¹³å°; 3ã€ç†Ÿç»ƒæŒæ¡perl ã€pythonç­‰è„šæœ¬è¯­è¨€ç†Ÿç»ƒä½¿ç”¨EDAéªŒè¯å·¥å…·(å¦‚VCSã€NCsimç­‰)ï¼› å·¥ä½œè®¤çœŸã€ç§¯æä¸»åŠ¨ã€ä¸¥è°¨ã€æ•¬ä¸šã€æœ‰è¾ƒå¼ºçš„æ²Ÿé€šèƒ½åŠ›ä¸å›¢é˜Ÿç»„ç»‡åè°ƒèƒ½åŠ›ã€‚ç¦åˆ©å¾…é‡ï¼šå›½ä¼ç¦åˆ©ï¼Œå…­é™©äºŒé‡‘ï¼Œåšäº”ä¼‘äºŒï¼Œé¤è´¹è¡¥åŠ©ï¼Œäº¤é€šè¡¥åŠ©ï¼Œå…¨å‹¤å¥–ï¼Œé¡¹ç›®æ´¥è´´ï¼Œå¹´ç»ˆå¥–ï¼Œå¥èº«æˆ¿ï¼Œç¾½ä¹’é¦†ç­‰\né’ˆå¯¹æŠ€æœ¯æ ˆå»åŠªåŠ›æé«˜ï¼Œé¡ºä¾¿æ‰¾å¿—åŒé“åˆçš„äººã€ç¾¤å‹ã€äº¤æµç¾¤ã€å­¦é•¿å­¦å§ï¼ˆæ‹‰å­¦å¼Ÿå­¦å¦¹ä¸‹æ°´ï¼‰ã€‘\nç¬¬å››æ­¥ï¼šç¤¾äº¤åŒæ ·é‡è¦ï¼ å­¦é•¿å­¦å§ äº¤æµç¾¤ ç¾¤å‹ã€‚ã€‚ã€‚ã€‚ã€‚ ä¸ºä»€ä¹ˆè¦å®ä¹  é¢è¯•é€ ç«ç®­â€”â€”å®é™…ä¸Šæ‹§èºä¸ ã€å°ç§¯ç”µçš„ä¾‹å­ã€‘\nå¦‚æœåœ¨å°å‚ã€‚ã€‚ã€‚ä½ å¯èƒ½è¦ä¸€ä¸ªäººå¹²ä¸‰ä¸ªäººçš„æ´» å¦‚æœåœ¨å¤§å‚ã€‚ã€‚ã€‚æ‹§èºä¸ï¼ å…¬å¸éœ€è¦çš„æ˜¯å•¥ï¼ˆä»€ä¹ˆä»·å€¼ï¼Ÿéœ€è¦ä½ äº§ç”Ÿä»€ä¹ˆä»·å€¼ï¼Œç»™å…¬å¸å¸¦æ¥ä»€ä¹ˆï¼Œè‡ªå·±çš„å¯æ›¿ä»£æ€§å¼ºä¸å¼ºï¼‰\nå¼¥è¡¥å­¦æ ¡ä¸ç¤¾ä¼šçš„é¸¿æ²Ÿ\næ”’ç»éªŒï¼Œåˆ·å±¥å†\nå‘å°æœ±å­¦ä¹ ï¼ï¼ï¼\nèˆ”ç‹—çš„è‰ºæœ¯ ï¼ˆæ‰¾ä¸€åˆ‡æœºä¼šå‘ä¼˜ç§€çš„å¤§ä½¬ä»¬å­¦ä¹ ï¼‰\næ¯”èµ·ä»¥åä¸èƒ½å¤šè¯·è€å©†å–ä¸€æ¯å¥¶èŒ¶çš„å§”å±ˆï¼Œæ¯”èµ·ä»¥åä¸èƒ½å¤šç»™å„¿å­ä¹°ä¸€æ ¹æ£’æ£’ç³–çš„å§”å±ˆï¼Œè‡ªå·±èˆ”ç‹—åˆæœ‰ä»€ä¹ˆå§”å±ˆçš„ï¼Ÿ è¯´ä¸å®šå°±èˆ”åˆ°äº†å‘¢ï¼Ÿ éƒ½æ˜¯å°æ¦‚ç‡äº‹ä»¶ï¼Œå€¼å¾—å°è¯•ï¼ ä¸è¢«ç†ç¬æ‰æ˜¯æœ€æ­£å¸¸çš„ç°è±¡ï¼Œå¦‚æœæœ‰å°±å¸¦ä¸Šæ„Ÿè°¢ï¼æ²¡æœ‰ä¹Ÿæ²¡å…³ç³»ï¼Œè¿™å¾ˆæ­£å¸¸ï¼ é¢å­çš„é—®é¢˜æ€ä¹ˆè§£å†³â€”â€”â€”â€”åæ­£å‡ åå¹´åå¤§å®¶éƒ½å…¥åœŸäº†ï¼Œæ²¡ä»€ä¹ˆå¥½æ€•çš„ æˆ˜èƒœé—å¿˜çš„æ–¹æ³•ï¼š å¤ä¹  å¤ä¹  å¤ä¹  ï¼ˆæ¨èä¸€æ¬¾app memory helper æ ¹æ®é—å¿˜æ›²çº¿å®‰æ’ä½ åº”è¯¥ä»€ä¹ˆæ—¶å€™å¤ä¹ ä»€ä¹ˆ å…è´¹ï¼ï¼‰ å¹²ä¸­å­¦ä¸ºä»€ä¹ˆå¿˜å¾—æ…¢ï¼Ÿ å› ä¸ºä½ å¤©å¤©éƒ½å¾—å¹² åšè¿™äº›çš„ç›®çš„æ˜¯ã€‚ã€‚ã€‚ï¼Ÿ é’æ˜¥ä¸€å»ä¸å¤è¿”ï¼ è·å¾—æ›´å¥½çš„æŠ¥é…¬ çœ‹åˆ°æ›´å¥½çš„è‡ªå·± æ´»åœ¨çŸ­æš‚æœªæ¥çš„è‡ªå·± æ¯”èµ·ç‚’è‚¡ï¼Œä½ èƒ½åšå¥½çš„ä¹Ÿå°±æ˜¯è¿™äº›äº† ","date":"2022-02-21T21:18:24+08:00","permalink":"https://sanbuphy.github.io/p/%E8%80%83%E7%A0%94%E6%89%BE%E5%B7%A5%E4%BD%9C%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/","title":"è€ƒç ”ï¼Œæ‰¾å·¥ä½œçš„é‚£äº›äº‹"},{"content":"ä¸­å¿ƒæ€æƒ³ï¼šé‡äº‹ä¸å†³ï¼Œé™ä½ç‰ˆæœ¬ ï¼ˆnumpy,paddlepaddle,opencvï¼‰\nä»¥é˜²ä¸‡ä¸€çš„æ“ä½œ 1.å®‰è£…PyQt5\nsudo apt-get install python3-pyqt5\n2.å®‰è£…qt-designer\nsudo apt-get install qt5-default qttools5-dev-tools\n#å‘½ä»¤è¡Œè¾“å…¥designerå¯æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ\næ¨èå®‰è£…æµç¨‹ï¼ˆä»æ–°å»ºè™šæ‹Ÿç¯å¢ƒåˆ°å®‰è£…ä¸€æ¡é¾™æœåŠ¡ï¼‰ è¯·ä¸¥æ ¼æŒ‰ç…§é¡ºåºï¼\n#[è£…é”™äº†æƒ³å¸è½½é‡è£…ï¼ŒæŠŠinstallæ”¹æˆuninstall ä¸è¦åŠ åŒ…æ‹¬-iåœ¨å†…åé¢çš„ä¿¡æ¯å³å¯]\n#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ\nconda create -n æ”¹æˆä½ çš„è™šæ‹Ÿç¯å¢ƒåå­— python=3.7 ã€3.7åˆ«æ‰“3.9ã€‘\n#è¿›å…¥è™šæ‹Ÿç¯å¢ƒ\nconda activate æ”¹æˆåˆšæ‰ä½ çš„è™šæ‹Ÿç¯å¢ƒåå­—\n#è£…åäº†æƒ³ç‚¸æ‰è™šæ‹Ÿç¯å¢ƒï¼ˆæ…é‡åˆ«æ‰“é”™äº†ï¼‰\nconda remove -n ä½ çš„è™šæ‹Ÿç¯å¢ƒåå­— --all\n#æ­¤æ—¶ä½ èƒ½çœ‹åˆ°ç»ˆç«¯å·¦ä¾§æ˜¾ç¤ºç¯å¢ƒåï¼Œæ¥ä¸‹æ¥å®‰è£…å„ç±»ç¨‹åº\n#æ³¨ï¼šè¿™é‡Œé‡‡ç”¨ç™¾åº¦æºä½œä¸ºç¤ºèŒƒï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ¸…åæºï¼š\n-i https://pypi.tuna.tsinghua.edu.cn/simple\n#å‡çº§pip\npip install --upgrade pip -i https://mirror.baidu.com/pypi/simple\t#ä»¥é˜²ä¸‡ä¸€çš„æ“ä½œ\npip install qtpy -i https://mirror.baidu.com/pypi/simple pip install pyqt5 -i https://mirror.baidu.com/pypi/simple #å®‰è£…paddle githubä¸»é¡µé¢ ã€è¿™é‡Œé‡‡ç”¨çš„æ˜¯cpuï¼Œå¦‚æœè¦gpuè¯¦ç»†å®‰è£…è¿‡ç¨‹å‚è€ƒgpuæ€ä¹ˆçœ‹ã€‘\nï¼ˆå¦‚æœå‡ºç°é—®é¢˜å¯ä»¥åœ¨paddlepaddleåé¢åŠ ä¸Š==2.1.0å®‰è£…æ—§ç‰ˆæœ¬ï¼‰\npython -m pip install paddlepaddle -i https://mirror.baidu.com/pypi/simple\n#å®‰è£…PPOCRLabelï¼ˆOCRï¼‰ githubä¸»é¡µé¢\npip install PPOCRLabel -i https://mirror.baidu.com/pypi/simple\npip install trash-cli -i https://mirror.baidu.com/pypi/simple\n#å®‰è£…EISegï¼ˆå›¾åƒå¤„ç†ï¼‰ githubä¸»é¡µé¢\nâ€‹\tpip install eiseg -i https://mirror.baidu.com/pypi/simple #åªè¾“å…¥è¿™ä¸ªå°±è¡Œ\nâ€‹\tpip install paddleseg -i https://mirror.baidu.com/pypi/simple #ã€æœ€åã€‘å®‰è£…æ—§ç‰ˆæœ¬opencvï¼ˆå¦‚æœè£…äº†è¯·å…ˆå¸è½½ï¼‰\npip install opencv-python==4.2.0.32 -i https://mirror.baidu.com/pypi/simple\n#æ¥ç€æµ‹è¯•ocrå’Œeisegï¼šé¦–å…ˆè¾“å…¥PPOCRLabel --lang ch\n#å¦‚æœæ­¤æ—¶å‡ºç°ä¸€æ®µåŠ è½½è¿‡ç¨‹ï¼Œæœ€åå‡ºç°ç•Œé¢ï¼Œå°±è¯´æ˜ä½ å®‰è£…æˆåŠŸäº†ï¼ï¼\n#å†æ¬¡è¾“å…¥ï¼š eiseg è¿™æ—¶å€™å¤§æ¦‚ç‡å·²ç»æˆåŠŸæ‰“å¼€ï¼\nå€’éœ‰äººè¯·çœ‹è¿™ å¦‚æœeisegæ‰“å¼€ä¸æˆåŠŸå¯ä»¥å°è¯•æ›²çº¿æ–¹æ¡ˆï¼ˆå…ˆå®‰è£…è¿™äº›ä¾èµ–åº“ï¼‰ï¼š\n(pipä¸æˆåŠŸå°±æ”¹æˆconda)\n#é¦–å…ˆå…ˆæŠŠpaddlesegçš„æ•´ä¸ªé¡¹ç›®cloneåˆ°æœ¬åœ° ï¼ˆä»¥ä¸‹å®‰è£…è¿˜æ‰“ä¸å¼€å¯ä»¥è¿™ä¹ˆåšï¼‰\nconda install gdal\npip install qtpy\npip instal pyqt5\npip install easydict\npip install scikit-image\nè¿™æ—¶å€™å†è¿›å…¥å³å¯ï¼ ï¼ˆå¦‚æœä½ è¿˜æ˜¯æ‰“ä¸å¼€ï¼Œå°±cloneåè¿›å…¥eisegå­æ–‡ä»¶ï¼ŒæŒ‰ç…§è¿™ä¸ªå¸–å­è¿è¡Œexe.py\tï¼‰\næœ€åä½¿ç”¨conda deactivateé€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼ï¼\n","date":"2022-02-19T20:45:40+08:00","permalink":"https://sanbuphy.github.io/p/%E5%AE%8C%E7%BE%8E%E5%AE%89%E8%A3%85paddleppocrlabeleiseglinux/","title":"å®Œç¾å®‰è£…paddleã€PPOCRLabelã€eiseg(linux)"},{"content":"å¤‡æ³¨:æˆ‘æ­£åœ¨å†™ä¸€ä»½ç›®æ ‡æ£€æµ‹\u0026amp;å›¾åƒå¼‚å¸¸æ£€æµ‹çš„ç»¼è¿°slidesï¼Œå¦‚æœæœ‰å…´è¶£å¯ä»¥ç­‰æˆ‘å‡ºï¼æ¬¢è¿é‚®ä»¶å‚¬æ›´æå»ºè®®ï¼šphysicoada@gmail.com\nopencvåŸºç¡€ æ¨èå‚è€ƒï¼š åŸºäºPythonçš„Opencvå…¨ç³»åˆ—é€Ÿæˆè¯¾ 3å¤©å»ºç«‹è®¡ç®—æœºè§†è§‰ç§»åŠ¨åº”ç”¨ç¨‹åº-æ”¯æŒiOSä¸Android æ— äººæœºç¼–ç¨‹ä¸Pythonæ•™å­¦\né¡¹ç›®åœ°å€ï¼šhttps://github.com/jasmcaus/opencv-course\nå‡ ä¸ªå¤§å‹ç»¼è¿° Object Detection in 20 Years: A Survey ç›¸å…³ç¬”è®°ï¼šhttps://zhuanlan.zhihu.com/p/192362333\nç»¼è¿°ï¼šç›®æ ‡æ£€æµ‹äºŒåå¹´ï¼ˆ2001-2021ï¼‰ ç›®æ ‡æ£€æµ‹è¿‘5å¹´å‘å±•å†ç¨‹æ¦‚è¿°ï¼Œä»R-CNNåˆ°RFBNetï¼ˆ2013\u0026ndash;2018ï¼‰ (éŸ©å›½äººæ•´çš„) ç›®æ ‡æ£€æµ‹ï¼šAnchor-Freeæ—¶ä»£ - é™€é£è½®çš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/62103812 CVPR 2021 è®ºæ–‡å¤§ç›˜ç‚¹-ç›®æ ‡æ£€æµ‹ç¯‡ - æˆ‘çˆ±è®¡ç®—æœºè§†è§‰çš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/387510116 ç›®æ ‡æ£€æµ‹çš„ç²¾è¿›è·¯å¾„ - mileistoneçš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/266648028 ç›®æ ‡æ£€æµ‹å…¥é—¨ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†ï¼ˆä¸Šï¼‰ - æœ€åˆšçƒˆçš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/60120331 å›½å†…åšæ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹çš„æœ‰å“ªäº›å¤§ç‰›å’Œå‰å®³çš„è¯¾é¢˜ç»„ï¼Ÿ - Amusiçš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/330390445/answer/723973941 ICCV 2021 ç»“æœå‡ºç‚‰ï¼æœ€æ–°200ç¯‡ICCV2021è®ºæ–‡åˆ†æ–¹å‘æ±‡æ€»ï¼ˆæ›´æ–°ä¸­ï¼‰ https://zhuanlan.zhihu.com/p/392575669\nhttps://zhuanlan.zhihu.com/p/354043252\n7.CVPR2021è®ºæ–‡åˆ†æ–¹å‘ç›˜ç‚¹ https://github.com/extreme-assistant/CVPR2021-Paper-Code-Interpretation#7\nä¸€æ–‡çœ‹å°½ 27 ç¯‡ CVPR2021 2D ç›®æ ‡æ£€æµ‹è®ºæ–‡ https://mp.weixin.qq.com/s/Ho7qtrpF9FhHGaamkQo6Lw CVPR 2020 è®ºæ–‡å¤§ç›˜ç‚¹-ç›®æ ‡æ£€æµ‹ç¯‡\nhttps://bbs.cvmart.net/articles/2732\nå…¶ä»– ã€Šç›®æ ‡æ£€æµ‹ã€‹-ç¬¬24ç« -YOLOç³»åˆ—çš„åˆä¸€é›†å¤§æˆè€…ï¼šYOLOXï¼https://zhuanlan.zhihu.com/p/391396921 ç›®æ ‡æ£€æµ‹å¯ä»¥å…ˆä»æˆç†Ÿæ¡†æ¶å¼€å§‹ä¸Šæ‰‹ï¼Œæ¯”å¦‚mmdetectionå’Œdetectron2ã€‚ å¦‚æœåŸºç¡€ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ç›®æ ‡æ£€æµ‹è¯¥æ€ä¹ˆå­¦å‘€ï¼Œç›®å‰ç ”ä¸€ï¼Œè€å¸ˆå•¥ä¹Ÿä¸ä¼šï¼Œæ„Ÿè§‰æ¯•ä¸äº†ä¸šäº†ï¼Ÿ - å°å°å°†çš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/510784176/answer/2305603811 ç³»ç»Ÿåœ°å­¦ä¹ ç›®æ ‡æ£€æµ‹å¯ä»¥éµä»ä¸‹é¢çš„å­¦ä¹ è·¯çº¿ï¼š 1.å­¦ä¹ ç»å…¸å·¥ä½œã€‚ç»å…¸å·¥ä½œåŒ…æ‹¬RCNNç³»åˆ—ï¼ˆRCNNã€Fast RCNNã€Faster RCNNï¼‰ï¼Œå®è§‚ä¸Šå¯ä»¥å­¦ä¹ åˆ°ä»€ä¹ˆæ˜¯ç›®æ ‡æ£€æµ‹ã€ç›®æ ‡æ£€æµ‹æ˜¯åšä»€ä¹ˆçš„ï¼Œå¾®è§‚ä¸Šå¯ä»¥å­¦ä¹ åˆ°è¯¸å¦‚Region Proposal Networkï¼ˆåç»­one-stageå·¥ä½œçš„åŸºç¡€ï¼‰ã€Anchor boxç­‰åŸºç¡€æŠ€æœ¯ã€‚è¿™ä¸ªç³»åˆ—åæ¥è¢«åˆ’å®šä¸ºâ€œtwo-stageâ€å·¥ä½œï¼Œæ£€æµ‹ç²¾åº¦å¥½ã€é€Ÿåº¦è¦æ…¢ä¸€äº›ã€‚éšåï¼Œå†å­¦ä¹ æ—©æœŸçš„YOLOç³»åˆ—å·¥ä½œï¼ˆYOLOv1ã€YOLOv2ï¼‰ï¼Œå®è§‚ä¸Šå¯ä»¥å­¦ä¹ åˆ°ä»€ä¹ˆæ˜¯one-stageç›®æ ‡æ£€æµ‹æ–¹æ³•ã€å¦‚ä½•è¿›è¡Œç«¯åˆ°ç«¯çš„è®­ç»ƒå’Œæ¨ç†ï¼ŒåŒæ—¶ï¼Œå­¦ä¹ SSDï¼Œå¯ä»¥åˆæ¬¡æ¥è§¦åˆ°å¤šçº§æ£€æµ‹æ–¹æ³•â€”â€”ä½¿ç”¨æ›´å¤šçš„ç‰¹å¾å›¾å»æ£€æµ‹ä¸åŒå¤§å°çš„ç‰©ä½“ã€‚æœ€åï¼Œå­¦ä¹ FPNã€YOLOv3ä»¥åŠRetinaNetï¼ˆFocal lossï¼‰ï¼ŒæŒæ¡å½“ä¸‹ä¸»æµæ£€æµ‹æ¡†æ¶â€œåˆ†è€Œæ²»ä¹‹â€æ–¹æ³•ã€‚å­¦ä¹ ç©è¿™äº›ç»å…¸å·¥ä½œï¼Œæœ€å¥½èƒ½ä»ä¸­æŒ‘é€‰å‡ºä¸€è‡³ä¸¤ä¸ªå·¥ä½œï¼Œè¿›è¡Œå¤ç°ï¼Œé‚£ä¹ˆï¼Œç›®æ ‡æ£€æµ‹å°±å…¥é—¨äº†ã€‚ç›®æ ‡æ£€æµ‹è¯¥æ€ä¹ˆå­¦å‘€ï¼Œç›®å‰ç ”ä¸€ï¼Œè€å¸ˆå•¥ä¹Ÿä¸ä¼šï¼Œæ„Ÿè§‰æ¯•ä¸äº†ä¸šäº†ï¼Ÿ - Kissrabbitçš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/510784176/answer/2305881442 ç›®æ ‡æ£€æµ‹ï¼ˆObject Detectionï¼‰å…¥é—¨æ¦‚è¦https://blog.csdn.net/f290131665/article/details/81012556 Reference ç›®æ ‡æ£€æµ‹ä½ç½®å›å½’æŸå¤±å‡½æ•°æ•´ç† ç›®æ ‡æ£€æµ‹å›å½’æŸå¤±å‡½æ•°ç®€ä»‹ï¼šSmoothL1/IoU/GIoU/DIoU/CIoU Loss è¾¹æ¡†å›å½’(Bounding Box Regression)è¯¦è§£ Faster RCNN ä¸­æ£€æµ‹æ¡†ä½ç½®å›å½’æ˜¯æ€ä¹ˆåšçš„ ç›®æ ‡æ£€æµ‹ï¼ˆ1ï¼‰-Selective Search ç¬¬ä¸‰åä¸‰èŠ‚ï¼Œç›®æ ‡æ£€æµ‹ä¹‹é€‰æ‹©æ€§æœç´¢-Selective Search Object Detection\u0026ndash;RCNN,SPPNet,Fast RCNNï¼ŒFasterRCNNè®ºæ–‡è¯¦è§£ ä»€ä¹ˆæ˜¯anchor-based å’Œanchor freeï¼Ÿ ","date":"2022-02-08T15:28:17+08:00","permalink":"https://sanbuphy.github.io/p/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%E6%B1%87%E6%80%BB/","title":"ç›®æ ‡æ£€æµ‹ç›¸å…³èµ„æ–™æ±‡æ€»"},{"content":"todo:https://www.cnblogs.com/charlotte77/p/5629865.html TODO:https://blog.csdn.net/Serins/article/details/121508468 TODO:https://www.bilibili.com/video/BV16x411V7Qg?spm_id_from=333.337.search-card.all.click\nåœ¨ä»‹ç»å…·ä½“çš„ç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆè®¤è¯†ä¸€ä¸‹ç¥ç»ç½‘ç»œä»¥åŠä¸ºä»€ä¹ˆè¦æ„é€ è¿™æ ·çš„ç¥ç»ç½‘ç»œã€‚ æ³¨ï¼Œå¦‚æœä½ å¯¹ç¥ç»ç½‘ç»œçš„å‘å±•å²æ„Ÿå…´è¶£ï¼Œå¯å‚è€ƒç¥ç»ç½‘ç»œæµ…è®²ï¼šä»ç¥ç»å…ƒåˆ°æ·±åº¦å­¦ä¹ \nç¥ç»ç½‘ç»œåŸºç¡€ é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“äººçš„ç¥ç»ç½‘ç»œæ˜¯ç”±ç¥ç»å…ƒç»„æˆçš„ï¼Œæ¯ä¸ªç¥ç»å…ƒä¸å…¶ä»–ç¥ç»å…ƒç›¸è¿ã€‚å½“æŸä¸ªç¥ç»å…ƒ â€œå…´å¥‹â€æ—¶, å°±ä¼šå‘ç›¸è¿çš„ç¥ç»å…ƒå‘é€åŒ–å­¦ç‰©è´¨ï¼Œæ”¹å˜è¿™äº›ç¥ç»å…ƒå†…çš„ç”µä½ï¼›å¦‚æœæŸç¥ç»å…ƒçš„ç”µä½è¶…è¿‡äº†ä¸€ä¸ªâ€œé˜ˆå€¼â€ ( threshold), é‚£ä¹ˆå®ƒå°±ä¼šè¢«æ¿€æ´»ï¼Œå³ â€œå…´å¥‹â€ èµ·æ¥ï¼Œæ¥ç€å‘å‘å…¶ä»–ç¥ç»å…ƒå‘é€åŒ–å­¦ç‰©è´¨ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠç¥ç»å…ƒæŠ½è±¡æˆâ€œç¥ç»å•å…ƒâ€ï¼Œå³ä»å•çº¯çš„è¾“å…¥0æˆ–1ï¼Œé˜¶è·ƒå‡½æ•°å‹æ¿€æ´»æ¨¡å¼ï¼Œè¾“å‡º0æˆ–1ï¼ˆå³ç‚¹ç«ï¼‰çš„ç”Ÿç‰©æ¨¡å‹ï¼›å˜ä¸ºå…è®¸è¾“å…¥ä»»ä½•æ¨¡å‹æ¡†æ¶å†…æ•°å€¼ï¼Œè‡ªé€‰æ¿€æ´»å‡½æ•°ä¸”å°†ç»“æœè½¬åŒ–ä¸ºå…´å¥‹åº¦çš„ä¸€èˆ¬æ¨¡å‹ã€‚ ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬å¸¸ç”¨sigmoidå‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œå¦‚æœä½ æƒ³äº†è§£å…¶ä»–æ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥è‡ªè¡Œæœç´¢ï¼ˆç½‘ç»œä¸ŠçœŸçš„å¾ˆå¤šï¼‰ï¼š MPç¥ç»å…ƒæ¨¡å‹ byï¼šå‘¨å¿—å-æœºå™¨å­¦ä¹  å¸¸è§æ¿€æ´»å‡½æ•° byï¼šå‘¨å¿—å-æœºå™¨å­¦ä¹  ç”±ä¸Šå¯çŸ¥ï¼Œç¥ç»å•å…ƒå¯ä»¥æ‹†è§£ä¸ºä¸‰å¤§è¦ç´ ï¼š $$ \\text{è¾“å…¥ï¼š} z=w_1x_1+\\cdots +w_nx_n+b\\cdot 1 \\\\ \\text{è¾“å‡ºï¼š} a=f\\left( z \\right) \\\\ \\text{æ¿€æ´»å‡½æ•°ï¼š}f\\left( z \\right) =\\frac{1}{1+e^{-z}} $$ å…¶ä¸­bä¸ºåç½®ï¼ˆä¸ºäº†å½¢å¼ç¾è§‚ï¼Œæˆ‘ä»¬ä»¤é˜ˆå€¼ $ \\theta = -b $ ï¼‰ï¼ŒbÂ·1çš„æ„æ€æ˜¯å¸¸æ•°1ä½œä¸ºbå¯¹åº”çš„è¾“å…¥å€¼ï¼ˆè¿™æ ·å¯ä»¥åœ¨ä¹‹åå°†ç­‰å¼å†™æˆæ›´ç¾è§‚çš„çŸ©é˜µï¼Œç±»ä¼¼å¤šå…ƒå›å½’æ—¶æŠŠå¸¸æ•°æ”¾å…¥çŸ©é˜µçš„æ“ä½œï¼‰ æœ‰äº†ç¥ç»å•å…ƒï¼ŒæŠŠä»–ä»¬è¿æ¥åå°±å½¢æˆäº†ç¥ç»ç½‘ç»œï¼ˆä¸åŒå±‚çš„ä½œç”¨å°†åœ¨ä¸‹éƒ¨åˆ†ç»™å‡ºï¼‰ é˜¶å±‚å‹ç¥ç»ç½‘ç»œ byï¼šæ·±åº¦å­¦ä¹ çš„æ•°å­¦ ç¥ç»ç½‘ç»œçš„è¿ä½œåŸç† å‡è®¾ï¼Œä½ æ˜¯ä¸€åªçˆ±åƒâ€œ0â€ä¸â€œ1â€å›¾æ ·çŒ«ç²®ä¸”éå¸¸æŒ‘é£Ÿçš„å°çŒ«ï¼Œå‡ºäºæ‡’æƒ°ï¼Œä½ æƒ³è®©è®¡ç®—æœºå¸®è‡ªå·±æŠŠè¿™ä¸¤ç±»å›¾æ¡ˆçš„çŒ«ç²®å®Œå…¨åŒºåˆ†ã€‚åœ¨ä»¥å‰ï¼Œæˆ‘ä»¬å­¦è¿‡äº†åˆ†ç±»æ³•çš„çº¿æ€§å›å½’(é€»è¾‘å›å½’)ï¼Œå•çº¯çš„äºŒç»´æ•°æ®ç‚¹åˆ†ç±»ä¸æ˜¯ä»¶éš¾äº‹ï¼Œä½†å½“æˆ‘ä»¬é‡åˆ°å›¾åƒåè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸Šè¿°çš„ç¥ç»ç½‘ç»œã€‚ ä¸ºäº†å¼•å…¥ç¥ç»ç½‘ç»œï¼Œé¦–å…ˆéœ€è¦å¯¹çŒ«ç²®å›¾æ¡ˆå¤„ç†æˆè®¡ç®—æœºå¯è¯†åˆ«çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è¿›è¡Œç¼–å·ï¼šï¼ˆä¸¾ä¾‹å›¾æ¡ˆä¸º4x3çš„æ ¼å­ï¼‰ å°†çŒ«ç²®çš„0/1å›¾æ¡ˆä½¿ç”¨æ ¼å­åˆ’åˆ† å…¶ä¸­ç¼–å·ä»£è¡¨æœ‰å¤šå°‘ä¸ªä¿¡å·æºè¾“å…¥ï¼Œä¿¡å·è¾“å…¥çš„å¤§å°å¯ä»¥æ ¹æ®é»‘ç™½è®¾å®šï¼Œç»™å‡ºç›¸åº”çš„0/1ã€‚ï¼ˆæ¯”å¦‚é»‘æ ¼å­ç»™ç¥ç»å…ƒ1çš„è¾“å…¥ï¼Œç™½æ ¼å­ä¸º0çš„è¾“å…¥ï¼‰ å°†å›¾åƒä¿¡æ¯è¾“å…¥ç¥ç»ç½‘ç»œ åœ¨è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬åªæœ‰ç®€å•çš„ä¸‰å±‚ï¼Œä¸€å±‚è¾“å…¥ï¼Œä¸€å±‚éšè—å±‚ï¼ˆä½ å¯ä»¥ç†è§£ä¸ºè¿›ä¸€æ­¥å¤„ç†æ•°æ®ï¼‰ï¼Œä¸€å±‚è¾“å‡ºï¼ˆç”¨äºåˆ¤æ–­ç»“æœæ˜¯0è¿˜æ˜¯1ï¼‰ã€‚æˆ‘ä»¬æŠŠå®ƒç§°ä¸ºä¸¤å±‚ç¥ç»ç½‘ç»œï¼ˆæœ‰äº›åœ°æ–¹è§‰å¾—è¾“å…¥å±‚éœ€è¦è®¡å…¥ï¼Œä½†åœ¨æ­¤æˆ‘ä»¬é‡‡ç”¨â€œå› ä¸ºè¾“å…¥å±‚ä¸æ´»åŠ¨åªæ˜¯è¾“å…¥â€çš„è§‚ç‚¹ï¼Œå°†è¾“å…¥å±‚æ’é™¤åœ¨å±‚æ•°è®¡ç®—å¤–ï¼‰ æœ‰äº†æ•°æ®è¾“å…¥ï¼Œæ¥ä¸‹æ¥ä¾¿éœ€è¦è¿›ä¸€æ­¥è®¤è¯†ç¥ç»å•å…ƒçš„ç¬¦å·è¯­è¨€ï¼Œä»è€Œç†è§£æ•°æ®åœ¨ç¥ç»ç½‘ç»œä¸­æ˜¯æ€ä¹ˆä¼ å¯¼çš„ã€‚ï¼ˆæ­¤å¤„å‹æƒ…å»ºè®®å¤ä¹ å°èŠ‚ä¸€çš„ç¥ç»å•å…ƒä¸‰å¤§è¦ç´ ï¼‰ ç¥ç»å•å…ƒçš„ç¬¦å·è¯­è¨€ å¦‚ä½•ç†è§£è¿™å¥—ç¬¦å·å‘¢ï¼Ÿå¦‚å›¾æ‰€ç¤ºï¼Œâ€œæˆ‘ä»¬ç°åœ¨æ‰€ç ”ç©¶çš„â€å¯¹è±¡æ˜¯ç¬¬Lå±‚çš„ç¬¬jä¸ªç¥ç»å•å…ƒï¼Œè€Œä»–å‰ä¸€å±‚çš„ç¥ç»ç½‘ç»œå³ä¸ºL-1å±‚ï¼Œä¸”æˆ‘ä»¬è®¾å‰ä¸€å±‚ç¥ç»å•å…ƒçš„æ ‡å·ä¸ºiã€‚æ ¹æ®è¿™å¥—ç¬¦å·ä»¥åŠæˆ‘ä»¬å‰é¢å­¦åˆ°çš„ç¥ç»å•å…ƒä¸‰å¤§è¦ç´ ï¼Œæˆ‘ä»¬çŸ¥é“äº†ç¬¬Lå±‚ç¬¬jä¸ªç¥ç»å•å…ƒçš„è¾“å…¥ä¸º $ \\mathrm{z}_{j}^{l} $ï¼Œè¾“å‡ºä¸º $ \\mathrm{a}_{j}^{l} $ ,å…¶ä¸­bä¸ºåç½®ï¼Œä¸”L-1å±‚ç¬¬iä¸ªç¥ç»å•å…ƒå¯¹Lå±‚ç¬¬jä¸ªç¥ç»å•å…ƒçš„å½±å“æƒé‡ä¸º $\\mathrm{w}_{ji}^{l}$ï¼Œæ¿€æ´»å‡½æ•°è´Ÿè´£æŠŠç¥ç»å•å…ƒçš„â€œå·¦åŠè¾¹â€å˜æˆå³åŠè¾¹çš„è¾“å‡ºã€‚ï¼ˆæ³¨ï¼Œæœ‰äº›åœ°æ–¹æƒé‡ç¼–å·çš„jiå¯èƒ½äº’æ¢ä¸ºijï¼Œä½†ä¸å½±å“æœ€åç»“æœï¼‰\næœ‰äº†ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬è‡ªç„¶æƒ³åˆ°å®ƒåˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿè®©æˆ‘ä»¬å›æœ›åˆå¿ƒâ€”â€”åˆ†ç±»ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯é€šè¿‡æ¨¡å‹å¯¹æ ·æœ¬è¿›è¡Œåˆ†ç±»ï¼›æ“ä½œæ˜¯é€šè¿‡å¯¹è®­ç»ƒé›†çš„å­¦ä¹ ï¼Œå°†æŸç§å‚æ•°å†³å®šä¸‹çš„æ¨¡å‹é¢„æµ‹å€¼ï¼ˆæŸç§ç‰¹å¾ï¼‰ä¸å¯¹åº”çš„ç°å®ç‰¹å¾æ¯”è¾ƒï¼Œè®©ç°å®å’Œé¢„æµ‹çš„å·®åˆ«å°½é‡å°ï¼Œä»è€Œå®ç°åˆ†ç±»çš„æ•ˆæœã€‚è€Œç¥ç»ç½‘ç»œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå†³å®šåˆ†ç±»ç»“æœçš„æ˜¯è¾“å‡ºå±‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è¾“å‡ºå±‚ï¼ˆå‚è€ƒä¸Šé¢å‡ºç°çš„ä¸¤å±‚ç¥ç»ç½‘ç»œï¼‰çš„ç¬¬ä¸€ä¸ªç¥ç»å•å…ƒçš„è¾“å‡ºå€¼ $a_1^3$ åœ¨å›¾æ ·ä¸º1çš„æ—¶å€™æ¥è¿‘1ï¼ˆç°å®ç›®æ ‡ä¸º1ï¼‰ï¼Œç¬¬äºŒä¸ªç¥ç»å•å…ƒçš„è¾“å‡ºå€¼ $a_2^3$åœ¨å›¾æ ·ä¸º0çš„æ—¶å€™æ¥è¿‘1ï¼ˆæ˜¾ç¤ºç›®æ ‡ä¸º0ï¼‰ï¼Œå³ä¸ºï¼šï¼ˆæ³¨æ„ï¼Œå€¼ä¸º1è¡¨ç¤ºçš„æ˜¯ç¥ç»å•å…ƒâ€œå…´å¥‹â€ï¼‰\nä¸ºä»€ä¹ˆéœ€è¦æ¢¯åº¦ä¸‹é™æ³• å‰å‘ä¼ æ’­åŸç† åå‘ä¼ æ’­åŸç† ä¸€èˆ¬åŒ–å¤„ç† æµ…æè¥¿ç“œä¹¦ä¸­çš„BPç®—æ³• Reference æ¸©æ•…çŸ¥æ–°â€”â€”å‰å‘ä¼ æ’­ç®—æ³•å’Œåå‘ä¼ æ’­ç®—æ³•ï¼ˆBPç®—æ³•ï¼‰åŠå…¶æ¨å¯¼ åå‘ä¼ æ’­ç®—æ³•è¯¦ç»†æ¨å¯¼ æ·±åº¦å­¦ä¹ ä¹‹åå‘ä¼ æ’­ç®—æ³• ä¸Š/ä¸‹ Part 3 ver 0.9 beta ã€Šæ·±åº¦å­¦ä¹ çš„æ•°å­¦ã€‹ æ¶Œäº•è‰¯å¹¸ æ¶Œäº•è´ç¾ ã€Šæœºå™¨å­¦ä¹  Machine Learningã€‹ å‘¨å¿—å ","date":"2022-01-29T16:18:00+08:00","image":"https://sanbuphy.github.io/p/%E5%B0%8F%E7%8C%AB%E4%B9%9F%E8%83%BD%E7%9C%8B%E6%87%82%E7%9A%84%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95/jeff-rodgers-DaPabnoYMKc-unsplash_hu994d601531656c23f7e611d455c8d878_8153127_120x120_fill_q75_box_smart1.jpg","permalink":"https://sanbuphy.github.io/p/%E5%B0%8F%E7%8C%AB%E4%B9%9F%E8%83%BD%E7%9C%8B%E6%87%82%E7%9A%84%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95/","title":"å°çŒ«ä¹Ÿèƒ½çœ‹æ‡‚çš„åå‘ä¼ æ’­ç®—æ³•"},{"content":"é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®¤è¯†ä»€ä¹ˆæ˜¯ä¿¡æ¯é‡ä¸ä¿¡æ¯ç†µ:\nè‡ªä¿¡æ¯é‡ é€šå¸¸è‡ªä¿¡æ¯å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢æ¥ç†è§£:\nè‡ªä¿¡æ¯æ˜¯äº‹ä»¶å‘ç”Ÿå‰,äº‹ä»¶å‘ç”Ÿçš„ä¸ç¡®å®šæ€§ã€‚ è‡ªä¿¡æ¯è¡¨ç¤ºäº‹ä»¶å‘ç”Ÿå,äº‹ä»¶æ‰€åŒ…å«çš„ä¿¡æ¯é‡ã€‚ (æ¯”å¦‚ä½ çœ‹åˆ°è¿™ï¼Œä¼šæƒ³é—®ä½œè€…ä¹Ÿè®¸ä¸æ˜¯ä¸€åªçŒ«è€Œæ˜¯äººç±»â€”â€”â€”â€”é‚£æˆ‘å½“ç„¶ä¸æ˜¯çŒ«ï¼Œè¿™å°±æ²¡æœ‰ä¸ç¡®å®šæ€§å¯è¨€ï¼Œæ²¡æœ‰ä»€ä¹ˆä¿¡æ¯é‡ï¼›å¦‚æœæœ‰ä¸€å¤©æˆ‘çœŸçš„æ˜¯çŒ«äº†ï¼Œé‚£ä¾¿æ˜¯å¤§æ–°é—»äº†ï¼ï¼) è‡ªç„¶è€Œç„¶ï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°æ‰€è°“ä¿¡æ¯é‡åº”å½“ä¸æ¦‚ç‡æœ‰å…³ï¼Œä¸”åº”è¯¥å¯ä»¥åŠ åˆï¼ˆä¸¤ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶å¸¦æ¥çš„ä¿¡æ¯é‡åº”è¯¥æ˜¯åˆ†åˆ«å‘ç”Ÿæ—¶çš„å’Œï¼‰ï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³ä»¥ä¸‹ç‰¹è´¨ï¼š\n$f\\left( P \\right) \u0026gt;0 \\; \\; \\; \\; P\\left( x \\right) \\in \\left( 0,1 \\right) $ $f\\left( P_AÂ·P_B \\right) =f\\left( P_A \\right) +f\\left( P_B \\right) $ $f\\left( 1 \\right) =0$ äº‹ä»¶å‘ç”Ÿæ¦‚ç‡è¶Šå¤§ï¼Œè‡ªä¿¡æ¯é‡è¶Šå° æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ‰æƒ³åˆ°å¯¹æ•°ä¼šæ»¡è¶³è¿™æ ·çš„æ€§è´¨ï¼Œäºæ˜¯å¯ä»¥ç»™å‡ºï¼š$I\\left( x \\right) =-\\log \\left( P\\left( x \\right) \\right) $ å› ä¸ºåœ¨è®¡ç®—æœºé¢†åŸŸä¸­ä¹ æƒ¯ç”¨äºŒè¿›åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä»¥2ä¸ºåº•ï¼Œè¿™æ ·è‡ªä¿¡æ¯é‡çš„å•ä½å°±ä¸ºæ¯”ç‰¹bit,â€”â€”å³äºŒè¿›åˆ¶æ•°çš„ä¸€ä½åŒ…å«çš„ä¿¡æ¯æˆ–2ä¸ªé€‰é¡¹ä¸­ç‰¹åˆ«æŒ‡å®š1ä¸ªçš„éœ€è¦ä¿¡æ¯é‡ã€‚è€Œæœºå™¨å­¦ä¹ ä¸­å¸¸é€‰æ‹©ä»¥eä¸ºåº•ï¼Œå•ä½ä¸ºå¥ˆç‰¹nats ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¾‹é¢˜æ¥æ›´å¥½çš„ç†è§£è‡ªä¿¡æ¯é‡ï¼š ä»¥2ä¸ºåº•çš„å¯¹æ•°ç¬¦å·lb ä¿¡æ¯ç†µ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥ç ”ç©¶ä»€ä¹ˆæ˜¯ä¿¡æ¯ç†µï¼Œåœ¨å‰é¢æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•è¡¡é‡ä¸€ä¸ªäº‹ä»¶çš„ä¸ç¡®å®šæ€§ï¼Œä½†ä¸€ä¸ªéšæœºå˜é‡å¯èƒ½åŒ…å«çš„å¤šä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¯¹è¿™ä¸ª éšæœºå˜é‡çš„ä¸ç¡®å®šæ€§ è¿›è¡Œåˆ»ç”»å‘¢ï¼Ÿ æˆ‘ä»¬ä¼šè‡ªç„¶æƒ³åˆ°æ±‚å‡ºæ‰€æœ‰äº‹ä»¶çš„ä¿¡æ¯é‡æœŸæœ›ï¼Œä¸”ç†µè¶Šå¤§ï¼Œäº‹ä»¶çš„ä¸ç¡®å®šæ€§è¶Šå¼ºï¼Œå½“æ»¡è¶³å‡åŒ€åˆ†å¸ƒæ—¶ç†µæœ€å¤§(æœ‰çº¦æŸæƒ…å†µä¸‹è¦é¢å¤–è€ƒè™‘ï¼Œä¸€é˜¶çŸ©äºŒé˜¶çŸ©ä¸åŒæ—¶çš„æœ€å¤§ç†µåˆ†å¸ƒä¸åŒï¼Œè¯¦æƒ…å¯å‚è€ƒæœ€å¤§ç†µåŸç†ï¼‰ï¼›å¦‚æœç†µå€¼å°ï¼Œè¯æ˜æŸä¸ªäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡æ¯”è¾ƒå¤§ï¼Œéšæœºå˜é‡å–æŸä¸ªå€¼çš„æ¦‚ç‡å¤§ï¼Œä¸ç¡®å®šæ€§å°±å°äº†ã€‚(å¦å¤–ï¼Œä¿¡æ¯ç†µä¹Ÿå¯ä»¥ç†è§£ä¸ºè§£é™¤ä¿¡æºä¸ç¡®å®šæ€§æ‰€éœ€è¦çš„ä¿¡æ¯é‡) äºæ˜¯æˆ‘ä»¬ç»™å‡ºï¼š (å…¶ä¸­è§„å®š)$0\\log 0=0$ $$ H\\left( x \\right) =-\\sum_{i=1}^n{p\\left( x_i \\right) \\log \\left( p\\left( x_i \\right) \\right)} $$ æˆ‘ä»¬å¯ä»¥éªŒè¯ï¼Œå½“nä¸ªäº‹ä»¶æ»¡è¶³ç­‰æ¦‚ç‡åˆ†å¸ƒæ—¶å…¶ä¸­å½“ç»“æœä¸ºlognï¼ˆnä¸ºæ€»æ•°ï¼‰ä¿¡æ¯ç†µè¾¾åˆ°æœ€å¤§å€¼ã€‚ å¦å¤–å¯ä»¥ç»™å‡ºæ¡ä»¶ç†µ(ä½ å¯ä»¥è¿ç”¨æ¡ä»¶æ¦‚ç‡è¾…åŠ©ç†è§£)ï¼š $$ H\\left( Y|X \\right) =-\\sum_x{\\sum_y{p\\left( xy \\right) \\log P\\left( y|x \\right) =\\sum_x{-\\sum_y{P\\left( y|x \\right) \\log P\\left( x \\right) =\\sum_x{P\\left( x \\right) H\\left( Y|x \\right)}}}}} $$\nç›¸å¯¹ç†µ å¦‚æœæˆ‘ä»¬å¯¹äºåŒä¸€ä¸ªéšæœºå˜é‡xæœ‰ä¸¤ä¸ªå•ç‹¬çš„æ¦‚ç‡åˆ†å¸ƒP(x) å’Œ Q(x)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨KLæ•£åº¦ï¼ˆKullback-Leibler (KL) divergenceï¼‰æˆ–è€…å«ç›¸å¯¹ç†µæ¥è¡¡é‡è¿™ä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚æƒ…å†µï¼Œå…¶ä¸­på¯¹qçš„ç›¸å¯¹ç†µå†™ä½œ(åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠP(x)çœ‹ä½œçœŸå®åˆ†å¸ƒï¼Œè€ŒQ(x)ä½œä¸ºé¢„æµ‹çš„åˆ†å¸ƒ)ï¼š $$ D_{KL}\\left(p||q \\right) =\\sum_x{p\\left( x \\right) \\log \\frac{p\\left( x \\right)}{q\\left( x \\right)}=E_{p\\left( x \\right)}\\log \\frac{p\\left( x \\right)}{q\\left( x \\right)}} $$ åŒæ—¶KLæ•£åº¦è¿˜æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š $$ D_{KL}\\left(p||q \\right) \\ne D_{KL}(q||p) \\\\ D_{KL}\\left( p||q\\right) \\geqslant 0 $$ å¯¹äºç¬¬ä¸€ä¸ªå¼å­ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä»¥ä¸‹å†…å®¹ç†è§£ï¼š by Deep Learning.Ian Goodfellow and Yoshua Bengio and Aaron Courville ç”¨æ¯”è¾ƒé€šä¿—çš„è¯æ¥è¯´ï¼Œè®©æˆ‘ä»¬å›åˆ°å…¬å¼ä¹‹ä¸­ï¼Œä¸”æ³¨æ„åˆ°P(x)ä½œä¸ºçœŸå®åˆ†å¸ƒï¼ŒQ(x)ä½œä¸ºé¢„æµ‹çš„åˆ†å¸ƒï¼›\n$$ D_{KL}\\left( p||q \\right) =E_{p\\left( x \\right)}\\log \\frac{p\\left( x \\right)}{q\\left( x \\right)} $$\nå½“ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æœP(x)æ˜¯è¾ƒå¤§çš„ï¼Œé‚£ä¹ˆq(x)ä¹Ÿåº”è¯¥è¾ƒå¤§æ¥ä¿è¯ç›¸å¯¹ç†µæœ€å°åŒ–ï¼›å¦‚æœP(x)æ˜¯è¾ƒå°çš„ï¼Œé‚£å®é™…ä¸Šq(x)çš„å¤§å°å¯¹ç›¸å¯¹ç†µå½±å“ä¸å¤§ï¼›æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç‰¹åˆ«æ³¨æ„å‰è€…çš„æƒ…å†µã€‚æ­¤æ—¶åœ¨çœ‹å›¾ä½ å°±å¯ä»¥æ›´åŠ ç†è§£äº†ã€‚ $$ D_{KL}\\left( q||p \\right) =E_{q\\left( x \\right)}\\log \\frac{q\\left( x \\right)}{p\\left( x \\right)} $$\nå½“ç¬¬äºŒç§æƒ…å†µï¼Œå¾ˆæ˜¾ç„¶ä¼šä¸ç¬¬ä¸€ç§æƒ…å†µç›¸åï¼Œå¦‚æœP(x)æ˜¯è¾ƒå°çš„ï¼Œé‚£ä¹ˆq(x)ä¹Ÿåº”è¯¥è¾ƒå°æ¥ä¿è¯ç›¸å¯¹ç†µæœ€å°åŒ–â€”â€”â€”â€”è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´å›¾ä¸­æåˆ°æ¦‚ç‡å°çš„åœ°æ–¹æ¯”è¾ƒé‡è¦ï¼Œè€Œq(x)è¾ƒå¤§çš„æ—¶å€™å°±å½±å“ä¸å¤§äº†ã€‚ äº¤å‰ç†µ æ¥ä¸‹æ¥æˆ‘ä»¬è¦äº†è§£å¸¸ç”¨çš„ä¸€ç§æ›´å¸¸ç”¨çš„ç†µâ€”â€”â€”â€”äº¤å‰ç†µï¼Œç”±å‰é¢å­¦åˆ°çš„ç›¸å¯¹ç†µå¯ä»¥è¿›ä¸€æ­¥æ¨å¯¼ï¼š\n$$ \\begin{aligned} D_{KL}\\left( p||q \\right) \u0026amp;=\\sum_{i=1}^n{p\\left( x_{\\mathrm{i}} \\right) \\log \\left( \\frac{p\\left( x_i \\right)}{q\\left( x_i \\right)} \\right)}\\\\ \\mathrm{ }\u0026amp;=\\sum_{i=1}^n{p\\left( x_i \\right) \\log \\left( p\\left( x_i \\right) \\right)}-\\sum_{i=1}^n{p\\left( x_i \\right)}\\log \\left( q\\left( x_i \\right) \\right)\\\\ \u0026amp;=-H\\left( p \\right) -\\sum_{i=1}^n{p\\left( x_i \\right)}\\log \\left( q\\left( x_i \\right) \\right)\\ \\end{aligned} $$\nå…¶ä¸­ç¬¬ä¸€é¡¹æˆ‘ä»¬å¯é€šè¿‡æ¨å¯¼å¾—çŸ¥æ˜¯é’ˆå¯¹çœŸå®åˆ†å¸ƒæ¦‚ç‡p(x)çš„ä¿¡æ¯ç†µï¼Œè€Œåä¸€é¡¹æˆ‘ä»¬å®šä¹‰ä¸ºäº¤å‰ç†µï¼› $$ H\\left( p,q \\right) =-\\sum_{i=1}^n{p\\left( x_i \\right)}\\log \\left( q\\left( x_i \\right) \\right) $$ äº¤å‰ç†µå¯ä»¥ç†è§£ä¸ºï¼Œæ¶ˆé™¤ä½“ç³»ä¸ç¡®å®šæ€§æ‰€éœ€è¦ä»˜å‡ºçš„åŠªåŠ›å¤§å°ã€‚\näº¤å‰ç†µä¸æå¤§ä¼¼ç„¶ä¼°è®¡çš„è”ç³» ç”±äºçœŸå®åˆ†å¸ƒçš„ä¿¡æ¯ç†µæ˜¯ç¡®å®šçš„ï¼Œåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼ˆæœ€å°åŒ–ç›¸å¯¹ç†µï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»–å¿½ç•¥ï¼Œåªçœ‹äº¤å‰ç†µçš„éƒ¨åˆ†ã€‚æ­¤å¤–ï¼Œæœ€å°åŒ–äº¤å‰ç†µå…¶å®ä¸æå¤§ä¼¼ç„¶ä¼°è®¡æ˜¯ç­‰ä»·çš„ï¼Œå…·ä½“è¯æ˜å¦‚ä¸‹ï¼šï¼ˆå‚è€ƒDeep Learning.Ian Goodfellow and Yoshua Bengio and Aaron Courvilleï¼‰ æˆ‘ä»¬è€ƒè™‘ä¸€ç»„å«æœ‰mä¸ªæ ·æœ¬çš„æ•°æ®é›†$\\mathbf{X}=({ x^{(1)},\\cdots ,x^{(m)} }) $,æ­¤æ—¶å¯ä»¥å®šä¹‰ $ \\theta $ çš„æå¤§ä¼¼ç„¶ä¸º(å…¶ä¸­Pä¸ºæ¨¡å‹çš„è”åˆæ¦‚ç‡)ï¼š(å¦‚æœä½ ä¸æ‡‚argmaxæ˜¯ä»€ä¹ˆæ„æ€å¯ä»¥å‚è€ƒargmaxç§‘æ™®) $$ \\begin{aligned} \\mathbf{\\theta }_{ML}\u0026amp;=\\underset{\\theta}{\\mathrm{argmax}}P_{model}\\left( \\mathbf{X};\\theta \\right)\\\\ \\mathrm{ }\u0026amp;=\\underset{\\theta}{\\mathrm{argmax}}\\prod_{i=1}^m{P_{model}\\left( \\boldsymbol{x}^{\\left( i \\right)};\\theta \\right)} \\end{aligned} $$ ç”±äºä¹˜ç§¯ä¸å¥½è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥å–logå°†ä»–è½¬æ¢ä¸ºåŠ å’Œå½¢å¼ï¼Œå–æœ€å€¼æ—¶çš„å‚æ•°ä¸å˜ï¼›ä¸”å¯ä»¥ä¹˜ä¸Šä¸å½±å“ç»“æœçš„ $ \\frac{1}{m} $ã€‚ $$ \\begin{aligned} \\mathbf{\\theta }_{ML}\u0026amp;=\\underset{\\theta}{\\mathrm{argmax}}\\sum_{i=1}^m \\mathrm{log} {P_{model}\\left( \\boldsymbol{x}^{\\left( i \\right)};\\theta \\right)}\\\\ \\mathrm{ }\u0026amp;=\\underset{\\theta}{\\mathrm{argmax}}\\frac{1}{m}\\sum_{i=1}^m \\mathrm{log} {P_{model}\\left( \\boldsymbol{x}^{\\left( i \\right)};\\theta \\right)} \\end{aligned} $$ ç”±å¤§æ•°å®šå¾‹å¯çŸ¥ï¼ˆç®—æœ¯å¹³å‡å€¼ä¾æ¦‚ç‡æ”¶æ•›äºæœŸæœ›ï¼‰ï¼š $$ \\frac{1}{m}\\sum_{i=1}^m{X_i\\longrightarrow} \\mu $$ å¯ä»¥å°†åŸå¼è¿›ä¸€æ­¥åŒ–ä¸ºï¼š $$ \\begin{aligned} \\mathbf{\\theta }_{ML}\u0026amp;=\\underset{\\theta}{\\mathrm{arg}\\max}\\mathbb{E}_{\\mathbf{x}~\\hat{p}_{data}}\\log P_{model}\\left( \\boldsymbol{x};\\boldsymbol{\\theta } \\right)\\\\ \u0026amp;=\\underset{\\theta}{\\mathrm{arg}\\max}\\sum_x{p\\left( x \\right) \\log q\\left( x \\right)}\\\\ \u0026amp;=\\underset{\\theta}{\\mathrm{arg}\\min}\\left[ -\\sum_x{p\\left( x \\right) \\log q\\left( x \\right)} \\right]\\\\ \\end{aligned} $$ Bravo!!! æ­¤æ—¶ä½ æƒŠå–œçš„å‘ç°è¿™å°±æ˜¯æˆ‘ä»¬å‰é¢æ¨å¯¼å¾—åˆ°çš„äº¤å‰ç†µå…¬å¼ï¼Œè‡³æ­¤ï¼Œå¯¹äºçœŸå®åˆ†å¸ƒå’Œæ¨¡å‹åˆ†å¸ƒï¼Œæˆ‘ä»¬æ˜ç™½äº†MLEæ–¹æ³•ï¼ˆè®©ä¼¼ç„¶æœ€å¤§åŒ–ï¼‰ç­‰ä»·äºä¸¤è€…é—´äº¤å‰ç†µçš„æœ€å°åŒ–ã€‚å¥½å¥‡çš„ä½ ä¹Ÿè®¸æƒ³é—®â€œMLEä¸KLæ•£åº¦ä¹Ÿæ˜¯å…±é€šçš„å—ï¼Ÿâ€â€”â€”â€”â€”è¿™ä¸ªé—®é¢˜ä½ å¯ä»¥è‡ªå·±è¯•è¯•çœ‹ï¼Œå°±ç”¨ä¸Šå¼ç±»ä¼¼åŠæ³•åŠ å¸¸æ•°å³å¯ï¼\nReference ä¸€æ–‡ææ‡‚äº¤å‰ç†µæŸå¤± è¯¦è§£æœºå™¨å­¦ä¹ ä¸­çš„ç†µã€æ¡ä»¶ç†µã€ç›¸å¯¹ç†µå’Œäº¤å‰ç†µ ä¿¡æ¯è®ºåŸºç¡€ æ•°å­—ä¸–ç•Œé€¼è¿‘ç°å®ä¸–ç•Œâ€”â€”æµ…è°ˆåˆ†å¸ƒè¿‘ä¼¼ä¸æœ€å¤§ä¼¼ç„¶ä¼°è®¡ ","date":"2022-01-22T22:34:11+08:00","image":"https://sanbuphy.github.io/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E8%AE%BA%E5%9F%BA%E7%A1%80/michael-sum-LEpfefQf4rU-unsplash_hu05be89c43654817bfc3a6d1d1f1925fe_2269278_120x120_fill_q75_box_smart1.jpg","permalink":"https://sanbuphy.github.io/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E8%AE%BA%E5%9F%BA%E7%A1%80/","title":"æœºå™¨å­¦ä¹ ä¸­çš„ä¿¡æ¯è®ºåŸºç¡€"},{"content":"æœ¬æ–‡ä¸ºä¸ªäººå¯¹è¥¿ç“œä¹¦ä¸æˆç†Ÿçš„ä¸€äº›ç†è§£å’Œèµ„æ–™æ•´ç†ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡å‡ºæ„è§ï¼Œè°¢è°¢ï¼(å¯é‚®ç®±è”ç³»physicoada@gmail.com)\nè¥¿ç“œä¹¦ç« èŠ‚ä¸‰ çº¿æ€§æ¨¡å‹ æ–‡å­—ç‰ˆæµ“ç¼©å¯å‚è€ƒï¼šå‘¨å¿—åæœºå™¨å­¦ä¹ ç¬”è®° by:Vay-keen\nç®€ç•¥è€Œè¨€ï¼Œæœ¬ç« ä¸»è¦æ¶‰åŠåˆ°ä¸‰å¤§å—å†…å®¹\nçº¿æ€§å›å½’åŠæå¤§ä¼¼ç„¶ä¼°è®¡ å¯¹æ•°å‡ ç‡å›å½’åŠäº¤å‰ç†µæ€æƒ³ äºŒåˆ†ç±»çº¿æ€§åˆ¤åˆ«åˆ†æ æ•°å­¦åŸºç¡€ æå¤§ä¼¼ç„¶ä¼°è®¡ å‡¸å‡½æ•° æœ¬å›¾æ¥è‡ªï¼šå‡¸å‡½æ•°çš„å››ç§åˆ¤æ–­æ–¹æ³• å¤šå…ƒå‡½æ•°åˆ¤åˆ«æ³•(HessiançŸ©é˜µæ­£å®šæ€§)ï¼š\næœºå™¨å­¦ä¹ ä¸­å‡¸å‡½æ•°çš„å¥½å¤„ï¼šå‡½æ•°å…·æœ‰å”¯ä¸€çš„æå°å€¼ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ±‚å¾—çš„æ¨¡å‹æ˜¯å…¨å±€æœ€ä¼˜ï¼Œä¸ä¼šé™·å…¥å±€éƒ¨æœ€ä¼˜ï¼ˆæƒ³è±¡ä¸€ä¸‹æ— æ•°æ³¢æµªçš„å‡½æ•°ï¼Œéš¾ä»¥åœ¨æ¢¯åº¦ä¸‹é™ä¸­æ‰¾åˆ°æœ€å°å€¼ï¼‰ã€‚\nä¿¡æ¯ç†µã€ç›¸å¯¹ç†µä¸äº¤å‰ç†µ è¯·å‚è€ƒæ•°å­¦ä¸“æ ä¸­çš„æ–‡ç« ï¼ˆæœºå™¨å­¦ä¹ ä¸­çš„ä¿¡æ¯è®ºåŸºç¡€ï¼‰\næ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³• çº¿æ€§å›å½’ çŸ©é˜µæ¨å¯¼ çŸ©é˜µæ±‚å¯¼æ–¹æ³•åŠå…¶å®Œæ•´è¿‡ç¨‹è¯·å‚è€ƒæˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼šçŸ©é˜µæ±‚å¯¼å»ºè®®å…¥é—¨æ‰‹å†Œ\næå¤§ä¼¼ç„¶ä¼°è®¡æ³• å¯¹æ•°å‡ ç‡å›å½’(é€»è¾‘å›å½’) æå¤§ä¼¼ç„¶ä¼°è®¡æ³• çº¿æ€§åˆ¤åˆ«åˆ†æ å¤šåˆ†ç±»å­¦ä¹  ECOCç  åœ¨ä¹¦ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ ·çš„ä¸€å¼ å›¾ï¼š å…¶ä¸­æ¶‰åŠåˆ°æ‰€è°“çš„æµ·æ˜è·ç¦»ä¸æ¬§æ°è·ç¦»ã€‚ æµ·æ˜è·ç¦»æŒ‡çš„æ˜¯ï¼šå¯¹äºé•¿åº¦ç›¸ç­‰çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨ç›¸åŒä½ç½®ä¸Šä¸åŒå­—ç¬¦çš„ä¸ªæ•°ã€‚\nè€Œæ¬§æ°è·ç¦»æŒ‡çš„æ˜¯å¤šç»´ç©ºé—´ä¸­ä¸¤ç‚¹é—´ç»å¯¹è·ç¦»ï¼š $ dist\\left( X,Y \\right) =\\sqrt{\\sum_{i=1}^n{\\left( x_i-y_i \\right) ^2}} $ ç”±æ­¤æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºå›¾ä¸­çš„æ•°å­—ï¼Œå¯¹(a)å›¾ä¸­å¯æœ‰ï¼š $$ \\qquad \\text{ç¤ºä¾‹}-1 {\\color{red} -1 +1 -1 }+1 \\\\ C1\\text{ç¼–ç } \\ -1 {\\color{red} +1 -1 +1 }+1 $$ å®¹æ˜“çœ‹å‡ºæµ·æ˜è·ç¦»ä¸º3ï¼Œè€Œæ¬§æ°è·ç¦»ä¸º $$ \\sqrt{\\left( -1-\\left( -1 \\right) \\right) ^2+\\left( -1-1 \\right) ^2+2^2+2^2+0}=2\\sqrt{3} $$ å…¶ä»–å€¼å¯ä»¥ç”¨ç›¸åŒçš„åŠæ³•æ¨å¯¼å¾—åˆ°ã€‚\nReference é€»è¾‘å›å½’çš„åŸç†ã€æ¨å¯¼å’Œå¸¸è§é—®é¢˜ å‡¸å‡½æ•°ã€æŸå¤±å‡½æ•°ã€çº¿æ€§æ¨¡å‹çš„åŸºæœ¬å½¢å¼ã€çº¿æ€§å›å½’ã€w* çš„ä»£ç å®ç° ","date":"2022-01-17T22:53:41+08:00","permalink":"https://sanbuphy.github.io/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%A5%BF%E7%93%9C%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C/","title":"ã€Šæœºå™¨å­¦ä¹ ã€‹è¥¿ç“œä¹¦ç¬”è®°(äºŒ)"},{"content":" åˆå§‹ä»‹ç» ç¬¦å·è§„å®š åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åšå¦‚ä¸‹è§„å®šï¼š\nMatrixçŸ©é˜µä¸ºï¼š$\\mathbf{A}, \\mathbf{X}, \\mathbf{Y}$ Vectorå‘é‡ï¼ˆè§„å®šä¸º$\\color{red} {åˆ—} $å‘é‡ï¼‰ä¸ºï¼š$ \\mathbf{a}, \\mathbf{x}, \\mathbf{y}$\nScalaræ ‡é‡ä¸ºï¼š$a, x, y$\nåˆ†å­å¸ƒå±€ åœ¨çŸ©é˜µæ±‚å¯¼ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§å¸ƒå±€ï¼ˆåˆ†å­ä¸åˆ†æ¯ï¼‰ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæœ¬æ–‡åªé˜è¿°äº†åˆ†å­å¸ƒå±€å³ï¼š\n$$\\frac{\\partial \\mathbf{y}}{\\partial {x}}=\\left[\\begin{array}{c} \\frac{\\partial y_{1}}{\\partial x} \\\\ \\frac{\\partial y_{2}}{\\partial x} \\\\ \\vdots \\\\ \\frac{\\partial y_{m}}{\\partial x}\\end{array}\\right]\\ \\ \\ \\frac{\\partial y}{\\partial \\mathbf {x}} = \\left[\\frac{\\partial y}{\\partial x_{1}} ,\\frac{\\partial y}{\\partial x_{2}}, \\cdots ,\\frac{\\partial y}{\\partial x_{n}}\\right]$$ åˆ†æ¯å¸ƒå±€ä¸ºåˆ†å­å¸ƒå±€çš„è½¬ç½®ã€‚ è®°å¿†æ–¹æ³•ï¼šåˆ†å­åˆ—å‘é‡åˆ†æ¯æ ‡é‡ï¼Œçœ‹ä½œé•¿ç­’å†°æ·‡æ·‹ï¼Œåˆ†æ¯çœ‹ä½œå°ç›’å­ï¼Œâ€œèƒ½ç«™ä½â€ã€‚åˆ†å­æ ‡é‡åˆ†æ¯åˆ—å‘é‡ï¼Œåˆ™ç›’å­æŠŠå†°æ·‡æ·‹â€œå‹å€’äº†â€ã€‚æˆ–å¯çœ‹æœ€åç»“æœçš„è¡Œæ•°ï¼Œæ˜¯åˆ†å­çš„è¡Œæ•°ä¾¿æ˜¯åˆ†å­å¸ƒå±€ã€‚ ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¦‚ä¸‹å¸ƒå±€,ä¸”å¯ç”¨è®°å¿†æ–¹æ³•é…åˆå³å›¾å½¢è±¡ç†è§£(ä¸‹é¢æ˜¯ç»“æœï¼‰ï¼š by: Reference 2 by: Reference 2 å½“åˆ†å­ä¸ºçŸ¢é‡ã€çŸ©é˜µæ—¶ï¼Œç»“æœä¸ºåˆ†å­çš„è¡Œï¼›å½“åˆ†å­ä¸ºæ ‡é‡æ—¶ï¼Œç»“æœæ˜¯åˆ†æ¯è½¬ç½®çš„è¡Œã€‚\nVector-by-Vector å¦å¤–æˆ‘ä»¬æœ‰ï¼š\n$\\mathbf{y}=\\begin{bmatrix} y_1 \\\\ y_2 \\\\ \\vdots \\\\ y_m \\end{bmatrix}$ $\\mathbf{x}=\\begin{bmatrix} x_1 \\\\ x_2 \\\\ \\vdots \\\\ x_n \\end{bmatrix}$ ç”± $ \\frac{\\partial \\mathbf{y}}{\\partial \\mathbf{x}}$ è¿ç®—åäº§ç”Ÿmè¡Œnåˆ—çŸ©é˜µï¼š $ \\frac{\\partial \\mathbf{y}}{\\partial \\mathbf{x}} \\stackrel{\\text { def }}{=}\\left[\\begin{array}{cccc}\\frac{\\partial y_{1}}{\\partial x_{1}} \u0026amp; \\frac{\\partial y_{1}}{\\partial x_{2}} \u0026amp; \\ldots \u0026amp; \\frac{\\partial y_{1}}{\\partial x_{n}} \\\\ \\frac{\\partial y_{2}}{\\partial x_{1}} \u0026amp; \\frac{\\partial y_{2}}{\\partial x_{2}} \u0026amp; \\ldots \u0026amp; \\frac{\\partial y_{2}}{\\partial x_{n}} \\\\ \\vdots \u0026amp; \\vdots \u0026amp; \\ddots \u0026amp; \\vdots\\\\ \\frac{\\partial y_{m}}{\\partial x_{1}} \u0026amp; \\frac{\\partial y_{m}}{\\partial x_{2}} \u0026amp; \\ldots \u0026amp; \\frac{\\partial y_{m}}{\\partial x_{n}}\\end{array}\\right] $ è¿™ç§çŸ©é˜µå¯è¢«ç§°ä¸ºJacobian matrixã€‚ æ¥ä¸‹æ¥ä¸¾ä¸ªä¾‹å­ï¼Œè‹¥æˆ‘ä»¬æœ‰ï¼š $$\\mathbf{y}=\\begin{bmatrix} y_1 \\\\ y_2 \\\\ \\end{bmatrix} \\ \\ \\ \\mathbf{x}=\\begin{bmatrix} x_1 \\\\ x_2 \\\\ x_3 \\end{bmatrix}\\ \\ ä¸”y_1=x^2_1-2x_2 \\ ,\\ y_2=x^2_3-4x_2$$ åˆ™èƒ½å¾—åˆ°: $$\\frac{\\partial \\mathbf{y}}{\\partial \\mathbf{x}} =\\begin{bmatrix} 2x_1 \u0026amp; -2 \u0026amp; 0 \\\\ 0 \u0026amp; -4 \u0026amp; 2x_3 \\\\ \\end{bmatrix} $$\nMatrix-by-Scalar åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡ºçŸ©é˜µä¸å‘é‡é—´çš„è¿ç®—å…³ç³»ï¼š $ \\frac{\\partial \\mathbf{Y}}{\\partial {x}} \\stackrel{}{=}\\left[\\begin{array}{cccc}\\frac{\\partial Y_{11}}{\\partial x} \u0026amp; \\frac{\\partial Y_{12}}{\\partial x} \u0026amp; \\ldots \u0026amp; \\frac{\\partial Y_{1n}}{\\partial x} \\\\ \\frac{\\partial Y_{21}}{\\partial x} \u0026amp; \\frac{\\partial Y_{22}}{\\partial x} \u0026amp; \\ldots \u0026amp; \\frac{\\partial Y_{2n}}{\\partial x} \\\\ \\vdots \u0026amp; \\vdots \u0026amp; \\ddots \u0026amp; \\vdots\\\\ \\frac{\\partial Y_{m1}}{\\partial x} \u0026amp; \\frac{\\partial Y_{m2}}{\\partial x} \u0026amp; \\ldots \u0026amp; \\frac{\\partial Y_{mn}}{\\partial x}\\end{array}\\right]$ $ \\ \\ \\ \\ \\ and \\ \\ \\ \\ \\frac{\\partial y}{\\partial\\mathbf{X}} \\stackrel{}{=}\\left[\\begin{array}{cccc}\\frac{\\partial y}{\\partial X_{11}} \u0026amp; \\frac{\\partial y}{\\partial X_{21}} \u0026amp; \\ldots \u0026amp; \\frac{\\partial y}{\\partial X_{m1}} \\\\ \\frac{\\partial y}{\\partial X_{12}} \u0026amp; \\frac{\\partial y}{\\partial X_{22}} \u0026amp; \\ldots \u0026amp; \\frac{\\partial y}{\\partial X_{m2}} \\\\ \\vdots \u0026amp; \\vdots \u0026amp; \\ddots \u0026amp; \\vdots\\\\ \\frac{\\partial y}{\\partial X_{1n}} \u0026amp; \\frac{\\partial y}{\\partial X_{2n}} \u0026amp; \\ldots \u0026amp; \\frac{\\partial y}{\\partial X_{mn}}\\end{array}\\right] $\nå¯ä»¥æ³¨æ„åˆ°å½“çŸ©é˜µåœ¨åˆ†æ¯æ—¶$\\mathrm{X}$å·²ç»â€œè¢«è½¬ç½®â€\nå¸¸ç”¨æ±‚å¯¼å…¬å¼ æ³¨ï¼šå…¶ä¸­$\\mathbf{a},\\mathrm{A}$éƒ½ä¸æ˜¯$\\mathbf{x}, \\mathrm{X}$çš„å‡½æ•° $$\\frac{\\mathrm{d} \\mathbf{a}}{\\mathrm{d} x} =\\mathbf{0} \\tag{1} \\qquad (column \\ matrix)$$ $$\\frac{\\mathrm{d}a }{\\mathrm{d} \\mathbf{x}} =\\mathbf{0}^{\\mathrm{T}} \\tag{2} \\qquad (row \\ matrix)$$ $$\\frac{\\mathrm{d}a }{\\mathrm{d} \\mathbf{X}} =\\mathbf{0}^{\\mathrm{T}} \\tag{3} \\qquad (matrix)$$ $$\\frac{\\mathrm{d} \\mathbf{a} }{\\mathrm{d} \\mathbf{X}} =\\mathbf{0} \\tag{4} \\qquad (matrix)$$ $$\\frac{\\mathrm{d} \\mathbf{x} }{\\mathrm{d} \\mathbf{x}} =\\mathbf{I} \\tag{5} \\qquad (matrix)$$ è‹¥æƒ³ä»â€œç›´è§‚ä¸Šâ€ç†è§£ç»“æœä¸ºä»€ä¹ˆä¼šæœ‰è½¬ç½®ç¬¦ï¼Œå¯ä»¥åå¤ç†è§£ (1.2)åˆ†å­å¸ƒå±€ ä¸­çš„å³å›¾ $$\\frac{\\mathrm{d} \\mathbf{a}^{\\mathrm{T}}\\mathbf{x} }{\\mathrm{d} \\mathbf{x}}=\\frac{\\mathrm{d} \\mathbf{x}^{\\mathrm{T}}\\mathbf{a} }{\\mathrm{d} \\mathbf{x}}=\\mathbf{a}^{\\mathrm{T}} \\tag{6} $$ $$\\frac{\\mathrm{d} \\mathbf{x}^{\\mathrm{T}}\\mathbf{x} }{\\mathrm{d} \\mathbf{x}}=2\\mathbf{x}^{\\mathrm{T}} \\tag{7} $$ $$\\frac{\\mathrm{d} ({\\mathbf{x}^{\\mathrm{T}}\\mathbf{a}})^2 }{\\mathrm{d} \\mathbf{x}}=2\\mathbf{x}^{\\mathrm{T}}\\mathbf{a}\\mathbf{a}^{\\mathrm{T}} \\tag{8} $$ $$\\frac{\\mathrm{d} \\mathbf{Ax} }{\\mathrm{d} \\mathbf{x}} =\\mathbf{A} \\tag{9} $$ $$\\frac{\\mathrm{d} \\mathbf{x}^{\\mathrm{T}}\\mathbf{A} }{\\mathrm{d} \\mathbf{x}}=\\mathbf{A}^{\\mathrm{T}} \\tag{10} $$ $$\\frac{\\mathrm{d} \\mathbf{x}^{\\mathrm{T}}\\mathbf{A}\\mathbf{x} }{\\mathrm{d} \\mathbf{x}}=\\mathbf{x}^{\\mathrm{T}}(\\mathbf{A}+\\mathbf{A}^{\\mathrm{T}}) \\tag{11} $$\næ³¨ï¼šå…¶ä¸­(11)ç”¨åˆ°äº†çŸ©é˜µæ±‚å¯¼ä¸­çš„\u0026quot;è±å¸ƒå°¼å…¹æ³•åˆ™\u0026quot;ï¼ˆä»”ç»†æ€è€ƒå‰è€…çš„è¡Œåˆ—ä¸åè€…çš„è¡Œåˆ—å°±å¯ä»¥æ˜ç™½ï¼‰: $$\\frac{\\partial \\mathbf u^{\\mathrm{T} }\\mathbf v}{\\partial \\mathbf x} = \\mathbf u^{\\mathrm{T}} \\frac{\\partial \\mathbf v}{\\partial \\mathbf x} + \\mathbf v^{\\mathrm{T}}\\frac{\\partial \\mathbf u}{\\partial \\mathbf x}$$\nå®ä¾‹ç»ƒä¹  æˆ‘ä»¬ä¼šå¥½å¥‡ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆå¤§å¤šæ•°æ±‚å¯¼åä»¥åŠæ±‚å¯¼æ—¶å½¢å¼éƒ½æ˜¯è½¬ç½®åœ¨å‰ï¼Ÿ å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå‡è®¾æœ‰å‚æ•°$\\mathbf{\\Theta } =\\begin{bmatrix} \\theta_0\\\\ \\theta_1\\\\ \\theta_2 \\end{bmatrix}$ ä»¥åŠåˆ—å‘é‡$\\mathbf{x}=\\begin{bmatrix} 1 \\\\ x_1 \\\\ x_2 \\end{bmatrix}$ æˆ‘ä»¬å¯ä»¥æŠŠå¤šå…ƒå‡½æ•°è¡¨è¾¾ä¸º$$f(x_1,x_2)=\\Theta^{\\mathrm{T}} \\mathbf{x}=\\theta_0 + \\theta_1x_1 + \\theta_2x_2$$ æ–¹ä¾¿è®¡ç®—ï¼Œä¸”ç¬¦åˆç›®çš„ã€‚åœ¨è®¡ç®—ç»“æœç›´è§‰ä¸­ä¸€å®šè¦ç´§ç´§æŠŠæ¡ç»“æœä¸åˆ†å­ï¼ˆä¸Šä¸‹æ‹‰é•¿ï¼‰åˆ†æ¯ï¼ˆå·¦å³æ‹‰å®½ï¼‰çš„å…³ç³»ã€‚\nå¤šå…ƒçº¿æ€§å›å½’æ¨å¯¼ åœ¨è¥¿ç“œä¹¦ç¬¬ä¸‰ç« å¼€å¤´ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ±‚è§£æœ€å°error$\\ E=(\\boldsymbol{y}-\\mathbf{X}\\boldsymbol{\\hat{w}})^{\\mathrm{T}}(\\boldsymbol{y}-\\mathbf{X}\\boldsymbol{\\hat{w}}) $ å¯¹å…¶å±•å¼€æœ‰ï¼š$$ \\begin{aligned}(\\boldsymbol{y}-\\mathbf{X}\\boldsymbol{\\hat{w}})^{\\mathrm{T}}(\\boldsymbol{y}-\\mathbf{X}\\boldsymbol{\\hat{w}}) \u0026amp;=(\\boldsymbol{y}^{\\mathrm{T}}-\\boldsymbol{\\hat{w}}^{\\mathrm{T}}\\mathbf{X}^{\\mathrm{T}})(\\boldsymbol{y}-\\mathbf{X}\\boldsymbol{\\hat{w}}) \\\\ \u0026amp;= \\boldsymbol{y}^{\\mathrm{T}} \\boldsymbol{y}- (\\boldsymbol{y}^{\\mathrm{T}} \\mathbf{X}) \\boldsymbol{\\hat{w}}-\\boldsymbol{\\hat{w}}^{\\mathrm{T}} (\\mathbf{X}^{\\mathrm{T}} \\boldsymbol{y}) +\\boldsymbol{\\hat{w}}^{\\mathrm{T}} (\\mathbf{X}^{\\mathrm{T}} \\mathbf{X}) \\boldsymbol{\\hat{w}} \\end{aligned}$$\næŠŠæ‹¬å·ä¸­çœ‹ä½œå¸¸æ•°ï¼Œæ¯ä¸€é¡¹åˆ†åˆ«å¯¹ $\\boldsymbol{\\hat{w}}$ æ±‚å¯¼ï¼Œåˆ©ç”¨å…¬å¼$(9),(10),(11)$å¯å¾—: $$ \\frac{\\partial \\boldsymbol{E}_{\\boldsymbol{\\hat{w}}} }{\\partial \\boldsymbol{\\hat{w}}} = -\\boldsymbol{y}^{\\mathrm{T}} \\mathbf{X} - \\boldsymbol{y}^{\\mathrm{T}} \\mathbf{X} + \\boldsymbol{\\hat{w}}^{\\mathrm{T}} [\\mathbf{X}^{\\mathrm{T}} \\mathbf{X}+(\\mathbf{X}^{\\mathrm{T}} \\mathbf{X})^{\\mathrm{T}}] = -2\\boldsymbol{y}^{\\mathrm{T}} \\mathbf{X} + 2\\boldsymbol{\\hat{w}}^{\\mathrm{T}} \\mathbf{X}^{\\mathrm{T}} \\mathbf{X} $$ ä»¤å…¶ç­‰äºé›¶å¯å¾—ï¼š $$\\boldsymbol{y}^{\\mathrm{T}} \\mathbf{X} = \\boldsymbol{\\hat{w}}^{\\mathrm{T}} \\mathbf{X}^{\\mathrm{T}} \\mathbf{X}$$ åŒæ—¶è½¬ç½®å¯å¾—ï¼š $$ \\mathbf{X}^{\\mathrm{T}} \\boldsymbol{y} = \\mathbf{X}^{\\mathrm{T}} \\mathbf{X} \\boldsymbol{\\hat{w}} $$ è‹¥æ­¤æ—¶ $\\mathbf{X}^{\\mathrm{T}} \\mathbf{X}$ ä¸ºæ»¡ç§©ã€éå¥‡å¼‚çŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š $$\\boldsymbol{\\hat{w}}=( \\mathbf{X}^{\\mathrm{T}} \\mathbf{X})^{-1} \\mathbf{X}^{\\mathrm{T}} \\boldsymbol{y} \\\\ \\ \\\\ Q.E.D$$\nä¸Šæ–‡å…¬å¼çš„è¯æ˜è¿‡ç¨‹ å¦‚æœä½ ä¸çŸ¥é“è®¡ç®—ç»“æœæ˜¯å¦æ­£ç¡®ï¼Œå¯ä»¥ä½¿ç”¨éªŒç®—çŸ©é˜µæ±‚å¯¼ç»“æœæ˜¯å¦æ­£ç¡®è¿›è¡ŒéªŒè¯ã€‚ è¯æ˜(6) $$ Let \\; s=\\boldsymbol{a}^T\\mathbf{x}={a}_1x_1+\\cdots +a_nx_n.\\quad Then,\\;\\frac{\\partial s}{\\partial x_i}=a_i \\\\ So,\\:\\frac{\\mathrm{d} \\boldsymbol{a}^{\\mathrm{T}}\\mathbf{x} }{\\mathrm{d} \\mathbf{x}}=\\frac{\\mathrm{d} s}{\\mathrm{d} \\mathbf{x}}=\\left[ \\frac{\\mathrm{d}s}{\\mathrm{d}x_1},\\frac{\\mathrm{d}s}{\\mathrm{d}x_2},\\cdots ,\\frac{\\mathrm{d}s}{\\mathrm{d}x_n} \\right] =\\left[ a_1,a_2,\\cdots ,a_n \\right] =\\boldsymbol{a}^T $$\nè¯æ˜(7) $$ Let \\; s=\\boldsymbol{\\mathbf{x}}^{\\mathrm{T}}\\mathbf{x}=\\sum_i{x_{i}^{2}}. \\quad Then,\\;\\frac{\\partial s}{\\partial x_i}=2x_i \\\\ So, \\;\\; \\frac{\\mathrm{d} s}{\\mathrm{d} \\mathbf{x}}=2\\mathbf{x}^{\\mathrm{T}} $$\nè¯æ˜(8) å½“æˆå¤åˆå‡½æ•°å³å¯ï¼Œç›¸ä¿¡ä½ å¯ä»¥è‡ªå·±è¯æ˜ï¼\nè¯æ˜(9) æ¯”è¾ƒéº»çƒ¦çš„æ–¹æ³•ï¼Œç”±ï¼š $$ \\mathbf{A}\\mathbf{x}=\\left[ \\begin{matrix} a_{11}\u0026amp;\t\\cdots\u0026amp;\ta_{1n}\\\\ \\vdots\u0026amp;\t\\ddots\u0026amp;\t\\vdots\\\\ a_{n1}\u0026amp;\t\\cdots\u0026amp;\ta_{nn}\\\\ \\end{matrix} \\right] \\left[ \\begin{array}{c} x_1\\\\ \\vdots\\\\ x_n\\\\ \\end{array} \\right] =\\left[ \\begin{array}{c} a_{11}x_1+\\cdots +a_{1n}x_n\\\\ \\vdots\\\\ a_{n1}x_1+\\cdots +a_{nn}x_n\\\\ \\end{array} \\right] $$ å†ç”±â€œåˆ†å­å†³å®šè¡Œï¼Œåˆ†æ¯å†³å®šåˆ—ï¼Œåˆ†åˆ«æ±‚å¯¼â€åŸåˆ™ï¼ˆå¦‚æœä¸ç†è§£å¯ä»¥è¿”å›å¼€å¤´å†çœ‹ä¸€éï¼‰ å¾—åˆ°ï¼š $$ \\left[ \\begin{matrix} a_{11}\u0026amp;\t\\cdots\u0026amp;\ta_{1n}\\\\ \\vdots\u0026amp;\t\\ddots\u0026amp;\t\\vdots\\\\ a_{n1}\u0026amp;\t\\cdots\u0026amp;\ta_{nn}\\\\ \\end{matrix} \\right]=\\mathbf{A} $$ æ¯”è¾ƒç®€å•çš„æ–¹æ³•ï¼šï¼ˆç±»ä¼¼ä¸Šé¢çš„è¯æ˜ï¼‰\n$$ Let\\,\\, \\boldsymbol{s}=\\mathbf{A} \\mathbf{x}. \\;\\; Then, s_i=\\sum_j{\\begin{array}{c} a_{ij}x_j\\\\ \\end{array}}, and\\,\\,\\frac{\\partial s_i}{\\partial x_j}=a_{ij}. \\\\ So, \\frac{\\mathrm{d} \\boldsymbol{s}}{\\mathrm{d} \\mathbf{x}}=A. $$\næ³¨é‡Š:æœ‰äº›æƒ…å†µï¼ˆæ¯”å¦‚çŸ©é˜µå¯¹å‘é‡ã€å‘é‡å¯¹çŸ©é˜µã€çŸ©é˜µå¯¹çŸ©é˜µæ±‚å¯¼ï¼‰å¯èƒ½å­˜åœ¨ä¸å¥½è¡¨è¾¾çš„æƒ…å†µï¼ˆè¯¦æƒ…å‚è€ƒReference4)å› ä¸ºåˆ—å‘é‡å¯¹åˆ—å‘é‡æ±‚å¯¼æœ¬è´¨æ˜¯ç”¨é›…å¯æ¯”çŸ©é˜µå®šä¹‰çš„ã€‚åœ¨è¿™é‡Œå»ºè®®ç›´æ¥è®°ä½ç»“æœ,æˆ–è€…ç”¨ç½‘ç«™éªŒè¯ç»“æœï¼›å¦‚æœä¼šç”¨å¼ é‡æŒ‡æ ‡è®¡ç®—ä¹Ÿè¡Œã€‚å¦‚æœä½ æƒ³å­¦ä¹ æ›´ä¸€èˆ¬åœ°åšæ³•ï¼Œå¯ä»¥å‚è€ƒé™„å½•3çš„æ–‡ç« ã€‚\nReference matrix_calculus NTU (Po-Chen Wu) Matrix Differentiation NUS(Leow Wee Kheng) çŸ©é˜µæ±‚å¯¼å…¬å¼çš„æ•°å­¦æ¨å¯¼ï¼ˆçŸ©é˜µæ±‚å¯¼â€”â€”åŸºç¡€ç¯‡ï¼‰ æœºå™¨å­¦ä¹ ä¸­çš„çŸ©é˜µã€å‘é‡æ±‚å¯¼ ","date":"2022-01-12T21:54:58+08:00","permalink":"https://sanbuphy.github.io/p/%E7%9F%A9%E9%98%B5%E6%B1%82%E5%AF%BC%E7%AE%80%E6%98%93%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/","title":"çŸ©é˜µæ±‚å¯¼ç®€æ˜“å…¥é—¨æ‰‹å†Œ"},{"content":" æœ¬æ–‡ä¸ºä¸ªäººå¯¹è¥¿ç“œä¹¦ä¸æˆç†Ÿçš„ä¸€äº›ç†è§£å’Œèµ„æ–™æ•´ç†ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡å‡ºæ„è§ï¼Œè°¢è°¢ï¼(å¯é‚®ç®±è”ç³»physicoada@gmail.com)\nè¥¿ç“œä¹¦ç« èŠ‚ä¸€ ç»ªè®º æ–‡å­—ç‰ˆæµ“ç¼©å¯å‚è€ƒï¼šå‘¨å¿—åæœºå™¨å­¦ä¹ ç¬”è®°1 by:Vay-keen\nç®€æ˜“ç‰ˆæ€ç»´å¯¼å›¾ï¼šå‘¨å¿—åç¬¬ä¸€ç«  by:Sophia-11 å…¶ä¸­ä¸€äº›è®¡ç®—é—®é¢˜:\np21 å¦‚ä½•ç†è§£å‡è®¾ç©ºé—´ è€ƒè™‘åˆ°é€šé…ç¬¦ï¼Œå‡è®¾å¦‚æ–‡ä¸­ä¸€èˆ¬åŸå§‹å‚æ•°çš„å–å€¼åˆ†åˆ«ä¸º3ï¼Œ3ï¼Œ3ï¼›åˆ™æ€»å¯èƒ½å€¼ä¸º(3+1)ï¼ˆ3+1ï¼‰ï¼ˆ3+1ï¼‰+1=65ç§ æˆ–è€…æ›´å¤æ‚ä¸€äº›ï¼Œå¯ä»¥æšä¸¾æ±‚å¾—ï¼šæšä¸¾æ³•ç†è§£ç‰ˆæœ¬ç©ºé—´\np22 å¦‚ä½•ç†è§£ç‰ˆæœ¬ç©ºé—´ ç®€å•è€Œè¨€ï¼Œç‰ˆæœ¬ç©ºé—´ç”¨äºå¯¹å­¦ä¹ å†…å®¹è¿›è¡Œæ”¶æ•›ï¼Œæ˜¯ä¸ºäº†æ”¶æ•›å‡è®¾ç©ºé—´ä»è€Œä½¿å…¶æˆä¸ºä¸æ•°æ®é›†ä¸€è‡´çš„æ‰€æœ‰å‡è®¾çš„å­é›†é›†åˆã€‚æœ¬è´¨æ˜¯ç¼©å‡å‡è®¾èŒƒå›´ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç ”ç©¶é—®é¢˜çš„èŒƒå›´ã€‚æ“ä½œä¸Šå¯å½¢è±¡ç†è§£ä¸ºâ€œçŸ©é˜µè¾¹ç•Œçš„é›†åˆâ€ï¼Œæœ‰ä¸Šä¸‹ç•Œï¼Œéœ€è¦æœ‰ä¸€å®šçš„æ³›åŒ–ç¨‹åº¦ã€‚ ä»å›¾ä¸Šç†è§£ï¼š Photo by WIKI ä»å‡è®¾ç©ºé—´çš„åˆ†å¸ƒç¼©å‡ç†è§£ï¼šversion spaceç®—æ³•\np24 NFLå®šç†çš„æ¨å¯¼ç†è§£ Photo by æˆ‘è‡ªå·± å¦‚æœè¿˜ä¸èƒ½ç†è§£ï¼Œå¯ä»¥å‚è€ƒï¼š\næµ…è°ˆNFLæ²¡æœ‰å…è´¹çš„åˆé¤å®šç†\nNFLå…¬å¼æ¨å¯¼ å¦‚æœè¿˜ä¸èƒ½ç†è§£1/2ï¼Œå¯å‚è€ƒå—ç“œä¹¦ä¸­çš„çœŸå®å‡½æ•°å±•å¼€\nè¥¿ç“œä¹¦ç« èŠ‚äºŒ æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹© æ–‡å­—æµ“ç¼©ç‰ˆå¯å‚è€ƒï¼šæ€§èƒ½åº¦é‡æ–¹æ³• å‡è®¾æ£€éªŒ\u0026amp;æ–¹å·®\u0026amp;åå·®\nåŠ å¼ºç†è§£æŸ¥å‡†ç‡ã€æŸ¥å…¨ç‡ä»¥åŠROCã€AUC ä¸€æ–‡å¸¦ä½ å½»åº•ç†è§£ROCæ›²çº¿å’ŒAUCå€¼ æœ¬æ–‡ç”¨æ‚£ç—…çš„ä¾‹å­ç”ŸåŠ¨å½¢è±¡ç›´è§‚è§£é‡Šäº†æ‰€æœ‰æ¦‚å¿µã€‚ é‚£ä¹ˆï¼ŒROCã€AUCå…·ä½“æ˜¯å¦‚ä½•è®¡ç®—çš„å‘¢ï¼Ÿ è¯·å‚è€ƒå—ç“œä¹¦(2.20)å…¬å¼ï¼Œä»¥åŠ(2.21)ã€‚\np61 å¦‚ä½•ç†è§£å™ªå£°ä¸fç‹¬ç«‹ä»è€Œä½¿å¾—æœ€åé¡¹ä¸º0 Photo by æˆ‘è‡ªå·± Photo by æˆ‘è‡ªå·± å…¶ä»–é—®é¢˜ ä»€ä¹ˆæ˜¯Pé—®é¢˜ã€NPé—®é¢˜å’ŒNPCé—®é¢˜\néƒ¨åˆ†å†…å®¹æœªè¡¥å…¨ï¼Œæ…¢æ…¢è¡¥å…¨\n","date":"2022-01-11T20:53:41+08:00","permalink":"https://sanbuphy.github.io/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%A5%BF%E7%93%9C%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80/","title":"ã€Šæœºå™¨å­¦ä¹ ã€‹è¥¿ç“œä¹¦ç¬”è®°(ä¸€)"},{"content":" æ³¨æ„äº‹é¡¹ åœ¨å¼€å§‹èœå•ï¼Œéœ€è¦ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€git bash åœ¨linuxæ“ä½œä¸­ï¼ˆæ¯”å¦‚gitï¼‰ç²˜è´´æ“ä½œæ˜¯shift+insertæˆ–å•å‡»é¼ æ ‡çš„æ»šè½®ã€‚è€Œå¤åˆ¶åªè¦é€‰ä¸­å³å¯ã€‚ï¼ˆç²˜è´´åä¿®æ”¹å°±å¾ˆéº»çƒ¦äº†ï¼Œæ¨èå…ˆä¿®æ”¹å¥½å†ç²˜è´´ï¼‰ ç”ŸæˆSSHè´¦å·å¯†ç  å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨,å¯ä»¥å…ˆè®¾ç½®gitçš„user nameå’Œemailï¼š\ngit config --global user.name \u0026#34;è¿™é‡Œæ”¹æˆä½ çš„åå­—\u0026#34; git config --global user.email \u0026#34;è¿™é‡Œæ”¹æˆä½ çš„é‚®ç®±\u0026#34; æ¥ä¸‹æ¥å³å¯ç”Ÿæˆsshå¯†é’¥ï¼šï¼ˆæ³¨æ„åˆ«æŠŠ$å’Œ#æ³¨é‡Šéƒ¨åˆ†ä¹Ÿç»™å¤åˆ¶è¿›å»äº†ï¼Œåªéœ€è¦å¤åˆ¶è€ƒè™‘$åé¢çš„éƒ¨åˆ†ï¼‰\n$ ssh-keygen -t rsa -b 4096 -C \u0026#34;è¿™é‡Œæ”¹æˆä½ çš„é‚®ç®±\u0026#34; # -t å¯†é’¥æ–¹å¼è®¾å®š # -b å¯†é’¥å¼ºåº¦è®¾å®š # -C æ³¨é‡Šè®¾å®š # ä½ ä¼šçœ‹åˆ°å‡ºç°ä»¥ä¸‹ä¿¡æ¯ï¼š Generating public/private rsa key pair. Enter file in which to save the key (/Users/ts/.ssh/id_rsa): /Users/ts/.ssh/id_rsa_github # æ­¤æ—¶è¾“å…¥ä½ çš„å¯†é’¥ç”¨æˆ·å(å¯ä»¥æ˜¯é‚®ç®±) Enter passphrase (empty for no passphrase): #æ­¤æ—¶è¾“å…¥ä½ çš„å¯†é’¥å¯†ç  Enter same passphrase again: # å†æ¬¡è¾“å…¥å¯†ç  #ä»¥é˜²ä¸‡ä¸€å¿˜è®°è´¦æˆ·å¯†ç ï¼Œä½ å¯ä»¥è®°åœ¨å…¶ä»–åœ°æ–¹ #çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼Œä¾¿è¯´æ˜ä½ å¤§æ¦‚ç‡ç”ŸæˆæˆåŠŸ Your identification has been saved in id_rsa_github. Your public key has been saved in id_rsa_github.pub. æ¥ä¸‹æ¥éœ€è¦æ£€æŸ¥æˆ‘ä»¬æ˜¯ä¸æ˜¯çœŸçš„ç”ŸæˆæˆåŠŸï¼š\n$ ls -l ~/.ssh #å¦‚æœä½ çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼Œå°±è¯´æ˜å·²ç”ŸæˆæˆåŠŸï¼ˆæ²¡çœ‹åˆ°configä¹Ÿæ²¡å…³ç³»ï¼‰ -rw------- 1 ts staff 938 9 15 22:53 config -rw------- 1 ts staff 3326 11 8 21:52 id_rsa_github #ç§å¯†å¯†é’¥ -rw-r--r-- 1 ts staff 757 11 8 21:52 id_rsa_github.pub #å…¬å¼€å¯†é’¥ æ³¨æ„è¿™ä¸ªè¦ç”¨è®°äº‹æœ¬æ¨¡å¼æ‰“å¼€ï¼Œç„¶ååœ¨ä¸‹ä¸€æ­¥éª¤ä¸­ç²˜è´´ æ³¨æ„ï¼Œè¿™æ—¶å€™å¯èƒ½æ‰¾ä¸åˆ°å¯†é’¥ï¼Œä½†åœ¨æ–‡ä»¶å¤¹ä¸­åˆçœ‹å¾—åˆ°rsaå¯†é’¥æ–‡ä»¶ï¼Œæ­¤æ—¶å¯ä»¥åœ¨ä¸åŒæ–‡ä»¶å¤¹ï¼ˆå¯èƒ½ç”Ÿæˆåœ¨æŸä¸ªå­ç±»æ–‡ä»¶å¤¹å†…ï¼‰å³é”®æ‰“å¼€git bashå†è¾“å…¥ä¸Šè¿°å‘½ä»¤ï¼Œç›´åˆ°èƒ½å‡ºç°ä»¥ä¸Šä¿¡æ¯ä¸ºæ­¢ã€‚ã€è®°ä½æ­¤æ—¶çš„æ–‡ä»¶å¤¹ï¼Œåœ¨ç¬¬å››æ­¥è¿˜æœ‰ç”¨ã€‘\nåœ¨githubæ·»åŠ SSH key è¿™ä¸€æ­¥æ¯”è¾ƒç®€å•ï¼Œåœ¨githubä¸­å³ä¸Šè§’æ‰¾åˆ°settingsï¼Œæ‰¾åˆ°SSH and GPG keysï¼Œå†é€‰æ‹©New SSH keyï¼ŒæŠŠä¸Šä¸€ä¸ªæ­¥éª¤ä¸­çš„å…¬å¼€å¯†é’¥å†…ä¿¡æ¯å…¨éƒ¨ç²˜è´´åˆ°keyä¸­ï¼ŒTitleå¯ä»¥éšä¾¿å†™ã€‚æœ€åç‚¹å‡»Add keyå³å¯å®Œæˆï¼ˆå¦‚æœæƒ³çœ‹å›¾æ–‡æ“ä½œå¯ä»¥å‚è€ƒreferenceï¼‰\næœ€åä¿®æ”¹ä¸éªŒè¯ æ­¤æ—¶å›åˆ°ç¬¬äºŒæ­¥æœ«å°¾ä¸­çš„æ–‡ä»¶å¤¹ï¼Œè¾“å…¥ä»¥ä¸‹ä»£ç ï¼š\n$ vim ~/.ssh/config æ­¤æ—¶å·²åœ¨å‘½ä»¤è¡Œæ ¼å¼ä¸­è¿›å…¥æ–‡ä»¶,ç²˜è´´ä»¥ä¸‹è®¯æ¯ï¼š\nHost github HostName github.com IdentityFile ~/.ssh/id_rsa_github #æŒ‡å®šç§å¯†å¯†é’¥ User git ç²˜è´´åï¼ˆæ­¤æ—¶è¿˜åœ¨æ–‡ä»¶ä¸­ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ESCé”®è·³åˆ°å‘½ä»¤æ¨¡å¼ï¼Œç„¶åè¾“å…¥ä¸‹åˆ—æŒ‡ä»¤ï¼š\n$ :wq #å†’å·æ˜¯å¿…é¡»çš„ï¼Œæ„æ€æ˜¯ä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºvi æœ€åä¿®æ­£æƒé™ï¼š\n$ chmod 600 ~/.ssh/config æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•è¿æ¥ï¼Œé¦–å…ˆç¡®è®¤ssh-agentæ˜¯å¦æ­£å¸¸è¿è¡Œ:\n$ eval \u0026#34;$(ssh-agent -s)\u0026#34; Agent pid 32047 # å‡ºç°ç±»ä¼¼ä¿¡æ¯åˆ™è¡¨ç¤ºæ­£å¸¸è¿è¡Œ $ ssh-add ~/.ssh/id_rsa_github Enter passphrase for /Users/ts/.ssh/id_rsa_github: # æ­¤æ—¶è¾“å…¥ç¬¬äºŒæ­¥ä¸­è®¾å®šçš„å¯†ç  Identity added: /Users/ts/.ssh/id_rsa_github (/Users/ts/.ssh/id_rsa_github) æœ€åè¿›è¡Œè¿æ¥ï¼\n$ ssh -T git@github.com Hi mackerel7! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. #æ­å–œä½ ï¼Œå½“å‡ºç°å¦‚ä¸Šä¿¡æ¯åˆ™è¡¨ç¤ºä½ å·²ç»æˆåŠŸé“¾æ¥ï¼ Reference GitHubã«sshæ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ GitHubå¦‚ä½•é…ç½®SSH Key ","date":"2022-01-05T22:54:06+08:00","permalink":"https://sanbuphy.github.io/p/%E5%88%A9%E7%94%A8git%E7%94%9F%E6%88%90ssh%E5%B9%B6%E4%B8%8Egithub%E8%BF%9E%E6%8E%A5/","title":"åˆ©ç”¨gitç”ŸæˆSSHå¹¶ä¸githubè¿æ¥"},{"content":" æœºå™¨å­¦ä¹ çš„æ•°å­¦åŸºç¡€ åŸºç¡€ä¸ç‰¢åœ°åŠ¨å±±æ‘‡ï¼Œå¥½å¥½æ‰“æ•°ç†åŸºç¡€ï¼ä½†ä¸€å£åƒä¸æˆå¤§èƒ–å­â€”â€” æœ‰ç­”ä¸»æåˆ°ï¼š\nâ€åœ¨å¾ˆå¤šç›¸å…³çš„å›ç­”ä¸­ï¼Œæˆ‘éƒ½ä¸€å†å¼ºè°ƒä¸è¦è¯•å›¾è¡¥è¶³æ•°å­¦çŸ¥è¯†å†å¼€å§‹å­¦ä¹ æœºå™¨å­¦ä¹ ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æœºå™¨å­¦ä¹ è¯¾ç¨‹/ä¹¦ç±éƒ½è¦æ±‚ï¼š\nçº¿æ€§ä»£æ•°ï¼šçŸ©é˜µ/å¼ é‡ä¹˜æ³•ã€æ±‚é€†ï¼Œå¥‡å¼‚å€¼åˆ†è§£/ç‰¹å¾å€¼åˆ†è§£ï¼Œè¡Œåˆ—å¼ï¼ŒèŒƒæ•°ç­‰ ç»Ÿè®¡ä¸æ¦‚ç‡ï¼šæ¦‚ç‡åˆ†å¸ƒï¼Œç‹¬ç«‹æ€§ä¸è´å¶æ–¯ï¼Œæœ€å¤§ä¼¼ç„¶ï¼ˆMLEï¼‰å’Œæœ€å¤§åéªŒä¼°è®¡ï¼ˆMAPï¼‰ç­‰ ä¼˜åŒ–ï¼šçº¿æ€§ä¼˜åŒ–ï¼Œéçº¿æ€§ä¼˜åŒ–(å‡¸ä¼˜åŒ–/éå‡¸ä¼˜åŒ–)ä»¥åŠå…¶è¡ç”Ÿçš„æ±‚è§£æ–¹æ³•å¦‚æ¢¯åº¦ä¸‹é™ã€ç‰›é¡¿æ³•ã€åŸºå› ç®—æ³•å’Œæ¨¡æ‹Ÿé€€ç«ç­‰ å¾®ç§¯åˆ†ï¼šåå¾®åˆ†ï¼Œé“¾å¼æ³•åˆ™ï¼ŒçŸ©é˜µæ±‚å¯¼ç­‰ ä¿¡æ¯è®ºã€æ•°å€¼ç†è®ºç­‰\nä¸€èˆ¬äººå¦‚æœæƒ³è¦æŠŠè¿™äº›çŸ¥è¯†éƒ½è¡¥å…¨å†å¼€å§‹æœºå™¨å­¦ä¹ å¾€å¾€éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå®¹æ˜“åŠé€”è€ŒåºŸã€‚è€Œä¸”è¿™äº›çŸ¥è¯†æ˜¯å·¥å…·ä¸æ˜¯ç›®çš„ï¼Œæˆ‘ä»¬çš„ç›®æ ‡ä¸æ˜¯æˆä¸ºä¼˜åŒ–å¤§å¸ˆã€‚å»ºè®®åœ¨æœºå™¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å“ªé‡Œä¸ä¼šè¡¥å“ªé‡Œï¼Œè¿™æ ·æ›´æœ‰ç›®çš„æ€§ä¸”è€—æ—¶æ›´ä½ã€‚â€ [æœ¬æ–‡åªåŒ…å«å¼€æºéƒ¨åˆ†çš„ä¸‹è½½é“¾æ¥] çº¿æ€§ä»£æ•° Introduction to Linear Algebra é€‚åˆå…¥é—¨ã€ç›¸å¯¹ç®€å•å‹å¥½çš„ä¹¦\nä¸‹è½½åœ°å€ è§†é¢‘æ•™ç¨‹ å°æ¹¾æ¸…åå¤§å­¦ è¶™å•Ÿè¶…æ•™æˆ è¯¾ç¨‹é¦–é¡µ\nçŸ©é˜µæ±‚å¯¼ç›¸å…³ æ¨èä¸€ä¸‹æˆ‘è‡ªå·±å†™çš„å…¥é—¨ï¼šçŸ©é˜µæ±‚å¯¼ç®€æ˜“å…¥é—¨æ‰‹å†Œ å°æ¹¾å¤§å­¦ Matrix Calculu by Po-Chen Wu æˆ‘ä¸ªäººè§‰å¾—æ˜¯ç®€è¦å´é½å…¨çš„é€Ÿæˆpptã€‚ æŸ¥é˜…æ‰‹å†Œï¼šmatrixcookbook åœ¨çº¿è®¡ç®—ä¸éªŒè¯ï¼šMatrixCalculus çº¿æ€§ä»£æ•° æ‹“å±•(åº”ç”¨æ•°å­¦ç³») ç·šæ€§ä»£æ•¸(ä¸€) Linear Algebra I è§†é¢‘åœ°å€ ç·šæ€§ä»£æ•¸(äºŒ) Linear Algebra II è¯¾ç¨‹ç”¨ä¹¦ï¼šLinear Algebra, 4th Edition, S. Friedberg, A. Insel and L. Spence, 2003, Prentice Hall.\næ¦‚ç‡è®ºä¸ç»Ÿè®¡å­¦ æ´ªæ°¸æ·¼ æ¦‚ç‡è®ºä¸ç»Ÿè®¡å­¦ è¯¾ä»¶ä¸ä¹ é¢˜è§£ç­”\nMathematics for Machine Learning æœ¬ä¹¦ä¸»é¡µ ä¸‹è½½åœ°å€ å­¦ä¹ è§†é¢‘åŠå…¶ç¬”è®° æœ¬ä¹¦ç»“æ„ï¼š Part I: Mathematical Foundations Introduction and Motivation\nLinear Algebra Analytic Geometry Matrix Decompositions\nVector Calculus\nProbability and Distribution Continuous Optimization\nPart II: Central Machine Learning Problems When Models Meet Data\nLinear Regression\nDimensionality Reduction with Principal Component Analysis Density Estimation with Gaussian Mixture Models\nClassification with Support Vector Machines\næœºå™¨å­¦ä¹ å…¥é—¨ æå®æ¯…2021æ˜¥æœºå™¨å­¦ä¹ è¯¾ç¨‹ è¯¾ç¨‹åœ°å€ï¼š https://speech.ee.ntu.edu.tw/~hylee/ml/2021-spring.html\nè¯¾ä»¶å’Œèµ„æ–™Githubç‰ˆï¼š https://github.com/Fafa-DL/Lhy_Machine_Learning å¯å‚è€ƒç¬”è®°ï¼š https://github.com/unclestrong/DeepLearning_LHY21_Notes\næœºå™¨å­¦ä¹ å®æˆ˜ï¼šåŸºäºScikit-Learnå’ŒTensorFlow å¥½ä¹¦ï¼Œçœ‹å°±å®Œäº†!!ï¼ˆç¿»è¯‘å¯èƒ½æœ‰æ—¶å€™ä¸é è°±ï¼‰ [æ¶‰åŠåˆ°çš„ä»£ç ]](https://github.com/ageron/handson-ml2)\npythonæœºå™¨å­¦ä¹ æ‰‹å†Œ æœ¬ä¹¦çš„ç‰¹è‰²æ˜¯ä»»åŠ¡åˆ¶å­¦ä¹ \næœºå™¨å­¦ä¹ è¿›é˜¶ æèˆªè€å¸ˆ ç»Ÿè®¡å­¦ä¹  å…¥é—¨é€‰æ‰‹å¯å‚è€ƒå­¦ä¹ è·¯å¾„ Photo by NLPä»å…¥é—¨åˆ°æ”¾å¼ƒ æ·±åº¦å­¦ä¹  å¾…æ›´æ–°ï¼ˆå¼€æ‘†ï¼‰\nè®¡ç®—æœºè§†è§‰ å¾…æ›´æ–°ï¼ˆå¼€æ‘†ï¼‰\nReference å¦‚ä½•ç”¨3ä¸ªæœˆé›¶åŸºç¡€å…¥é—¨ã€Œæœºå™¨å­¦ä¹ ã€ï¼Ÿbyå¾® ä¸‰ä¸ªæœˆä»é›¶å…¥é—¨æ·±åº¦å­¦ä¹ ï¼Œä¿å§†çº§å­¦ä¹ è·¯çº¿å›¾ åˆ˜å»ºå¹³åšå®¢ ","date":"2021-12-31T19:48:48+08:00","image":"https://sanbuphy.github.io/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8%E8%B7%AF%E5%BE%84%E5%8F%8A%E5%85%B6%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/knowledge-3_hu3adb970a553883b0b7ae744c75f65cb9_2096564_120x120_fill_q75_box_smart1.jpg","permalink":"https://sanbuphy.github.io/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8%E8%B7%AF%E5%BE%84%E5%8F%8A%E5%85%B6%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/","title":"æœºå™¨å­¦ä¹ å…¥é—¨è·¯å¾„åŠå…¶æ•°å­¦åŸºç¡€"},{"content":" å‰ç½®è¦æ±‚ ä½ å¯èƒ½éœ€è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨gitï¼Œå¯å‚è€ƒæœ¬åšä¸­çš„æ•™ç¨‹æˆ–è§‚çœ‹ç‹‚ç¥gitç®€å•æ•™ç¨‹ã€‚ ä½ ä¹Ÿè®¸ä¹Ÿæƒ³çŸ¥é“æ€ä¹ˆåˆ©ç”¨GitHub Desktopä¸Šä¼ ä¸œè¥¿åˆ°githubä¸Šï¼Œå¯å‚è€ƒGitHub Desktop çš„ä½¿ç”¨æ•™ç¨‹ è®¤è¯†hugo Hugoæ˜¯ç”±Goè¯­è¨€å®ç°çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ã€‚ç®€å•ã€æ˜“ç”¨ã€é«˜æ•ˆã€æ˜“æ‰©å±•ã€å¿«é€Ÿéƒ¨ç½²ã€‚ ä¸­æ–‡æ–‡æ¡£åœ°å€ï¼š https://www.gohugo.org/ å›¾æ–‡å®‰è£…æ•™ç¨‹1 å›¾æ–‡å®‰è£…æ•™ç¨‹2\nhugoçš„ç»“æ„ hugoçš„åŸºæœ¬ç”¨æ³•å’Œé¡µé¢æ”¹é€ \nhugoä¸­æ–‡å¸®åŠ©æ–‡æ¡£\nçš®è‚¤ä¸‹è½½ https://www.gohugo.org/theme/ æ³¨ï¼šæˆ‘ç”¨çš„æ˜¯hahwul å†™çš„stackï¼š https://github.com/CaiJimmy/hugo-theme-stack\nä¸»é¢˜æ‰‹å†Œ\nå»ºè®®å®‰è£…æ–¹æ³•ï¼š\nhugo new site myblog åœ¨myblog/config.tomlåŠ ä¸€è¡Œ theme=xxxxï¼ˆä¸‹è½½åthemeæ–‡ä»¶å¤¹çš„åï¼‰ ä¸‹è½½æ”¾åˆ°theme æŠŠexampleçš„configå’Œyamlè¦†ç›–æ”¾åˆ°é¦–é¡µï¼ˆé¦–é¡µçš„configæ˜¯ç©ºçš„ï¼‰ hugo server markdownè¯­æ³•æ£€ç´¢ https://www.appinn.com/markdown/#%E5%AE%97%E6%97%A8 å¸¸è§çš„markdownå†™æ³•\nåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ–‡ç«  ä½¿ç”¨ hugo new xxxxx.md æ³¨æ„å‘½åæ—¶ä¸å¯ä»¥ç©ºæ ¼ï¼Œå¯ä»¥ç”¨-ä»£æ›¿\nç„¶åå°±å¯ä»¥ä½¿ç”¨ hugo server æ¥æŸ¥çœ‹æ•ˆæœå•¦ï¼\nå‘å¸ƒä½ çš„åšå®¢ æˆ‘ä»¬å°†ä½¿ç”¨github.ioæ¥ä»£æ›¿æœåŠ¡å™¨ä»¥åŠåŸŸåï¼šæ¨èå‚è€ƒæ•™ç¨‹ å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š\nGitè¦ä¸Šä¼ æˆ–æ‰§è¡Œçš„æ–‡ä»¶å¯ä»¥åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œå³é”®ç©ºç™½åœ°åŒºç‚¹git bash hereä»è€Œå®ç°ç›®å½•å†…æ“ä½œã€‚ åœ¨linuxæ“ä½œä¸­ï¼ˆæ¯”å¦‚gitï¼‰ç²˜è´´æ“ä½œæ˜¯shift+insertæˆ–å•å‡»é¼ æ ‡çš„æ»šè½®ã€‚è€Œå¤åˆ¶åªè¦é€‰ä¸­å³å¯ã€‚ **ã€éå¸¸é‡è¦ã€‘**githubçš„åŸŸååœ°å€ä¸ç”¨æˆ·åå¿…é¡»ä¸€è‡´ï¼Œæ¯”å¦‚ä½ çš„githubåå­—å«sakuraï¼Œé‚£ä¹ˆåŸŸåå¿…é¡»æ˜¯sakura.github.ioã€‚ hugoå‘½ä»¤ hugo --baseUrl=\u0026quot;https://æ”¹ä¸ºä½ çš„åå­—.github.io/\u0026quot;æ‰§è¡Œå®Œåï¼Œä¼šç”Ÿæˆä¸€ä¸ªpublicæ–‡ä»¶å¤¹ï¼Œåœ¨publicæ–‡ä»¶ä¸­æ‰§è¡Œ1.æ“ä½œå³å¯æ¨é€ã€‚ ç”¨gitæ¨é€çš„æ—¶å€™ git pull --rebase origin masterè¯­å¥å¯èƒ½ä¼šå‡ºé”™æ˜¾ç¤ºæ²¡æœ‰æ–‡ä»¶ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œè¿™æ˜¯å› ä¸ºæ­¤æ—¶ç›®æ ‡ä»“åº“æ˜¯ç©ºçš„ï¼Œç›´æ¥ä¸‹ä¸€æ­¥æœ€åï¼Œä½ åªéœ€è¦è¾“å…¥å¯¹åº”ç½‘å€ï¼Œå³å¯çœ‹åˆ°è‡ªå·±çš„å®è´åšå®¢äº†ï¼ *ï¼ˆå¯é€‰ï¼‰å¦‚æœä½ æƒ³ç»™åšå®¢åŠ ä¸Šè¯„è®ºç³»ç»Ÿï¼Œè¯·å‚è€ƒè¿™æ ·çš„æµç¨‹:WALINEä¸”è®°å¾—ä¿®æ”¹config.yamlé…ç½®æ–‡ä»¶ä¸­çš„commitå’Œå¯¹åº”walineé¡¹å³å¯ æ›´æ–°ä½ çš„åšå®¢ åœ¨åšå®¢ç›®å½•ä¸‹ä½¿ç”¨ hugo --baseUrl=\u0026quot;https://æ”¹ä¸ºä½ çš„åå­—.github.io/\u0026quot;è¦†ç›–åŸæ¥çš„publicæ–‡ä»¶å¤¹ è¿›å…¥publicæ–‡ä»¶å¤¹å³é”®git bash åˆ†åˆ«æ‰§è¡Œ git add . // git commit -m \u0026lsquo;å†™ä½ çš„å¤‡æ³¨\u0026rsquo; // git push å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼š ç•Œé¢å‡ºç°404 ä½¿ç”¨Shift+F5å¼ºåˆ¶åˆ·æ–°é¡µé¢ æ£€æŸ¥åŸŸåæ˜¯å¦å’Œgithubçš„åå­—å¯¹åº” githubä¸Šå­˜æ”¾æ–‡ä»¶çš„ä»“åº“æ˜¯å¦åªæœ‰ä¸€ä¸ªåˆ†æ”¯ï¼ˆåˆ›å»ºæ—¶ä¸è¦å‹¾é€‰ç”ŸæˆREADME.md) æ­£å¸¸publicä¸Šä¼ githubä»“åº“åä¼šåªæœ‰ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸”åŒ…å«äº†publicå†…çš„æ‰€æœ‰æ–‡ä»¶ æ–‡ç« çœ‹ä¸åˆ° æ£€æŸ¥æ˜¯å¦æ ¼å¼æ­£ç¡®ï¼Œä½¿ç”¨äº†hugo new xxxx.md æ£€æŸ¥æ˜¯å¦åŒ…å«äº† draft: trueï¼Œè‹¥æœ‰åˆ™åˆ é™¤æˆ–ä½¿ç”¨ hugo server -Dï¼Œè‹¥è‰ç¨¿æ¨¡å¼å¼€å¯æ˜¯çœ‹ä¸åˆ°æ–‡ç« çš„ æ•°å­¦å…¬å¼ä¸æ˜¾ç¤º æ˜¯å¦ä½¿ç”¨äº† math: trueï¼Œæˆ–å°è¯•å¯¼å…¥MathJaxåŒ…ï¼Œå¯å‚è€ƒHugo ã« MathJax ã‚’å°å…¥ã—ã¦æ•°å¼ã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹æˆ–è€…åˆ†ç¦»å¼çš„mathjaxè°ƒç”¨æ–¹æ³•Hugoã§MathJaxã‚’ä½¿ã†MathJaxçš„ä¸­æ–‡æ–‡æ¡£ï¼šhttps://www.gohugo.org/doc/tutorials/mathjax/Mathjaxçš„æ—¥æ–‡æ–‡æ¡£ï¼šhttps://www.eng.niigata-u.ac.jp/~nomoto/download/mathjax.pdf\næ³¨æ„æ­¤æ—¶ \\\\æ¢è¡Œä¸æˆåŠŸçš„è¯ï¼Œç”¨ \\\\\\è¯•è¯•çœ‹ï¼Œæœ‰äº› \\,çš„æ— æ•ˆä¹Ÿå¯ä»¥ç”¨ \\\\,ä»£æ›¿å°è¯•ã€‚\næœ‰æ—¶å€™æ•°å­¦å…¬å¼æ­£ç¡®ä¹Ÿä¼šæ˜¾ç¤ºä¸å‡ºæ¥ï¼Œæ­¤æ—¶ä½ å¯ä»¥æ£€æŸ¥ä»£ç ç•Œé¢æˆ–ç½‘é¡µå…¬å¼å¤„æ˜¯å¦å­˜åœ¨æ–œä½“å¦‚\u0026quot;_j\u0026quot;ï¼Œæ­¤æ—¶æ”¹ä¸º\u0026quot;_j\u0026quot;å³å¯æ¢å¤æ­£å¸¸ï¼Œç‰¹åˆ«æ˜¯_{}æ—¶è¦æ³¨æ„ï¼Œå¯ä»¥æŠŠå¼€å§‹å€¾æ–œçš„ä»£ç ï¼ˆæ‰¾åˆ°è¿™é‡Œçš„\u0026quot;_\u0026quot;)æ”¹ä¸º_{}å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚\næ–‡ç« å›¾ç‰‡åŠ è½½å¾ˆæ…¢ å¯ä»¥å‚è€ƒè¿™ä¸ªæ–‡ç« Hugo Content ä½¿ç”¨å›¾æºã€å‹ç¼©ä¸å·¥å…·ä»‹ç» æ–‡ç« å¤´çœ‹åˆ°äº†ä¸åŒçš„æ ¼å¼æ¯”å¦‚+++ä¸\u0026mdash; Front Matteræ”¯æŒä¸‰ç§æ ¼å¼ï¼Œyamlï¼Œtomlä¸jsonæ–¹å¼ï¼Œä½ å¯ä»¥å‚è€ƒï¼šåŸºç¡€æ–‡ä»¶å’Œå¤´éƒ¨æ ¼å¼ä»‹ç» git pushä¸æˆåŠŸ æ­¤æ—¶å¤§æ¦‚ç‡æ˜¯ç½‘ç»œé€šä¿¡æœ‰é—®é¢˜ï¼Œå¯ä»¥å…³æ‰gitç»ˆç«¯åç§‘å­¦ä¸Šç½‘ï¼›é‡å¯git ç»ˆç«¯åï¼ˆwindowséœ€è¦ï¼Œlinuxç³»ç»Ÿä¸éœ€è¦ï¼‰å†è¿›è¡Œpushå¤§æ¦‚ç‡å°±å¯ä»¥è§£å†³é—®é¢˜äº†ï¼›æ­¤æ—¶æ— éœ€å†è¿›è¡Œgit init ç­‰åˆå§‹åŒ–æ“ä½œå› ä¸ºä¹‹å‰å·²ç»åšå®Œã€‚ ","date":"2021-12-28T18:39:12+08:00","permalink":"https://sanbuphy.github.io/p/%E5%A6%82%E4%BD%95%E8%BF%90%E7%94%A8hugo%E4%B8%8Egithub.io%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/","title":"å¦‚ä½•è¿ç”¨hugoä¸github.ioæ­å»ºä¸ªäººåšå®¢"},{"content":" ç¯å¢ƒé…ç½®ç›¸å…³ anaconda anacondaä¸Jupyter notebookå®‰è£…æ•™ç¨‹https://zhuanlan.zhihu.com/p/37093476 å›½å†…çš„anacondaé•œåƒä¸‹è½½ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/ anacondaæ›´æ–°ä¸ä¸‹è½½åŒ…çš„é•œåƒæºæ›´æ¢ï¼šhttps://zhuanlan.zhihu.com/p/35985834 è®¡ç®—æœºåŸç† ä»äºŒè¿›åˆ¶åˆ°å¤„ç†å™¨åŸç†\nGITå°çŸ¥è¯† è¦ç†Ÿç»ƒä½¿ç”¨ Gitï¼Œææ€•è¦è®°ä½è¿™60ä¸ªå‘½ä»¤ git å…¥é—¨å°çŸ¥è¯†\nå…¶ä»–æ•°å­¦ æ•°å­¦ä¹‹ç¾ç•ªå¤–ç¯‡ï¼šå¹³å‡¡è€Œåˆç¥å¥‡çš„è´å¶æ–¯æ–¹æ³•\n","date":"2021-12-28T18:39:12+08:00","permalink":"https://sanbuphy.github.io/p/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9F%A5%E8%AF%86%E5%BA%93/","title":"æ‚ä¸ƒæ‚å…«çŸ¥è¯†åº“"}]